import{y as k,A as qa,B as qk,C as x,D as Mf,P as bt,F as pe,G as Mr,H as Wx,I as pa,J as La,K as Hx,L as Kk,R as rO,M as iO,N as Nd,O as sO,Q as $U,T as RU,U as OU,W as NU,X as _U,Y as DU,Z as FU,_ as zU,$ as Rde,a0 as Ode,a1 as BU,a2 as Jk,a3 as Nde,a4 as _de,a5 as Be,a6 as Gi,a7 as ip,a8 as Yl,a9 as Dde,aa as yn,ab as uo,ac as ho,ad as fo,ae as po,af as mo,ag as go,ah as yo,ai as xo,aj as So,ak as wo,al as bo,am as vo,an as ko,ao as Co,ap as To,aq as Eo,ar as Mo,as as Io,at as xn,au as Po,av as Ao,aw as $o,ax as Fde,ay as zde,az as Bde,aA as jU,aB as LU,aC as UU,aD as WU,aE as jde,aF as Lde,aG as Ude,aH as Wde,aI as Hde,aJ as sF,aK as qde,aL as HU,aM as Kde,aN as Jde,aO as Vde,aP as Gde,aQ as Yde,aR as Xde,aS as Zde}from"./index-BmDWg6Vj.js";function Qde(r){const e=k.useRef({value:r,previous:r});return k.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var vC="rovingFocusGroup.onEntryFocus",ehe={bubbles:!1,cancelable:!0},qx="RovingFocusGroup",[mP,qU,the]=qk(qx),[nhe,sp]=qa(qx,[the]),[rhe,ihe]=nhe(qx),KU=k.forwardRef((r,e)=>x.jsx(mP.Provider,{scope:r.__scopeRovingFocusGroup,children:x.jsx(mP.Slot,{scope:r.__scopeRovingFocusGroup,children:x.jsx(she,{...r,ref:e})})}));KU.displayName=qx;var she=k.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=r,h=k.useRef(null),f=Mr(e,h),p=Wx(s),[m,g]=pa({prop:o,defaultProp:a??null,onChange:l,caller:qx}),[y,S]=k.useState(!1),w=La(c),b=qU(t),v=k.useRef(!1),[C,E]=k.useState(0);return k.useEffect(()=>{const M=h.current;if(M)return M.addEventListener(vC,w),()=>M.removeEventListener(vC,w)},[w]),x.jsx(rhe,{scope:t,orientation:n,dir:p,loop:i,currentTabStopId:m,onItemFocus:k.useCallback(M=>g(M),[g]),onItemShiftTab:k.useCallback(()=>S(!0),[]),onFocusableItemAdd:k.useCallback(()=>E(M=>M+1),[]),onFocusableItemRemove:k.useCallback(()=>E(M=>M-1),[]),children:x.jsx(bt.div,{tabIndex:y||C===0?-1:0,"data-orientation":n,...d,ref:f,style:{outline:"none",...r.style},onMouseDown:pe(r.onMouseDown,()=>{v.current=!0}),onFocus:pe(r.onFocus,M=>{const P=!v.current;if(M.target===M.currentTarget&&P&&!y){const $=new CustomEvent(vC,ehe);if(M.currentTarget.dispatchEvent($),!$.defaultPrevented){const A=b().filter(B=>B.focusable),O=A.find(B=>B.active),_=A.find(B=>B.id===m),R=[O,_,...A].filter(Boolean).map(B=>B.ref.current);GU(R,u)}}v.current=!1}),onBlur:pe(r.onBlur,()=>S(!1))})})}),JU="RovingFocusGroupItem",VU=k.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:i=!1,tabStopId:s,children:o,...a}=r,l=Mf(),c=s||l,u=ihe(JU,t),d=u.currentTabStopId===c,h=qU(t),{onFocusableItemAdd:f,onFocusableItemRemove:p,currentTabStopId:m}=u;return k.useEffect(()=>{if(n)return f(),()=>p()},[n,f,p]),x.jsx(mP.ItemSlot,{scope:t,id:c,focusable:n,active:i,children:x.jsx(bt.span,{tabIndex:d?0:-1,"data-orientation":u.orientation,...a,ref:e,onMouseDown:pe(r.onMouseDown,g=>{n?u.onItemFocus(c):g.preventDefault()}),onFocus:pe(r.onFocus,()=>u.onItemFocus(c)),onKeyDown:pe(r.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){u.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const y=lhe(g,u.orientation,u.dir);if(y!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let w=h().filter(b=>b.focusable).map(b=>b.ref.current);if(y==="last")w.reverse();else if(y==="prev"||y==="next"){y==="prev"&&w.reverse();const b=w.indexOf(g.currentTarget);w=u.loop?che(w,b+1):w.slice(b+1)}setTimeout(()=>GU(w))}}),children:typeof o=="function"?o({isCurrentTabStop:d,hasTabStop:m!=null}):o})})});VU.displayName=JU;var ohe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ahe(r,e){return e!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function lhe(r,e,t){const n=ahe(r.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return ohe[n]}function GU(r,e=!1){const t=document.activeElement;for(const n of r)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function che(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var oO=KU,Vk=VU;function uhe(r){const e=dhe(r),t=k.forwardRef((n,i)=>{const{children:s,...o}=n,a=k.Children.toArray(s),l=a.find(fhe);if(l){const c=l.props.children,u=a.map(d=>d===l?k.Children.count(c)>1?k.Children.only(null):k.isValidElement(c)?c.props.children:null:d);return x.jsx(e,{...o,ref:i,children:k.isValidElement(c)?k.cloneElement(c,void 0,u):null})}return x.jsx(e,{...o,ref:i,children:s})});return t.displayName=`${r}.Slot`,t}function dhe(r){const e=k.forwardRef((t,n)=>{const{children:i,...s}=t;if(k.isValidElement(i)){const o=mhe(i),a=phe(s,i.props);return i.type!==k.Fragment&&(a.ref=n?Hx(n,o):o),k.cloneElement(i,a)}return k.Children.count(i)>1?k.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var hhe=Symbol("radix.slottable");function fhe(r){return k.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===hhe}function phe(r,e){const t={...e};for(const n in e){const i=r[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...r,...t}}function mhe(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var gP=["Enter"," "],ghe=["ArrowDown","PageUp","Home"],YU=["ArrowUp","PageDown","End"],yhe=[...ghe,...YU],xhe={ltr:[...gP,"ArrowRight"],rtl:[...gP,"ArrowLeft"]},She={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Kx="Menu",[Cy,whe,bhe]=qk(Kx),[_d,Gk]=qa(Kx,[bhe,Kk,sp]),Jx=Kk(),XU=sp(),[ZU,Xl]=_d(Kx),[vhe,Vx]=_d(Kx),QU=r=>{const{__scopeMenu:e,open:t=!1,children:n,dir:i,onOpenChange:s,modal:o=!0}=r,a=Jx(e),[l,c]=k.useState(null),u=k.useRef(!1),d=La(s),h=Wx(i);return k.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),x.jsx(rO,{...a,children:x.jsx(ZU,{scope:e,open:t,onOpenChange:d,content:l,onContentChange:c,children:x.jsx(vhe,{scope:e,onClose:k.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:o,children:n})})})};QU.displayName=Kx;var khe="MenuAnchor",aO=k.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,i=Jx(t);return x.jsx(iO,{...i,...n,ref:e})});aO.displayName=khe;var lO="MenuPortal",[Che,e9]=_d(lO,{forceMount:void 0}),t9=r=>{const{__scopeMenu:e,forceMount:t,children:n,container:i}=r,s=Xl(lO,e);return x.jsx(Che,{scope:e,forceMount:t,children:x.jsx(Nd,{present:t||s.open,children:x.jsx(sO,{asChild:!0,container:i,children:n})})})};t9.displayName=lO;var Bs="MenuContent",[The,cO]=_d(Bs),n9=k.forwardRef((r,e)=>{const t=e9(Bs,r.__scopeMenu),{forceMount:n=t.forceMount,...i}=r,s=Xl(Bs,r.__scopeMenu),o=Vx(Bs,r.__scopeMenu);return x.jsx(Cy.Provider,{scope:r.__scopeMenu,children:x.jsx(Nd,{present:n||s.open,children:x.jsx(Cy.Slot,{scope:r.__scopeMenu,children:o.modal?x.jsx(Ehe,{...i,ref:e}):x.jsx(Mhe,{...i,ref:e})})})})}),Ehe=k.forwardRef((r,e)=>{const t=Xl(Bs,r.__scopeMenu),n=k.useRef(null),i=Mr(e,n);return k.useEffect(()=>{const s=n.current;if(s)return $U(s)},[]),x.jsx(uO,{...r,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:pe(r.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Mhe=k.forwardRef((r,e)=>{const t=Xl(Bs,r.__scopeMenu);return x.jsx(uO,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),Ihe=uhe("MenuContent.ScrollLock"),uO=k.forwardRef((r,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,disableOutsideScroll:p,...m}=r,g=Xl(Bs,t),y=Vx(Bs,t),S=Jx(t),w=XU(t),b=whe(t),[v,C]=k.useState(null),E=k.useRef(null),M=Mr(e,E,g.onContentChange),P=k.useRef(0),$=k.useRef(""),A=k.useRef(0),O=k.useRef(null),_=k.useRef("right"),I=k.useRef(0),R=p?OU:k.Fragment,B=p?{as:Ihe,allowPinchZoom:!0}:void 0,U=L=>{const X=$.current+L,G=b().filter(ne=>!ne.disabled),ce=document.activeElement,ae=G.find(ne=>ne.ref.current===ce)?.textValue,ge=G.map(ne=>ne.textValue),De=jhe(ge,X,ae),Ne=G.find(ne=>ne.textValue===De)?.ref.current;(function ne(ue){$.current=ue,window.clearTimeout(P.current),ue!==""&&(P.current=window.setTimeout(()=>ne(""),1e3))})(X),Ne&&setTimeout(()=>Ne.focus())};k.useEffect(()=>()=>window.clearTimeout(P.current),[]),RU();const H=k.useCallback(L=>_.current===O.current?.side&&Uhe(L,O.current?.area),[]);return x.jsx(The,{scope:t,searchRef:$,onItemEnter:k.useCallback(L=>{H(L)&&L.preventDefault()},[H]),onItemLeave:k.useCallback(L=>{H(L)||(E.current?.focus(),C(null))},[H]),onTriggerLeave:k.useCallback(L=>{H(L)&&L.preventDefault()},[H]),pointerGraceTimerRef:A,onPointerGraceIntentChange:k.useCallback(L=>{O.current=L},[]),children:x.jsx(R,{...B,children:x.jsx(NU,{asChild:!0,trapped:i,onMountAutoFocus:pe(s,L=>{L.preventDefault(),E.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:x.jsx(_U,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,children:x.jsx(oO,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:v,onCurrentTabStopIdChange:C,onEntryFocus:pe(l,L=>{y.isUsingKeyboardRef.current||L.preventDefault()}),preventScrollOnEntryFocus:!0,children:x.jsx(DU,{role:"menu","aria-orientation":"vertical","data-state":S9(g.open),"data-radix-menu-content":"",dir:y.dir,...S,...m,ref:M,style:{outline:"none",...m.style},onKeyDown:pe(m.onKeyDown,L=>{const G=L.target.closest("[data-radix-menu-content]")===L.currentTarget,ce=L.ctrlKey||L.altKey||L.metaKey,ae=L.key.length===1;G&&(L.key==="Tab"&&L.preventDefault(),!ce&&ae&&U(L.key));const ge=E.current;if(L.target!==ge||!yhe.includes(L.key))return;L.preventDefault();const Ne=b().filter(ne=>!ne.disabled).map(ne=>ne.ref.current);YU.includes(L.key)&&Ne.reverse(),zhe(Ne)}),onBlur:pe(r.onBlur,L=>{L.currentTarget.contains(L.target)||(window.clearTimeout(P.current),$.current="")}),onPointerMove:pe(r.onPointerMove,Ty(L=>{const X=L.target,G=I.current!==L.clientX;if(L.currentTarget.contains(X)&&G){const ce=L.clientX>I.current?"right":"left";_.current=ce,I.current=L.clientX}}))})})})})})})});n9.displayName=Bs;var Phe="MenuGroup",dO=k.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return x.jsx(bt.div,{role:"group",...n,ref:e})});dO.displayName=Phe;var Ahe="MenuLabel",r9=k.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return x.jsx(bt.div,{...n,ref:e})});r9.displayName=Ahe;var q0="MenuItem",oF="menu.itemSelect",Yk=k.forwardRef((r,e)=>{const{disabled:t=!1,onSelect:n,...i}=r,s=k.useRef(null),o=Vx(q0,r.__scopeMenu),a=cO(q0,r.__scopeMenu),l=Mr(e,s),c=k.useRef(!1),u=()=>{const d=s.current;if(!t&&d){const h=new CustomEvent(oF,{bubbles:!0,cancelable:!0});d.addEventListener(oF,f=>n?.(f),{once:!0}),FU(d,h),h.defaultPrevented?c.current=!1:o.onClose()}};return x.jsx(i9,{...i,ref:l,disabled:t,onClick:pe(r.onClick,u),onPointerDown:d=>{r.onPointerDown?.(d),c.current=!0},onPointerUp:pe(r.onPointerUp,d=>{c.current||d.currentTarget?.click()}),onKeyDown:pe(r.onKeyDown,d=>{const h=a.searchRef.current!=="";t||h&&d.key===" "||gP.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});Yk.displayName=q0;var i9=k.forwardRef((r,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:i,...s}=r,o=cO(q0,t),a=XU(t),l=k.useRef(null),c=Mr(e,l),[u,d]=k.useState(!1),[h,f]=k.useState("");return k.useEffect(()=>{const p=l.current;p&&f((p.textContent??"").trim())},[s.children]),x.jsx(Cy.ItemSlot,{scope:t,disabled:n,textValue:i??h,children:x.jsx(Vk,{asChild:!0,...a,focusable:!n,children:x.jsx(bt.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...s,ref:c,onPointerMove:pe(r.onPointerMove,Ty(p=>{n?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:pe(r.onPointerLeave,Ty(p=>o.onItemLeave(p))),onFocus:pe(r.onFocus,()=>d(!0)),onBlur:pe(r.onBlur,()=>d(!1))})})})}),$he="MenuCheckboxItem",s9=k.forwardRef((r,e)=>{const{checked:t=!1,onCheckedChange:n,...i}=r;return x.jsx(u9,{scope:r.__scopeMenu,checked:t,children:x.jsx(Yk,{role:"menuitemcheckbox","aria-checked":K0(t)?"mixed":t,...i,ref:e,"data-state":pO(t),onSelect:pe(i.onSelect,()=>n?.(K0(t)?!0:!t),{checkForDefaultPrevented:!1})})})});s9.displayName=$he;var o9="MenuRadioGroup",[Rhe,Ohe]=_d(o9,{value:void 0,onValueChange:()=>{}}),a9=k.forwardRef((r,e)=>{const{value:t,onValueChange:n,...i}=r,s=La(n);return x.jsx(Rhe,{scope:r.__scopeMenu,value:t,onValueChange:s,children:x.jsx(dO,{...i,ref:e})})});a9.displayName=o9;var l9="MenuRadioItem",c9=k.forwardRef((r,e)=>{const{value:t,...n}=r,i=Ohe(l9,r.__scopeMenu),s=t===i.value;return x.jsx(u9,{scope:r.__scopeMenu,checked:s,children:x.jsx(Yk,{role:"menuitemradio","aria-checked":s,...n,ref:e,"data-state":pO(s),onSelect:pe(n.onSelect,()=>i.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});c9.displayName=l9;var hO="MenuItemIndicator",[u9,Nhe]=_d(hO,{checked:!1}),d9=k.forwardRef((r,e)=>{const{__scopeMenu:t,forceMount:n,...i}=r,s=Nhe(hO,t);return x.jsx(Nd,{present:n||K0(s.checked)||s.checked===!0,children:x.jsx(bt.span,{...i,ref:e,"data-state":pO(s.checked)})})});d9.displayName=hO;var _he="MenuSeparator",h9=k.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return x.jsx(bt.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});h9.displayName=_he;var Dhe="MenuArrow",f9=k.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,i=Jx(t);return x.jsx(zU,{...i,...n,ref:e})});f9.displayName=Dhe;var fO="MenuSub",[Fhe,p9]=_d(fO),m9=r=>{const{__scopeMenu:e,children:t,open:n=!1,onOpenChange:i}=r,s=Xl(fO,e),o=Jx(e),[a,l]=k.useState(null),[c,u]=k.useState(null),d=La(i);return k.useEffect(()=>(s.open===!1&&d(!1),()=>d(!1)),[s.open,d]),x.jsx(rO,{...o,children:x.jsx(ZU,{scope:e,open:n,onOpenChange:d,content:c,onContentChange:u,children:x.jsx(Fhe,{scope:e,contentId:Mf(),triggerId:Mf(),trigger:a,onTriggerChange:l,children:t})})})};m9.displayName=fO;var Gp="MenuSubTrigger",g9=k.forwardRef((r,e)=>{const t=Xl(Gp,r.__scopeMenu),n=Vx(Gp,r.__scopeMenu),i=p9(Gp,r.__scopeMenu),s=cO(Gp,r.__scopeMenu),o=k.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=s,c={__scopeMenu:r.__scopeMenu},u=k.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return k.useEffect(()=>u,[u]),k.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),x.jsx(aO,{asChild:!0,...c,children:x.jsx(i9,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":S9(t.open),...r,ref:Hx(e,i.onTriggerChange),onClick:d=>{r.onClick?.(d),!(r.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:pe(r.onPointerMove,Ty(d=>{s.onItemEnter(d),!d.defaultPrevented&&!r.disabled&&!t.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:pe(r.onPointerLeave,Ty(d=>{u();const h=t.content?.getBoundingClientRect();if(h){const f=t.content?.dataset.side,p=f==="right",m=p?-5:5,g=h[p?"left":"right"],y=h[p?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+m,y:d.clientY},{x:g,y:h.top},{x:y,y:h.top},{x:y,y:h.bottom},{x:g,y:h.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:pe(r.onKeyDown,d=>{const h=s.searchRef.current!=="";r.disabled||h&&d.key===" "||xhe[n.dir].includes(d.key)&&(t.onOpenChange(!0),t.content?.focus(),d.preventDefault())})})})});g9.displayName=Gp;var y9="MenuSubContent",x9=k.forwardRef((r,e)=>{const t=e9(Bs,r.__scopeMenu),{forceMount:n=t.forceMount,...i}=r,s=Xl(Bs,r.__scopeMenu),o=Vx(Bs,r.__scopeMenu),a=p9(y9,r.__scopeMenu),l=k.useRef(null),c=Mr(e,l);return x.jsx(Cy.Provider,{scope:r.__scopeMenu,children:x.jsx(Nd,{present:n||s.open,children:x.jsx(Cy.Slot,{scope:r.__scopeMenu,children:x.jsx(uO,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{o.isUsingKeyboardRef.current&&l.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:pe(r.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:pe(r.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:pe(r.onKeyDown,u=>{const d=u.currentTarget.contains(u.target),h=She[o.dir].includes(u.key);d&&h&&(s.onOpenChange(!1),a.trigger?.focus(),u.preventDefault())})})})})})});x9.displayName=y9;function S9(r){return r?"open":"closed"}function K0(r){return r==="indeterminate"}function pO(r){return K0(r)?"indeterminate":r?"checked":"unchecked"}function zhe(r){const e=document.activeElement;for(const t of r)if(t===e||(t.focus(),document.activeElement!==e))return}function Bhe(r,e){return r.map((t,n)=>r[(e+n)%r.length])}function jhe(r,e,t){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=t?r.indexOf(t):-1;let o=Bhe(r,Math.max(s,0));i.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.toLowerCase().startsWith(i.toLowerCase()));return l!==t?l:void 0}function Lhe(r,e){const{x:t,y:n}=r;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>n!=h>n&&t<(d-c)*(n-u)/(h-u)+c&&(i=!i)}return i}function Uhe(r,e){if(!e)return!1;const t={x:r.clientX,y:r.clientY};return Lhe(t,e)}function Ty(r){return e=>e.pointerType==="mouse"?r(e):void 0}var w9=QU,b9=aO,v9=t9,k9=n9,C9=dO,T9=r9,E9=Yk,M9=s9,I9=a9,P9=c9,A9=d9,$9=h9,R9=f9,O9=m9,N9=g9,_9=x9,mO="ContextMenu",[Whe,Xat]=qa(mO,[Gk]),Ir=Gk(),[Hhe,D9]=Whe(mO),F9=r=>{const{__scopeContextMenu:e,children:t,onOpenChange:n,dir:i,modal:s=!0}=r,[o,a]=k.useState(!1),l=Ir(e),c=La(n),u=k.useCallback(d=>{a(d),c(d)},[c]);return x.jsx(Hhe,{scope:e,open:o,onOpenChange:u,modal:s,children:x.jsx(w9,{...l,dir:i,open:o,onOpenChange:u,modal:s,children:t})})};F9.displayName=mO;var z9="ContextMenuTrigger",B9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,disabled:n=!1,...i}=r,s=D9(z9,t),o=Ir(t),a=k.useRef({x:0,y:0}),l=k.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=k.useRef(0),u=k.useCallback(()=>window.clearTimeout(c.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},s.onOpenChange(!0)};return k.useEffect(()=>u,[u]),k.useEffect(()=>void(n&&u()),[n,u]),x.jsxs(x.Fragment,{children:[x.jsx(b9,{...o,virtualRef:l}),x.jsx(bt.span,{"data-state":s.open?"open":"closed","data-disabled":n?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...r.style},onContextMenu:n?r.onContextMenu:pe(r.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:n?r.onPointerDown:pe(r.onPointerDown,LS(h=>{u(),c.current=window.setTimeout(()=>d(h),700)})),onPointerMove:n?r.onPointerMove:pe(r.onPointerMove,LS(u)),onPointerCancel:n?r.onPointerCancel:pe(r.onPointerCancel,LS(u)),onPointerUp:n?r.onPointerUp:pe(r.onPointerUp,LS(u))})]})});B9.displayName=z9;var qhe="ContextMenuPortal",gO=r=>{const{__scopeContextMenu:e,...t}=r,n=Ir(e);return x.jsx(v9,{...n,...t})};gO.displayName=qhe;var j9="ContextMenuContent",L9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=D9(j9,t),s=Ir(t),o=k.useRef(!1);return x.jsx(k9,{...s,...n,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{r.onCloseAutoFocus?.(a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{r.onInteractOutside?.(a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...r.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});L9.displayName=j9;var Khe="ContextMenuGroup",Jhe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(C9,{...i,...n,ref:e})});Jhe.displayName=Khe;var Vhe="ContextMenuLabel",Ghe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(T9,{...i,...n,ref:e})});Ghe.displayName=Vhe;var Yhe="ContextMenuItem",U9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(E9,{...i,...n,ref:e})});U9.displayName=Yhe;var Xhe="ContextMenuCheckboxItem",W9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(M9,{...i,...n,ref:e})});W9.displayName=Xhe;var Zhe="ContextMenuRadioGroup",Qhe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(I9,{...i,...n,ref:e})});Qhe.displayName=Zhe;var efe="ContextMenuRadioItem",tfe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(P9,{...i,...n,ref:e})});tfe.displayName=efe;var nfe="ContextMenuItemIndicator",rfe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(A9,{...i,...n,ref:e})});rfe.displayName=nfe;var ife="ContextMenuSeparator",sfe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx($9,{...i,...n,ref:e})});sfe.displayName=ife;var ofe="ContextMenuArrow",afe=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(R9,{...i,...n,ref:e})});afe.displayName=ofe;var H9="ContextMenuSub",q9=r=>{const{__scopeContextMenu:e,children:t,onOpenChange:n,open:i,defaultOpen:s}=r,o=Ir(e),[a,l]=pa({prop:i,defaultProp:s??!1,onChange:n,caller:H9});return x.jsx(O9,{...o,open:a,onOpenChange:l,children:t})};q9.displayName=H9;var lfe="ContextMenuSubTrigger",K9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(N9,{...i,...n,ref:e})});K9.displayName=lfe;var cfe="ContextMenuSubContent",J9=k.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,i=Ir(t);return x.jsx(_9,{...i,...n,ref:e,style:{...r.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});J9.displayName=cfe;function LS(r){return e=>e.pointerType!=="mouse"?r(e):void 0}var ufe=F9,dfe=B9,hfe=gO,ffe=L9,pfe=U9,mfe=W9,Xk="DropdownMenu",[gfe,Zat]=qa(Xk,[Gk]),Pr=Gk(),[yfe,V9]=gfe(Xk),G9=r=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=r,l=Pr(e),c=k.useRef(null),[u,d]=pa({prop:i,defaultProp:s??!1,onChange:o,caller:Xk});return x.jsx(yfe,{scope:e,triggerId:Mf(),triggerRef:c,contentId:Mf(),open:u,onOpenChange:d,onOpenToggle:k.useCallback(()=>d(h=>!h),[d]),modal:a,children:x.jsx(w9,{...l,open:u,onOpenChange:d,dir:n,modal:a,children:t})})};G9.displayName=Xk;var Y9="DropdownMenuTrigger",X9=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...i}=r,s=V9(Y9,t),o=Pr(t);return x.jsx(b9,{asChild:!0,...o,children:x.jsx(bt.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...i,ref:Hx(e,s.triggerRef),onPointerDown:pe(r.onPointerDown,a=>{!n&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:pe(r.onKeyDown,a=>{n||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});X9.displayName=Y9;var xfe="DropdownMenuPortal",Z9=r=>{const{__scopeDropdownMenu:e,...t}=r,n=Pr(e);return x.jsx(v9,{...n,...t})};Z9.displayName=xfe;var Q9="DropdownMenuContent",e7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=V9(Q9,t),s=Pr(t),o=k.useRef(!1);return x.jsx(k9,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...n,ref:e,onCloseAutoFocus:pe(r.onCloseAutoFocus,a=>{o.current||i.triggerRef.current?.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:pe(r.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(o.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});e7.displayName=Q9;var Sfe="DropdownMenuGroup",wfe=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(C9,{...i,...n,ref:e})});wfe.displayName=Sfe;var bfe="DropdownMenuLabel",vfe=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(T9,{...i,...n,ref:e})});vfe.displayName=bfe;var kfe="DropdownMenuItem",t7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(E9,{...i,...n,ref:e})});t7.displayName=kfe;var Cfe="DropdownMenuCheckboxItem",n7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(M9,{...i,...n,ref:e})});n7.displayName=Cfe;var Tfe="DropdownMenuRadioGroup",Efe=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(I9,{...i,...n,ref:e})});Efe.displayName=Tfe;var Mfe="DropdownMenuRadioItem",Ife=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(P9,{...i,...n,ref:e})});Ife.displayName=Mfe;var Pfe="DropdownMenuItemIndicator",r7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(A9,{...i,...n,ref:e})});r7.displayName=Pfe;var Afe="DropdownMenuSeparator",$fe=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx($9,{...i,...n,ref:e})});$fe.displayName=Afe;var Rfe="DropdownMenuArrow",Ofe=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(R9,{...i,...n,ref:e})});Ofe.displayName=Rfe;var Nfe=r=>{const{__scopeDropdownMenu:e,children:t,open:n,onOpenChange:i,defaultOpen:s}=r,o=Pr(e),[a,l]=pa({prop:n,defaultProp:s??!1,onChange:i,caller:"DropdownMenuSub"});return x.jsx(O9,{...o,open:a,onOpenChange:l,children:t})},_fe="DropdownMenuSubTrigger",i7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(N9,{...i,...n,ref:e})});i7.displayName=_fe;var Dfe="DropdownMenuSubContent",s7=k.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,i=Pr(t);return x.jsx(_9,{...i,...n,ref:e,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});s7.displayName=Dfe;var yO=G9,xO=X9,Zk=Z9,SO=e7,Ffe=t7,o7=n7,zfe=r7,Bfe=Nfe,jfe=i7,Lfe=s7;function a7(r,[e,t]){return Math.min(t,Math.max(e,r))}function Ufe(r){const e=Wfe(r),t=k.forwardRef((n,i)=>{const{children:s,...o}=n,a=k.Children.toArray(s),l=a.find(qfe);if(l){const c=l.props.children,u=a.map(d=>d===l?k.Children.count(c)>1?k.Children.only(null):k.isValidElement(c)?c.props.children:null:d);return x.jsx(e,{...o,ref:i,children:k.isValidElement(c)?k.cloneElement(c,void 0,u):null})}return x.jsx(e,{...o,ref:i,children:s})});return t.displayName=`${r}.Slot`,t}function Wfe(r){const e=k.forwardRef((t,n)=>{const{children:i,...s}=t;if(k.isValidElement(i)){const o=Jfe(i),a=Kfe(s,i.props);return i.type!==k.Fragment&&(a.ref=n?Hx(n,o):o),k.cloneElement(i,a)}return k.Children.count(i)>1?k.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var Hfe=Symbol("radix.slottable");function qfe(r){return k.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Hfe}function Kfe(r,e){const t={...e};for(const n in e){const i=r[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...r,...t}}function Jfe(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var Qk="Popover",[l7,Qat]=qa(Qk,[Kk]),Gx=Kk(),[Vfe,Zl]=l7(Qk),c7=r=>{const{__scopePopover:e,children:t,open:n,defaultOpen:i,onOpenChange:s,modal:o=!1}=r,a=Gx(e),l=k.useRef(null),[c,u]=k.useState(!1),[d,h]=pa({prop:n,defaultProp:i??!1,onChange:s,caller:Qk});return x.jsx(rO,{...a,children:x.jsx(Vfe,{scope:e,contentId:Mf(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:k.useCallback(()=>h(f=>!f),[h]),hasCustomAnchor:c,onCustomAnchorAdd:k.useCallback(()=>u(!0),[]),onCustomAnchorRemove:k.useCallback(()=>u(!1),[]),modal:o,children:t})})};c7.displayName=Qk;var u7="PopoverAnchor",Gfe=k.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,i=Zl(u7,t),s=Gx(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=i;return k.useEffect(()=>(o(),()=>a()),[o,a]),x.jsx(iO,{...s,...n,ref:e})});Gfe.displayName=u7;var d7="PopoverTrigger",h7=k.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,i=Zl(d7,t),s=Gx(t),o=Mr(e,i.triggerRef),a=x.jsx(bt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":y7(i.open),...n,ref:o,onClick:pe(r.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:x.jsx(iO,{asChild:!0,...s,children:a})});h7.displayName=d7;var wO="PopoverPortal",[Yfe,Xfe]=l7(wO,{forceMount:void 0}),f7=r=>{const{__scopePopover:e,forceMount:t,children:n,container:i}=r,s=Zl(wO,e);return x.jsx(Yfe,{scope:e,forceMount:t,children:x.jsx(Nd,{present:t||s.open,children:x.jsx(sO,{asChild:!0,container:i,children:n})})})};f7.displayName=wO;var If="PopoverContent",p7=k.forwardRef((r,e)=>{const t=Xfe(If,r.__scopePopover),{forceMount:n=t.forceMount,...i}=r,s=Zl(If,r.__scopePopover);return x.jsx(Nd,{present:n||s.open,children:s.modal?x.jsx(Qfe,{...i,ref:e}):x.jsx(epe,{...i,ref:e})})});p7.displayName=If;var Zfe=Ufe("PopoverContent.RemoveScroll"),Qfe=k.forwardRef((r,e)=>{const t=Zl(If,r.__scopePopover),n=k.useRef(null),i=Mr(e,n),s=k.useRef(!1);return k.useEffect(()=>{const o=n.current;if(o)return $U(o)},[]),x.jsx(OU,{as:Zfe,allowPinchZoom:!0,children:x.jsx(m7,{...r,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:pe(r.onCloseAutoFocus,o=>{o.preventDefault(),s.current||t.triggerRef.current?.focus()}),onPointerDownOutside:pe(r.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:pe(r.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),epe=k.forwardRef((r,e)=>{const t=Zl(If,r.__scopePopover),n=k.useRef(!1),i=k.useRef(!1);return x.jsx(m7,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{r.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||t.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,i.current=!1},onInteractOutside:s=>{r.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;t.triggerRef.current?.contains(o)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),m7=k.forwardRef((r,e)=>{const{__scopePopover:t,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=r,h=Zl(If,t),f=Gx(t);return RU(),x.jsx(NU,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:i,onUnmountAutoFocus:s,children:x.jsx(_U,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:x.jsx(DU,{"data-state":y7(h.open),role:"dialog",id:h.contentId,...f,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),g7="PopoverClose",tpe=k.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,i=Zl(g7,t);return x.jsx(bt.button,{type:"button",...n,ref:e,onClick:pe(r.onClick,()=>i.onOpenChange(!1))})});tpe.displayName=g7;var npe="PopoverArrow",rpe=k.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,i=Gx(t);return x.jsx(zU,{...i,...n,ref:e})});rpe.displayName=npe;function y7(r){return r?"open":"closed"}var bO=c7,vO=h7,kO=f7,CO=p7,ipe="Separator",aF="horizontal",spe=["horizontal","vertical"],x7=k.forwardRef((r,e)=>{const{decorative:t,orientation:n=aF,...i}=r,s=ope(n)?n:aF,a=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return x.jsx(bt.div,{"data-orientation":s,...a,...i,ref:e})});x7.displayName=ipe;function ope(r){return spe.includes(r)}var ape=x7,S7=["PageUp","PageDown"],w7=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],b7={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},op="Slider",[yP,lpe,cpe]=qk(op),[v7,elt]=qa(op,[cpe]),[upe,e1]=v7(op),k7=k.forwardRef((r,e)=>{const{name:t,min:n=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[n],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:f=!1,form:p,...m}=r,g=k.useRef(new Set),y=k.useRef(0),w=o==="horizontal"?dpe:hpe,[b=[],v]=pa({prop:u,defaultProp:c,onChange:A=>{[...g.current][y.current]?.focus(),d(A)}}),C=k.useRef(b);function E(A){const O=ype(b,A);$(A,O)}function M(A){$(A,y.current)}function P(){const A=C.current[y.current];b[y.current]!==A&&h(b)}function $(A,O,{commit:_}={commit:!1}){const I=bpe(s),R=vpe(Math.round((A-n)/s)*s+n,I),B=a7(R,[n,i]);v((U=[])=>{const H=mpe(U,B,O);if(wpe(H,l*s)){y.current=H.indexOf(B);const L=String(H)!==String(U);return L&&_&&h(H),L?H:U}else return U})}return x.jsx(upe,{scope:r.__scopeSlider,name:t,disabled:a,min:n,max:i,valueIndexToChangeRef:y,thumbs:g.current,values:b,orientation:o,form:p,children:x.jsx(yP.Provider,{scope:r.__scopeSlider,children:x.jsx(yP.Slot,{scope:r.__scopeSlider,children:x.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:e,onPointerDown:pe(m.onPointerDown,()=>{a||(C.current=b)}),min:n,max:i,inverted:f,onSlideStart:a?void 0:E,onSlideMove:a?void 0:M,onSlideEnd:a?void 0:P,onHomeKeyDown:()=>!a&&$(n,0,{commit:!0}),onEndKeyDown:()=>!a&&$(i,b.length-1,{commit:!0}),onStepKeyDown:({event:A,direction:O})=>{if(!a){const R=S7.includes(A.key)||A.shiftKey&&w7.includes(A.key)?10:1,B=y.current,U=b[B],H=s*R*O;$(U+H,B,{commit:!0})}}})})})})});k7.displayName=op;var[C7,T7]=v7(op,{startEdge:"left",endEdge:"right",size:"width",direction:1}),dpe=k.forwardRef((r,e)=>{const{min:t,max:n,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=r,[d,h]=k.useState(null),f=Mr(e,w=>h(w)),p=k.useRef(void 0),m=Wx(i),g=m==="ltr",y=g&&!s||!g&&s;function S(w){const b=p.current||d.getBoundingClientRect(),v=[0,b.width],E=TO(v,y?[t,n]:[n,t]);return p.current=b,E(w-b.left)}return x.jsx(C7,{scope:r.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:x.jsx(E7,{dir:m,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const b=S(w.clientX);o?.(b)},onSlideMove:w=>{const b=S(w.clientX);a?.(b)},onSlideEnd:()=>{p.current=void 0,l?.()},onStepKeyDown:w=>{const v=b7[y?"from-left":"from-right"].includes(w.key);c?.({event:w,direction:v?-1:1})}})})}),hpe=k.forwardRef((r,e)=>{const{min:t,max:n,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=r,u=k.useRef(null),d=Mr(e,u),h=k.useRef(void 0),f=!i;function p(m){const g=h.current||u.current.getBoundingClientRect(),y=[0,g.height],w=TO(y,f?[n,t]:[t,n]);return h.current=g,w(m-g.top)}return x.jsx(C7,{scope:r.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:x.jsx(E7,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const g=p(m.clientY);s?.(g)},onSlideMove:m=>{const g=p(m.clientY);o?.(g)},onSlideEnd:()=>{h.current=void 0,a?.()},onStepKeyDown:m=>{const y=b7[f?"from-bottom":"from-top"].includes(m.key);l?.({event:m,direction:y?-1:1})}})})}),E7=k.forwardRef((r,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=r,u=e1(op,t);return x.jsx(bt.span,{...c,ref:e,onKeyDown:pe(r.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):S7.concat(w7).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:pe(r.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():n(d)}),onPointerMove:pe(r.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:pe(r.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),s(d))})})}),M7="SliderTrack",I7=k.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,i=e1(M7,t);return x.jsx(bt.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...n,ref:e})});I7.displayName=M7;var xP="SliderRange",P7=k.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,i=e1(xP,t),s=T7(xP,t),o=k.useRef(null),a=Mr(e,o),l=i.values.length,c=i.values.map(h=>R7(h,i.min,i.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return x.jsx(bt.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...n,ref:a,style:{...r.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}})});P7.displayName=xP;var SP="SliderThumb",A7=k.forwardRef((r,e)=>{const t=lpe(r.__scopeSlider),[n,i]=k.useState(null),s=Mr(e,a=>i(a)),o=k.useMemo(()=>n?t().findIndex(a=>a.ref.current===n):-1,[t,n]);return x.jsx(fpe,{...r,ref:s,index:o})}),fpe=k.forwardRef((r,e)=>{const{__scopeSlider:t,index:n,name:i,...s}=r,o=e1(SP,t),a=T7(SP,t),[l,c]=k.useState(null),u=Mr(e,S=>c(S)),d=l?o.form||!!l.closest("form"):!0,h=Rde(l),f=o.values[n],p=f===void 0?0:R7(f,o.min,o.max),m=gpe(n,o.values.length),g=h?.[a.size],y=g?xpe(g,p,a.direction):0;return k.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),x.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${y}px)`},children:[x.jsx(yP.ItemSlot,{scope:r.__scopeSlider,children:x.jsx(bt.span,{role:"slider","aria-label":r["aria-label"]||m,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:f===void 0?{display:"none"}:r.style,onFocus:pe(r.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),d&&x.jsx($7,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},n)]})});A7.displayName=SP;var ppe="RadioBubbleInput",$7=k.forwardRef(({__scopeSlider:r,value:e,...t},n)=>{const i=k.useRef(null),s=Mr(i,n),o=Qde(e);return k.useEffect(()=>{const a=i.current;if(!a)return;const l=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&u){const d=new Event("input",{bubbles:!0});u.call(a,e),a.dispatchEvent(d)}},[o,e]),x.jsx(bt.input,{style:{display:"none"},...t,ref:s,defaultValue:e})});$7.displayName=ppe;function mpe(r=[],e,t){const n=[...r];return n[t]=e,n.sort((i,s)=>i-s)}function R7(r,e,t){const s=100/(t-e)*(r-e);return a7(s,[0,100])}function gpe(r,e){return e>2?`Value ${r+1} of ${e}`:e===2?["Minimum","Maximum"][r]:void 0}function ype(r,e){if(r.length===1)return 0;const t=r.map(i=>Math.abs(i-e)),n=Math.min(...t);return t.indexOf(n)}function xpe(r,e,t){const n=r/2,s=TO([0,50],[0,n]);return(n-s(e)*t)*t}function Spe(r){return r.slice(0,-1).map((e,t)=>r[t+1]-e)}function wpe(r,e){if(e>0){const t=Spe(r);return Math.min(...t)>=e}return!0}function TO(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function bpe(r){return(String(r).split(".")[1]||"").length}function vpe(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}var kpe=k7,Cpe=I7,Tpe=P7,Epe=A7;function Mpe(r){const e=Ipe(r),t=k.forwardRef((n,i)=>{const{children:s,...o}=n,a=k.Children.toArray(s),l=a.find(Ape);if(l){const c=l.props.children,u=a.map(d=>d===l?k.Children.count(c)>1?k.Children.only(null):k.isValidElement(c)?c.props.children:null:d);return x.jsx(e,{...o,ref:i,children:k.isValidElement(c)?k.cloneElement(c,void 0,u):null})}return x.jsx(e,{...o,ref:i,children:s})});return t.displayName=`${r}.Slot`,t}var EO=Mpe("Slot");function Ipe(r){const e=k.forwardRef((t,n)=>{const{children:i,...s}=t;if(k.isValidElement(i)){const o=Rpe(i),a=$pe(s,i.props);return i.type!==k.Fragment&&(a.ref=n?Hx(n,o):o),k.cloneElement(i,a)}return k.Children.count(i)>1?k.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var Ppe=Symbol("radix.slottable");function Ape(r){return k.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Ppe}function $pe(r,e){const t={...e};for(const n in e){const i=r[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...r,...t}}function Rpe(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var MO="ToastProvider",[IO,Ope,Npe]=qk("Toast"),[O7,tlt]=qa("Toast",[Npe]),[_pe,t1]=O7(MO),N7=r=>{const{__scopeToast:e,label:t="Notification",duration:n=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:o}=r,[a,l]=k.useState(null),[c,u]=k.useState(0),d=k.useRef(!1),h=k.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${MO}\`. Expected non-empty \`string\`.`),x.jsx(IO.Provider,{scope:e,children:x.jsx(_pe,{scope:e,label:t,duration:n,swipeDirection:i,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:k.useCallback(()=>u(f=>f+1),[]),onToastRemove:k.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};N7.displayName=MO;var _7="ToastViewport",Dpe=["F8"],wP="toast.viewportPause",bP="toast.viewportResume",D7=k.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:n=Dpe,label:i="Notifications ({hotkey})",...s}=r,o=t1(_7,t),a=Ope(t),l=k.useRef(null),c=k.useRef(null),u=k.useRef(null),d=k.useRef(null),h=Mr(e,d,o.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=o.toastCount>0;k.useEffect(()=>{const g=y=>{n.length!==0&&n.every(w=>y[w]||y.code===w)&&d.current?.focus()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[n]),k.useEffect(()=>{const g=l.current,y=d.current;if(p&&g&&y){const S=()=>{if(!o.isClosePausedRef.current){const C=new CustomEvent(wP);y.dispatchEvent(C),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const C=new CustomEvent(bP);y.dispatchEvent(C),o.isClosePausedRef.current=!1}},b=C=>{!g.contains(C.relatedTarget)&&w()},v=()=>{g.contains(document.activeElement)||w()};return g.addEventListener("focusin",S),g.addEventListener("focusout",b),g.addEventListener("pointermove",S),g.addEventListener("pointerleave",v),window.addEventListener("blur",S),window.addEventListener("focus",w),()=>{g.removeEventListener("focusin",S),g.removeEventListener("focusout",b),g.removeEventListener("pointermove",S),g.removeEventListener("pointerleave",v),window.removeEventListener("blur",S),window.removeEventListener("focus",w)}}},[p,o.isClosePausedRef]);const m=k.useCallback(({tabbingDirection:g})=>{const S=a().map(w=>{const b=w.ref.current,v=[b,...Gpe(b)];return g==="forwards"?v:v.reverse()});return(g==="forwards"?S.reverse():S).flat()},[a]);return k.useEffect(()=>{const g=d.current;if(g){const y=S=>{const w=S.altKey||S.ctrlKey||S.metaKey;if(S.key==="Tab"&&!w){const v=document.activeElement,C=S.shiftKey;if(S.target===g&&C){c.current?.focus();return}const P=m({tabbingDirection:C?"backwards":"forwards"}),$=P.findIndex(A=>A===v);kC(P.slice($+1))?S.preventDefault():C?c.current?.focus():u.current?.focus()}};return g.addEventListener("keydown",y),()=>g.removeEventListener("keydown",y)}},[a,m]),x.jsxs(Ode,{ref:l,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&x.jsx(vP,{ref:c,onFocusFromOutsideViewport:()=>{const g=m({tabbingDirection:"forwards"});kC(g)}}),x.jsx(IO.Slot,{scope:t,children:x.jsx(bt.ol,{tabIndex:-1,...s,ref:h})}),p&&x.jsx(vP,{ref:u,onFocusFromOutsideViewport:()=>{const g=m({tabbingDirection:"backwards"});kC(g)}})]})});D7.displayName=_7;var F7="ToastFocusProxy",vP=k.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:n,...i}=r,s=t1(F7,t);return x.jsx(BU,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{const a=o.relatedTarget;!s.viewport?.contains(a)&&n()}})});vP.displayName=F7;var Yx="Toast",Fpe="toast.swipeStart",zpe="toast.swipeMove",Bpe="toast.swipeCancel",jpe="toast.swipeEnd",z7=k.forwardRef((r,e)=>{const{forceMount:t,open:n,defaultOpen:i,onOpenChange:s,...o}=r,[a,l]=pa({prop:n,defaultProp:i??!0,onChange:s,caller:Yx});return x.jsx(Nd,{present:t||a,children:x.jsx(Wpe,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:La(r.onPause),onResume:La(r.onResume),onSwipeStart:pe(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:pe(r.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:pe(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:pe(r.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});z7.displayName=Yx;var[Lpe,Upe]=O7(Yx,{onClose(){}}),Wpe=k.forwardRef((r,e)=>{const{__scopeToast:t,type:n="foreground",duration:i,open:s,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...p}=r,m=t1(Yx,t),[g,y]=k.useState(null),S=Mr(e,I=>y(I)),w=k.useRef(null),b=k.useRef(null),v=i||m.duration,C=k.useRef(0),E=k.useRef(v),M=k.useRef(0),{onToastAdd:P,onToastRemove:$}=m,A=La(()=>{g?.contains(document.activeElement)&&m.viewport?.focus(),o()}),O=k.useCallback(I=>{!I||I===1/0||(window.clearTimeout(M.current),C.current=new Date().getTime(),M.current=window.setTimeout(A,I))},[A]);k.useEffect(()=>{const I=m.viewport;if(I){const R=()=>{O(E.current),c?.()},B=()=>{const U=new Date().getTime()-C.current;E.current=E.current-U,window.clearTimeout(M.current),l?.()};return I.addEventListener(wP,B),I.addEventListener(bP,R),()=>{I.removeEventListener(wP,B),I.removeEventListener(bP,R)}}},[m.viewport,v,l,c,O]),k.useEffect(()=>{s&&!m.isClosePausedRef.current&&O(v)},[s,v,m.isClosePausedRef,O]),k.useEffect(()=>(P(),()=>$()),[P,$]);const _=k.useMemo(()=>g?q7(g):null,[g]);return m.viewport?x.jsxs(x.Fragment,{children:[_&&x.jsx(Hpe,{__scopeToast:t,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:_}),x.jsx(Lpe,{scope:t,onClose:A,children:Jk.createPortal(x.jsx(IO.ItemSlot,{scope:t,children:x.jsx(Nde,{asChild:!0,onEscapeKeyDown:pe(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||A(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:x.jsx(bt.li,{tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":m.swipeDirection,...p,ref:S,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:pe(r.onKeyDown,I=>{I.key==="Escape"&&(a?.(I.nativeEvent),I.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,A()))}),onPointerDown:pe(r.onPointerDown,I=>{I.button===0&&(w.current={x:I.clientX,y:I.clientY})}),onPointerMove:pe(r.onPointerMove,I=>{if(!w.current)return;const R=I.clientX-w.current.x,B=I.clientY-w.current.y,U=!!b.current,H=["left","right"].includes(m.swipeDirection),L=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,X=H?L(0,R):0,G=H?0:L(0,B),ce=I.pointerType==="touch"?10:2,ae={x:X,y:G},ge={originalEvent:I,delta:ae};U?(b.current=ae,US(zpe,d,ge,{discrete:!1})):lF(ae,m.swipeDirection,ce)?(b.current=ae,US(Fpe,u,ge,{discrete:!1}),I.target.setPointerCapture(I.pointerId)):(Math.abs(R)>ce||Math.abs(B)>ce)&&(w.current=null)}),onPointerUp:pe(r.onPointerUp,I=>{const R=b.current,B=I.target;if(B.hasPointerCapture(I.pointerId)&&B.releasePointerCapture(I.pointerId),b.current=null,w.current=null,R){const U=I.currentTarget,H={originalEvent:I,delta:R};lF(R,m.swipeDirection,m.swipeThreshold)?US(jpe,f,H,{discrete:!0}):US(Bpe,h,H,{discrete:!0}),U.addEventListener("click",L=>L.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),Hpe=r=>{const{__scopeToast:e,children:t,...n}=r,i=t1(Yx,e),[s,o]=k.useState(!1),[a,l]=k.useState(!1);return Jpe(()=>o(!0)),k.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:x.jsx(sO,{asChild:!0,children:x.jsx(BU,{...n,children:s&&x.jsxs(x.Fragment,{children:[i.label," ",t]})})})},qpe="ToastTitle",B7=k.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return x.jsx(bt.div,{...n,ref:e})});B7.displayName=qpe;var Kpe="ToastDescription",j7=k.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return x.jsx(bt.div,{...n,ref:e})});j7.displayName=Kpe;var L7="ToastAction",U7=k.forwardRef((r,e)=>{const{altText:t,...n}=r;return t.trim()?x.jsx(H7,{altText:t,asChild:!0,children:x.jsx(PO,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${L7}\`. Expected non-empty \`string\`.`),null)});U7.displayName=L7;var W7="ToastClose",PO=k.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r,i=Upe(W7,t);return x.jsx(H7,{asChild:!0,children:x.jsx(bt.button,{type:"button",...n,ref:e,onClick:pe(r.onClick,i.onClose)})})});PO.displayName=W7;var H7=k.forwardRef((r,e)=>{const{__scopeToast:t,altText:n,...i}=r;return x.jsx(bt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...i,ref:e})});function q7(r){const e=[];return Array.from(r.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),Vpe(n)){const i=n.ariaHidden||n.hidden||n.style.display==="none",s=n.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const o=n.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...q7(n))}}),e}function US(r,e,t,{discrete:n}){const i=t.originalEvent.currentTarget,s=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(r,e,{once:!0}),n?FU(i,s):i.dispatchEvent(s)}var lF=(r,e,t=0)=>{const n=Math.abs(r.x),i=Math.abs(r.y),s=n>i;return e==="left"||e==="right"?s&&n>t:!s&&i>t};function Jpe(r=()=>{}){const e=La(r);_de(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}function Vpe(r){return r.nodeType===r.ELEMENT_NODE}function Gpe(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const i=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||i?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function kC(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var Ype=N7,Xpe=z7,Zpe=B7,Qpe=j7,eme=U7,cF=PO,K7="Toggle",J7=k.forwardRef((r,e)=>{const{pressed:t,defaultPressed:n,onPressedChange:i,...s}=r,[o,a]=pa({prop:t,onChange:i,defaultProp:n??!1,caller:K7});return x.jsx(bt.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":r.disabled?"":void 0,...s,ref:e,onClick:pe(r.onClick,()=>{r.disabled||a(!o)})})});J7.displayName=K7;var Ql="ToggleGroup",[V7,G7]=qa(Ql,[sp]),Y7=sp(),AO=Be.forwardRef((r,e)=>{const{type:t,...n}=r;if(t==="single"){const i=n;return x.jsx(tme,{...i,ref:e})}if(t==="multiple"){const i=n;return x.jsx(nme,{...i,ref:e})}throw new Error(`Missing prop \`type\` expected on \`${Ql}\``)});AO.displayName=Ql;var[X7,Z7]=V7(Ql),tme=Be.forwardRef((r,e)=>{const{value:t,defaultValue:n,onValueChange:i=()=>{},...s}=r,[o,a]=pa({prop:t,defaultProp:n??"",onChange:i,caller:Ql});return x.jsx(X7,{scope:r.__scopeToggleGroup,type:"single",value:Be.useMemo(()=>o?[o]:[],[o]),onItemActivate:a,onItemDeactivate:Be.useCallback(()=>a(""),[a]),children:x.jsx(Q7,{...s,ref:e})})}),nme=Be.forwardRef((r,e)=>{const{value:t,defaultValue:n,onValueChange:i=()=>{},...s}=r,[o,a]=pa({prop:t,defaultProp:n??[],onChange:i,caller:Ql}),l=Be.useCallback(u=>a((d=[])=>[...d,u]),[a]),c=Be.useCallback(u=>a((d=[])=>d.filter(h=>h!==u)),[a]);return x.jsx(X7,{scope:r.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:l,onItemDeactivate:c,children:x.jsx(Q7,{...s,ref:e})})});AO.displayName=Ql;var[rme,ime]=V7(Ql),Q7=Be.forwardRef((r,e)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:i=!0,orientation:s,dir:o,loop:a=!0,...l}=r,c=Y7(t),u=Wx(o),d={role:"group",dir:u,...l};return x.jsx(rme,{scope:t,rovingFocus:i,disabled:n,children:i?x.jsx(oO,{asChild:!0,...c,orientation:s,dir:u,loop:a,children:x.jsx(bt.div,{...d,ref:e})}):x.jsx(bt.div,{...d,ref:e})})}),J0="ToggleGroupItem",eW=Be.forwardRef((r,e)=>{const t=Z7(J0,r.__scopeToggleGroup),n=ime(J0,r.__scopeToggleGroup),i=Y7(r.__scopeToggleGroup),s=t.value.includes(r.value),o=n.disabled||r.disabled,a={...r,pressed:s,disabled:o},l=Be.useRef(null);return n.rovingFocus?x.jsx(Vk,{asChild:!0,...i,focusable:!o,active:s,ref:l,children:x.jsx(uF,{...a,ref:e})}):x.jsx(uF,{...a,ref:e})});eW.displayName=J0;var uF=Be.forwardRef((r,e)=>{const{__scopeToggleGroup:t,value:n,...i}=r,s=Z7(J0,t),o={role:"radio","aria-checked":r.pressed,"aria-pressed":void 0},a=s.type==="single"?o:void 0;return x.jsx(J7,{...a,...i,ref:e,onPressedChange:l=>{l?s.onItemActivate(n):s.onItemDeactivate(n)}})}),sme=AO,ome=eW,$O="Toolbar",[ame,nlt]=qa($O,[sp,G7]),RO=sp(),tW=G7(),[lme,nW]=ame($O),rW=k.forwardRef((r,e)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:i,loop:s=!0,...o}=r,a=RO(t),l=Wx(i);return x.jsx(lme,{scope:t,orientation:n,dir:l,children:x.jsx(oO,{asChild:!0,...a,orientation:n,dir:l,loop:s,children:x.jsx(bt.div,{role:"toolbar","aria-orientation":n,dir:l,...o,ref:e})})})});rW.displayName=$O;var iW="ToolbarSeparator",cme=k.forwardRef((r,e)=>{const{__scopeToolbar:t,...n}=r,i=nW(iW,t);return x.jsx(ape,{orientation:i.orientation==="horizontal"?"vertical":"horizontal",...n,ref:e})});cme.displayName=iW;var ume="ToolbarButton",OO=k.forwardRef((r,e)=>{const{__scopeToolbar:t,...n}=r,i=RO(t);return x.jsx(Vk,{asChild:!0,...i,focusable:!r.disabled,children:x.jsx(bt.button,{type:"button",...n,ref:e})})});OO.displayName=ume;var dme="ToolbarLink",hme=k.forwardRef((r,e)=>{const{__scopeToolbar:t,...n}=r,i=RO(t);return x.jsx(Vk,{asChild:!0,...i,focusable:!0,children:x.jsx(bt.a,{...n,ref:e,onKeyDown:pe(r.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});hme.displayName=dme;var sW="ToolbarToggleGroup",oW=k.forwardRef((r,e)=>{const{__scopeToolbar:t,...n}=r,i=nW(sW,t),s=tW(t);return x.jsx(sme,{"data-orientation":i.orientation,dir:i.dir,...s,...n,ref:e,rovingFocus:!1})});oW.displayName=sW;var fme="ToolbarToggleItem",aW=k.forwardRef((r,e)=>{const{__scopeToolbar:t,...n}=r,i=tW(t),s={__scopeToolbar:r.__scopeToolbar};return x.jsx(OO,{asChild:!0,...s,children:x.jsx(ome,{...i,...n,ref:e})})});aW.displayName=fme;var pme=rW,mme=OO,gme=oW,yme=aW;const CC="__TLDRAW_LIBRARY_VERSIONS__";function xme(){if(globalThis[CC])return globalThis[CC];const r={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,CC,{value:r,writable:!1,configurable:!1,enumerable:!1}),r}function ec(r,e,t){if(!r||!e||!t)throw new Error("Missing name/version/module system in built version of tldraw library");const n=xme();if(n.versions.push({name:r,version:e,modules:t}),!n.scheduledNotice)try{n.scheduledNotice=setTimeout(()=>{n.scheduledNotice=null,dF(n)},100)}catch{dF(n)}}function dF(r){if(!r.versions.length||r.didWarn)return;const e=r.versions.sort((a,l)=>hF(a.version,l.version)),t=e[e.length-1].version,n=new Set,i=new Map;for(const a of e){if(i.has(a.name)){n.delete(a.name),TC(i,a.name,new Set).add(a.version);continue}a.version===t?n.add(a.name):(n.delete(a.name),TC(i,a.name,new Set).add(a.version))}if(i.size>0){const a=[`${Pa("[tldraw]",["bold","bgRed","textWhite"])} ${Pa("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${Pa(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(n,l=>`    ${Pa(l,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([l,c])=>{const u=Array.from(c).sort(hF).map(d=>Pa(`v${d}`,d===t?["textGreen"]:["textRed"]));return`    ${Pa(l,["bold"])} (${u.join(", ")})`})];console.log(a.join(`
`)),r.didWarn=!0;return}const s=new Map;for(const a of e)TC(s,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const o=new Map;for(const[a,l]of s)l.modules.length>1&&o.set(a,l);if(o.size>0){const a=[`${Pa("[tldraw]",["bold","bgRed","textWhite"])} ${Pa("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([l,c])=>{const u=c.modules.map((d,h)=>d==="esm"?`      ${h+1}. ES Modules`:`      ${h+1}. CommonJS`).join(`
`);return`    ${Pa(l,["bold"])} v${c.version}: 
${u}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),r.didWarn=!0;return}}function hF(r,e){const t=r.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),n=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!n?r.localeCompare(e):t[1]!==n[1]?Number(t[1])-Number(n[1]):t[2]!==n[2]?Number(t[2])-Number(n[2]):t[3]!==n[3]?Number(t[3])-Number(n[3]):t[4]&&n[4]?t[4].localeCompare(n[4]):t[4]?1:n[4]?-1:0}const Sme={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function Pa(r,e=[]){return`\x1B[${e.map(t=>Sme[t]).join(";")}m${r}\x1B[m`}function TC(r,e,t){return r.has(e)?r.get(e):(r.set(e,t),t)}var Yp={exports:{}};Yp.exports;var fF;function wme(){return fF||(fF=1,(function(r,e){var t=200,n="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Function]",f="[object GeneratorFunction]",p="[object Map]",m="[object Number]",g="[object Object]",y="[object Promise]",S="[object RegExp]",w="[object Set]",b="[object String]",v="[object Symbol]",C="[object WeakMap]",E="[object ArrayBuffer]",M="[object DataView]",P="[object Float32Array]",$="[object Float64Array]",A="[object Int8Array]",O="[object Int16Array]",_="[object Int32Array]",I="[object Uint8Array]",R="[object Uint8ClampedArray]",B="[object Uint16Array]",U="[object Uint32Array]",H=/[\\^$.*+?()[\]{}|]/g,L=/^\[object .+?Constructor\]$/,X=/^(?:0|[1-9]\d*)$/,G={};G[P]=G[$]=G[A]=G[O]=G[_]=G[I]=G[R]=G[B]=G[U]=!0,G[a]=G[l]=G[E]=G[c]=G[M]=G[u]=G[d]=G[h]=G[p]=G[m]=G[g]=G[S]=G[w]=G[b]=G[C]=!1;var ce=typeof Gi=="object"&&Gi&&Gi.Object===Object&&Gi,ae=typeof self=="object"&&self&&self.Object===Object&&self,ge=ce||ae||Function("return this")(),De=e&&!e.nodeType&&e,Ne=De&&!0&&r&&!r.nodeType&&r,ne=Ne&&Ne.exports===De,ue=ne&&ce.process,ze=(function(){try{return ue&&ue.binding("util")}catch{}})(),xe=ze&&ze.isTypedArray;function hn(N,j){for(var Y=-1,me=N?N.length:0;++Y<me;)if(j(N[Y],Y,N))return!0;return!1}function An(N,j){for(var Y=-1,me=Array(N);++Y<N;)me[Y]=j(Y);return me}function Bt(N){return function(j){return N(j)}}function Rt(N,j){return N?.[j]}function Ot(N){var j=!1;if(N!=null&&typeof N.toString!="function")try{j=!!(N+"")}catch{}return j}function Jr(N){var j=-1,Y=Array(N.size);return N.forEach(function(me,wn){Y[++j]=[wn,me]}),Y}function Vr(N,j){return function(Y){return N(j(Y))}}function rs(N){var j=-1,Y=Array(N.size);return N.forEach(function(me){Y[++j]=me}),Y}var Js=Array.prototype,Fo=Function.prototype,zo=Object.prototype,Ap=ge["__core-js_shared__"],$S=(function(){var N=/[^.]+$/.exec(Ap&&Ap.keys&&Ap.keys.IE_PROTO||"");return N?"Symbol(src)_1."+N:""})(),RS=Fo.toString,Vs=zo.hasOwnProperty,Uc=zo.toString,yC=RegExp("^"+RS.call(Vs).replace(H,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$p=ge.Symbol,OS=ge.Uint8Array,W=zo.propertyIsEnumerable,Z=Js.splice,Fe=Vr(Object.keys,Object),Et=Xd(ge,"DataView"),Cs=Xd(ge,"Map"),Gs=Xd(ge,"Promise"),Yd=Xd(ge,"Set"),Bo=Xd(ge,"WeakMap"),is=Xd(Object,"create"),NS=Kc(Et),il=Kc(Cs),Wc=Kc(Gs),_S=Kc(Yd),Jue=Kc(Bo),YD=$p?$p.prototype:void 0,xC=YD?YD.valueOf:void 0;function Hc(N){var j=-1,Y=N?N.length:0;for(this.clear();++j<Y;){var me=N[j];this.set(me[0],me[1])}}function Vue(){this.__data__=is?is(null):{}}function Gue(N){return this.has(N)&&delete this.__data__[N]}function Yue(N){var j=this.__data__;if(is){var Y=j[N];return Y===n?void 0:Y}return Vs.call(j,N)?j[N]:void 0}function Xue(N){var j=this.__data__;return is?j[N]!==void 0:Vs.call(j,N)}function Zue(N,j){var Y=this.__data__;return Y[N]=is&&j===void 0?n:j,this}Hc.prototype.clear=Vue,Hc.prototype.delete=Gue,Hc.prototype.get=Yue,Hc.prototype.has=Xue,Hc.prototype.set=Zue;function Ma(N){var j=-1,Y=N?N.length:0;for(this.clear();++j<Y;){var me=N[j];this.set(me[0],me[1])}}function Que(){this.__data__=[]}function ede(N){var j=this.__data__,Y=FS(j,N);if(Y<0)return!1;var me=j.length-1;return Y==me?j.pop():Z.call(j,Y,1),!0}function tde(N){var j=this.__data__,Y=FS(j,N);return Y<0?void 0:j[Y][1]}function nde(N){return FS(this.__data__,N)>-1}function rde(N,j){var Y=this.__data__,me=FS(Y,N);return me<0?Y.push([N,j]):Y[me][1]=j,this}Ma.prototype.clear=Que,Ma.prototype.delete=ede,Ma.prototype.get=tde,Ma.prototype.has=nde,Ma.prototype.set=rde;function qc(N){var j=-1,Y=N?N.length:0;for(this.clear();++j<Y;){var me=N[j];this.set(me[0],me[1])}}function ide(){this.__data__={hash:new Hc,map:new(Cs||Ma),string:new Hc}}function sde(N){return zS(this,N).delete(N)}function ode(N){return zS(this,N).get(N)}function ade(N){return zS(this,N).has(N)}function lde(N,j){return zS(this,N).set(N,j),this}qc.prototype.clear=ide,qc.prototype.delete=sde,qc.prototype.get=ode,qc.prototype.has=ade,qc.prototype.set=lde;function DS(N){var j=-1,Y=N?N.length:0;for(this.__data__=new qc;++j<Y;)this.add(N[j])}function cde(N){return this.__data__.set(N,n),this}function ude(N){return this.__data__.has(N)}DS.prototype.add=DS.prototype.push=cde,DS.prototype.has=ude;function sl(N){this.__data__=new Ma(N)}function dde(){this.__data__=new Ma}function hde(N){return this.__data__.delete(N)}function fde(N){return this.__data__.get(N)}function pde(N){return this.__data__.has(N)}function mde(N,j){var Y=this.__data__;if(Y instanceof Ma){var me=Y.__data__;if(!Cs||me.length<t-1)return me.push([N,j]),this;Y=this.__data__=new qc(me)}return Y.set(N,j),this}sl.prototype.clear=dde,sl.prototype.delete=hde,sl.prototype.get=fde,sl.prototype.has=pde,sl.prototype.set=mde;function gde(N,j){var Y=SC(N)||Ide(N)?An(N.length,String):[],me=Y.length,wn=!!me;for(var tt in N)Vs.call(N,tt)&&!(wn&&(tt=="length"||Cde(tt,me)))&&Y.push(tt);return Y}function FS(N,j){for(var Y=N.length;Y--;)if(QD(N[Y][0],j))return Y;return-1}function yde(N){return Uc.call(N)}function XD(N,j,Y,me,wn){return N===j?!0:N==null||j==null||!wC(N)&&!bC(j)?N!==N&&j!==j:xde(N,j,XD,Y,me,wn)}function xde(N,j,Y,me,wn,tt){var Gr=SC(N),Li=SC(j),lr=l,Ui=l;Gr||(lr=ol(N),lr=lr==a?g:lr),Li||(Ui=ol(j),Ui=Ui==a?g:Ui);var Ts=lr==g&&!Ot(N),Ys=Ui==g&&!Ot(j),Yr=lr==Ui;if(Yr&&!Ts)return tt||(tt=new sl),Gr||$de(N)?ZD(N,j,Y,me,wn,tt):vde(N,j,lr,Y,me,wn,tt);if(!(wn&s)){var Es=Ts&&Vs.call(N,"__wrapped__"),Ms=Ys&&Vs.call(j,"__wrapped__");if(Es||Ms){var al=Es?N.value():N,Ia=Ms?j.value():j;return tt||(tt=new sl),Y(al,Ia,me,wn,tt)}}return Yr?(tt||(tt=new sl),kde(N,j,Y,me,wn,tt)):!1}function Sde(N){if(!wC(N)||Ede(N))return!1;var j=tF(N)||Ot(N)?yC:L;return j.test(Kc(N))}function wde(N){return bC(N)&&nF(N.length)&&!!G[Uc.call(N)]}function bde(N){if(!Mde(N))return Fe(N);var j=[];for(var Y in Object(N))Vs.call(N,Y)&&Y!="constructor"&&j.push(Y);return j}function ZD(N,j,Y,me,wn,tt){var Gr=wn&s,Li=N.length,lr=j.length;if(Li!=lr&&!(Gr&&lr>Li))return!1;var Ui=tt.get(N);if(Ui&&tt.get(j))return Ui==j;var Ts=-1,Ys=!0,Yr=wn&i?new DS:void 0;for(tt.set(N,j),tt.set(j,N);++Ts<Li;){var Es=N[Ts],Ms=j[Ts];if(me)var al=Gr?me(Ms,Es,Ts,j,N,tt):me(Es,Ms,Ts,N,j,tt);if(al!==void 0){if(al)continue;Ys=!1;break}if(Yr){if(!hn(j,function(Ia,Jc){if(!Yr.has(Jc)&&(Es===Ia||Y(Es,Ia,me,wn,tt)))return Yr.add(Jc)})){Ys=!1;break}}else if(!(Es===Ms||Y(Es,Ms,me,wn,tt))){Ys=!1;break}}return tt.delete(N),tt.delete(j),Ys}function vde(N,j,Y,me,wn,tt,Gr){switch(Y){case M:if(N.byteLength!=j.byteLength||N.byteOffset!=j.byteOffset)return!1;N=N.buffer,j=j.buffer;case E:return!(N.byteLength!=j.byteLength||!me(new OS(N),new OS(j)));case c:case u:case m:return QD(+N,+j);case d:return N.name==j.name&&N.message==j.message;case S:case b:return N==j+"";case p:var Li=Jr;case w:var lr=tt&s;if(Li||(Li=rs),N.size!=j.size&&!lr)return!1;var Ui=Gr.get(N);if(Ui)return Ui==j;tt|=i,Gr.set(N,j);var Ts=ZD(Li(N),Li(j),me,wn,tt,Gr);return Gr.delete(N),Ts;case v:if(xC)return xC.call(N)==xC.call(j)}return!1}function kde(N,j,Y,me,wn,tt){var Gr=wn&s,Li=rF(N),lr=Li.length,Ui=rF(j),Ts=Ui.length;if(lr!=Ts&&!Gr)return!1;for(var Ys=lr;Ys--;){var Yr=Li[Ys];if(!(Gr?Yr in j:Vs.call(j,Yr)))return!1}var Es=tt.get(N);if(Es&&tt.get(j))return Es==j;var Ms=!0;tt.set(N,j),tt.set(j,N);for(var al=Gr;++Ys<lr;){Yr=Li[Ys];var Ia=N[Yr],Jc=j[Yr];if(me)var iF=Gr?me(Jc,Ia,Yr,j,N,tt):me(Ia,Jc,Yr,N,j,tt);if(!(iF===void 0?Ia===Jc||Y(Ia,Jc,me,wn,tt):iF)){Ms=!1;break}al||(al=Yr=="constructor")}if(Ms&&!al){var BS=N.constructor,jS=j.constructor;BS!=jS&&"constructor"in N&&"constructor"in j&&!(typeof BS=="function"&&BS instanceof BS&&typeof jS=="function"&&jS instanceof jS)&&(Ms=!1)}return tt.delete(N),tt.delete(j),Ms}function zS(N,j){var Y=N.__data__;return Tde(j)?Y[typeof j=="string"?"string":"hash"]:Y.map}function Xd(N,j){var Y=Rt(N,j);return Sde(Y)?Y:void 0}var ol=yde;(Et&&ol(new Et(new ArrayBuffer(1)))!=M||Cs&&ol(new Cs)!=p||Gs&&ol(Gs.resolve())!=y||Yd&&ol(new Yd)!=w||Bo&&ol(new Bo)!=C)&&(ol=function(N){var j=Uc.call(N),Y=j==g?N.constructor:void 0,me=Y?Kc(Y):void 0;if(me)switch(me){case NS:return M;case il:return p;case Wc:return y;case _S:return w;case Jue:return C}return j});function Cde(N,j){return j=j??o,!!j&&(typeof N=="number"||X.test(N))&&N>-1&&N%1==0&&N<j}function Tde(N){var j=typeof N;return j=="string"||j=="number"||j=="symbol"||j=="boolean"?N!=="__proto__":N===null}function Ede(N){return!!$S&&$S in N}function Mde(N){var j=N&&N.constructor,Y=typeof j=="function"&&j.prototype||zo;return N===Y}function Kc(N){if(N!=null){try{return RS.call(N)}catch{}try{return N+""}catch{}}return""}function QD(N,j){return N===j||N!==N&&j!==j}function Ide(N){return Pde(N)&&Vs.call(N,"callee")&&(!W.call(N,"callee")||Uc.call(N)==a)}var SC=Array.isArray;function eF(N){return N!=null&&nF(N.length)&&!tF(N)}function Pde(N){return bC(N)&&eF(N)}function Ade(N,j,Y){Y=typeof Y=="function"?Y:void 0;var me=Y?Y(N,j):void 0;return me===void 0?XD(N,j,Y):!!me}function tF(N){var j=wC(N)?Uc.call(N):"";return j==h||j==f}function nF(N){return typeof N=="number"&&N>-1&&N%1==0&&N<=o}function wC(N){var j=typeof N;return!!N&&(j=="object"||j=="function")}function bC(N){return!!N&&typeof N=="object"}var $de=xe?Bt(xe):wde;function rF(N){return eF(N)?gde(N):bde(N)}r.exports=Ade})(Yp,Yp.exports)),Yp.exports}var bme=wme();const vme=ip(bme);var EC,pF;function kme(){if(pF)return EC;pF=1;var r="Expected a function",e=NaN,t="[object Symbol]",n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,l=typeof Gi=="object"&&Gi&&Gi.Object===Object&&Gi,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype,h=d.toString,f=Math.max,p=Math.min,m=function(){return u.Date.now()};function g(C,E,M){var P,$,A,O,_,I,R=0,B=!1,U=!1,H=!0;if(typeof C!="function")throw new TypeError(r);E=v(E)||0,S(M)&&(B=!!M.leading,U="maxWait"in M,A=U?f(v(M.maxWait)||0,E):A,H="trailing"in M?!!M.trailing:H);function L(ue){var ze=P,xe=$;return P=$=void 0,R=ue,O=C.apply(xe,ze),O}function X(ue){return R=ue,_=setTimeout(ae,E),B?L(ue):O}function G(ue){var ze=ue-I,xe=ue-R,hn=E-ze;return U?p(hn,A-xe):hn}function ce(ue){var ze=ue-I,xe=ue-R;return I===void 0||ze>=E||ze<0||U&&xe>=A}function ae(){var ue=m();if(ce(ue))return ge(ue);_=setTimeout(ae,G(ue))}function ge(ue){return _=void 0,H&&P?L(ue):(P=$=void 0,O)}function De(){_!==void 0&&clearTimeout(_),R=0,P=I=$=_=void 0}function Ne(){return _===void 0?O:ge(m())}function ne(){var ue=m(),ze=ce(ue);if(P=arguments,$=this,I=ue,ze){if(_===void 0)return X(I);if(U)return _=setTimeout(ae,E),L(I)}return _===void 0&&(_=setTimeout(ae,E)),O}return ne.cancel=De,ne.flush=Ne,ne}function y(C,E,M){var P=!0,$=!0;if(typeof C!="function")throw new TypeError(r);return S(M)&&(P="leading"in M?!!M.leading:P,$="trailing"in M?!!M.trailing:$),g(C,E,{leading:P,maxWait:E,trailing:$})}function S(C){var E=typeof C;return!!C&&(E=="object"||E=="function")}function w(C){return!!C&&typeof C=="object"}function b(C){return typeof C=="symbol"||w(C)&&h.call(C)==t}function v(C){if(typeof C=="number")return C;if(b(C))return e;if(S(C)){var E=typeof C.valueOf=="function"?C.valueOf():C;C=S(E)?E+"":E}if(typeof C!="string")return C===0?C:+C;C=C.replace(n,"");var M=s.test(C);return M||o.test(C)?a(C.slice(2),M?2:8):i.test(C)?e:+C}return EC=y,EC}var Cme=kme();const lW=ip(Cme);var MC,mF;function Tme(){if(mF)return MC;mF=1;var r=200,e="__lodash_hash_undefined__",t=1/0,n="[object Function]",i="[object GeneratorFunction]",s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=typeof Gi=="object"&&Gi&&Gi.Object===Object&&Gi,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function u(W,Z){var Fe=W?W.length:0;return!!Fe&&h(W,Z,0)>-1}function d(W,Z,Fe,Et){for(var Cs=W.length,Gs=Fe+-1;++Gs<Cs;)if(Z(W[Gs],Gs,W))return Gs;return-1}function h(W,Z,Fe){if(Z!==Z)return d(W,f,Fe);for(var Et=Fe-1,Cs=W.length;++Et<Cs;)if(W[Et]===Z)return Et;return-1}function f(W){return W!==W}function p(W,Z){return W.has(Z)}function m(W,Z){return W?.[Z]}function g(W){var Z=!1;if(W!=null&&typeof W.toString!="function")try{Z=!!(W+"")}catch{}return Z}function y(W){var Z=-1,Fe=Array(W.size);return W.forEach(function(Et){Fe[++Z]=Et}),Fe}var S=Array.prototype,w=Function.prototype,b=Object.prototype,v=c["__core-js_shared__"],C=(function(){var W=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||"");return W?"Symbol(src)_1."+W:""})(),E=w.toString,M=b.hasOwnProperty,P=b.toString,$=RegExp("^"+E.call(M).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=S.splice,O=zo(c,"Map"),_=zo(c,"Set"),I=zo(Object,"create");function R(W){var Z=-1,Fe=W?W.length:0;for(this.clear();++Z<Fe;){var Et=W[Z];this.set(Et[0],Et[1])}}function B(){this.__data__=I?I(null):{}}function U(W){return this.has(W)&&delete this.__data__[W]}function H(W){var Z=this.__data__;if(I){var Fe=Z[W];return Fe===e?void 0:Fe}return M.call(Z,W)?Z[W]:void 0}function L(W){var Z=this.__data__;return I?Z[W]!==void 0:M.call(Z,W)}function X(W,Z){var Fe=this.__data__;return Fe[W]=I&&Z===void 0?e:Z,this}R.prototype.clear=B,R.prototype.delete=U,R.prototype.get=H,R.prototype.has=L,R.prototype.set=X;function G(W){var Z=-1,Fe=W?W.length:0;for(this.clear();++Z<Fe;){var Et=W[Z];this.set(Et[0],Et[1])}}function ce(){this.__data__=[]}function ae(W){var Z=this.__data__,Fe=Jr(Z,W);if(Fe<0)return!1;var Et=Z.length-1;return Fe==Et?Z.pop():A.call(Z,Fe,1),!0}function ge(W){var Z=this.__data__,Fe=Jr(Z,W);return Fe<0?void 0:Z[Fe][1]}function De(W){return Jr(this.__data__,W)>-1}function Ne(W,Z){var Fe=this.__data__,Et=Jr(Fe,W);return Et<0?Fe.push([W,Z]):Fe[Et][1]=Z,this}G.prototype.clear=ce,G.prototype.delete=ae,G.prototype.get=ge,G.prototype.has=De,G.prototype.set=Ne;function ne(W){var Z=-1,Fe=W?W.length:0;for(this.clear();++Z<Fe;){var Et=W[Z];this.set(Et[0],Et[1])}}function ue(){this.__data__={hash:new R,map:new(O||G),string:new R}}function ze(W){return Fo(this,W).delete(W)}function xe(W){return Fo(this,W).get(W)}function hn(W){return Fo(this,W).has(W)}function An(W,Z){return Fo(this,W).set(W,Z),this}ne.prototype.clear=ue,ne.prototype.delete=ze,ne.prototype.get=xe,ne.prototype.has=hn,ne.prototype.set=An;function Bt(W){var Z=-1,Fe=W?W.length:0;for(this.__data__=new ne;++Z<Fe;)this.add(W[Z])}function Rt(W){return this.__data__.set(W,e),this}function Ot(W){return this.__data__.has(W)}Bt.prototype.add=Bt.prototype.push=Rt,Bt.prototype.has=Ot;function Jr(W,Z){for(var Fe=W.length;Fe--;)if(Uc(W[Fe][0],Z))return Fe;return-1}function Vr(W){if(!$p(W)||$S(W))return!1;var Z=yC(W)||g(W)?$:o;return Z.test(RS(W))}function rs(W,Z,Fe){var Et=-1,Cs=u,Gs=W.length,Yd=!0,Bo=[],is=Bo;if(Gs>=r){var NS=Js(W);if(NS)return y(NS);Yd=!1,Cs=p,is=new Bt}else is=Bo;e:for(;++Et<Gs;){var il=W[Et],Wc=il;if(il=il!==0?il:0,Yd&&Wc===Wc){for(var _S=is.length;_S--;)if(is[_S]===Wc)continue e;Bo.push(il)}else Cs(is,Wc,Fe)||(is!==Bo&&is.push(Wc),Bo.push(il))}return Bo}var Js=_&&1/y(new _([,-0]))[1]==t?function(W){return new _(W)}:OS;function Fo(W,Z){var Fe=W.__data__;return Ap(Z)?Fe[typeof Z=="string"?"string":"hash"]:Fe.map}function zo(W,Z){var Fe=m(W,Z);return Vr(Fe)?Fe:void 0}function Ap(W){var Z=typeof W;return Z=="string"||Z=="number"||Z=="symbol"||Z=="boolean"?W!=="__proto__":W===null}function $S(W){return!!C&&C in W}function RS(W){if(W!=null){try{return E.call(W)}catch{}try{return W+""}catch{}}return""}function Vs(W){return W&&W.length?rs(W):[]}function Uc(W,Z){return W===Z||W!==W&&Z!==Z}function yC(W){var Z=$p(W)?P.call(W):"";return Z==n||Z==i}function $p(W){var Z=typeof W;return!!W&&(Z=="object"||Z=="function")}function OS(){}return MC=Vs,MC}var Eme=Tme();const Mme=ip(Eme);function NO(r,e){const t=[];e:for(const n of r){for(const i of t)if(e?e(n,i):n===i)continue e;t.push(n)}return t}function Re(r){return r.filter(e=>e!=null)}function Xn(r){return r[r.length-1]}function cW(r,e){let t,n=1/0;for(const i of r){const s=e(i);s<n&&(t=i,n=s)}return t}function Ime(r,e){let t,n=-1/0;for(const i of r){const s=e(i);s>n&&(t=i,n=s)}return t}function V0(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Object.is(r[t],e[t]))return!1;return!0}function Ug(r,e,t){const n=new Set(e.map(s=>s[r])),i=[];for(const s of t)n.has(s[r])||i.push(s);for(const s of e)i.push(s);return i}function uW(r){const e=(...t)=>{try{return r(...t)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,e),n}};return e}const Ey=()=>{},Go={ok(r){return{ok:!0,value:r}},err(r){return{ok:!1,error:r}}};function at(r,e){const t=e&&r&&typeof r=="object"&&e in r?r[e]:r;throw new Error(`Unknown switch case ${t}`)}const se=uW((r,e)=>{if(!r)throw new Error(e||"Assertion Error")}),Dn=uW((r,e)=>{if(r==null)throw new Error(e??"value must be defined");return r});function _O(){let r,e;const t=new Promise((n,i)=>{r=n,e=i});return Object.assign(t,{resolve:r,reject:e})}function kP(r){return new Promise(e=>setTimeout(e,r))}/*!
 * MIT License: https://github.com/NoHomey/bind-decorator/blob/master/License
 * Copyright (c) 2016 Ivo Stratev
 */function Yi(...r){if(r.length===2){const[e,t]=r;t.addInitializer(function(){se(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const i=e.bind(this),s=Reflect.defineProperty(this,t.name,{value:i,writable:!0,configurable:!0});se(s,"Cannot bind a non-configurable class method.")})}else{const[e,t,n]=r;if(!n||typeof n.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const i=n.value.bind(this);return Object.defineProperty(this,t,{value:i,configurable:!0,writable:!0}),i}}}}class Ar{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function n1(r,e){let t;const n=(...i)=>(t||(t={},t.promise=new Promise((s,o)=>{t.resolve=s,t.reject=o})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const s=t;t=void 0;try{s.resolve(r(...s.latestArgs))}catch(o){s.reject(o)}},e),t.promise);return n.cancel=()=>{t&&clearTimeout(t.timeout)},n}const gF=new WeakMap;function DO(r,e){if(typeof r!="object"||r===null)return;let t=gF.get(r);t||(t={tags:{},extras:{}},gF.set(r,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function Ua(r,e){return window.fetch(r,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const My=(r,e)=>{const t=new window.Image(r,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class mr{static async urlToArrayBuffer(e){return await(await Ua(e)).arrayBuffer()}static async urlToBlob(e){return await(await Ua(e)).blob()}static async urlToDataUrl(e){if(e.startsWith("data:"))return e;const t=await mr.urlToBlob(e);return await mr.blobToDataUrl(t)}static async blobToDataUrl(e){return await new Promise((t,n)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>n(s),i.onabort=s=>n(s),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,n)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>n(s),i.onabort=s=>n(s),i.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function dW(r){let e=0;for(let t=0;t<r.length;t++)e=(e<<5)-e+r.charCodeAt(t),e|=0;return e+""}function hW(r){const e=new DataView(r);let t=0;for(let n=0;n<e.byteLength;n++)t=(t<<5)-t+e.getUint8(n),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const yF=globalThis.crypto,Pme="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Ame=128;let Yc,Zh;function $me(r){!Yc||Yc.length<r?(Yc=new Uint8Array(r*Ame),yF.getRandomValues(Yc),Zh=0):Zh+r>Yc.length&&(yF.getRandomValues(Yc),Zh=0),Zh+=r}function Rme(r=21){$me(r-=0);let e="";for(let t=Zh-r;t<Zh;t++)e+=Pme[Yc[t]&63];return e}let Ome=Rme;function ft(r){return Ome(r)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function Nme(r){const e=new Uint8Array(r);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function n(s,o,a,l,c=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,d=new TextDecoder,h=s.length;if(typeof l>"u"&&(l=h),a>=h||l<=0||a>=l)return-1;s=s.subarray(a,l);let f=-1,p=0,m=0,g="";e:for(;p<s.length;){const y=p+c,S=s.subarray(p,y),w=d.decode(S,{stream:!0}),b=g+w;let v,C=-1;for(;(v=o.exec(b))!==null;){C=v.index-g.length,f=m+C;break e}p=y,m+=w.length;const E=C>-1?C+u:w.length-u;g=w.slice(E)}return f>=0&&(f+=a>=0?a:h+a),f}const i=n(e,"IDAT",12);return i>=12?n(e,"acTL",8,i)>=8:!1}const _me=r=>new Uint8Array(r)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function xF(r,e){let t=0;for(;r[e+t];)t+=r[e+t]+1;return t+1}function Dme(r){return new TextDecoder("ascii").decode(r.slice(0,3))==="GIF"}function Fme(r){const e=new Uint8Array(r);let t,n,i=0,s=0;if(!Dme(r))return!1;for(t=e[10]&128,n=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,n+1):0;s<2&&i<e.length;)switch(e[i]){case 44:s+=1,t=e[i+9]&128,n=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,n+1):0,i+=xF(e,i+1)+1;break;case 33:i+=2,i+=xF(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return s>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let CP=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(CP=new Int32Array(CP));const zme=(r,e)=>{let t=-1;for(let n=0;n<r.length;n++)t=CP[(t^r[n])&255]^t>>>8;return t^-1},SF=4,wF=4;class Ko{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const n={};if(!Ko.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,s=e.getInt32(t);t+=4;const o=Ko.getChunkType(e,t);if(o==="IDAT"&&n[o]){t+=s+SF+wF;continue}if(o==="IEND")break;n[o]={start:i,dataOffset:t+4,size:s},t+=s+SF+wF}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+8)}}static findChunk(e,t){return Ko.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let i=46,s=0;const o=Ko.findChunk(e,"pHYs");o&&(i=o.start,s=o.size);const a=Ko.findChunk(e,"IDAT");a&&(i=a.start,s=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115);const u=2835.5;c.setInt32(8,u*t),c.setInt32(12,u*t),c.setInt8(16,1);const d=new Uint8Array(l.slice(4,17));c.setInt32(17,zme(d));const h=e.buffer.slice(0,i),f=e.buffer.slice(i+s);return new Blob([h,l,f],n)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function Bme(r){return!r||r.length<12?!1:r[8]===87&&r[9]===69&&r[10]===66&&r[11]===80}function jme(r){const e=new Uint8Array(r);return!Bme(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const fW=Object.freeze(["image/svg+xml"]),pW=Object.freeze(["image/jpeg","image/png","image/webp"]),mW=Object.freeze(["image/gif","image/apng","image/avif"]),ap=Object.freeze([...pW,...fW,...mW]),r1=Object.freeze(["video/mp4","video/webm","video/quicktime"]),Lme=Object.freeze([...ap,...r1]);Lme.join(",");class cs{static loadVideo(e){return new Promise((t,n)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=s=>{console.error(s),n(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const n=_O();let i=!1;const s=()=>{if(!i)if(e.readyState>=e.HAVE_METADATA)i=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const l=a.getContext("2d");if(!l)throw new Error("Could not get 2d context");l.drawImage(e,0,0),n.resolve(a.toDataURL())}},o=a=>{console.error(a),n.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",s),e.addEventListener("loadeddata",s),e.addEventListener("canplay",s),e.addEventListener("seeked",s),e.addEventListener("error",o),e.addEventListener("stalled",o),s();try{return await n}finally{e.removeEventListener("loadedmetadata",s),e.removeEventListener("loadeddata",s),e.removeEventListener("canplay",s),e.removeEventListener("seeked",s),e.removeEventListener("error",o),e.removeEventListener("stalled",o)}}static getImageAndDimensions(e){return new Promise((t,n)=>{const i=My();i.onload=()=>{let s;i.naturalWidth?s={w:i.naturalWidth,h:i.naturalHeight}:(document.body.appendChild(i),s={w:i.clientWidth,h:i.clientHeight},document.body.removeChild(i)),t({...s,image:i})},i.onerror=s=>{console.error(s),n(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.style.visibility="hidden",i.style.position="absolute",i.style.opacity="0",i.style.zIndex="-9999",i.src=e})}static async getVideoSize(e){return cs.usingObjectURL(e,async t=>{const n=await cs.loadVideo(t);return{w:n.videoWidth,h:n.videoHeight}})}static async getImageSize(e){const{w:t,h:n}=await cs.usingObjectURL(e,cs.getImageAndDimensions);try{if(e.type==="image/png"){const i=new DataView(await e.arrayBuffer());if(Ko.isPng(i,0)){const s=Ko.findChunk(i,"pHYs");if(s){const o=Ko.parsePhys(i,s.dataOffset);if(o.unit===1&&o.ppux===o.ppuy){const l=Math.max(o.ppux/2834.645669291339,1);return{w:Math.round(t/l),h:Math.round(n/l)}}}}}}catch(i){return console.error(i),{w:t,h:n}}return{w:t,h:n}}static async isAnimated(e){return e.type==="image/gif"?Fme(await e.arrayBuffer()):e.type==="image/avif"?_me(await e.arrayBuffer()):e.type==="image/webp"?jme(await e.arrayBuffer()):e.type==="image/apng"?Nme(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return mW.includes(e||"")}static isStaticImageType(e){return pW.includes(e||"")}static isVectorImageType(e){return fW.includes(e||"")}static isImageType(e){return ap.includes(e||"")}static async usingObjectURL(e,t){const n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function Ye(r,e,t){return r+(e-r)*t}function Iy(r,e,t){return(t-r)/(e-r)}function Dd(r=""){let e=0,t=0,n=0,i=0;function s(){const o=e^e<<11;return e=t,t=n,n=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<r.length+64;o++)e^=r.charCodeAt(o)|0,s();return s}function oo(r,e,t,n=!1){const[i,s]=e,[o,a]=t,l=o+(r-i)/(s-i)*(a-o);return n?o<a?Math.max(Math.min(l,a),o):Math.max(Math.min(l,o),a):l}function Xi(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Cn(r,e){if(Xi(r,e))return r[e]}function Wg(r){return Object.keys(r)}function pn(r){return Object.values(r)}function fi(r){return Object.entries(r)}function gW(r){return Object.fromEntries(r)}function Hg(r,e){const t={};let n=!1;for(const[i,s]of fi(r))e(i,s)?t[i]=s:n=!0;return n?t:r}function tc(r,e){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=e(n,r[n]));return t}function yW(r,e){if(r===e)return!0;const t=new Set(Object.keys(r)),n=new Set(Object.keys(e));if(t.size!==n.size)return!1;for(const i of t)if(!n.has(i)||!Object.is(r[i],e[i]))return!1;return!0}function Ume(r,e){const t=[];for(const n in r)Object.is(r[n],e[n])||t.push(n);return t}function Wme(r,e,t=1e-6){return vme(r,e,(n,i)=>{if(typeof n=="number"&&typeof i=="number")return Math.abs(n-i)<t})}const Xp={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},Hme=Xp.Good;class xW{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),n=t>55?Xp.Good:t>30?Xp.Mid:Xp.Poor,i=n===Xp.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${t}%c fps`,`color: white; background: ${Hme};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${n};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}const SW="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Qh(r,e,t){const n=t[0];if(e!=null&&r>=e)throw new Error(r+" >= "+e);if(r.slice(-1)===n||e&&e.slice(-1)===n)throw new Error("trailing zero");if(e){let o=0;for(;(r[o]||n)===e[o];)o++;if(o>0)return e.slice(0,o)+Qh(r.slice(o),e.slice(o),t)}const i=r?t.indexOf(r[0]):0,s=e!=null?t.indexOf(e[0]):t.length;if(s-i>1){const o=Math.round(.5*(i+s));return t[o]}else return e&&e.length>1?e.slice(0,1):t[i]+Qh(r.slice(1),null,t)}function wW(r){if(r.length!==bW(r[0]))throw new Error("invalid integer part of order key: "+r)}function bW(r){if(r>="a"&&r<="z")return r.charCodeAt(0)-97+2;if(r>="A"&&r<="Z")return 90-r.charCodeAt(0)+2;throw new Error("invalid order key head: "+r)}function Zp(r){const e=bW(r[0]);if(e>r.length)throw new Error("invalid order key: "+r);return r.slice(0,e)}function bF(r,e){if(r==="A"+e[0].repeat(26))throw new Error("invalid order key: "+r);const t=Zp(r);if(r.slice(t.length).slice(-1)===e[0])throw new Error("invalid order key: "+r)}function vF(r,e){wW(r);const[t,...n]=r.split("");let i=!0;for(let s=n.length-1;i&&s>=0;s--){const o=e.indexOf(n[s])+1;o===e.length?n[s]=e[0]:(n[s]=e[o],i=!1)}if(i){if(t==="Z")return"a"+e[0];if(t==="z")return null;const s=String.fromCharCode(t.charCodeAt(0)+1);return s>"a"?n.push(e[0]):n.pop(),s+n.join("")}else return t+n.join("")}function qme(r,e){wW(r);const[t,...n]=r.split("");let i=!0;for(let s=n.length-1;i&&s>=0;s--){const o=e.indexOf(n[s])-1;o===-1?n[s]=e.slice(-1):(n[s]=e[o],i=!1)}if(i){if(t==="a")return"Z"+e.slice(-1);if(t==="A")return null;const s=String.fromCharCode(t.charCodeAt(0)-1);return s<"Z"?n.push(e.slice(-1)):n.pop(),s+n.join("")}else return t+n.join("")}function xl(r,e,t=SW){if(r!=null&&bF(r,t),e!=null&&bF(e,t),r!=null&&e!=null&&r>=e)throw new Error(r+" >= "+e);if(r==null){if(e==null)return"a"+t[0];const l=Zp(e),c=e.slice(l.length);if(l==="A"+t[0].repeat(26))return l+Qh("",c,t);if(l<e)return l;const u=qme(l,t);if(u==null)throw new Error("cannot decrement any more");return u}if(e==null){const l=Zp(r),c=r.slice(l.length),u=vF(l,t);return u??l+Qh(c,null,t)}const n=Zp(r),i=r.slice(n.length),s=Zp(e),o=e.slice(s.length);if(n===s)return n+Qh(i,o,t);const a=vF(n,t);if(a==null)throw new Error("cannot increment any more");return a<e?a:n+Qh(i,null,t)}function G0(r,e,t,n=SW){if(t===0)return[];if(t===1)return[xl(r,e,n)];if(e==null){let o=xl(r,e,n);const a=[o];for(let l=0;l<t-1;l++)o=xl(o,e,n),a.push(o);return a}if(r==null){let o=xl(r,e,n);const a=[o];for(let l=0;l<t-1;l++)o=xl(r,o,n),a.push(o);return a.reverse(),a}const i=Math.floor(t/2),s=xl(r,e,n);return[...G0(r,s,i,n),s,...G0(s,e,t-i-1,n)]}const Kme=30,Jme=()=>Math.random()<.5;function vW(r,e){if(!Number.isInteger(e))throw new Error(`"${r}" must be an integer, got '${e}'`);if(e<0)throw new Error(`"${r}" must be greater than or equal to 0, got '${e}'`)}function kW(r,e,t){const{digits:n,jitterBits:i=Kme,getRandomBit:s=Jme}=t??{};vW("jitterBits",i);let o=i,a=r,l=e,c=xl(r,e,n);for(;o>0;)(s()?1:0)===1?a=c:l=c,c=xl(a,l,n),o--;return c}function Vme(r,e,t,n){const{digits:i,jitterBits:s}=n??{};if(vW("n",t),t===0)return[];if(s===0)return G0(r,e,t,i);const o=G0(r,e,t+1,i),a=[];for(let l=0;l<t;l++){const c=o[l],u=o[l+1];a.push(kW(c,u,n))}return a}const lp=Vme,FO="a0";function Gme(r){try{kW(r,null)}catch{throw new Error("invalid index: "+r)}}function ld(r,e,t){return lp(r??null,e??null,t)}function IC(r,e){return lp(r??null,null,e)}function Pf(r,e){return lp(r??null,e??null,1)[0]}function _s(r=null){return lp(r,null,1)[0]}function Yme(r=null){return lp(null,r,1)[0]}function Py(r,e="a1"){return[e,...lp(e,null,r)]}function Fn(r,e){return r.index<e.index?-1:r.index>e.index?1:0}function Xme(r,e){return r.id>e.id?1:-1}function zO(r){try{return localStorage.getItem(r)}catch{return null}}function BO(r,e){try{localStorage.setItem(r,e)}catch{}}function Zme(){try{localStorage.clear()}catch{}}function CW(r){try{return sessionStorage.getItem(r)}catch{return null}}function jO(r,e){try{sessionStorage.setItem(r,e)}catch{}}function TW(r){try{sessionStorage.removeItem(r)}catch{}}function Qme(){try{sessionStorage.clear()}catch{}}const ef=[],ege=60,EW=Math.floor(1e3/ege)*.9;let PC,WS,AC=-EW;const kF=()=>{const r=ef.splice(0,ef.length);for(const e of r)e()};function MW(r=!1){if(PC)return;const e=Date.now();if(e-AC<EW){PC=requestAnimationFrame(()=>{PC=void 0,MW(!0)});return}if(r){if(WS)return;AC=e,kF()}else{if(WS)return;WS=requestAnimationFrame(()=>{WS=void 0,AC=e,kF()})}}function LO(r){return ef.includes(r)||(ef.push(r),MW()),()=>{const e=ef.indexOf(r);e>-1&&ef.splice(e,1)}}class tge{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,n,...i){const s=window.setTimeout(t,n,i),o=this.timeouts.get(e)??[];return this.timeouts.set(e,[...o,s]),s}setInterval(e,t,n,...i){const s=window.setInterval(t,n,i),o=this.intervals.get(e)??[];return this.intervals.set(e,[...o,s]),s}requestAnimationFrame(e,t){const n=window.requestAnimationFrame(t),i=this.rafs.get(e)??[];return this.rafs.set(e,[...i,n]),n}dispose(e){this.timeouts.get(e)?.forEach(t=>clearTimeout(t)),this.intervals.get(e)?.forEach(t=>clearInterval(t)),this.rafs.get(e)?.forEach(t=>cancelAnimationFrame(t)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,n,...i)=>this.setTimeout(e,t,n,i),setInterval:(t,n,...i)=>this.setInterval(e,t,n,i),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const je=(r,e)=>{try{return new URL(r,e)}catch{return}};function nge(r){return r!==void 0}function rge(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[r=>r&&JSON.parse(JSON.stringify(r)),!1]}const IW=rge(),vn=IW[0];IW[1];const ige=Object.getPrototypeOf(vn({})),CF=new Set;function sge(r){CF.has(r)||(CF.add(r),console.warn(`[tldraw] ${r}`))}ec("@tldraw/utils","4.2.1","esm");var TF={},Rp,EF;function $r(){if(EF)return Rp;EF=1;var r=function(e){return e&&e.Math===Math&&e};return Rp=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof Gi=="object"&&Gi)||r(typeof Rp=="object"&&Rp)||(function(){return this})()||Function("return this")(),Rp}var $C={},RC,MF;function Rr(){return MF||(MF=1,RC=function(r){try{return!!r()}catch{return!0}}),RC}var OC,IF;function nc(){if(IF)return OC;IF=1;var r=Rr();return OC=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),OC}var NC,PF;function i1(){if(PF)return NC;PF=1;var r=Rr();return NC=!r(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),NC}var _C,AF;function Ka(){if(AF)return _C;AF=1;var r=i1(),e=Function.prototype.call;return _C=r?e.bind(e):function(){return e.apply(e,arguments)},_C}var DC={},$F;function oge(){if($F)return DC;$F=1;var r={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!r.call({1:2},1);return DC.f=t?function(i){var s=e(this,i);return!!s&&s.enumerable}:r,DC}var FC,RF;function PW(){return RF||(RF=1,FC=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}),FC}var zC,OF;function Hn(){if(OF)return zC;OF=1;var r=i1(),e=Function.prototype,t=e.call,n=r&&e.bind.bind(t,t);return zC=r?n:function(i){return function(){return t.apply(i,arguments)}},zC}var BC,NF;function cp(){if(NF)return BC;NF=1;var r=Hn(),e=r({}.toString),t=r("".slice);return BC=function(n){return t(e(n),8,-1)},BC}var jC,_F;function age(){if(_F)return jC;_F=1;var r=Hn(),e=Rr(),t=cp(),n=Object,i=r("".split);return jC=e(function(){return!n("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?i(s,""):n(s)}:n,jC}var LC,DF;function AW(){return DF||(DF=1,LC=function(r){return r==null}),LC}var UC,FF;function up(){if(FF)return UC;FF=1;var r=AW(),e=TypeError;return UC=function(t){if(r(t))throw new e("Can't call method on "+t);return t},UC}var WC,zF;function s1(){if(zF)return WC;zF=1;var r=age(),e=up();return WC=function(t){return r(e(t))},WC}var HC,BF;function zi(){if(BF)return HC;BF=1;var r=typeof document=="object"&&document.all;return HC=typeof r>"u"&&r!==void 0?function(e){return typeof e=="function"||e===r}:function(e){return typeof e=="function"},HC}var qC,jF;function Ja(){if(jF)return qC;jF=1;var r=zi();return qC=function(e){return typeof e=="object"?e!==null:r(e)},qC}var KC,LF;function o1(){if(LF)return KC;LF=1;var r=$r(),e=zi(),t=function(n){return e(n)?n:void 0};return KC=function(n,i){return arguments.length<2?t(r[n]):r[n]&&r[n][i]},KC}var JC,UF;function $W(){if(UF)return JC;UF=1;var r=Hn();return JC=r({}.isPrototypeOf),JC}var VC,WF;function lge(){if(WF)return VC;WF=1;var r=$r(),e=r.navigator,t=e&&e.userAgent;return VC=t?String(t):"",VC}var GC,HF;function cge(){if(HF)return GC;HF=1;var r=$r(),e=lge(),t=r.process,n=r.Deno,i=t&&t.versions||n&&n.version,s=i&&i.v8,o,a;return s&&(o=s.split("."),a=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&e&&(o=e.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=e.match(/Chrome\/(\d+)/),o&&(a=+o[1]))),GC=a,GC}var YC,qF;function RW(){if(qF)return YC;qF=1;var r=cge(),e=Rr(),t=$r(),n=t.String;return YC=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!n(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&r&&r<41}),YC}var XC,KF;function OW(){if(KF)return XC;KF=1;var r=RW();return XC=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol",XC}var ZC,JF;function NW(){if(JF)return ZC;JF=1;var r=o1(),e=zi(),t=$W(),n=OW(),i=Object;return ZC=n?function(s){return typeof s=="symbol"}:function(s){var o=r("Symbol");return e(o)&&t(o.prototype,i(s))},ZC}var QC,VF;function uge(){if(VF)return QC;VF=1;var r=String;return QC=function(e){try{return r(e)}catch{return"Object"}},QC}var eT,GF;function UO(){if(GF)return eT;GF=1;var r=zi(),e=uge(),t=TypeError;return eT=function(n){if(r(n))return n;throw new t(e(n)+" is not a function")},eT}var tT,YF;function WO(){if(YF)return tT;YF=1;var r=UO(),e=AW();return tT=function(t,n){var i=t[n];return e(i)?void 0:r(i)},tT}var nT,XF;function dge(){if(XF)return nT;XF=1;var r=Ka(),e=zi(),t=Ja(),n=TypeError;return nT=function(i,s){var o,a;if(s==="string"&&e(o=i.toString)&&!t(a=r(o,i))||e(o=i.valueOf)&&!t(a=r(o,i))||s!=="string"&&e(o=i.toString)&&!t(a=r(o,i)))return a;throw new n("Can't convert object to primitive value")},nT}var rT={exports:{}},iT,ZF;function _W(){return ZF||(ZF=1,iT=!1),iT}var sT,QF;function HO(){if(QF)return sT;QF=1;var r=$r(),e=Object.defineProperty;return sT=function(t,n){try{e(r,t,{value:n,configurable:!0,writable:!0})}catch{r[t]=n}return n},sT}var ez;function qO(){if(ez)return rT.exports;ez=1;var r=_W(),e=$r(),t=HO(),n="__core-js_shared__",i=rT.exports=e[n]||t(n,{});return(i.versions||(i.versions=[])).push({version:"3.47.0",mode:r?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"}),rT.exports}var oT,tz;function KO(){if(tz)return oT;tz=1;var r=qO();return oT=function(e,t){return r[e]||(r[e]=t||{})},oT}var aT,nz;function Xx(){if(nz)return aT;nz=1;var r=up(),e=Object;return aT=function(t){return e(r(t))},aT}var lT,rz;function rc(){if(rz)return lT;rz=1;var r=Hn(),e=Xx(),t=r({}.hasOwnProperty);return lT=Object.hasOwn||function(i,s){return t(e(i),s)},lT}var cT,iz;function DW(){if(iz)return cT;iz=1;var r=Hn(),e=0,t=Math.random(),n=r(1.1.toString);return cT=function(i){return"Symbol("+(i===void 0?"":i)+")_"+n(++e+t,36)},cT}var uT,sz;function Va(){if(sz)return uT;sz=1;var r=$r(),e=KO(),t=rc(),n=DW(),i=RW(),s=OW(),o=r.Symbol,a=e("wks"),l=s?o.for||o:o&&o.withoutSetter||n;return uT=function(c){return t(a,c)||(a[c]=i&&t(o,c)?o[c]:l("Symbol."+c)),a[c]},uT}var dT,oz;function hge(){if(oz)return dT;oz=1;var r=Ka(),e=Ja(),t=NW(),n=WO(),i=dge(),s=Va(),o=TypeError,a=s("toPrimitive");return dT=function(l,c){if(!e(l)||t(l))return l;var u=n(l,a),d;if(u){if(c===void 0&&(c="default"),d=r(u,l,c),!e(d)||t(d))return d;throw new o("Can't convert object to primitive value")}return c===void 0&&(c="number"),i(l,c)},dT}var hT,az;function FW(){if(az)return hT;az=1;var r=hge(),e=NW();return hT=function(t){var n=r(t,"string");return e(n)?n:n+""},hT}var fT,lz;function zW(){if(lz)return fT;lz=1;var r=$r(),e=Ja(),t=r.document,n=e(t)&&e(t.createElement);return fT=function(i){return n?t.createElement(i):{}},fT}var pT,cz;function BW(){if(cz)return pT;cz=1;var r=nc(),e=Rr(),t=zW();return pT=!r&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),pT}var uz;function jW(){if(uz)return $C;uz=1;var r=nc(),e=Ka(),t=oge(),n=PW(),i=s1(),s=FW(),o=rc(),a=BW(),l=Object.getOwnPropertyDescriptor;return $C.f=r?l:function(u,d){if(u=i(u),d=s(d),a)try{return l(u,d)}catch{}if(o(u,d))return n(!e(t.f,u,d),u[d])},$C}var mT={},gT,dz;function LW(){if(dz)return gT;dz=1;var r=nc(),e=Rr();return gT=r&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),gT}var yT,hz;function Fd(){if(hz)return yT;hz=1;var r=Ja(),e=String,t=TypeError;return yT=function(n){if(r(n))return n;throw new t(e(n)+" is not an object")},yT}var fz;function Zx(){if(fz)return mT;fz=1;var r=nc(),e=BW(),t=LW(),n=Fd(),i=FW(),s=TypeError,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",u="writable";return mT.f=r?t?function(h,f,p){if(n(h),f=i(f),n(p),typeof h=="function"&&f==="prototype"&&"value"in p&&u in p&&!p[u]){var m=a(h,f);m&&m[u]&&(h[f]=p.value,p={configurable:c in p?p[c]:m[c],enumerable:l in p?p[l]:m[l],writable:!1})}return o(h,f,p)}:o:function(h,f,p){if(n(h),f=i(f),n(p),e)try{return o(h,f,p)}catch{}if("get"in p||"set"in p)throw new s("Accessors not supported");return"value"in p&&(h[f]=p.value),h},mT}var xT,pz;function JO(){if(pz)return xT;pz=1;var r=nc(),e=Zx(),t=PW();return xT=r?function(n,i,s){return e.f(n,i,t(1,s))}:function(n,i,s){return n[i]=s,n},xT}var ST={exports:{}},wT,mz;function fge(){if(mz)return wT;mz=1;var r=nc(),e=rc(),t=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,i=e(t,"name"),s=i&&(function(){}).name==="something",o=i&&(!r||r&&n(t,"name").configurable);return wT={EXISTS:i,PROPER:s,CONFIGURABLE:o},wT}var bT,gz;function UW(){if(gz)return bT;gz=1;var r=Hn(),e=zi(),t=qO(),n=r(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(i){return n(i)}),bT=t.inspectSource,bT}var vT,yz;function pge(){if(yz)return vT;yz=1;var r=$r(),e=zi(),t=r.WeakMap;return vT=e(t)&&/native code/.test(String(t)),vT}var kT,xz;function WW(){if(xz)return kT;xz=1;var r=KO(),e=DW(),t=r("keys");return kT=function(n){return t[n]||(t[n]=e(n))},kT}var CT,Sz;function VO(){return Sz||(Sz=1,CT={}),CT}var TT,wz;function HW(){if(wz)return TT;wz=1;var r=pge(),e=$r(),t=Ja(),n=JO(),i=rc(),s=qO(),o=WW(),a=VO(),l="Object already initialized",c=e.TypeError,u=e.WeakMap,d,h,f,p=function(S){return f(S)?h(S):d(S,{})},m=function(S){return function(w){var b;if(!t(w)||(b=h(w)).type!==S)throw new c("Incompatible receiver, "+S+" required");return b}};if(r||s.state){var g=s.state||(s.state=new u);g.get=g.get,g.has=g.has,g.set=g.set,d=function(S,w){if(g.has(S))throw new c(l);return w.facade=S,g.set(S,w),w},h=function(S){return g.get(S)||{}},f=function(S){return g.has(S)}}else{var y=o("state");a[y]=!0,d=function(S,w){if(i(S,y))throw new c(l);return w.facade=S,n(S,y,w),w},h=function(S){return i(S,y)?S[y]:{}},f=function(S){return i(S,y)}}return TT={set:d,get:h,has:f,enforce:p,getterFor:m},TT}var bz;function mge(){if(bz)return ST.exports;bz=1;var r=Hn(),e=Rr(),t=zi(),n=rc(),i=nc(),s=fge().CONFIGURABLE,o=UW(),a=HW(),l=a.enforce,c=a.get,u=String,d=Object.defineProperty,h=r("".slice),f=r("".replace),p=r([].join),m=i&&!e(function(){return d(function(){},"length",{value:8}).length!==8}),g=String(String).split("String"),y=ST.exports=function(S,w,b){h(u(w),0,7)==="Symbol("&&(w="["+f(u(w),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),b&&b.getter&&(w="get "+w),b&&b.setter&&(w="set "+w),(!n(S,"name")||s&&S.name!==w)&&(i?d(S,"name",{value:w,configurable:!0}):S.name=w),m&&b&&n(b,"arity")&&S.length!==b.arity&&d(S,"length",{value:b.arity});try{b&&n(b,"constructor")&&b.constructor?i&&d(S,"prototype",{writable:!1}):S.prototype&&(S.prototype=void 0)}catch{}var v=l(S);return n(v,"source")||(v.source=p(g,typeof w=="string"?w:"")),S};return Function.prototype.toString=y(function(){return t(this)&&c(this).source||o(this)},"toString"),ST.exports}var ET,vz;function qW(){if(vz)return ET;vz=1;var r=zi(),e=Zx(),t=mge(),n=HO();return ET=function(i,s,o,a){a||(a={});var l=a.enumerable,c=a.name!==void 0?a.name:s;if(r(o)&&t(o,c,a),a.global)l?i[s]=o:n(s,o);else{try{a.unsafe?i[s]&&(l=!0):delete i[s]}catch{}l?i[s]=o:e.f(i,s,{value:o,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return i},ET}var MT={},IT,kz;function gge(){if(kz)return IT;kz=1;var r=Math.ceil,e=Math.floor;return IT=Math.trunc||function(n){var i=+n;return(i>0?e:r)(i)},IT}var PT,Cz;function zd(){if(Cz)return PT;Cz=1;var r=gge();return PT=function(e){var t=+e;return t!==t||t===0?0:r(t)},PT}var AT,Tz;function yge(){if(Tz)return AT;Tz=1;var r=zd(),e=Math.max,t=Math.min;return AT=function(n,i){var s=r(n);return s<0?e(s+i,0):t(s,i)},AT}var $T,Ez;function KW(){if(Ez)return $T;Ez=1;var r=zd(),e=Math.min;return $T=function(t){var n=r(t);return n>0?e(n,9007199254740991):0},$T}var RT,Mz;function Qx(){if(Mz)return RT;Mz=1;var r=KW();return RT=function(e){return r(e.length)},RT}var OT,Iz;function xge(){if(Iz)return OT;Iz=1;var r=s1(),e=yge(),t=Qx(),n=function(i){return function(s,o,a){var l=r(s),c=t(l);if(c===0)return!i&&-1;var u=e(a,c),d;if(i&&o!==o){for(;c>u;)if(d=l[u++],d!==d)return!0}else for(;c>u;u++)if((i||u in l)&&l[u]===o)return i||u||0;return!i&&-1}};return OT={includes:n(!0),indexOf:n(!1)},OT}var NT,Pz;function JW(){if(Pz)return NT;Pz=1;var r=Hn(),e=rc(),t=s1(),n=xge().indexOf,i=VO(),s=r([].push);return NT=function(o,a){var l=t(o),c=0,u=[],d;for(d in l)!e(i,d)&&e(l,d)&&s(u,d);for(;a.length>c;)e(l,d=a[c++])&&(~n(u,d)||s(u,d));return u},NT}var _T,Az;function GO(){return Az||(Az=1,_T=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),_T}var $z;function Sge(){if($z)return MT;$z=1;var r=JW(),e=GO(),t=e.concat("length","prototype");return MT.f=Object.getOwnPropertyNames||function(i){return r(i,t)},MT}var DT={},Rz;function wge(){return Rz||(Rz=1,DT.f=Object.getOwnPropertySymbols),DT}var FT,Oz;function bge(){if(Oz)return FT;Oz=1;var r=o1(),e=Hn(),t=Sge(),n=wge(),i=Fd(),s=e([].concat);return FT=r("Reflect","ownKeys")||function(a){var l=t.f(i(a)),c=n.f;return c?s(l,c(a)):l},FT}var zT,Nz;function vge(){if(Nz)return zT;Nz=1;var r=rc(),e=bge(),t=jW(),n=Zx();return zT=function(i,s,o){for(var a=e(s),l=n.f,c=t.f,u=0;u<a.length;u++){var d=a[u];!r(i,d)&&!(o&&r(o,d))&&l(i,d,c(s,d))}},zT}var BT,_z;function kge(){if(_z)return BT;_z=1;var r=Rr(),e=zi(),t=/#|\.prototype\./,n=function(l,c){var u=s[i(l)];return u===a?!0:u===o?!1:e(c)?r(c):!!c},i=n.normalize=function(l){return String(l).replace(t,".").toLowerCase()},s=n.data={},o=n.NATIVE="N",a=n.POLYFILL="P";return BT=n,BT}var jT,Dz;function dp(){if(Dz)return jT;Dz=1;var r=$r(),e=jW().f,t=JO(),n=qW(),i=HO(),s=vge(),o=kge();return jT=function(a,l){var c=a.target,u=a.global,d=a.stat,h,f,p,m,g,y;if(u?f=r:d?f=r[c]||i(c,{}):f=r[c]&&r[c].prototype,f)for(p in l){if(g=l[p],a.dontCallGetSet?(y=e(f,p),m=y&&y.value):m=f[p],h=o(u?p:c+(d?".":"#")+p,a.forced),!h&&m!==void 0){if(typeof g==typeof m)continue;s(g,m)}(a.sham||m&&m.sham)&&t(g,"sham",!0),n(f,p,g,a)}},jT}var LT={},UT,Fz;function Cge(){if(Fz)return UT;Fz=1;var r=JW(),e=GO();return UT=Object.keys||function(n){return r(n,e)},UT}var zz;function Tge(){if(zz)return LT;zz=1;var r=nc(),e=LW(),t=Zx(),n=Fd(),i=s1(),s=Cge();return LT.f=r&&!e?Object.defineProperties:function(a,l){n(a);for(var c=i(l),u=s(l),d=u.length,h=0,f;d>h;)t.f(a,f=u[h++],c[f]);return a},LT}var WT,Bz;function Ege(){if(Bz)return WT;Bz=1;var r=o1();return WT=r("document","documentElement"),WT}var HT,jz;function VW(){if(jz)return HT;jz=1;var r=Fd(),e=Tge(),t=GO(),n=VO(),i=Ege(),s=zW(),o=WW(),a=">",l="<",c="prototype",u="script",d=o("IE_PROTO"),h=function(){},f=function(S){return l+u+a+S+l+"/"+u+a},p=function(S){S.write(f("")),S.close();var w=S.parentWindow.Object;return S=null,w},m=function(){var S=s("iframe"),w="java"+u+":",b;return S.style.display="none",i.appendChild(S),S.src=String(w),b=S.contentWindow.document,b.open(),b.write(f("document.F=Object")),b.close(),b.F},g,y=function(){try{g=new ActiveXObject("htmlfile")}catch{}y=typeof document<"u"?document.domain&&g?p(g):m():p(g);for(var S=t.length;S--;)delete y[c][t[S]];return y()};return n[d]=!0,HT=Object.create||function(w,b){var v;return w!==null?(h[c]=r(w),v=new h,h[c]=null,v[d]=w):v=y(),b===void 0?v:e.f(v,b)},HT}var qT,Lz;function YO(){if(Lz)return qT;Lz=1;var r=Va(),e=VW(),t=Zx().f,n=r("unscopables"),i=Array.prototype;return i[n]===void 0&&t(i,n,{configurable:!0,value:e(null)}),qT=function(s){i[n][s]=!0},qT}var Uz;function Mge(){if(Uz)return TF;Uz=1;var r=dp(),e=Xx(),t=Qx(),n=zd(),i=YO();return r({target:"Array",proto:!0},{at:function(o){var a=e(this),l=t(a),c=n(o),u=c>=0?c:l+c;return u<0||u>=l?void 0:a[u]}}),i("at"),TF}var KT,Wz;function eS(){if(Wz)return KT;Wz=1;var r=$r(),e=Hn();return KT=function(t,n){return e(r[t].prototype[n])},KT}var JT,Hz;function Ige(){if(Hz)return JT;Hz=1,Mge();var r=eS();return JT=r("Array","at"),JT}var VT,qz;function Pge(){if(qz)return VT;qz=1;var r=Ige();return VT=r,VT}Pge();var Kz={},GT,Jz;function GW(){if(Jz)return GT;Jz=1;var r=cp();return GT=Array.isArray||function(t){return r(t)==="Array"},GT}var YT,Vz;function Age(){if(Vz)return YT;Vz=1;var r=TypeError,e=9007199254740991;return YT=function(t){if(t>e)throw r("Maximum allowed index exceeded");return t},YT}var XT,Gz;function $ge(){if(Gz)return XT;Gz=1;var r=cp(),e=Hn();return XT=function(t){if(r(t)==="Function")return e(t)},XT}var ZT,Yz;function Rge(){if(Yz)return ZT;Yz=1;var r=$ge(),e=UO(),t=i1(),n=r(r.bind);return ZT=function(i,s){return e(i),s===void 0?i:t?n(i,s):function(){return i.apply(s,arguments)}},ZT}var QT,Xz;function YW(){if(Xz)return QT;Xz=1;var r=GW(),e=Qx(),t=Age(),n=Rge(),i=function(s,o,a,l,c,u,d,h){for(var f=c,p=0,m=d?n(d,h):!1,g,y;p<l;)p in a&&(g=m?m(a[p],p,o):a[p],u>0&&r(g)?(y=e(g),f=i(s,o,g,y,f,u-1)-1):(t(f+1),s[f]=g),f++),p++;return f};return QT=i,QT}var eE,Zz;function Oge(){if(Zz)return eE;Zz=1;var r=Va(),e=r("toStringTag"),t={};return t[e]="z",eE=String(t)==="[object z]",eE}var tE,Qz;function XW(){if(Qz)return tE;Qz=1;var r=Oge(),e=zi(),t=cp(),n=Va(),i=n("toStringTag"),s=Object,o=t((function(){return arguments})())==="Arguments",a=function(l,c){try{return l[c]}catch{}};return tE=r?t:function(l){var c,u,d;return l===void 0?"Undefined":l===null?"Null":typeof(u=a(c=s(l),i))=="string"?u:o?t(c):(d=t(c))==="Object"&&e(c.callee)?"Arguments":d},tE}var nE,eB;function Nge(){if(eB)return nE;eB=1;var r=Hn(),e=Rr(),t=zi(),n=XW(),i=o1(),s=UW(),o=function(){},a=i("Reflect","construct"),l=/^\s*(?:class|function)\b/,c=r(l.exec),u=!l.test(o),d=function(p){if(!t(p))return!1;try{return a(o,[],p),!0}catch{return!1}},h=function(p){if(!t(p))return!1;switch(n(p)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!c(l,s(p))}catch{return!0}};return h.sham=!0,nE=!a||e(function(){var f;return d(d.call)||!d(Object)||!d(function(){f=!0})||f})?h:d,nE}var rE,tB;function _ge(){if(tB)return rE;tB=1;var r=GW(),e=Nge(),t=Ja(),n=Va(),i=n("species"),s=Array;return rE=function(o){var a;return r(o)&&(a=o.constructor,e(a)&&(a===s||r(a.prototype))?a=void 0:t(a)&&(a=a[i],a===null&&(a=void 0))),a===void 0?s:a},rE}var iE,nB;function ZW(){if(nB)return iE;nB=1;var r=_ge();return iE=function(e,t){return new(r(e))(t===0?0:t)},iE}var rB;function Dge(){if(rB)return Kz;rB=1;var r=dp(),e=YW(),t=UO(),n=Xx(),i=Qx(),s=ZW();return r({target:"Array",proto:!0},{flatMap:function(a){var l=n(this),c=i(l),u;return t(a),u=s(l,0),u.length=e(u,l,l,c,0,1,a,arguments.length>1?arguments[1]:void 0),u}}),Kz}var iB={},sB;function Fge(){if(sB)return iB;sB=1;var r=YO();return r("flatMap"),iB}var sE,oB;function zge(){if(oB)return sE;oB=1,Dge(),Fge();var r=eS();return sE=r("Array","flatMap"),sE}var oE,aB;function Bge(){if(aB)return oE;aB=1;var r=zge();return oE=r,oE}Bge();var lB={},cB;function jge(){if(cB)return lB;cB=1;var r=dp(),e=YW(),t=Xx(),n=Qx(),i=zd(),s=ZW();return r({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,l=t(this),c=n(l),u=s(l,0);return u.length=e(u,l,l,c,0,a===void 0?1:i(a)),u}}),lB}var uB={},dB;function Lge(){if(dB)return uB;dB=1;var r=YO();return r("flat"),uB}var aE,hB;function Uge(){if(hB)return aE;hB=1,jge(),Lge();var r=eS();return aE=r("Array","flat"),aE}var lE,fB;function Wge(){if(fB)return lE;fB=1;var r=Uge();return lE=r,lE}Wge();var pB={},cE,mB;function tS(){if(mB)return cE;mB=1;var r=XW(),e=String;return cE=function(t){if(r(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},cE}var gB;function Hge(){if(gB)return pB;gB=1;var r=dp(),e=Hn(),t=up(),n=zd(),i=tS(),s=Rr(),o=e("".charAt),a=s(function(){return"".at(-2)!=="\uD842"});return r({target:"String",proto:!0,forced:a},{at:function(c){var u=i(t(this)),d=u.length,h=n(c),f=h>=0?h:d+h;return f<0||f>=d?void 0:o(u,f)}}),pB}var uE,yB;function qge(){if(yB)return uE;yB=1,Hge();var r=eS();return uE=r("String","at"),uE}var dE,xB;function Kge(){if(xB)return dE;xB=1;var r=qge();return dE=r,dE}Kge();var SB={},hE,wB;function QW(){if(wB)return hE;wB=1;var r=Fd();return hE=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},hE}var fE,bB;function Jge(){if(bB)return fE;bB=1;var r=Rr(),e=$r(),t=e.RegExp,n=r(function(){var o=t("a","y");return o.lastIndex=2,o.exec("abcd")!==null}),i=n||r(function(){return!t("a","y").sticky}),s=n||r(function(){var o=t("^r","gy");return o.lastIndex=2,o.exec("str")!==null});return fE={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:n},fE}var pE,vB;function Vge(){if(vB)return pE;vB=1;var r=Rr(),e=$r(),t=e.RegExp;return pE=r(function(){var n=t(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),pE}var mE,kB;function Gge(){if(kB)return mE;kB=1;var r=Rr(),e=$r(),t=e.RegExp;return mE=r(function(){var n=t("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),mE}var gE,CB;function XO(){if(CB)return gE;CB=1;var r=Ka(),e=Hn(),t=tS(),n=QW(),i=Jge(),s=KO(),o=VW(),a=HW().get,l=Vge(),c=Gge(),u=s("native-string-replace",String.prototype.replace),d=RegExp.prototype.exec,h=d,f=e("".charAt),p=e("".indexOf),m=e("".replace),g=e("".slice),y=(function(){var v=/a/,C=/b*/g;return r(d,v,"a"),r(d,C,"a"),v.lastIndex!==0||C.lastIndex!==0})(),S=i.BROKEN_CARET,w=/()??/.exec("")[1]!==void 0,b=y||w||S||l||c;return b&&(h=function(C){var E=this,M=a(E),P=t(C),$=M.raw,A,O,_,I,R,B,U;if($)return $.lastIndex=E.lastIndex,A=r(h,$,P),E.lastIndex=$.lastIndex,A;var H=M.groups,L=S&&E.sticky,X=r(n,E),G=E.source,ce=0,ae=P;if(L&&(X=m(X,"y",""),p(X,"g")===-1&&(X+="g"),ae=g(P,E.lastIndex),E.lastIndex>0&&(!E.multiline||E.multiline&&f(P,E.lastIndex-1)!==`
`)&&(G="(?: "+G+")",ae=" "+ae,ce++),O=new RegExp("^(?:"+G+")",X)),w&&(O=new RegExp("^"+G+"$(?!\\s)",X)),y&&(_=E.lastIndex),I=r(d,L?O:E,ae),L?I?(I.input=g(I.input,ce),I[0]=g(I[0],ce),I.index=E.lastIndex,E.lastIndex+=I[0].length):E.lastIndex=0:y&&I&&(E.lastIndex=E.global?I.index+I[0].length:_),w&&I&&I.length>1&&r(u,I[0],O,function(){for(R=1;R<arguments.length-2;R++)arguments[R]===void 0&&(I[R]=void 0)}),I&&H)for(I.groups=B=o(null),R=0;R<H.length;R++)U=H[R],B[U[0]]=I[U[1]];return I}),gE=h,gE}var TB;function eH(){if(TB)return SB;TB=1;var r=dp(),e=XO();return r({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),SB}var EB={},yE,MB;function Yge(){if(MB)return yE;MB=1;var r=i1(),e=Function.prototype,t=e.apply,n=e.call;return yE=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(t):function(){return n.apply(t,arguments)}),yE}var xE,IB;function Xge(){if(IB)return xE;IB=1,eH();var r=Ka(),e=qW(),t=XO(),n=Rr(),i=Va(),s=JO(),o=i("species"),a=RegExp.prototype;return xE=function(l,c,u,d){var h=i(l),f=!n(function(){var y={};return y[h]=function(){return 7},""[l](y)!==7}),p=f&&!n(function(){var y=!1,S=/a/;if(l==="split"){var w={};w[o]=function(){return S},S={constructor:w,flags:""},S[h]=/./[h]}return S.exec=function(){return y=!0,null},S[h](""),!y});if(!f||!p||u){var m=/./[h],g=c(h,""[l],function(y,S,w,b,v){var C=S.exec;return C===t||C===a.exec?f&&!v?{done:!0,value:r(m,S,w,b)}:{done:!0,value:r(y,w,S,b)}:{done:!1}});e(String.prototype,l,g[0]),e(a,h,g[1])}d&&s(a[h],"sham",!0)},xE}var SE,PB;function Zge(){if(PB)return SE;PB=1;var r=Hn(),e=zd(),t=tS(),n=up(),i=r("".charAt),s=r("".charCodeAt),o=r("".slice),a=function(l){return function(c,u){var d=t(n(c)),h=e(u),f=d.length,p,m;return h<0||h>=f?l?"":void 0:(p=s(d,h),p<55296||p>56319||h+1===f||(m=s(d,h+1))<56320||m>57343?l?i(d,h):p:l?o(d,h,h+2):(p-55296<<10)+(m-56320)+65536)}};return SE={codeAt:a(!1),charAt:a(!0)},SE}var wE,AB;function Qge(){if(AB)return wE;AB=1;var r=Zge().charAt;return wE=function(e,t,n){return t+(n?r(e,t).length:1)},wE}var bE,$B;function tH(){if($B)return bE;$B=1;var r=Hn(),e=Xx(),t=Math.floor,n=r("".charAt),i=r("".replace),s=r("".slice),o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return bE=function(l,c,u,d,h,f){var p=u+l.length,m=d.length,g=a;return h!==void 0&&(h=e(h),g=o),i(f,g,function(y,S){var w;switch(n(S,0)){case"$":return"$";case"&":return l;case"`":return s(c,0,u);case"'":return s(c,p);case"<":w=h[s(S,1,-1)];break;default:var b=+S;if(b===0)return y;if(b>m){var v=t(b/10);return v===0?y:v<=m?d[v-1]===void 0?n(S,1):d[v-1]+n(S,1):y}w=d[b-1]}return w===void 0?"":w})},bE}var vE,RB;function eye(){if(RB)return vE;RB=1;var r=$r(),e=Rr(),t=r.RegExp,n=!e(function(){var i=!0;try{t(".","d")}catch{i=!1}var s={},o="",a=i?"dgimsy":"gimsy",l=function(h,f){Object.defineProperty(s,h,{get:function(){return o+=f,!0}})},c={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};i&&(c.hasIndices="d");for(var u in c)l(u,c[u]);var d=Object.getOwnPropertyDescriptor(t.prototype,"flags").get.call(s);return d!==a||o!==a});return vE={correct:n},vE}var kE,OB;function nH(){if(OB)return kE;OB=1;var r=Ka(),e=rc(),t=$W(),n=eye(),i=QW(),s=RegExp.prototype;return kE=n.correct?function(o){return o.flags}:function(o){return!n.correct&&t(s,o)&&!e(o,"flags")?r(i,o):o.flags},kE}var CE,NB;function tye(){if(NB)return CE;NB=1;var r=Ka(),e=Fd(),t=zi(),n=cp(),i=XO(),s=TypeError;return CE=function(o,a){var l=o.exec;if(t(l)){var c=r(l,o,a);return c!==null&&e(c),c}if(n(o)==="RegExp")return r(i,o,a);throw new s("RegExp#exec called on incompatible receiver")},CE}var _B;function nye(){if(_B)return EB;_B=1;var r=Yge(),e=Ka(),t=Hn(),n=Xge(),i=Rr(),s=Fd(),o=zi(),a=Ja(),l=zd(),c=KW(),u=tS(),d=up(),h=Qge(),f=WO(),p=tH(),m=nH(),g=tye(),y=Va(),S=y("replace"),w=Math.max,b=Math.min,v=t([].concat),C=t([].push),E=t("".indexOf),M=t("".slice),P=function(_){return _===void 0?_:String(_)},$=(function(){return"a".replace(/./,"$0")==="$0"})(),A=(function(){return/./[S]?/./[S]("a","$0")==="":!1})(),O=!i(function(){var _=/./;return _.exec=function(){var I=[];return I.groups={a:"7"},I},"".replace(_,"$<a>")!=="7"});return n("replace",function(_,I,R){var B=A?"$":"$0";return[function(H,L){var X=d(this),G=a(H)?f(H,S):void 0;return G?e(G,H,X,L):e(I,u(X),H,L)},function(U,H){var L=s(this),X=u(U);if(typeof H=="string"&&E(H,B)===-1&&E(H,"$<")===-1){var G=R(I,L,X,H);if(G.done)return G.value}var ce=o(H);ce||(H=u(H));var ae=u(m(L)),ge=E(ae,"g")!==-1,De;ge&&(De=E(ae,"u")!==-1,L.lastIndex=0);for(var Ne=[],ne;ne=g(L,X),!(ne===null||(C(Ne,ne),!ge));){var ue=u(ne[0]);ue===""&&(L.lastIndex=h(X,c(L.lastIndex),De))}for(var ze="",xe=0,hn=0;hn<Ne.length;hn++){ne=Ne[hn];for(var An=u(ne[0]),Bt=w(b(l(ne.index),X.length),0),Rt=[],Ot,Jr=1;Jr<ne.length;Jr++)C(Rt,P(ne[Jr]));var Vr=ne.groups;if(ce){var rs=v([An],Rt,Bt,X);Vr!==void 0&&C(rs,Vr),Ot=u(r(H,void 0,rs))}else Ot=p(An,X,Bt,Rt,Vr,H);Bt>=xe&&(ze+=M(X,xe,Bt)+Ot,xe=Bt+An.length)}return ze+M(X,xe)}]},!O||!$||A),EB}var DB={},TE,FB;function rye(){if(FB)return TE;FB=1;var r=Ja(),e=cp(),t=Va(),n=t("match");return TE=function(i){var s;return r(i)&&((s=i[n])!==void 0?!!s:e(i)==="RegExp")},TE}var zB;function iye(){if(zB)return DB;zB=1;var r=dp(),e=Ka(),t=Hn(),n=up(),i=zi(),s=Ja(),o=rye(),a=tS(),l=WO(),c=nH(),u=tH(),d=Va(),h=_W(),f=d("replace"),p=TypeError,m=t("".indexOf),g=t("".replace),y=t("".slice),S=Math.max;return r({target:"String",proto:!0},{replaceAll:function(b,v){var C=n(this),E,M,P,$,A,O,_,I,R,B,U=0,H="";if(s(b)){if(E=o(b),E&&(M=a(n(c(b))),!~m(M,"g")))throw new p("`.replaceAll` does not allow non-global regexes");if(P=l(b,f),P)return e(P,b,C,v);if(h&&E)return g(a(C),b,v)}for($=a(C),A=a(b),O=i(v),O||(v=a(v)),_=A.length,I=S(1,_),R=m($,A);R!==-1;)B=O?a(v(A,R,$)):u(A,$,R,[],void 0,v),H+=y($,U,R)+B,U=R+_,R=R+I>$.length?-1:m($,A,R+I);return U<$.length&&(H+=y($,U)),H}}),DB}var EE,BB;function sye(){if(BB)return EE;BB=1,eH(),nye(),iye();var r=eS();return EE=r("String","replaceAll"),EE}var ME,jB;function oye(){if(jB)return ME;jB=1;var r=sye();return ME=r,ME}oye();function rH(r){return r&&typeof r=="object"&&"parents"in r}function iH(r){for(let e=0,t=r.parents.length;e<t;e++)if(r.parents[e].__unsafe__getWithoutCapture(!0),r.parents[e].lastChangedEpoch!==r.parentEpochs[e])return!0;return!1}function Y0(r,e){if(r.children.remove(e)&&r.children.isEmpty&&rH(r))for(let t=0,n=r.parents.length;t<n;t++)Y0(r.parents[t],r)}function ZO(r,e){if(r.children.add(e)&&rH(r))for(let t=0,n=r.parents.length;t<n;t++)ZO(r.parents[t],r)}function sH(r,e){return r===e||Object.is(r,e)||!!(r&&e&&typeof r.equals=="function"&&r.equals(e))}function ic(r,e){const t=Symbol.for(`com.tldraw.state/${r}`),n=globalThis;return n[t]??=e(),n[t]}const gn=ic("empty_array",()=>Object.freeze([])),LB=8;class X0{arraySize=0;array=Array(LB);set=null;get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<LB?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const n=this.array[t];typeof n<"u"&&e(n)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let e=0;e<this.arraySize;e++){const t=this.array[e];typeof t<"u"&&(yield t)}else if(this.set)yield*this.set;else throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const ds=Symbol.for("com.tldraw.state/RESET_VALUE");class oH{constructor(e){this.capacity=e,this.buffer=new Array(e)}index=0;buffer;pushEntry(e,t,n){if(n!==void 0){if(n===ds){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:n,buffer:i}=this;for(let s=0;s<n;s++){const o=(t-1+n-s)%n,a=i[o];if(!a)return ds;const[l,c]=a;if(s===0&&e>=c)return[];if(l<=e&&e<c){const u=s+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=i[(o+h)%n][2];return d}}return ds}}const vl=-1;class aye{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=vl;lastReactedEpoch=vl;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new X0;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Ki()){if(this.parents.length&&!iH(this)){this.lastReactedEpoch=Ki();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)ZO(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Y0(this.parents[e],this)}execute(){try{uH(this);const e=Ki(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{dH()}}}const Bd=ic("EffectScheduler",()=>aye);function Zi(r,e,t){const n=new Bd(r,e,t);return n.attach(),n.scheduleEffect(),()=>{n.detach()}}function lye(r,e,t){const n=new Bd(r,e,t);return{scheduler:n,start:i=>{const s=i?.force??!1;n.attach(),s?n.scheduleEffect():n.maybeScheduleEffect()},stop:()=>{n.detach()}}}let cye=class{constructor(e,t){this.parent=e,this.isSync=t}asyncProcessCount=0;initialAtomValues=new Map;get isRoot(){return this.parent===null}commit(){if(xt.globalIsReacting)for(const e of this.initialAtomValues.keys())lH(e);else this.isRoot?aH(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){xt.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}};const xt=ic("transactions",()=>({globalEpoch:vl+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:vl+1}));function uye(){return xt.reactionEpoch}function Ki(){return xt.globalEpoch}function dye(){return xt.globalIsReacting}function QO(r,e){e.lastTraversedEpoch!==xt.globalEpoch&&(e.lastTraversedEpoch=xt.globalEpoch,e instanceof Bd?r.add(e):e.children.visit(t=>QO(r,t)))}function aH(r){if(xt.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=xt.currentTransaction;try{xt.currentTransaction=null,xt.globalIsReacting=!0,xt.reactionEpoch=xt.globalEpoch;const t=new Set;for(const i of r)i.children.visit(s=>QO(t,s));for(const i of t)i.maybeScheduleEffect();let n=0;for(;xt.cleanupReactors?.size;){if(n++>1e3)throw new Error("Reaction update depth limit exceeded");const i=xt.cleanupReactors;xt.cleanupReactors=null;for(const s of i)s.maybeScheduleEffect()}}finally{xt.cleanupReactors=null,xt.globalIsReacting=!1,xt.currentTransaction=e}}function hye(r,e){xt.currentTransaction?xt.currentTransaction.initialAtomValues.has(r)||xt.currentTransaction.initialAtomValues.set(r,e):xt.globalIsReacting?lH(r):aH([r])}function lH(r){const e=xt.cleanupReactors??=new Set;r.children.visit(t=>QO(e,t))}function fye(){xt.globalEpoch++}function pye(r){const e=new cye(xt.currentTransaction,!0);xt.currentTransaction=e;try{let t,n=!1;try{t=r(()=>n=!0)}catch(i){throw e.abort(),i}if(xt.currentTransaction!==e)throw new Error("Transaction boundaries overlap");return n?e.abort():e.commit(),t}finally{xt.currentTransaction=e.parent}}function hs(r){return xt.currentTransaction?r():pye(r)}let UB=!1;function mye(){UB||(UB=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const hr=Symbol.for("com.tldraw.state/UNINITIALIZED");function Cu(r){return r===hr}const TP=ic("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function Qp(r,e){return new TP(r,e)}class gye{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new oH(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??sH}lastChangedEpoch=vl;lastTraversedEpoch=vl;__debug_ancestor_epochs__=null;lastCheckedEpoch=vl;parentSet=new X0;parents=[];parentEpochs=[];children=new X0;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=hr;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){const t=this.lastChangedEpoch===vl,n=Ki();if(!t&&(this.lastCheckedEpoch===n||this.isActivelyListening&&dye()&&this.lastTraversedEpoch<uye()||!iH(this)))if(this.lastCheckedEpoch=n,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{uH(this);const i=this.derive(this.state,this.lastCheckedEpoch),s=i instanceof TP?i.value:i,o=this.state===hr;if(o||!this.isEqual(s,this.state)){if(this.historyBuffer&&!o){const a=i instanceof TP?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Ki(),a??this.computeDiff?.(this.state,s,this.lastCheckedEpoch,Ki())??ds)}this.lastChangedEpoch=Ki(),this.state=s}return this.error=null,this.lastCheckedEpoch=Ki(),this.state}catch(i){if(this.state!==hr&&(this.state=hr,this.lastChangedEpoch=Ki()),this.lastCheckedEpoch=Ki(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!e)throw i;return this.state}finally{dH()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Z0(this)}}getDiffSince(e){return this.__unsafe__getWithoutCapture(!0),Z0(this),e>=this.lastChangedEpoch?gn:this.historyBuffer?.getChangesSince(e)??ds}}const nS=ic("Computed",()=>gye);function yye(r={},e,t,n){const i=n.value,s=Symbol.for("__@tldraw/state__computed__"+t);return n.value=function(){let o=this[s];return o||(o=new nS(t,i.bind(this),r),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},n.value[cH]=!0,n}function xye(r={},e,t,n){const i=n.get,s=Symbol.for("__@tldraw/state__computed__"+t);return n.get=function(){let o=this[s];return o||(o=new nS(t,i.bind(this),r),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},n}function Sye(r,e,t){se(t.kind==="method","@computed can only be used on methods");const n=Symbol.for("__@tldraw/state__computed__"+String(t.name)),i=function(){let s=this[n];return s||(s=new nS(String(t.name),e.bind(this),r),Object.defineProperty(this,n,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()};return i[cH]=!0,i}function WB(r={},e){if(e.length===2){const[t,n]=e;return Sye(r,t,n)}else{const[t,n,i]=e;return i.get?(mye(),xye(r,t,n,i)):yye(r,t,n,i)}}const cH="@@__isComputedMethod__@@";function q(){if(arguments.length===1){const r=arguments[0];return(...e)=>WB(r,e)}else return typeof arguments[0]=="string"?new nS(arguments[0],arguments[1],arguments[2]):WB(void 0,arguments)}function eN(r){return!!(r&&r instanceof nS)}class wye{constructor(e,t){this.below=e,this.child=t}offset=0;maybeRemoved}const jt=ic("capture",()=>({stack:null}));function em(r){const e=jt.stack;jt.stack=null;try{return r()}finally{jt.stack=e}}function uH(r){if(jt.stack=new wye(jt.stack,r),r.__debug_ancestor_epochs__){const e=r.__debug_ancestor_epochs__;r.__debug_ancestor_epochs__=null;for(const t of r.parents)t.__unsafe__getWithoutCapture(!0);bye(r,e)}r.parentSet.clear()}function dH(){const r=jt.stack;if(jt.stack=r.below,r.offset<r.child.parents.length){for(let e=r.offset;e<r.child.parents.length;e++){const t=r.child.parents[e];r.child.parentSet.has(t)||Y0(t,r.child)}r.child.parents.length=r.offset,r.child.parentEpochs.length=r.offset}if(r.maybeRemoved)for(let e=0;e<r.maybeRemoved.length;e++){const t=r.maybeRemoved[e];r.child.parentSet.has(t)||Y0(t,r.child)}r.child.__debug_ancestor_epochs__&&hH(r.child,r.child.__debug_ancestor_epochs__)}function Z0(r){if(jt.stack){if(jt.stack.child.parentSet.has(r))return;if(jt.stack.child.parentSet.add(r),jt.stack.child.isActivelyListening&&ZO(r,jt.stack.child),jt.stack.offset<jt.stack.child.parents.length){const t=jt.stack.child.parents[jt.stack.offset];t!==r&&(jt.stack.maybeRemoved?jt.stack.maybeRemoved.push(t):jt.stack.maybeRemoved=[t])}jt.stack.child.parents[jt.stack.offset]=r,jt.stack.child.parentEpochs[jt.stack.offset]=r.lastChangedEpoch,jt.stack.offset++}}function hH(r,e){for(let t=0;t<r.parents.length;t++){const n=r.parents[t],i=r.parentEpochs[t];e.set(n,i),eN(n)&&hH(n,e)}return e}function fH(r,e){const t={};for(let n=0;n<r.parents.length;n++){const i=r.parents[n];if(!e.has(i))continue;const s=e.get(i);i.lastChangedEpoch!==s&&(eN(i)?t[i.name]=fH(i,e):t[i.name]=null)}return t}function bye(r,e){const t=fH(r,e);if(Object.keys(t).length===0){console.log(`Effect(${r.name}) was executed manually.`);return}let n=eN(r)?`Computed(${r.name}) is recomputing because:`:`Effect(${r.name}) is executing because:`;function i(s,o){const a=`
`+" ".repeat(o)+" ";for(const[l,c]of Object.entries(s))c?(n+=`${a}Computed(${l}) changed`,i(c,o+2)):n+=`${a}Atom(${l}) changed`}i(t,1),console.log(n)}class vye{constructor(e,t,n){this.name=e,this.current=t,this.isEqual=n?.isEqual??null,n&&(n.historyLength&&(this.historyBuffer=new oH(n.historyLength)),this.computeDiff=n.computeDiff)}isEqual;computeDiff;lastChangedEpoch=Ki();children=new X0;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return Z0(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??sH(this.current,e))return this.current;fye(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Ki(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,Ki())??ds),this.lastChangedEpoch=Ki();const n=this.current;return this.current=e,hye(this,n),e}update(e){return this.set(e(this.current))}getDiffSince(e){return Z0(this),e>=this.lastChangedEpoch?gn:this.historyBuffer?.getChangesSince(e)??ds}}const kye=ic("Atom",()=>vye);function Ft(r,e,t){return new kye(r,e,t)}const pH=1,Cye=ic("apiVersion",()=>pH);if(Cye!==pH)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");ec("@tldraw/state","4.2.1","esm");function a1(r,e,t=[]){const n=Be.useRef(e);n.current=e;const[i,s,o]=Be.useMemo(()=>{let a=null;const l=d=>(a=d,()=>{a=null}),c=new Bd(`useStateTracking(${r})`,()=>n.current?.(),{scheduleEffect(){a?.()}});return[c,l,()=>c.scheduleCount]},[r,...t]);return Be.useSyncExternalStore(s,o,o),Be.useEffect(()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()}),[i]),i.execute()}const HB={apply(r,e,t){return a1(r.displayName??r.name??"tracked(???)",()=>r.apply(e,t))}},Tye=Symbol.for("react.memo"),Eye=Symbol.for("react.forward_ref");function In(r){let e=null;const t=r.$$typeof;return t===Tye&&(r=r.type,e=r.compare),t===Eye?k.memo(k.forwardRef(new Proxy(r.render,HB))):k.memo(new Proxy(r,HB),e)}function rS(r,e,t){return k.useState(()=>{const n=typeof e=="function"?e():e;return Ft(`useAtom(${r})`,n,t)})[0]}function Mye(){const r=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],n=arguments.length===3?arguments[2]:arguments[3];return k.useMemo(()=>q(`useComputed(${r})`,e,t),n)}function cd(r,e,t=gn){k.useEffect(()=>{const n=new Bd(r,e);return n.attach(),n.execute(),()=>{n.detach()}},t)}function tN(r,e,t=[]){k.useEffect(()=>{let n;const i=new Bd(r,e,{scheduleEffect:s=>{n=LO(s)}});return i.attach(),i.execute(),()=>{i.detach(),n?.()}},t)}function F(){const r=arguments,e=r.length===3?r[2]:[r[0]],t=r.length===3?r[0]:`useValue(${r[0].name})`,{$val:n,subscribe:i,getSnapshot:s}=k.useMemo(()=>{const o=r.length===1?r[0]:q(t,r[1]);return{$val:o,subscribe:a=>Zi(`useValue(${t})`,()=>{try{o.get()}catch{}a()}),getSnapshot:()=>o.lastChangedEpoch}},e);return k.useSyncExternalStore(i,s,s),n.__unsafe__getWithoutCapture()}ec("@tldraw/state-react","4.2.1","esm");/*!
 * This file was lovingly and delicately extracted from Immutable.js
 * MIT License: https://github.com/immutable-js/immutable-js/blob/main/LICENSE
 * Copyright (c) 2014-present, Lee Byron and other contributors.
 */function nN(r){return r>>>1&1073741824|r&3221225471}const Iye=Object.prototype.valueOf;function ud(r){if(r==null)return qB(r);if(typeof r.hashCode=="function")return nN(r.hashCode(r));const e=Oye(r);if(e==null)return qB(e);switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return Pye(e);case"string":return e.length>Nye?Aye(e):EP(e);case"object":case"function":return Rye(e);case"symbol":return $ye(e);default:if(typeof e.toString=="function")return EP(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function qB(r){return r===null?1108378658:1108378659}function Pye(r){if(r!==r||r===1/0)return 0;let e=r|0;for(e!==r&&(e^=r*4294967295);r>4294967295;)r/=4294967295,e^=r;return nN(e)}function Aye(r){let e=AE[r];return e===void 0&&(e=EP(r),PE===_ye&&(PE=0,AE={}),PE++,AE[r]=e),e}function EP(r){let e=0;for(let t=0;t<r.length;t++)e=31*e+r.charCodeAt(t)|0;return nN(e)}function $ye(r){let e=JB[r];return e!==void 0||(e=mH(),JB[r]=e),e}function Rye(r){let e=KB.get(r);return e!==void 0||(e=mH(),KB.set(r,e)),e}function Oye(r){return r.valueOf!==Iye&&typeof r.valueOf=="function"?r.valueOf(r):r}function mH(){const r=++IE;return IE&1073741824&&(IE=0),r}const KB=new WeakMap,JB=Object.create(null);let IE=0;const Nye=16,_ye=255;let PE=0,AE={};const Af=5,iS=1<<Af,$f=iS-1,Wa={};function VB(){return{value:!1}}function Qs(r){r&&(r.value=!0)}function rN(r,e){e=e||0;const t=Math.max(0,r.length-e),n=new Array(t);for(let i=0;i<t;i++)n[i]=r[i+e];return n}const Rf=Object.is;class gH{}class iN{_root;size;__ownerID;__hash;__altered;constructor(e){return e==null?lf():e instanceof iN?e:lf().withMutations(t=>{for(const[n,i]of e)t.set(n,i)})}get(e,t){return this._root?this._root.get(0,void 0,e,t):t}set(e,t){return XB(this,e,t)}delete(e){return XB(this,e,Wa)}deleteAll(e){return this.withMutations(t=>{for(const n of e)t.delete(n)})}__ensureOwner(e){return e===this.__ownerID?this:e?aN(this.size,this._root,e,this.__hash):this.size===0?lf():(this.__ownerID=e,this.__altered=!1,this)}withMutations(e){const t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new gH)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new $E(this,Dye,!1)}keys(){return new $E(this,yH,!1)}values(){return new $E(this,xH,!1)}}class sN{constructor(e,t){this.ownerID=e,this.entries=t}get(e,t,n,i){const s=this.entries;for(let o=0,a=s.length;o<a;o++)if(Rf(n,s[o][0]))return s[o][1];return i}update(e,t,n,i,s,o,a){const l=s===Wa,c=this.entries;let u=0;const d=c.length;for(;u<d&&!Rf(i,c[u][0]);u++);const h=u<d;if(h?c[u][1]===s:l)return this;if(Qs(a),(l||!h)&&Qs(o),l&&c.length===1)return;if(!h&&!l&&c.length>=Hye)return Bye(e,c,i,s);const f=e&&e===this.ownerID,p=f?c:rN(c);return h?l?u===d-1?p.pop():p[u]=p.pop():p[u]=[i,s]:p.push([i,s]),f?(this.entries=p,this):new sN(e,p)}}class l1{constructor(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}get(e,t,n,i){t===void 0&&(t=ud(n));const s=1<<((e===0?t:t>>>e)&$f),o=this.bitmap;return(o&s)===0?i:this.nodes[QB(o&s-1)].get(e+Af,t,n,i)}update(e,t,n,i,s,o,a){n===void 0&&(n=ud(i));const l=(t===0?n:n>>>t)&$f,c=1<<l,u=this.bitmap,d=(u&c)!==0;if(!d&&s===Wa)return this;const h=QB(u&c-1),f=this.nodes,p=d?f[h]:void 0,m=lN(p,e,t+Af,n,i,s,o,a);if(m===p)return this;if(!d&&m&&f.length>=qye)return Lye(e,f,u,l,m);if(d&&!m&&f.length===2&&ZB(f[h^1]))return f[h^1];if(d&&m&&f.length===1&&ZB(m))return m;const g=e&&e===this.ownerID,y=d?m?u:u^c:u|c,S=d?m?SH(f,h,m,g):Wye(f,h,g):Uye(f,h,m,g);return g?(this.bitmap=y,this.nodes=S,this):new l1(e,y,S)}}class oN{constructor(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}get(e,t,n,i){t===void 0&&(t=ud(n));const s=(e===0?t:t>>>e)&$f,o=this.nodes[s];return o?o.get(e+Af,t,n,i):i}update(e,t,n,i,s,o,a){n===void 0&&(n=ud(i));const l=(t===0?n:n>>>t)&$f,c=s===Wa,u=this.nodes,d=u[l];if(c&&!d)return this;const h=lN(d,e,t+Af,n,i,s,o,a);if(h===d)return this;let f=this.count;if(!d)f++;else if(!h&&(f--,f<Kye))return jye(e,u,f,l);const p=e&&e===this.ownerID,m=SH(u,l,h,p);return p?(this.count=f,this.nodes=m,this):new oN(e,f,m)}}class c1{constructor(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}get(e,t,n,i){const s=this.entries;for(let o=0,a=s.length;o<a;o++)if(Rf(n,s[o][0]))return s[o][1];return i}update(e,t,n,i,s,o,a){n===void 0&&(n=ud(i));const l=s===Wa;if(n!==this.keyHash)return l?this:(Qs(a),Qs(o),cN(this,e,t,n,[i,s]));const c=this.entries;let u=0;const d=c.length;for(;u<d&&!Rf(i,c[u][0]);u++);const h=u<d;if(h?c[u][1]===s:l)return this;if(Qs(a),(l||!h)&&Qs(o),l&&d===2)return new jd(e,this.keyHash,c[u^1]);const f=e&&e===this.ownerID,p=f?c:rN(c);return h?l?u===d-1?p.pop():p[u]=p.pop():p[u]=[i,s]:p.push([i,s]),f?(this.entries=p,this):new c1(e,this.keyHash,p)}}class jd{constructor(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}get(e,t,n,i){return Rf(n,this.entry[0])?this.entry[1]:i}update(e,t,n,i,s,o,a){const l=s===Wa,c=Rf(i,this.entry[0]);if(c?s===this.entry[1]:l)return this;if(Qs(a),l){Qs(o);return}return c?e&&e===this.ownerID?(this.entry[1]=s,this):new jd(e,this.keyHash,[i,s]):(Qs(o),cN(this,e,t,ud(i),[i,s]))}}class $E{constructor(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&GB(e._root)}_stack;[Symbol.iterator](){return this}next(){const e=this._type;let t=this._stack;for(;t;){const n=t.node,i=t.index++;let s;if(n.entry){if(i===0)return RE(e,n.entry)}else if("entries"in n&&n.entries){if(s=n.entries.length-1,i<=s)return RE(e,n.entries[this._reverse?s-i:i])}else if(s=n.nodes.length-1,i<=s){const o=n.nodes[this._reverse?s-i:i];if(o){if(o.entry)return RE(e,o.entry);t=this._stack=GB(o,t)}continue}t=this._stack=this._stack.__prev}return zye()}}function RE(r,e){return Fye(r,e[0],e[1])}function GB(r,e){return{node:r,index:0,__prev:e}}const yH=0,xH=1,Dye=2;function Fye(r,e,t,n){const i=r===yH?e:r===xH?t:[e,t];return n?n.value=i:n={value:i,done:!1},n}function zye(){return{value:void 0,done:!0}}function aN(r,e,t,n){const i=Object.create(iN.prototype);return i.size=r,i._root=e,i.__ownerID=t,i.__hash=n,i.__altered=!1,i}let YB;function lf(){return YB||(YB=aN(0))}function XB(r,e,t){let n,i;if(r._root){const s=VB(),o=VB();if(n=lN(r._root,r.__ownerID,0,void 0,e,t,s,o),!o.value)return r;i=r.size+(s.value?t===Wa?-1:1:0)}else{if(t===Wa)return r;i=1,n=new sN(r.__ownerID,[[e,t]])}return r.__ownerID?(r.size=i,r._root=n,r.__hash=void 0,r.__altered=!0,r):n?aN(i,n):lf()}function lN(r,e,t,n,i,s,o,a){return r?r.update(e,t,n,i,s,o,a):s===Wa?r:(Qs(a),Qs(o),new jd(e,n,[i,s]))}function ZB(r){return r.constructor===jd||r.constructor===c1}function cN(r,e,t,n,i){if(r.keyHash===n)return new c1(e,n,[r.entry,i]);const s=(t===0?r.keyHash:r.keyHash>>>t)&$f,o=(t===0?n:n>>>t)&$f;let a;const l=s===o?[cN(r,e,t+Af,n,i)]:(a=new jd(e,n,i),s<o?[r,a]:[a,r]);return new l1(e,1<<s|1<<o,l)}function Bye(r,e,t,n){r||(r=new gH);let i=new jd(r,ud(t),[t,n]);for(let s=0;s<e.length;s++){const o=e[s];i=i.update(r,0,void 0,o[0],o[1])}return i}function jye(r,e,t,n){let i=0,s=0;const o=new Array(t);for(let a=0,l=1,c=e.length;a<c;a++,l<<=1){const u=e[a];u!==void 0&&a!==n&&(i|=l,o[s++]=u)}return new l1(r,i,o)}function Lye(r,e,t,n,i){let s=0;const o=new Array(iS);for(let a=0;t!==0;a++,t>>>=1)o[a]=t&1?e[s++]:void 0;return o[n]=i,new oN(r,s+1,o)}function QB(r){return r-=r>>1&1431655765,r=(r&858993459)+(r>>2&858993459),r=r+(r>>4)&252645135,r+=r>>8,r+=r>>16,r&127}function SH(r,e,t,n){const i=n?r:rN(r);return i[e]=t,i}function Uye(r,e,t,n){const i=r.length+1;if(n&&e+1===i)return r[e]=t,r;const s=new Array(i);let o=0;for(let a=0;a<i;a++)a===e?(s[a]=t,o=-1):s[a]=r[a+o];return s}function Wye(r,e,t){const n=r.length-1;if(t&&e===n)return r.pop(),r;const i=new Array(n);let s=0;for(let o=0;o<n;o++)o===e&&(s=1),i[o]=r[o+s];return i}const Hye=iS/4,qye=iS/2,Kye=iS/4;class MP{constructor(e,t){this.name=e;let n=lf();t&&(n=n.withMutations(i=>{for(const[s,o]of t)i.set(s,Ft(`${e}:${String(s)}`,o))})),this.atoms=Ft(`${e}:atoms`,n)}atoms;getAtom(e){const t=this.atoms.__unsafe__getWithoutCapture().get(e);if(!t){this.atoms.get();return}return t}get(e){const t=this.getAtom(e)?.get();return se(t!==hr),t}__unsafe__getWithoutCapture(e){const t=this.atoms.__unsafe__getWithoutCapture().get(e);if(!t)return;const n=t.__unsafe__getWithoutCapture();return se(n!==hr),n}has(e){const t=this.getAtom(e);return t?t.get()!==hr:!1}__unsafe__hasWithoutCapture(e){const t=this.atoms.__unsafe__getWithoutCapture().get(e);return t?(se(t.__unsafe__getWithoutCapture()!==hr),!0):!1}set(e,t){const n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?n.set(t):this.atoms.update(i=>i.set(e,Ft(`${this.name}:${String(e)}`,t))),this}update(e,t){const n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n)throw new Error(`AtomMap: key ${e} not found`);const i=n.__unsafe__getWithoutCapture();se(i!==hr),n.set(t(i))}delete(e){const t=this.atoms.__unsafe__getWithoutCapture().get(e);return t?(hs(()=>{t.set(hr),this.atoms.update(n=>n.delete(e))}),!0):!1}deleteMany(e){return hs(()=>{const t=[],n=this.atoms.get().withMutations(i=>{for(const s of e){const o=i.get(s);if(!o)continue;const a=o.get();se(a!==hr),t.push([s,a]),i.delete(s),o.set(hr)}});return t.length&&this.atoms.set(n),t})}clear(){return hs(()=>{for(const e of this.atoms.__unsafe__getWithoutCapture().values())e.set(hr);this.atoms.set(lf())})}*entries(){for(const[e,t]of this.atoms.get()){const n=t.get();se(n!==hr),yield[e,n]}}*keys(){for(const e of this.atoms.get().keys())yield e}*values(){for(const e of this.atoms.get().values()){const t=e.get();se(t!==hr),yield t}}get size(){return this.atoms.get().size}forEach(e,t){for(const[n,i]of this.entries())e.call(t,i,n,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"}class Cb{constructor(e){this.previousValue=e}nextValue;diff;get(){const e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){const t=this.previousValue.has(e);if(t)return this.diff?.removed?.has(e)?this._add(e,t):void 0;this.nextValue?.has(e)||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){const t=this.previousValue.has(e);if(!t)return this.diff?.added?.has(e)?this._remove(e,t):void 0;this.diff?.removed?.has(e)||this._remove(e,t)}}function Jye(r){const e=[];for(let t=r.length-1;t>=0;t--){const n=r[t];if("id"in n)e.unshift(n);else{const i=n.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:i.concat(s.dependsOn??[])})}}return e}function cf({sequence:r,sequenceId:e,retroactive:t=!0}){const n={sequenceId:e,retroactive:t,sequence:Jye(r)};return wH(n),n}function ns(r,e){return Object.fromEntries(fi(e).map(([t,n])=>[t,`${r}/${n}`]))}function xs(r){const e=r.sequenceId;return cf({sequenceId:e,retroactive:r.retroactive??!0,sequence:r.sequence.map(t=>"id"in t?{...t,scope:"record",filter:n=>n.typeName===r.recordType&&(t.filter?.(n)??!0)&&(r.filter?.(n)??!0)}:t)})}function Vye(r){if(r.length===0)return[];const e=new Map(r.map(l=>[l.id,l])),t=new Map,n=new Map,i=new Map;for(const l of r)n.set(l.id,0),t.set(l.id,new Set),i.set(l.id,new Set);for(const l of r){const{version:c,sequenceId:u}=Q0(l.id),d=`${u}/${c-1}`;if(e.has(d)&&(t.get(d).add(l.id),n.set(l.id,n.get(l.id)+1)),l.dependsOn)for(const h of l.dependsOn)e.has(h)&&(t.get(h).add(l.id),i.get(l.id).add(h),n.set(l.id,n.get(l.id)+1))}const s=r.filter(l=>n.get(l.id)===0),o=[],a=new Set;for(;s.length>0;){let l,c=-1/0;for(const d of s){let h=0;for(const f of t.get(d.id)||[])a.has(f)||(h+=1,i.get(f).has(d.id)&&(h+=100));(h>c||h===c&&d.id.localeCompare(l?.id??"")<0)&&(l=d,c=h)}const u=l;s.splice(s.indexOf(u),1),o.push(u),a.add(u.id);for(const d of t.get(u.id)||[])a.has(d)||(n.set(d,n.get(d)-1),n.get(d)===0&&s.push(e.get(d)))}if(o.length!==r.length){const l=r.filter(c=>!a.has(c.id));se(!1,`Circular dependency in migrations: ${l[0].id}`)}return o}function Q0(r){const[e,t]=r.split("/");return{sequenceId:e,version:parseInt(t)}}function ej(r,e){e&&se(r.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${r}'`),se(r.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${r}'`)}function wH(r){if(se(!r.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${r.sequenceId}`),se(r.sequenceId.length,"sequenceId must be a non-empty string"),r.sequence.length===0)return;ej(r.sequence[0].id,r.sequenceId);let e=Q0(r.sequence[0].id).version;se(e===1,`Expected the first migrationId to be '${r.sequenceId}/1' but got '${r.sequence[0].id}'`);for(let t=1;t<r.sequence.length;t++){const n=r.sequence[t].id;ej(n,r.sequenceId);const i=Q0(n).version;se(i===e+1,`Migration id numbers must increase in increments of 1, expected ${r.sequenceId}/${e+1} but got '${r.sequence[t].id}'`),e=i}}var fl=(r=>(r.IncompatibleSubtype="incompatible-subtype",r.UnknownType="unknown-type",r.TargetVersionTooNew="target-version-too-new",r.TargetVersionTooOld="target-version-too-old",r.MigrationError="migration-error",r.UnrecognizedSubtype="unrecognized-subtype",r))(fl||{});function ev(){return{added:{},updated:{},removed:{}}}function IP(r){const e={added:r.removed,removed:r.added,updated:{}};for(const[t,n]of Object.values(r.updated))e.updated[t.id]=[n,t];return e}function bH(r){return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0}function uN(r,e){const t=e?.mutateFirstDiff?r[0]:{added:{},removed:{},updated:{}};return qg(t,r),t}function qg(r,e){for(const t of e){for(const[n,i]of fi(t.added))if(r.removed[n]){const s=r.removed[n];delete r.removed[n],s!==i&&(r.updated[n]=[s,i])}else r.added[n]=i;for(const[n,[i,s]]of fi(t.updated)){if(r.added[n]){r.added[n]=s,delete r.updated[n],delete r.removed[n];continue}if(r.updated[n]){r.updated[n]=[r.updated[n][0],s],delete r.removed[n];continue}r.updated[n]=t.updated[n],delete r.removed[n]}for(const[n,i]of fi(t.removed))r.added[n]?delete r.added[n]:r.updated[n]?(r.removed[n]=r.updated[n][0],delete r.updated[n]):r.removed[n]=i}}class u1{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:i=>i},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const n=new Set;if(t.ephemeralKeys)for(const[i,s]of fi(t.ephemeralKeys))s&&n.add(i);this.ephemeralKeySet=n}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){const t={...this.createDefaultProperties(),id:"id"in e?e.id:this.createId()};for(const[n,i]of Object.entries(e))i!==void 0&&(t[n]=i);return t.typeName=this.typeName,t}clone(e){return{...vn(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??ft())}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return e?.typeName===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new u1(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function ma(r,e){return new u1(r,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Gye(r){if(r.length===0)return new Set;const e=r[0],t=r.slice(1),n=new Set;for(const i of e)t.every(s=>s.has(i))&&n.add(i);return n}function Yye(r,e){const t={};for(const n of e)r.has(n)||(t.added??=new Set,t.added.add(n));for(const n of r)e.has(n)||(t.removed??=new Set,t.removed.add(n));return t.added||t.removed?t:void 0}function vH(r){return typeof r!="object"||r===null?!1:"eq"in r||"neq"in r||"gt"in r}function kH(r,e=""){const t=[];for(const[n,i]of Object.entries(r)){const s=e?`${e}\\${n}`:n;vH(i)?t.push({path:s,matcher:i}):typeof i=="object"&&i!==null&&t.push(...kH(i,s))}return t}function PP(r,e){for(const[t,n]of Object.entries(r)){const i=e[t];if(vH(n)){if("eq"in n&&i!==n.eq||"neq"in n&&i===n.neq||"gt"in n&&(typeof i!="number"||i<=n.gt))return!1;continue}if(typeof i!="object"||i===null||!PP(n,i))return!1}return!0}function tj(r,e,t){const n=kH(t),i=Object.fromEntries(n.map(({path:s})=>[s,new Set]));for(const{path:s,matcher:o}of n){const a=r.index(e,s);if("eq"in o){const l=a.get().get(o.eq);if(l)for(const c of l)i[s].add(c)}else if("neq"in o){for(const[l,c]of a.get())if(l!==o.neq)for(const u of c)i[s].add(u)}else if("gt"in o){for(const[l,c]of a.get())if(typeof l=="number"&&l>o.gt)for(const u of c)i[s].add(u)}if(i[s].size===0)return new Set}return Gye(Object.values(i))}class Xye{constructor(e,t){this.recordMap=e,this.history=t}indexCache=new Map;historyCache=new Map;getAllIdsForType(e){const t=new Set;for(const n of this.recordMap.values())n.typeName===e&&t.add(n.id);return t}getRecordById(e,t){const n=this.recordMap.get(t);if(n&&n.typeName===e)return n}getNestedValue(e,t){let n=e;for(const i of t){if(n==null||typeof n!="object")return;n=n[i]}return n}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=q("filterHistory:"+e,(n,i)=>{if(Cu(n))return this.history.get();const s=this.history.getDiffSince(i);if(s===ds)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of s){for(const d of pn(u.added))if(d.typeName===e)if(o.removed[d.id]){const h=o.removed[d.id];delete o.removed[d.id],l--,h!==d&&(o.updated[d.id]=[h,d],c++)}else o.added[d.id]=d,a++;for(const[d,h]of pn(u.updated))h.typeName===e&&(o.added[h.id]?o.added[h.id]=h:o.updated[h.id]?o.updated[h.id]=[o.updated[h.id][0],h]:(o.updated[h.id]=[d,h],c++));for(const d of pn(u.removed))d.typeName===e&&(o.added[d.id]?(delete o.added[d.id],a--):o.updated[d.id]?(o.removed[d.id]=o.updated[d.id][0],delete o.updated[d.id],c--,l++):(o.removed[d.id]=d,l++))}return a||l||c?Qp(this.history.get(),o):n},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(n,i),i}__uncached_createIndex(e,t){const n=this.filterHistory(e),i=t.split("\\"),s=i.length>1?a=>this.getNestedValue(a,i):a=>a[t],o=()=>{n.get();const a=new Map;for(const l of this.recordMap.values())if(l.typeName===e){const c=s(l);c!==void 0&&(a.has(c)||a.set(c,new Set),a.get(c).add(l.id))}return a};return q("index:"+e+":"+t,(a,l)=>{if(Cu(a))return o();const c=n.getDiffSince(l);if(c===ds)return o();const u=new Map,d=(m,g)=>{let y=u.get(m);y||(y=new Cb(a.get(m)??new Set)),y.add(g),u.set(m,y)},h=(m,g)=>{let y=u.get(m);y||(y=new Cb(a.get(m)??new Set)),y.remove(g),u.set(m,y)};for(const m of c){for(const g of pn(m.added))if(g.typeName===e){const y=s(g);y!==void 0&&d(y,g.id)}for(const[g,y]of pn(m.updated))if(y.typeName===e){const S=s(g),w=s(y);S!==w&&(S!==void 0&&h(S,y.id),w!==void 0&&d(w,y.id))}for(const g of pn(m.removed))if(g.typeName===e){const y=s(g);y!==void 0&&h(y,g.id)}}let f,p;for(const[m,g]of u){const y=g.get();y&&(f||(f=new Map(a)),p||(p=new Map),y.value.size===0?f.delete(m):f.set(m,y.value),p.set(m,y.diff))}return f&&p?Qp(f,p):a},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,n);return q(n,()=>{for(const s of i.get())return this.recordMap.get(s)})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+n);return q(n,()=>Array.from(i.get(),s=>this.recordMap.get(s)),{isEqual:V0})}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const l=t();return Object.keys(l).length===0?this.getAllIdsForType(e):tj(this,e,l)},o=l=>{const c=s(),u=Yye(l,c);return u?Qp(c,u):l},a=q("ids_query:"+n,t,{isEqual:Yl});return q("query:"+n,(l,c)=>{const u=a.get();if(Cu(l))return s();if(c<a.lastChangedEpoch)return o(l);const d=i.getDiffSince(c);if(d===ds)return o(l);const h=new Cb(l);for(const p of d){for(const m of pn(p.added))m.typeName===e&&PP(u,m)&&h.add(m.id);for(const[m,g]of pn(p.updated))g.typeName===e&&(PP(u,g)?h.add(g.id):h.remove(g.id));for(const m of pn(p.removed))m.typeName===e&&h.remove(m.id)}const f=h.get();return f?Qp(f.value,f.diff):l},{historyLength:50})}exec(e,t){const n=tj(this,e,t);return n.size===0?gn:Array.from(n,i=>this.recordMap.get(i))}}class Zye{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const n=this._beforeCreateHandlers[e.typeName];if(n){let i=e;for(const s of n)i=s(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const n=this._afterCreateHandlers[e.typeName];if(n)for(const i of n)i(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let s=t;for(const o of i)s=o(e,s,n);return s}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const s of i)s(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const n=this._beforeDeleteHandlers[e.typeName];if(n){for(const i of n)if(i(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const n=this._afterDeleteHandlers[e.typeName];if(n)for(const i of n)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[n,i]of Object.entries(e))i?.beforeCreate&&t.push(this.registerBeforeCreateHandler(n,i.beforeCreate)),i?.afterCreate&&t.push(this.registerAfterCreateHandler(n,i.afterCreate)),i?.beforeChange&&t.push(this.registerBeforeChangeHandler(n,i.beforeChange)),i?.afterChange&&t.push(this.registerAfterChangeHandler(n,i.afterChange)),i?.beforeDelete&&t.push(this.registerBeforeDeleteHandler(n,i.beforeDelete)),i?.afterDelete&&t.push(this.registerAfterDeleteHandler(n,i.afterDelete));return()=>{for(const n of t)n()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Vc(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Vc(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Vc(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Vc(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Vc(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Vc(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Vc(this._operationCompleteHandlers,e)}}function Vc(r,e){const t=r.indexOf(e);t>=0&&r.splice(t,1)}class dN{id;records;history=Ft("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new exe;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new Zye(this);constructor(e){const{initialData:t,schema:n,id:i}=e;this.id=i??ft(),this.schema=n,this.props=e.props,t?this.records=new MP("store",fi(t).map(([s,o])=>[s,this.schema.validateRecord(this,o,"initialize",null)])):this.records=new MP("store"),this.query=new Xye(this.records,this.history),this.historyReactor=lye("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=LO(s)}),this.scopedTypes={document:new Set(pn(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(pn(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(pn(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:n}of e){let i=null,s=null,o=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==n))if(l.scope!=="all")if(l.scope==="document"){if(s??=this.filterChangesByScope(t,"document"),!s)continue;a({changes:s,source:n})}else if(l.scope==="session"){if(i??=this.filterChangesByScope(t,"session"),!i)continue;a({changes:i,source:n})}else{if(o??=this.filterChangesByScope(t,"presence"),!o)continue;a({changes:o,source:n})}else a({changes:t,source:n})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const n={added:Hg(e.added,(i,s)=>this.scopedTypes[t].has(s.typeName)),updated:Hg(e.updated,(i,s)=>this.scopedTypes[t].has(s[1].typeName)),removed:Hg(e.removed,(i,s)=>this.scopedTypes[t].has(s.typeName))};return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const n={},i={};let s,o=!1;const a=this.isMergingRemoteChanges?"remote":"user";for(let l=0,c=e.length;l<c;l++){s=e[l];const u=this.records.__unsafe__getWithoutCapture(s.id);if(u){if(s=this.sideEffects.handleBeforeChange(u,s,a),this.schema.validateRecord(this,s,t??"updateRecord",u)===u)continue;s=s,this.records.set(s.id,s),o=!0,n[s.id]=[u,s],this.addDiffForAfterEvent(u,s)}else s=this.sideEffects.handleBeforeCreate(s,a),o=!0,s=this.schema.validateRecord(this,s,t??"createRecord",null),s=s,i[s.id]=s,this.addDiffForAfterEvent(null,s),this.records.set(s.id,s)}o&&this.updateHistory({added:i,updated:n,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set(e),n=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const o of e){const a=this.records.__unsafe__getWithoutCapture(o);a&&this.sideEffects.handleBeforeDelete(a,n)===!1&&t.delete(o)}const i=this.records.deleteMany(t);if(i.length===0)return;const s={};for(const[o,a]of i)s[o]=a,this.addDiffForAfterEvent(a,null);this.updateHistory({added:{},updated:{},removed:s})})}get(e){return this.records.get(e)}unsafeGetWithoutCapture(e){return this.records.__unsafe__getWithoutCapture(e)}serialize(e="document"){const t={};for(const[n,i]of this.records)(e==="all"||this.scopedTypes[e].has(i.typeName))&&(t[n]=i);return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(n)}}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(e,t){const n=this.unsafeGetWithoutCapture(e);if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n)])}has(e){return this.records.has(e)}listen(e,t){this._flushHistory();const n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(n),()=>{this.listeners.delete(n),this.listeners.size===0&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.atomic(e,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],n=this.historyAccumulator.addInterceptor(i=>t.push(i.changes));try{return hs(e),uN(t)}finally{n()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}={}){this.atomic(()=>{const i=pn(e.added);for(const[o,a]of pn(e.updated)){const l=this.schema.getType(a.typeName);if(n&&l.ephemeralKeySet.size){const c=this.get(a.id);if(!c){i.push(a);continue}let u=null;for(const[d,h]of Object.entries(a))l.ephemeralKeySet.has(d)||Object.is(h,Cn(c,d))||(u||(u={...c}),u[d]=h);u&&i.push(u)}else i.push(a)}const s=Wg(e.removed);i.length&&this.put(i),s.length&&this.remove(s)},t)}createCache(e){const t=new Ar;return{get:n=>{const i=this.records.getAtom(n);if(i)return t.get(i,()=>e(n,i)).get()}}}createComputedCache(e,t,n){return this.createCache((i,s)=>{const o=n?.areRecordsEqual?q(`${e}:${i}:isEqual`,()=>s.get(),{isEqual:n.areRecordsEqual}):s;return q(e+":"+i,()=>t(o.get()),{isEqual:n?.areResultsEqual})})}_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,t){if(se(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&se(e.id===t.id),!e&&!t))return;const n=(e||t).id,i=this.pendingAfterEvents.get(n);i?i.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(e){let t=0,n=e?"remote":"user";for(;this.pendingAfterEvents;){const i=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(t++,t>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:o}of i.values())s&&o&&s!==o&&!Yl(s,o)?this.sideEffects.handleAfterChange(s,o,n):s&&!o?this.sideEffects.handleAfterDelete(s,n):!s&&o&&this.sideEffects.handleAfterCreate(o,n);this.pendingAfterEvents?n="user":this.sideEffects.handleOperationComplete(n)}}}_isInAtomicOp=!1;atomic(e,t=!0,n=!1){return hs(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);const s=this.sideEffects.isEnabled();se(!n,"cannot call mergeRemoteChanges while in atomic operation");try{return s&&!t&&this.sideEffects.setIsEnabled(!1),e()}finally{this.sideEffects.setIsEnabled(s)}}this.pendingAfterEvents=new Map;const i=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??i),this._isInAtomicOp=!0,n&&(this.isMergingRemoteChanges=!0);try{const s=e();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(n),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(i),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function Qye(r){if(r.length===0)return[];const e=[];let t=[r[0]],n;for(let i=1,s=r.length;i<s;i++)n=r[i],t[0].source!==n.source&&(e.push(t),t=[]),t.push(n);return e.push(t),e.map(i=>({source:i[0].source,changes:uN(i.map(s=>s.changes))}))}class exe{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=Qye(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function d1(r,e,t){const n=new Ar;return{get(i,s){return n.get(i,()=>(i instanceof dN?i:i.store).createComputedCache(r,l=>e(i,l),t)).get(s)}}}function txe(r){if(r.schemaVersion>2||r.schemaVersion<1)return Go.err("Bad schema version");if(r.schemaVersion===2)return Go.ok(r);const e={schemaVersion:2,sequences:{"com.tldraw.store":r.storeVersion}};for(const[t,n]of Object.entries(r.recordVersions))if(e.sequences[`com.tldraw.${t}`]=n.version,"subTypeKey"in n)for(const[i,s]of Object.entries(n.subTypeVersions))e.sequences[`com.tldraw.${t}.${i}`]=s;return Go.ok(e)}class hN{constructor(e,t){this.types=e,this.options=t;for(const i of t.migrations??[])se(!this.migrations[i.sequenceId],`Duplicate migration sequenceId ${i.sequenceId}`),wH(i),this.migrations[i.sequenceId]=i;const n=Object.values(this.migrations).flatMap(i=>i.sequence);this.sortedMigrations=Vye(n);for(const i of this.sortedMigrations)if(i.dependsOn?.length)for(const s of i.dependsOn){const o=n.find(a=>a.id===s);se(o,`Migration '${i.id}' depends on missing migration '${s}'`)}}static create(e,t){return new hN(e,t??{})}migrations={};sortedMigrations;migrationCache=new WeakMap;validateRecord(e,t,n,i){try{const s=Cn(this.types,t.typeName);if(!s)throw new Error(`Missing definition for record type ${t.typeName}`);return s.validate(t,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const t=this.migrationCache.get(e);if(t)return t;const n=txe(e);if(!n.ok)return this.migrationCache.set(e,n),n;const i=n.value,s=new Set(Object.keys(i.sequences).filter(l=>this.migrations[l]));for(const l in this.migrations)i.sequences[l]===void 0&&this.migrations[l].retroactive&&s.add(l);if(s.size===0){const l=Go.ok([]);return this.migrationCache.set(e,l),l}const o=new Set;for(const l of s){const c=i.sequences[l];if(typeof c!="number"&&this.migrations[l].retroactive||c===0){for(const h of this.migrations[l].sequence)o.add(h.id);continue}const u=`${l}/${c}`,d=this.migrations[l].sequence.findIndex(h=>h.id===u);if(d===-1){const h=Go.err("Incompatible schema?");return this.migrationCache.set(e,h),h}for(const h of this.migrations[l].sequence.slice(d+1))o.add(h.id)}const a=Go.ok(this.sortedMigrations.filter(({id:l})=>o.has(l)));return this.migrationCache.set(e,a),a}migratePersistedRecord(e,t,n="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:fl.MigrationError};let s=i.value;if(s.length===0)return{type:"success",value:e};if(s.some(o=>o.scope==="store"))return{type:"error",reason:n==="down"?fl.TargetVersionTooOld:fl.TargetVersionTooNew};if(n==="down"){if(!s.every(o=>o.down))return{type:"error",reason:fl.TargetVersionTooOld};s=s.slice().reverse()}e=vn(e);try{for(const o of s){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const l=o[n](e);l&&(e=vn(l))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:fl.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e,t){let{store:n}=e;const i=this.getMigrationsSince(e.schema);if(!i.ok)return console.error("Error migrating store",i.error),{type:"error",reason:fl.MigrationError};const s=i.value;if(s.length===0)return{type:"success",value:n};t?.mutateInputStore||(n=vn(n));try{for(const o of s)if(o.scope==="record")for(const[a,l]of Object.entries(n)){if(!(o.filter?o.filter(l):!0))continue;const u=o.up(l);u&&(n[a]=u)}else if(o.scope==="store"){const a=o.up(n);a&&(n=a)}else at(o)}catch(o){return console.error("Error migrating store",o),{type:"error",reason:fl.MigrationError}}return{type:"success",value:n}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?Q0(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Cn(this.types,e);return se(t,"record type does not exists"),t}}ec("@tldraw/store","4.2.1","esm");function nxe(r){if(!r.length)return null;let e="";for(const t of r)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class ct extends Error{constructor(e,t=[]){const n=nxe(t),i=e.split(`
`).map((s,o)=>o===0?s:`  ${s}`).join(`
`);super(t?`At ${n}: ${i}`:i),this.rawMessage=e,this.path=t}name="ValidationError"}function Qi(r,e){try{return e()}catch(t){throw t instanceof ct?new ct(t.rawMessage,[r,...t.path]):new ct(t.toString(),[r])}}function _l(r){if(r===null)return"null";if(Array.isArray(r))return"an array";const e=typeof r;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:at(e)}}class Or{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return cxe(this)}optional(){return TH(this)}refine(e){return new Or(t=>e(this.validate(t)),(t,n)=>{const i=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,i)?t:e(i)})}check(e,t){return typeof e=="string"?this.refine(n=>(Qi(`(check ${e})`,()=>t(n)),n)):this.refine(n=>(e(n),n))}}class rxe extends Or{constructor(e){super(t=>{const n=nj.validate(t);for(let i=0;i<n.length;i++)Qi(i,()=>e.validate(n[i]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);const i=nj.validate(n);let s=t.length!==i.length;for(let o=0;o<i.length;o++){const a=i[o];if(o>=t.length){s=!0,Qi(o,()=>e.validate(a));continue}if(Object.is(t[o],a))continue;const l=Qi(o,()=>e.validateUsingKnownGoodVersion(t[o],a));Object.is(l,t[o])||(s=!0)}return s?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new ct("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ct("Expected an array with length greater than 1")})}}class tv extends Or{constructor(e,t=!1){super(n=>{if(typeof n!="object"||n===null)throw new ct(`Expected object, got ${_l(n)}`);for(const[i,s]of Object.entries(e))Qi(i,()=>{s.validate(Cn(n,i))});if(!t){for(const i of Object.keys(n))if(!Xi(e,i))throw new ct("Unexpected property",[i])}return n},(n,i)=>{if(typeof i!="object"||i===null)throw new ct(`Expected object, got ${_l(i)}`);let s=!1;for(const[o,a]of Object.entries(e)){const l=Cn(n,o),c=Cn(i,o);if(Object.is(l,c))continue;const u=Qi(o,()=>{const d=a;return d.validateUsingKnownGoodVersion?d.validateUsingKnownGoodVersion(l,c):d.validate(c)});Object.is(u,l)||(s=!0)}if(!t){for(const o of Object.keys(i))if(!Xi(e,o))throw new ct("Unexpected property",[o])}for(const o of Object.keys(n))if(!Xi(i,o)){s=!0;break}return s?i:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new tv(this.config,!0)}extend(e){return new tv({...this.config,...e})}}class h1 extends Or{constructor(e,t,n,i){super(s=>{this.expectObject(s);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(s);return o===void 0?this.unknownValueValidation(s,a):Qi(`(${e} = ${a})`,()=>o.validate(s))},(s,o)=>{this.expectObject(o),this.expectObject(s);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,l):Cn(s,e)!==Cn(o,e)?Qi(`(${e} = ${l})`,()=>a.validate(o)):Qi(`(${e} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(s,o):a.validate(o))}),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new ct(`Expected an object, got ${_l(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Cn(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new ct(`Expected a string for key "${this.key}", got ${_l(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new ct(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Xi(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new h1(this.key,this.config,e,this.useNumberKeys)}}class ixe extends Or{constructor(e,t){super(n=>{if(typeof n!="object"||n===null)throw new ct(`Expected object, got ${_l(n)}`);for(const[i,s]of Object.entries(n))Qi(i,()=>{e.validate(i),t.validate(s)});return n},(n,i)=>{if(typeof i!="object"||i===null)throw new ct(`Expected object, got ${_l(i)}`);let s=!1;for(const[o,a]of Object.entries(i)){if(!Xi(n,o)){s=!0,Qi(o,()=>{e.validate(o),t.validate(a)});continue}const l=Cn(n,o),c=a;if(Object.is(l,c))continue;const u=Qi(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(l,c):t.validate(c));Object.is(u,l)||(s=!0)}for(const o of Object.keys(n))if(!Xi(i,o)){s=!0;break}return s?i:n}),this.keyValidator=e,this.valueValidator=t}}function fN(r){return new Or(e=>{if(typeof e!==r)throw new ct(`Expected ${r}, got ${_l(e)}`);return e})}const sxe=new Or(r=>r),oxe=new Or(r=>r),Ze=fN("string"),$e=fN("number").check(r=>{if(Number.isNaN(r))throw new ct("Expected a number, got NaN");if(!Number.isFinite(r))throw new ct(`Expected a finite number, got ${r}`)}),nv=$e.check(r=>{if(r<0)throw new ct(`Expected a positive number, got ${r}`)}),En=$e.check(r=>{if(r<=0)throw new ct(`Expected a non-zero positive number, got ${r}`)}),CH=$e.check(r=>{if(!Number.isInteger(r))throw new ct(`Expected an integer, got ${r}`)}),Tb=CH.check(r=>{if(r<0)throw new ct(`Expected a positive integer, got ${r}`)}),axe=CH.check(r=>{if(r<=0)throw new ct(`Expected a non-zero positive integer, got ${r}`)}),Qe=fN("boolean");function yr(r){return new Or(e=>{if(e!==r)throw new ct(`Expected ${r}, got ${JSON.stringify(e)}`);return r})}const nj=new Or(r=>{if(!Array.isArray(r))throw new ct(`Expected an array, got ${_l(r)}`);return r});function Bn(r){return new rxe(r)}function st(r){return new tv(r)}function AP(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null||Object.getPrototypeOf(r)===ige)}function $P(r){return r===null||typeof r=="number"||typeof r=="string"||typeof r=="boolean"?!0:Array.isArray(r)?r.every($P):AP(r)?Object.values(r).every($P):!1}const tr=new Or(r=>{if($P(r))return r;throw new ct(`Expected json serializable value, got ${typeof r}`)},(r,e)=>{if(Array.isArray(r)&&Array.isArray(e)){let t=r.length!==e.length;for(let n=0;n<e.length;n++){if(n>=r.length){t=!0,tr.validate(e[n]);continue}const i=r[n],s=e[n];if(Object.is(i,s))continue;const o=tr.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}return t?e:r}else if(AP(r)&&AP(e)){let t=!1;for(const n of Object.keys(e)){if(!Xi(r,n)){t=!0,tr.validate(e[n]);continue}const i=r[n],s=e[n];if(Object.is(i,s))continue;const o=tr.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}for(const n of Object.keys(r))if(!Xi(e,n)){t=!0;break}return t?e:r}else return tr.validate(e)});function rv(r,e){return new ixe(r,e)}function pN(r,e){return new h1(r,e,(t,n)=>{throw new ct(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(n)}`,[r])},!1)}function lxe(r,e){return new h1(r,e,(t,n)=>{throw new ct(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(n)}`,[r])},!0)}function ga(r,e){return new Or(t=>Qi(r,()=>e.validate(t)),(t,n)=>Qi(r,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,n):e.validate(n)))}function f1(r){return new Or(e=>{if(!r.has(e)){const t=Array.from(r,n=>JSON.stringify(n)).join(" or ");throw new ct(`Expected ${t}, got ${e}`)}return e})}function TH(r){return new Or(e=>{if(e!==void 0)return r.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return r.validateUsingKnownGoodVersion&&e!==void 0?r.validateUsingKnownGoodVersion(e,t):r.validate(t)})}function cxe(r){return new Or(e=>e===null?null:r.validate(e),(e,t)=>t===null?null:r.validateUsingKnownGoodVersion&&e!==null?r.validateUsingKnownGoodVersion(e,t):r.validate(t))}function dd(...r){return f1(new Set(r))}function mN(r){try{return new URL(r)}catch{if(r.startsWith("/")||r.startsWith("./"))try{return new URL(r,"http://example.com")}catch{throw new ct(`Expected a valid url, got ${JSON.stringify(r)}`)}throw new ct(`Expected a valid url, got ${JSON.stringify(r)}`)}}const uxe=new Set(["http:","https:","mailto:"]),ps=Ze.check(r=>{if(r==="")return;const e=mN(r);if(!uxe.has(e.protocol.toLowerCase()))throw new ct(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)}),dxe=new Set(["http:","https:","data:","asset:"]),hd=Ze.check(r=>{if(r==="")return;const e=mN(r);if(!dxe.has(e.protocol.toLowerCase()))throw new ct(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)});Ze.check(r=>{if(r==="")return;if(!mN(r).protocol.toLowerCase().match(/^https?:$/))throw new ct(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)});const gN=Ze.refine(r=>{try{return Gme(r),r}catch{throw new ct(`Expected an index key, got ${JSON.stringify(r)}`)}});ec("@tldraw/validate","4.2.1","esm");function fs(r){return Ze.refine(e=>{if(!e.startsWith(`${r}:`))throw new Error(`${r} ID must start with "${r}:"`);return e})}const p1=fs("asset");function yN(r,e){return st({id:p1,typeName:yr("asset"),type:yr(r),props:e,meta:tr})}const fd=st({x:$e,y:$e,z:$e.optional()}),Kg=st({x:$e,y:$e,w:$e,h:$e}),EH=$e.check(r=>{if(r<0||r>1)throw new ct("Opacity must be between 0 and 1")}),hxe=Ze.refine(r=>{if(!r.startsWith("page:")&&!r.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return r}),Ps=fs("shape");function fxe(r,e,t){return st({id:Ps,typeName:yr("shape"),x:$e,y:$e,rotation:$e,index:gN,parentId:hxe,type:yr(r),isLocked:Qe,opacity:EH,props:e?st(e):tr,meta:t?st(t):tr})}const pxe=fs("binding");function mxe(r,e,t){return st({id:pxe,typeName:yr("binding"),type:yr(r),fromId:Ps,toId:Ps,props:e?st(e):tr,meta:t?st(t):tr})}ns("com.tldraw.binding",{});xs({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Tu(r){return`binding:${ft()}`}function gxe(r,e){return tc(e,(t,n)=>`com.tldraw.binding.${r}/${n}`)}function yxe(r){return ma("binding",{scope:"document",validator:ga("binding",pN("type",tc(r,(e,{props:t,meta:n})=>mxe(e,t,n))))}).withDefaultProperties(()=>({meta:{}}))}const m1=st({type:Ze,content:Bn(sxe)});function ir(r){return{type:"doc",content:r.split(`
`).map(n=>n?{type:"paragraph",content:[{type:"text",text:n}]}:{type:"paragraph"})}}class qn{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){const{defaultValue:n,type:i=oxe}=t;return new qn(e,n,i)}static defineEnum(e,t){const{defaultValue:n,values:i}=t;return new xxe(e,n,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class xxe extends qn{constructor(e,t,n){super(e,t,dd(...n)),this.values=n}}const HS=ns("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Sxe=xs({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:HS.AddIsLocked,up:r=>{r.isLocked=!1},down:r=>{delete r.isLocked}},{id:HS.HoistOpacity,up:r=>{r.opacity=Number(r.props.opacity??"1"),delete r.props.opacity},down:r=>{const e=r.opacity;delete r.opacity,r.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:HS.AddMeta,up:r=>{r.meta={}}},{id:HS.AddWhite,up:r=>{},down:r=>{r.props.color==="white"&&(r.props.color="black")}}]});function tf(r){return r?r.typeName==="shape":!1}function li(r){return r?r.startsWith("shape:"):!1}function Ct(r){return`shape:${r??ft()}`}function MH(r){const e=new Map;for(const[t,n]of Object.entries(r))if(n instanceof qn){if(e.has(n))throw new Error(`Duplicate style prop ${n.id}. Each style prop can only be used once within a shape.`);e.set(n,t)}return e}function Ws(r,e){return tc(e,(t,n)=>`com.tldraw.shape.${r}/${n}`)}function wxe(r){return ma("shape",{scope:"document",validator:ga("shape",pN("type",tc(r,(e,{props:t,meta:n})=>fxe(e,t,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function rj(r,e){const t=[];for(const[n,{migrations:i}]of Object.entries(e)){const s=`com.tldraw.${r}.${n}`;i?"sequenceId"in i?(se(s===i.sequenceId,`sequenceId mismatch for ${n} ${u1} migrations. Expected '${s}', got '${i.sequenceId}'`),t.push(i)):"sequence"in i?t.push(cf({sequenceId:s,retroactive:!0,sequence:i.sequence.map(o=>"id"in o?IH(r,n,o):o)})):t.push(cf({sequenceId:s,retroactive:!0,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${s}/${o}`,scope:"record",filter:a=>a.typeName===r&&a.type===n,up:a=>{const l=i.migrators[o].up(a);if(l)return l},down:a=>{const l=i.migrators[o].down(a);if(l)return l}}))})):t.push(cf({sequenceId:s,retroactive:!0,sequence:[]}))}return t}function IH(r,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:n=>n.typeName===r&&n.type===e,up:n=>{const i=t.up(n.props);i&&(n.props=i)},down:typeof t.down=="function"?n=>{const i=t.down(n.props);i&&(n.props=i)}:void 0}}const xN=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],iv={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",linedFill:"#363636",frameHeadingStroke:"#717171",frameHeadingFill:"#ffffff",frameStroke:"#717171",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FCE19C",noteText:"#000000",semi:"#e8e8e8",pattern:"#494949",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8205 0.05)"},blue:{solid:"#4465e9",fill:"#4465e9",linedFill:"#6580ec",frameHeadingStroke:"#6681ec",frameHeadingFill:"#f9fafe",frameStroke:"#6681ec",frameFill:"#f9fafe",frameText:"#000000",noteFill:"#8AA3FF",noteText:"#000000",semi:"#dce1f8",pattern:"#6681ee",highlightSrgb:"#10acff",highlightP3:"color(display-p3 0.308 0.6632 0.9996)"},green:{solid:"#099268",fill:"#099268",linedFill:"#0bad7c",frameHeadingStroke:"#37a684",frameHeadingFill:"#f8fcfa",frameStroke:"#37a684",frameFill:"#f8fcfa",frameText:"#000000",noteFill:"#6FC896",noteText:"#000000",semi:"#d3e9e3",pattern:"#39a785",highlightSrgb:"#00ffc8",highlightP3:"color(display-p3 0.2536 0.984 0.7981)"},grey:{solid:"#9fa8b2",fill:"#9fa8b2",linedFill:"#bbc1c9",frameHeadingStroke:"#aaaaab",frameHeadingFill:"#fbfcfc",frameStroke:"#aaaaab",frameFill:"#fcfcfd",frameText:"#000000",noteFill:"#C0CAD3",noteText:"#000000",semi:"#eceef0",pattern:"#bcc3c9",highlightSrgb:"#cbe7f1",highlightP3:"color(display-p3 0.8163 0.9023 0.9416)"},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",linedFill:"#7abaf5",frameHeadingStroke:"#6cb2f3",frameHeadingFill:"#f8fbfe",frameStroke:"#6cb2f3",frameFill:"#fafcff",frameText:"#000000",noteFill:"#9BC4FD",noteText:"#000000",semi:"#ddedfa",pattern:"#6fbbf8",highlightSrgb:"#00f4ff",highlightP3:"color(display-p3 0.1512 0.9414 0.9996)"},"light-green":{solid:"#4cb05e",fill:"#4cb05e",linedFill:"#7ec88c",frameHeadingStroke:"#6dbe7c",frameHeadingFill:"#f8fcf9",frameStroke:"#6dbe7c",frameFill:"#fafdfa",frameText:"#000000",noteFill:"#98D08A",noteText:"#000000",semi:"#dbf0e0",pattern:"#65cb78",highlightSrgb:"#65f641",highlightP3:"color(display-p3 0.563 0.9495 0.3857)"},"light-red":{solid:"#f87777",fill:"#f87777",linedFill:"#f99a9a",frameHeadingStroke:"#f89090",frameHeadingFill:"#fffafa",frameStroke:"#f89090",frameFill:"#fffbfb",frameText:"#000000",noteFill:"#F7A5A1",noteText:"#000000",semi:"#f4dadb",pattern:"#fe9e9e",highlightSrgb:"#ff7fa3",highlightP3:"color(display-p3 0.9988 0.5301 0.6397)"},"light-violet":{solid:"#e085f4",fill:"#e085f4",linedFill:"#e9abf7",frameHeadingStroke:"#e59bf5",frameHeadingFill:"#fefaff",frameStroke:"#e59bf5",frameFill:"#fefbff",frameText:"#000000",noteFill:"#DFB0F9",noteText:"#000000",semi:"#f5eafa",pattern:"#e9acf8",highlightSrgb:"#ff88ff",highlightP3:"color(display-p3 0.9676 0.5652 0.9999)"},orange:{solid:"#e16919",fill:"#e16919",linedFill:"#ea8643",frameHeadingStroke:"#e68544",frameHeadingFill:"#fef9f6",frameStroke:"#e68544",frameFill:"#fef9f6",frameText:"#000000",noteFill:"#FAA475",noteText:"#000000",semi:"#f8e2d4",pattern:"#f78438",highlightSrgb:"#ffa500",highlightP3:"color(display-p3 0.9988 0.6905 0.266)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#e75f5f",frameHeadingStroke:"#e55757",frameHeadingFill:"#fef7f7",frameStroke:"#e55757",frameFill:"#fef9f9",frameText:"#000000",noteFill:"#FC8282",noteText:"#000000",semi:"#f4dadb",pattern:"#e55959",highlightSrgb:"#ff636e",highlightP3:"color(display-p3 0.9992 0.4376 0.45)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#be68d4",frameHeadingStroke:"#bc62d3",frameHeadingFill:"#fcf7fd",frameStroke:"#bc62d3",frameFill:"#fdf9fd",frameText:"#000000",noteFill:"#DB91FD",noteText:"#000000",semi:"#ecdcf2",pattern:"#bd63d3",highlightSrgb:"#c77cff",highlightP3:"color(display-p3 0.7469 0.5089 0.9995)"},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",linedFill:"#f5c27a",frameHeadingStroke:"#f3bb6c",frameHeadingFill:"#fefcf8",frameStroke:"#f3bb6c",frameFill:"#fffdfa",frameText:"#000000",noteFill:"#FED49A",noteText:"#000000",semi:"#f9f0e6",pattern:"#fecb92",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8705 0.05)"},white:{solid:"#FFFFFF",fill:"#FFFFFF",linedFill:"#ffffff",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#7d7d7d",frameHeadingFill:"#ffffff",frameStroke:"#7d7d7d",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FFFFFF",noteText:"#000000",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",linedFill:"#ffffff",frameHeadingStroke:"#5c5c5c",frameHeadingFill:"#252525",frameStroke:"#5c5c5c",frameFill:"#0c0c0c",frameText:"#f2f2f2",noteFill:"#2c2c2c",noteText:"#f2f2f2",semi:"#2c3036",pattern:"#989898",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.6225 0.0312)"},blue:{solid:"#4f72fc",fill:"#4f72fc",linedFill:"#3c5cdd",frameHeadingStroke:"#384994",frameHeadingFill:"#1C2036",frameStroke:"#384994",frameFill:"#11141f",frameText:"#f2f2f2",noteFill:"#2A3F98",noteText:"#f2f2f2",semi:"#262d40",pattern:"#3a4b9e",highlightSrgb:"#0079d2",highlightP3:"color(display-p3 0.0032 0.4655 0.7991)"},green:{solid:"#099268",fill:"#099268",linedFill:"#087856",frameHeadingStroke:"#10513C",frameHeadingFill:"#14241f",frameStroke:"#10513C",frameFill:"#0E1614",frameText:"#f2f2f2",noteFill:"#014429",noteText:"#f2f2f2",semi:"#253231",pattern:"#366a53",highlightSrgb:"#009774",highlightP3:"color(display-p3 0.0085 0.582 0.4604)"},grey:{solid:"#9398b0",fill:"#9398b0",linedFill:"#8388a5",frameHeadingStroke:"#42474D",frameHeadingFill:"#23262A",frameStroke:"#42474D",frameFill:"#151719",frameText:"#f2f2f2",noteFill:"#56595F",noteText:"#f2f2f2",semi:"#33373c",pattern:"#7c8187",highlightSrgb:"#9cb4cb",highlightP3:"color(display-p3 0.6299 0.7012 0.7856)"},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",linedFill:"#2793ec",frameHeadingStroke:"#075797",frameHeadingFill:"#142839",frameStroke:"#075797",frameFill:"#0B1823",frameText:"#f2f2f2",noteFill:"#1F5495",noteText:"#f2f2f2",semi:"#2a3642",pattern:"#4d7aa9",highlightSrgb:"#00bdc8",highlightP3:"color(display-p3 0.0023 0.7259 0.7735)"},"light-green":{solid:"#40c057",fill:"#40c057",linedFill:"#37a44b",frameHeadingStroke:"#1C5427",frameHeadingFill:"#18251A",frameStroke:"#1C5427",frameFill:"#0F1911",frameText:"#f2f2f2",noteFill:"#21581D",noteText:"#f2f2f2",semi:"#2a3830",pattern:"#4e874e",highlightSrgb:"#00a000",highlightP3:"color(display-p3 0.2711 0.6172 0.0195)"},"light-red":{solid:"#ff8787",fill:"#ff8787",linedFill:"#ff6666",frameHeadingStroke:"#6f3232",frameHeadingFill:"#341818",frameStroke:"#6f3232",frameFill:"#181212",frameText:"#f2f2f2",noteFill:"#7a3333",noteText:"#f2f2f2",semi:"#3c2b2b",pattern:"#a56767",highlightSrgb:"#db005b",highlightP3:"color(display-p3 0.7849 0.0585 0.3589)"},"light-violet":{solid:"#e599f7",fill:"#e599f7",linedFill:"#dc71f4",frameHeadingStroke:"#6c367a",frameHeadingFill:"#2D2230",frameStroke:"#6c367a",frameFill:"#1C151E",frameText:"#f2f2f2",noteFill:"#762F8E",noteText:"#f2f2f2",semi:"#383442",pattern:"#9770a9",highlightSrgb:"#c400c7",highlightP3:"color(display-p3 0.7024 0.0403 0.753)"},orange:{solid:"#f76707",fill:"#f76707",linedFill:"#f54900",frameHeadingStroke:"#773a0e",frameHeadingFill:"#2f1d13",frameStroke:"#773a0e",frameFill:"#1c1512",frameText:"#f2f2f2",noteFill:"#7c3905",noteText:"#f2f2f2",semi:"#3b2e27",pattern:"#9f552d",highlightSrgb:"#d07a00",highlightP3:"color(display-p3 0.7699 0.4937 0.0085)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#c31d1d",frameHeadingStroke:"#701e1e",frameHeadingFill:"#301616",frameStroke:"#701e1e",frameFill:"#1b1313",frameText:"#f2f2f2",noteFill:"#7e201f",noteText:"#f2f2f2",semi:"#382726",pattern:"#8f3734",highlightSrgb:"#de002c",highlightP3:"color(display-p3 0.7978 0.0509 0.2035)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#8f2fa7",frameHeadingStroke:"#6d1583",frameHeadingFill:"#27152e",frameStroke:"#6d1583",frameFill:"#1b0f21",frameText:"#f2f2f2",noteFill:"#5f1c70",noteText:"#f2f2f2",semi:"#342938",pattern:"#763a8b",highlightSrgb:"#9e00ee",highlightP3:"color(display-p3 0.5651 0.0079 0.8986)"},yellow:{solid:"#ffc034",fill:"#ffc034",linedFill:"#ffae00",frameHeadingStroke:"#684e12",frameHeadingFill:"#2a2113",frameStroke:"#684e12",frameFill:"#1e1911",frameText:"#f2f2f2",noteFill:"#8a5e1c",noteText:"#f2f2f2",semi:"#3b352b",pattern:"#fecb92",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.7225 0.0312)"},white:{solid:"#f3f3f3",fill:"#f3f3f3",linedFill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#ffffff",frameHeadingFill:"#ffffff",frameStroke:"#ffffff",frameFill:"#ffffff",frameText:"#000000",noteFill:"#eaeaea",noteText:"#1d1d1d",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}}};function sc(r){return r.isDarkMode?iv.darkMode:iv.lightMode}const Oi=qn.defineEnum("tldraw:color",{defaultValue:"black",values:xN}),SN=qn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:xN}),bxe=new Set(xN);function vxe(r){return bxe.has(r)}function ot(r,e,t){return vxe(e)?r[e][t]:e}const pd=qn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Dl=qn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill","lined-fill"]}),Fl=qn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),kxe={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Qo=qn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Cxe=["arc","elbow"],sv=qn.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:Cxe}),PH=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],RP=qn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:PH}),OP=qn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:PH}),AH={kind:sv,labelColor:SN,color:Oi,fill:Dl,dash:pd,size:Qo,arrowheadStart:RP,arrowheadEnd:OP,font:Fl,start:fd,end:fd,bend:$e,richText:m1,labelPosition:$e,scale:En,elbowMidPoint:$e},pl=Ws("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6,AddRichText:7});function Zd(r){return IH("shape","arrow",r)}const $H=cf({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Zd({id:pl.AddLabelColor,up:r=>{r.labelColor="black"},down:"retired"}),Zd({id:pl.AddIsPrecise,up:({start:r,end:e})=>{r.type==="binding"&&(r.isPrecise=!(r.normalizedAnchor.x===.5&&r.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:r,end:e})=>{r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Zd({id:pl.AddLabelPosition,up:r=>{r.labelPosition=.5},down:r=>{delete r.labelPosition}}),{id:pl.ExtractBindings,scope:"store",up:r=>{const e=Object.values(r).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:n,end:i}=t.props;if(n.type==="binding"){const s=Tu(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:n.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:n.normalizedAnchor,isExact:n.isExact,isPrecise:n.isPrecise}};r[s]=o,t.props.start={x:0,y:0}}else delete t.props.start.type;if(i.type==="binding"){const s=Tu(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};r[s]=o,t.props.end={x:0,y:0}}else delete t.props.end.type}}},Zd({id:pl.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}),Zd({id:pl.AddElbow,up:r=>{r.kind="arc",r.elbowMidPoint=.5},down:r=>{delete r.kind,delete r.elbowMidPoint}}),Zd({id:pl.AddRichText,up:r=>{r.richText=ir(r.text),delete r.text}})]}),Txe=dd("center","edge-point","edge","none"),RH={terminal:dd("start","end"),normalizedAnchor:fd,isExact:Qe,isPrecise:Qe,snap:Txe},Exe=gxe("arrow",{AddSnap:1}),OH={sequence:[{dependsOn:[pl.ExtractBindings]},{id:Exe.AddSnap,up:r=>{r.snap="none"},down:r=>{delete r.snap}}]},Mxe=ga("camera",st({typeName:yr("camera"),id:fs("camera"),x:$e,y:$e,z:$e,meta:tr})),Ixe=ns("com.tldraw.camera",{AddMeta:1}),Pxe=xs({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:Ixe.AddMeta,up:r=>{r.meta={}}}]}),Jo=ma("camera",{validator:Mxe,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Axe=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),NH=f1(Axe),$xe=st({type:NH,rotation:$e}),Rxe=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),Oxe=f1(Rxe),Nxe=new Set(["starting","paused","active","stopping"]),_H=st({id:Ze,points:Bn(fd),size:nv,color:Oxe,opacity:$e,state:f1(Nxe),delay:$e,shrink:$e,taper:Qe}),Ay=fs("page"),_xe=ga("page",st({typeName:yr("page"),id:Ay,name:Ze,index:gN,meta:tr})),Dxe=ns("com.tldraw.page",{AddMeta:1}),Fxe=xs({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:Dxe.AddMeta,up:r=>{r.meta={}}}]}),Ci=ma("page",{validator:_xe,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Gn(r){return Ci.isId(r)}const zxe={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function DH(r){return r?Hg(r,e=>zxe[e]):null}fs("instance");function Bxe(r){const e={};for(const[n,i]of r)e[n]=TH(i);const t=ga("instance",st({typeName:yr("instance"),id:fs("instance"),currentPageId:Ay,followingUserId:Ze.nullable(),brush:Kg.nullable(),opacityForNextShape:EH,stylesForNextShape:st(e),cursor:$xe,scribbles:Bn(_H),isFocusMode:Qe,isDebugMode:Qe,isToolLocked:Qe,exportBackground:Qe,screenBounds:Kg,insets:Bn(Qe),zoomBrush:Kg.nullable(),isPenMode:Qe,isGridMode:Qe,chatMessage:Ze,isChatting:Qe,highlightedUserIds:Bn(Ze),isFocused:Qe,devicePixelRatio:$e,isCoarsePointer:Qe,isHoveringCanvas:Qe.nullable(),openMenus:Bn(Ze),isChangingStyle:Qe,isReadonly:Qe,meta:tr,duplicateProps:st({shapeIds:Bn(fs("shape")),offset:st({x:$e,y:$e})}).nullable()}));return ma("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Nt=ns("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),jxe=xs({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Nt.AddTransparentExportBgs,up:r=>({...r,exportBackground:!0})},{id:Nt.RemoveDialog,up:({dialog:r,...e})=>e},{id:Nt.AddToolLockMode,up:r=>({...r,isToolLocked:!1})},{id:Nt.RemoveExtraPropsForNextShape,up:({propsForNextShape:r,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(r).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Nt.AddLabelColor,up:({propsForNextShape:r,...e})=>({...e,propsForNextShape:{...r,labelColor:"black"}})},{id:Nt.AddFollowingUserId,up:r=>({...r,followingUserId:null})},{id:Nt.RemoveAlignJustify,up:r=>{let e=r.propsForNextShape.align;return e==="justify"&&(e="start"),{...r,propsForNextShape:{...r.propsForNextShape,align:e}}}},{id:Nt.AddZoom,up:r=>({...r,zoomBrush:null})},{id:Nt.AddVerticalAlign,up:r=>({...r,propsForNextShape:{...r.propsForNextShape,verticalAlign:"middle"}})},{id:Nt.AddScribbleDelay,up:r=>r.scribble!==null?{...r,scribble:{...r.scribble,delay:0}}:{...r}},{id:Nt.RemoveUserId,up:({userId:r,...e})=>e},{id:Nt.AddIsPenModeAndIsGridMode,up:r=>({...r,isPenMode:!1,isGridMode:!1})},{id:Nt.HoistOpacity,up:({propsForNextShape:{opacity:r,...e},...t})=>({...t,opacityForNextShape:Number(r??"1"),propsForNextShape:e})},{id:Nt.AddChat,up:r=>({...r,chatMessage:"",isChatting:!1})},{id:Nt.AddHighlightedUserIds,up:r=>({...r,highlightedUserIds:[]})},{id:Nt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:r,...e})=>({...e,stylesForNextShape:{}})},{id:Nt.AddMeta,up:r=>({...r,meta:{}})},{id:Nt.RemoveCursorColor,up:r=>{const{color:e,...t}=r.cursor;return{...r,cursor:t}}},{id:Nt.AddLonelyProperties,up:r=>({...r,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Nt.ReadOnlyReadonly,up:({isReadOnly:r,...e})=>({...e,isReadonly:r})},{id:Nt.AddHoveringCanvas,up:r=>({...r,isHoveringCanvas:null})},{id:Nt.AddScribbles,up:({scribble:r,...e})=>({...e,scribbles:[]})},{id:Nt.AddInset,up:r=>({...r,insets:[!1,!1,!1,!1]}),down:({insets:r,...e})=>({...e})},{id:Nt.AddDuplicateProps,up:r=>({...r,duplicateProps:null}),down:({duplicateProps:r,...e})=>({...e})},{id:Nt.RemoveCanMoveCamera,up:({canMoveCamera:r,...e})=>({...e}),down:r=>({...r,canMoveCamera:!0})}]}),ci="instance:instance",Lxe=ga("instance_page_state",st({typeName:yr("instance_page_state"),id:fs("instance_page_state"),pageId:Ay,selectedShapeIds:Bn(Ps),hintingShapeIds:Bn(Ps),erasingShapeIds:Bn(Ps),hoveredShapeId:Ps.nullable(),editingShapeId:Ps.nullable(),croppingShapeId:Ps.nullable(),focusedGroupId:Ps.nullable(),meta:tr})),Op=ns("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),Uxe=xs({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Op.AddCroppingId,up(r){r.croppingShapeId=null}},{id:Op.RemoveInstanceIdAndCameraId,up(r){delete r.instanceId,delete r.cameraId}},{id:Op.AddMeta,up:r=>{r.meta={}}},{id:Op.RenameProperties,up:r=>{},down:r=>{}},{id:Op.RenamePropertiesAgain,up:r=>{r.selectedShapeIds=r.selectedIds,delete r.selectedIds,r.hintingShapeIds=r.hintingIds,delete r.hintingIds,r.erasingShapeIds=r.erasingIds,delete r.erasingIds,r.hoveredShapeId=r.hoveredId,delete r.hoveredId,r.editingShapeId=r.editingId,delete r.editingId,r.croppingShapeId=r.croppingShapeId??r.croppingId??null,delete r.croppingId,r.focusedGroupId=r.focusLayerId,delete r.focusLayerId},down:r=>{r.selectedIds=r.selectedShapeIds,delete r.selectedShapeIds,r.hintingIds=r.hintingShapeIds,delete r.hintingShapeIds,r.erasingIds=r.erasingShapeIds,delete r.erasingShapeIds,r.hoveredId=r.hoveredShapeId,delete r.hoveredShapeId,r.editingId=r.editingShapeId,delete r.editingShapeId,r.croppingId=r.croppingShapeId,delete r.croppingShapeId,r.focusLayerId=r.focusedGroupId,delete r.focusedGroupId}}]}),eo=ma("instance_page_state",{validator:Lxe,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),Wxe=ga("pointer",st({typeName:yr("pointer"),id:fs("pointer"),x:$e,y:$e,lastActivityTimestamp:$e,meta:tr})),Hxe=ns("com.tldraw.pointer",{AddMeta:1}),qxe=xs({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:Hxe.AddMeta,up:r=>{r.meta={}}}]}),wN=ma("pointer",{validator:Wxe,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),ov=wN.createId("pointer"),Kxe=ga("instance_presence",st({typeName:yr("instance_presence"),id:fs("instance_presence"),userId:Ze,userName:Ze,lastActivityTimestamp:$e.nullable(),followingUserId:Ze.nullable(),cursor:st({x:$e,y:$e,type:NH,rotation:$e}).nullable(),color:Ze,camera:st({x:$e,y:$e,z:$e}).nullable(),screenBounds:Kg.nullable(),selectedShapeIds:Bn(fs("shape")),currentPageId:fs("page"),brush:Kg.nullable(),scribbles:Bn(_H),chatMessage:Ze,meta:tr})),Qd=ns("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),Jxe=xs({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Qd.AddScribbleDelay,up:r=>{r.scribble!==null&&(r.scribble.delay=0)}},{id:Qd.RemoveInstanceId,up:r=>{delete r.instanceId}},{id:Qd.AddChatMessage,up:r=>{r.chatMessage=""}},{id:Qd.AddMeta,up:r=>{r.meta={}}},{id:Qd.RenameSelectedShapeIds,up:r=>{}},{id:Qd.NullableCameraCursor,up:r=>{},down:r=>{r.camera===null&&(r.camera={x:0,y:0,z:1}),r.lastActivityTimestamp===null&&(r.lastActivityTimestamp=0),r.cursor===null&&(r.cursor={type:"default",x:0,y:0,rotation:0}),r.screenBounds===null&&(r.screenBounds={x:0,y:0,w:1,h:1})}}]}),Vxe=ma("instance_presence",{validator:Kxe,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),Gxe=ga("document",st({typeName:yr("document"),id:yr("document:document"),gridSize:$e,name:Ze,meta:tr})),ij=ns("com.tldraw.document",{AddName:1,AddMeta:2}),Yxe=xs({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:ij.AddName,up:r=>{r.name=""},down:r=>{delete r.name}},{id:ij.AddMeta,up:r=>{r.meta={}}}]}),bN=ma("document",{validator:Gxe,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),NP=bN.createId("document");function sj(r){r.typeName==="asset"&&("src"in r&&(r.src="<redacted>"),"src"in r.props&&(r.props.src="<redacted>"))}function Xxe({error:r,phase:e,record:t,recordBefore:n}){throw DO(r,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:n?sj(vn(n)):void 0,recordAfter:sj(vn(t))}}),r}function Zxe(){return[Ci.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function Qxe(r){const e=r.query.ids("page"),t=r.query.records("instance_page_state"),n=()=>{if(!r.has(NP))return r.put([bN.create({id:NP,name:r.props.defaultName})]),n();if(!r.has(ov))return r.put([wN.create({id:ov})]),n();const i=e.get();if(i.size===0)return r.put(Zxe()),n();const s=()=>[...i].map(u=>r.get(u)).sort(Fn)[0].id,o=r.get(ci);if(o){if(!i.has(o.currentPageId))return r.put([{...o,currentPageId:s()}]),n()}else return r.put([r.schema.types.instance.create({id:ci,currentPageId:s(),exportBackground:!0})]),n();const a=new Set,l=new Set;for(const u of i){const d=eo.createId(u);r.get(d)||a.add(d);const f=Jo.createId(u);r.has(f)||l.add(f)}a.size>0&&r.put([...a].map(u=>eo.create({id:u,pageId:eo.parseId(u)}))),l.size>0&&r.put([...l].map(u=>Jo.create({id:u})));const c=t.get();for(const u of c){if(!i.has(u.pageId)){r.remove([u.id]);continue}if(u.croppingShapeId&&!r.has(u.croppingShapeId))return r.put([{...u,croppingShapeId:null}]),n();if(u.focusedGroupId&&!r.has(u.focusedGroupId))return r.put([{...u,focusedGroupId:null}]),n();if(u.hoveredShapeId&&!r.has(u.hoveredShapeId))return r.put([{...u,hoveredShapeId:null}]),n();const d=u.selectedShapeIds.filter(p=>r.has(p));if(d.length!==u.selectedShapeIds.length)return r.put([{...u,selectedShapeIds:d}]),n();const h=u.hintingShapeIds.filter(p=>r.has(p));if(h.length!==u.hintingShapeIds.length)return r.put([{...u,hintingShapeIds:h}]),n();const f=u.erasingShapeIds.filter(p=>r.has(p));if(f.length!==u.erasingShapeIds.length)return r.put([{...u,erasingShapeIds:f}]),n()}};return n}const eSe=yN("bookmark",st({title:Ze,description:Ze,image:Ze,favicon:Ze,src:hd.nullable()})),oj=ns("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),tSe=xs({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:r=>r.type==="bookmark",sequence:[{id:oj.MakeUrlsValid,up:r=>{hd.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:oj.AddFavicon,up:r=>{hd.isValid(r.props.favicon)||(r.props.favicon="")},down:r=>{delete r.props.favicon}}]}),nSe=yN("image",st({w:$e,h:$e,name:Ze,isAnimated:Qe,mimeType:Ze.nullable(),src:hd.nullable(),fileSize:En.optional()})),Np=ns("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),rSe=xs({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:r=>r.type==="image",sequence:[{id:Np.AddIsAnimated,up:r=>{r.props.isAnimated=!1},down:r=>{delete r.props.isAnimated}},{id:Np.RenameWidthHeight,up:r=>{r.props.w=r.props.width,r.props.h=r.props.height,delete r.props.width,delete r.props.height},down:r=>{r.props.width=r.props.w,r.props.height=r.props.h,delete r.props.w,delete r.props.h}},{id:Np.MakeUrlsValid,up:r=>{hd.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:Np.AddFileSize,up:r=>{r.props.fileSize=-1},down:r=>{delete r.props.fileSize}},{id:Np.MakeFileSizeOptional,up:r=>{r.props.fileSize===-1&&(r.props.fileSize=void 0)},down:r=>{r.props.fileSize===void 0&&(r.props.fileSize=-1)}}]}),iSe=yN("video",st({w:$e,h:$e,name:Ze,isAnimated:Qe,mimeType:Ze.nullable(),src:hd.nullable(),fileSize:$e.optional()})),_p=ns("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),sSe=xs({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:r=>r.type==="video",sequence:[{id:_p.AddIsAnimated,up:r=>{r.props.isAnimated=!1},down:r=>{delete r.props.isAnimated}},{id:_p.RenameWidthHeight,up:r=>{r.props.w=r.props.width,r.props.h=r.props.height,delete r.props.width,delete r.props.height},down:r=>{r.props.width=r.props.w,r.props.height=r.props.h,delete r.props.w,delete r.props.h}},{id:_p.MakeUrlsValid,up:r=>{hd.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:_p.AddFileSize,up:r=>{r.props.fileSize=-1},down:r=>{delete r.props.fileSize}},{id:_p.MakeFileSizeOptional,up:r=>{r.props.fileSize===-1&&(r.props.fileSize=void 0)},down:r=>{r.props.fileSize===void 0&&(r.props.fileSize=-1)}}]}),oSe=ga("asset",pN("type",{image:nSe,video:iSe,bookmark:eSe})),aSe=ns("com.tldraw.asset",{AddMeta:1}),lSe=xs({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:aSe.AddMeta,up:r=>{r.meta={}}}]}),Ld=ma("asset",{validator:oSe,scope:"document"}).withDefaultProperties(()=>({meta:{}})),FH={w:En,h:En,assetId:p1.nullable(),url:ps},aj=Ws("bookmark",{NullAssetId:1,MakeUrlsValid:2}),zH={sequence:[{id:aj.NullAssetId,up:r=>{r.assetId===void 0&&(r.assetId=null)},down:"retired"},{id:aj.MakeUrlsValid,up:r=>{ps.isValid(r.url)||(r.url="")},down:r=>{}}]},BH=st({type:dd("free","straight"),points:Bn(fd)}),jH={color:Oi,fill:Dl,dash:pd,size:Qo,segments:Bn(BH),isComplete:Qe,isClosed:Qe,isPen:Qe,scale:En},lj=Ws("draw",{AddInPen:1,AddScale:2}),LH={sequence:[{id:lj.AddInPen,up:r=>{const{points:e}=r.segments[0];if(e.length===0){r.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),r.isPen=t},down:"retired"},{id:lj.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},cSe=/(^\/r\/[^/]+\/?$)/,uSe=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(cSe))return r}},{hostnames:["figma.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:r=>{const e=je(r);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const n=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${n}z`}}},{hostnames:["val.town"],fromEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:r=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:r=>{const e=je(r);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const n=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(n)return`https://www.youtube.com/watch?v=${n[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:r=>{const e=je(r),t=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const n=Array.from(e.searchParams.keys());for(const i of n)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:r=>{const e=je(r);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return r.split("/").pop()?r:void 0}},{hostnames:["replit.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["observablehq.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return r.replace("?embed","")}}],UH={w:En,h:En,url:Ze},qS=Ws("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),WH={sequence:[{id:qS.GenOriginalUrlInEmbed,up:r=>{try{const e=r.url,t=new URL(e).host.replace("www.","");let n;for(const i of uSe)if(i.hostnames.includes(t))try{n=i.fromEmbedUrl(e)}catch(s){console.warn(s)}r.tmpOldUrl=r.url,r.url=n??""}catch{r.url="",r.tmpOldUrl=r.url}},down:"retired"},{id:qS.RemoveDoesResize,up:r=>{delete r.doesResize},down:"retired"},{id:qS.RemoveTmpOldUrl,up:r=>{delete r.tmpOldUrl},down:"retired"},{id:qS.RemovePermissionOverrides,up:r=>{delete r.overridePermissions},down:"retired"}]},HH={w:En,h:En,name:Ze,color:dd(...Oi.values)},dSe=Ws("frame",{AddColorProp:1}),qH={sequence:[{id:dSe.AddColorProp,up:r=>{r.color="black"},down:r=>{delete r.color}}]},av=qn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),lv=qn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Vo=qn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),KH={geo:Vo,dash:pd,url:ps,w:En,h:En,growY:nv,scale:En,labelColor:SN,color:Oi,fill:Dl,size:Qo,font:Fl,align:av,verticalAlign:lv,richText:m1},jo=Ws("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),JH={sequence:[{id:jo.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:jo.AddLabelColor,up:r=>{r.labelColor="black"},down:"retired"},{id:jo.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:jo.AddCheckBox,up:r=>{},down:"retired"},{id:jo.AddVerticalAlign,up:r=>{r.verticalAlign="middle"},down:"retired"},{id:jo.MigrateLegacyAlign,up:r=>{let e;switch(r.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}r.align=e},down:"retired"},{id:jo.AddCloud,up:r=>{},down:"retired"},{id:jo.MakeUrlsValid,up:r=>{ps.isValid(r.url)||(r.url="")},down:r=>{}},{id:jo.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}},{id:jo.AddRichText,up:r=>{r.richText=ir(r.text),delete r.text}}]},VH={},GH={sequence:[]},YH={color:Oi,size:Qo,segments:Bn(BH),isComplete:Qe,isPen:Qe,scale:En},hSe=Ws("highlight",{AddScale:1}),XH={sequence:[{id:hSe.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},fSe=st({topLeft:fd,bottomRight:fd,isCircle:Qe.optional()}),ZH={w:En,h:En,playing:Qe,url:ps,assetId:p1.nullable(),crop:fSe.nullable(),flipX:Qe,flipY:Qe,altText:Ze},Dp=Ws("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),QH={sequence:[{id:Dp.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:Dp.AddCropProp,up:r=>{r.crop=null},down:r=>{delete r.crop}},{id:Dp.MakeUrlsValid,up:r=>{ps.isValid(r.url)||(r.url="")},down:r=>{}},{id:Dp.AddFlipProps,up:r=>{r.flipX=!1,r.flipY=!1},down:r=>{delete r.flipX,delete r.flipY}},{id:Dp.AddAltText,up:r=>{r.altText=""},down:r=>{delete r.altText}}]},_P=qn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),pSe=st({id:Ze,index:gN,x:$e,y:$e}),eq={color:Oi,dash:pd,size:Qo,spline:_P,points:rv(Ze,pSe),scale:En},Fp=Ws("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),tq={sequence:[{id:Fp.AddSnapHandles,up:r=>{for(const e of Object.values(r.handles))e.canSnap=!0},down:"retired"},{id:Fp.RemoveExtraHandleProps,up:r=>{r.handles=gW(Object.values(r.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:r=>{const e=Object.entries(r.handles).map(([t,n])=>({index:t,...n})).sort(Fn);r.handles=Object.fromEntries(e.map((t,n)=>{const i=n===0?"start":n===e.length-1?"end":`handle:${t.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:Fp.HandlesToPoints,up:r=>{const e=Object.entries(r.handles).map(([t,{x:n,y:i}])=>({x:n,y:i,index:t})).sort(Fn);r.points=e.map(({x:t,y:n})=>({x:t,y:n})),delete r.handles},down:r=>{const e=Py(r.points.length);r.handles=Object.fromEntries(r.points.map((t,n)=>[e[n],{x:t.x,y:t.y}])),delete r.points}},{id:Fp.PointIndexIds,up:r=>{const e=Py(r.points.length);r.points=Object.fromEntries(r.points.map((t,n)=>{const i=e[n];return[i,{id:i,index:i,x:t.x,y:t.y}]}))},down:r=>{const e=Object.values(r.points).sort(Fn);r.points=e.map(({x:t,y:n})=>({x:t,y:n}))}},{id:Fp.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},nq={color:Oi,labelColor:SN,size:Qo,font:Fl,fontSizeAdjustment:nv,align:av,verticalAlign:lv,growY:nv,url:ps,richText:m1,scale:En},Aa=Ws("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),rq={sequence:[{id:Aa.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:Aa.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:Aa.MigrateLegacyAlign,up:r=>{switch(r.align){case"start":r.align="start-legacy";return;case"end":r.align="end-legacy";return;default:r.align="middle-legacy";return}},down:"retired"},{id:Aa.AddVerticalAlign,up:r=>{r.verticalAlign="middle"},down:"retired"},{id:Aa.MakeUrlsValid,up:r=>{ps.isValid(r.url)||(r.url="")},down:r=>{}},{id:Aa.AddFontSizeAdjustment,up:r=>{r.fontSizeAdjustment=0},down:r=>{delete r.fontSizeAdjustment}},{id:Aa.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}},{id:Aa.AddLabelColor,up:r=>{r.labelColor="black"},down:r=>{delete r.labelColor}},{id:Aa.AddRichText,up:r=>{r.richText=ir(r.text),delete r.text}}]},DP=qn.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),iq={color:Oi,size:Qo,font:Fl,textAlign:DP,w:En,richText:m1,scale:En,autoSize:Qe},OE=Ws("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),sq={sequence:[{id:OE.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:OE.AddTextAlign,up:r=>{r.textAlign=r.align,delete r.align},down:r=>{r.align=r.textAlign,delete r.textAlign}},{id:OE.AddRichText,up:r=>{r.richText=ir(r.text),delete r.text}}]},oq={w:En,h:En,time:$e,playing:Qe,autoplay:Qe,url:ps,assetId:p1.nullable(),altText:Ze},KS=Ws("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),aq={sequence:[{id:KS.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:KS.MakeUrlsValid,up:r=>{ps.isValid(r.url)||(r.url="")},down:r=>{}},{id:KS.AddAltText,up:r=>{r.altText=""},down:r=>{delete r.altText}},{id:KS.AddAutoplay,up:r=>{r.autoplay=!0},down:r=>{delete r.autoplay}}]},zp=ns("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4,FixIndexKeys:5}),mSe=cf({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:zp.RemoveCodeAndIconShapeTypes,scope:"store",up:r=>{for(const[e,t]of fi(r))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete r[e]}},{id:zp.AddInstancePresenceType,scope:"store",up(r){}},{id:zp.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:r=>{for(const[e,t]of fi(r))t.typeName.match(/^(user|user_presence)$/)&&delete r[e]}},{id:zp.RemoveUserDocument,scope:"store",up:r=>{for(const[e,t]of fi(r))t.typeName.match("user_document")&&delete r[e]}},{id:zp.FixIndexKeys,scope:"record",up:r=>{if(["shape","page"].includes(r.typeName)&&"index"in r){const e=r;if(e.index.endsWith("0")&&e.index!=="a0"&&(e.index=e.index.slice(0,-1)+uj(3)),r.typeName==="shape"&&e.type==="line"){const t=e;for(const[n,i]of fi(t.props.points))i.index.endsWith("0")&&i.index!=="a0"&&(i.index=i.index.slice(0,-1)+uj(3))}}},down:()=>{}}]}),cj="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",gSe=()=>cj.charAt(Math.floor(Math.random()*cj.length)),uj=r=>Array.from({length:r},gSe).join(""),ySe={arrow:{migrations:$H,props:AH},bookmark:{migrations:zH,props:FH},draw:{migrations:LH,props:jH},embed:{migrations:WH,props:UH},frame:{migrations:qH,props:HH},geo:{migrations:JH,props:KH},group:{migrations:GH,props:VH},highlight:{migrations:XH,props:YH},image:{migrations:QH,props:ZH},line:{migrations:tq,props:eq},note:{migrations:rq,props:nq},text:{migrations:sq,props:iq},video:{migrations:aq,props:oq}},xSe={arrow:{migrations:OH,props:RH}};function SSe({shapes:r=ySe,bindings:e=xSe,migrations:t}={}){const n=new Map;for(const a of pn(r))for(const l of MH(a.props??{}).keys()){if(n.has(l.id)&&n.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);n.set(l.id,l)}const i=wxe(r),s=yxe(e),o=Bxe(n);return hN.create({asset:Ld,binding:s,camera:Jo,document:bN,instance:o,instance_page_state:eo,page:Ci,instance_presence:Vxe,pointer:wN,shape:i},{migrations:[mSe,lSe,Pxe,Yxe,jxe,Uxe,Fxe,Jxe,qxe,Sxe,tSe,rSe,sSe,...rj("shape",r),...rj("binding",e),...t??[]],onValidationFailure:Xxe,createIntegrityChecker:Qxe})}const $y=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"sl",label:"Slovenina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"el",label:""},{locale:"ru",label:""},{locale:"uk",label:""},{locale:"he",label:""},{locale:"ur",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ne",label:""},{locale:"mr",label:""},{locale:"hi-in",label:""},{locale:"bn",label:""},{locale:"pa",label:""},{locale:"gu-in",label:""},{locale:"ta",label:""},{locale:"te",label:""},{locale:"kn",label:""},{locale:"ml",label:""},{locale:"th",label:""},{locale:"km-kh",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function wSe(){const r=typeof window<"u"&&window.navigator?window.navigator.languages??["en"]:["en"];return bSe(r)}function bSe(r){for(const e of r){const t=vSe(e);if(t)return t}return"en"}const dj={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function vSe(r){const e=$y.find(i=>i.locale===r.toLowerCase());if(e)return e.locale;const[t,n]=r.split(/[-_]/).map(i=>i.toLowerCase());if(n){const i=$y.find(s=>s.locale===t);if(i)return i.locale}return t in dj?dj[t]:null}ec("@tldraw/tlschema","4.2.1","esm");function kSe(){return x.jsx("div",{className:"tl-background"})}function sS(r,e,t,n,i,s){k.useLayoutEffect(()=>{const o=r.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${t}px)`;n!==void 0&&(a+=` scale(${n})`),i!==void 0&&(a+=` rotate(${i}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),o.style.transform=a})}const gr={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>r*(2-r),easeInOutQuad:r=>r<.5?2*r*r:-1+(4-2*r)*r,easeInCubic:r=>r*r*r,easeOutCubic:r=>--r*r*r+1,easeInOutCubic:r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1- --r*r*r*r,easeInOutQuart:r=>r<.5?8*r*r*r*r:1-8*--r*r*r*r,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1+--r*r*r*r*r,easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,easeInSine:r=>1-Math.cos(r*Math.PI/2),easeOutSine:r=>Math.sin(r*Math.PI/2),easeInOutSine:r=>-(Math.cos(Math.PI*r)-1)/2,easeInExpo:r=>r<=0?0:Math.pow(2,10*r-10),easeOutExpo:r=>r>=1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r<=0?0:r>=1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2};class T{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(e===0)return this;const{x:t,y:n}=this,i=Math.sin(e),s=Math.cos(e);return this.x=t*s-n*i,this.y=t*i+n*s,this}rotWith(e,t){if(t===0)return this;const n=this.x-e.x,i=this.y-e.y,s=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-i*s),this.y=e.y+(n*s+i*o),this}clone(){const{x:e,y:t,z:n}=this;return new T(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const n=T.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return T.Dpr(this,e)}cpr(e){return T.Cpr(this,e)}len2(){return T.Len2(this)}len(){return T.Len(this)}pry(e){return T.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){const e=this.len();return e===0?this:(this.x/=e,this.y/=e,this)}tan(e){return this.sub(e).uni()}dist(e){return T.Dist(this,e)}distanceToLineSegment(e,t){return T.DistanceToLineSegment(e,t,this)}slope(e){return T.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return T.Angle(this,e)}toAngle(){return T.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return T.Equals(this,e)}equalsXY(e,t){return T.EqualsXY(this,e,t)}toFixed(){return this.x=Zs(this.x),this.y=Zs(this.y),this}toString(){return T.ToString(T.ToFixed(this))}toJson(){return T.ToJson(this)}toArray(){return T.ToArray(this)}static Add(e,t){return new T(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new T(e.x+t,e.y+n)}static Sub(e,t){return new T(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new T(e.x-t,e.y-n)}static AddScalar(e,t){return new T(e.x+t,e.y+t)}static SubScalar(e,t){return new T(e.x-t,e.y-t)}static Div(e,t){return new T(e.x/t,e.y/t)}static Mul(e,t){return new T(e.x*t,e.y*t)}static DivV(e,t){return new T(e.x/t.x,e.y/t.y)}static MulV(e,t){return new T(e.x*t.x,e.y*t.y)}static Neg(e){return new T(-e.x,-e.y)}static Per(e){return new T(e.y,-e.x)}static Abs(e){return new T(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static ManhattanDist(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new T(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return T.Dpr(e,t)/T.Len(t)}static Uni(e){const t=T.Len(e);return new T(t===0?0:e.x/t,t===0?0:e.y/t)}static Tan(e,t){return T.Uni(T.Sub(e,t))}static Min(e,t){return new T(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new T(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new T(e,t,n)}static FromArray(e){return new T(e[0],e[1])}static Rot(e,t=0){const n=Math.sin(t),i=Math.cos(t);return new T(e.x*i-e.y*n,e.x*n+e.y*i)}static RotWith(e,t,n){const i=e.x-t.x,s=e.y-t.y,o=Math.sin(n),a=Math.cos(n);return new T(t.x+(i*a-s*o),t.y+(i*o+s*a))}static NearestPointOnLineThroughPoint(e,t,n){return T.Mul(t,T.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,i=!0){if(T.Equals(e,n)||T.Equals(t,n))return T.From(n);const s=T.Tan(t,e),o=T.Add(e,T.Mul(s,T.Sub(n,e).pry(s)));if(i){if(o.x<Math.min(e.x,t.x))return T.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return T.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return T.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return T.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return T.Dist(n,T.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,i=!0){return T.Dist(n,T.NearestPointOnLineSegment(e,t,n,i))}static Snap(e,t=1){return new T(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof T?e:T.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static AngleBetween(e,t){const n=e.x*t.x+e.y*t.y,i=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(_e(n/i,-1,1))}static Lrp(e,t,n){return T.Sub(t,e).mul(n).add(e)}static Med(e,t){return new T((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){const n=T.Len(e);return new T(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return T.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new T(Zs(e.x),Zs(e.y))}static ToInt(e){return new T(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,n){return T.Add(e,T.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new T(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:n,z:i}=e;return{x:t,y:n,z:i}}static Average(e){const t=e.length,n=new T(0,0);if(t===0)return n;for(let i=0;i<t;i++)n.add(e[i]);return n.div(t)}static Clamp(e,t,n){return n===void 0?new T(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new T(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){const i=[];for(let s=0;s<n;s++){const o=gr.easeInQuad(s/(n-1)),a=T.Lrp(e,t,o);a.z=Math.min(1,.5+Math.abs(.5-CSe(o))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new T(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const CSe=r=>r<.5?2*r*r:-1+(4-2*r)*r;function Zn(r){return`${D(r.x)},${D(r.y)} `}function Ji(r,e){return`${D((r.x+e.x)/2)},${D((r.y+e.y)/2)} `}const pt=Math.PI,kn=pt/2,At=pt*2,TSe=Math.sin;function _e(r,e,t){return Math.max(e,typeof t<"u"?Math.min(r,t):r)}function JS(r,e=1e10){return r?Math.round(r*e)/e:0}function Mn(r,e,t=1e-6){return Math.abs(r-e)<=t}function kl(r,e,t=1e-6){return r<e||Mn(r,e,t)}function ESe(r,e){const t=Math.pow(r-e,2)/Math.pow(r+e,2);return pt*(r+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function cv(r){return r=r%At,r<0?r=r+At:r===0&&(r=0),r}function vN(r,e){return r=cv(r),e=cv(e),r>e&&(e+=At),e-r}function MSe(r,e){return At-vN(r,e)}function Eb(r,e){const t=(e-r)%At;return 2*t%At-t}function FP(r){return(At+r)%At}function uv(r,e){const t=At/e;let n=Math.floor((FP(r)+t/2)/t)*t%At;return n<pt&&(n+=At),n>pt&&(n-=At),n}function lq(r,e){return r===e||Mn(r%(Math.PI/2)-e%(Math.PI/2),0)}function ISe(r){return r*pt/180}function PSe(r){return r*180/pt}function kN(r,e,t){return new T(r.x,r.y).add(T.FromAngle(t,e))}function NE(r,e,t){const n=r/2,i=e/2,s=[];let o=1/0,a=-1/0,l=1/0,c=-1/0;for(let p=0;p<t;p++){const m=At/t,g=-kn+p*m,y=n+n*Math.cos(g),S=i+i*Math.sin(g);y<o&&(o=y),S<l&&(l=S),y>a&&(a=y),S>c&&(c=S),s.push(new T(y,S))}const u=a-o,d=c-l,h=r-u,f=e-d;if(h!==0||f!==0)for(let p=0;p<s.length;p++){const m=s[p];m.x=(m.x-o)/u*r,m.y=(m.y-l)/d*e}return s}function Bp(r,e,t,n){return r<n&&t<e}function Xs(r,e,t,n){const i=Math.max(r,t),s=Math.min(e,n);return i<=s?[i,s]:null}function hj(r,e,t){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function hi(r,e){let t=0,n,i;for(let s=0;s<e.length;s++){if(n=e[s],n.x===r.x&&n.y===r.y||(i=e[(s+1)%e.length],T.Dist(r,n)+T.Dist(r,i)===T.Dist(n,i)))return!0;n.y<=r.y?i.y>r.y&&hj(n,i,r)>0&&(t+=1):i.y<=r.y&&hj(n,i,r)<0&&(t-=1)}return t!==0}function D(r){return Math.round(r*1e4)/1e4}function Zs(r){return Math.round(r*100)/100}const fj=r=>Math.abs(r)<Number.MAX_SAFE_INTEGER;function pj(r,e,t,n){let i;if(Math.abs(r)>pt){i=Eb(e,n);const s=Eb(n,t);return Math.abs(i)<Math.abs(s)?i/r:(r-s)/r}else{i=Eb(e,n);const s=i/r;return Math.sign(i)!==Math.sign(r)?Math.abs(s)>.5?1:0:s}}function ASe(r,e,t,n){const i=2*((e-r)%At)%At-(e-r)%At;return n?(At-Math.abs(i))*(t?1:-1):i}function cq(r,e,t){const n=-2*(r.x*(e.y-t.y)-r.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i=((r.x*r.x+r.y*r.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(r.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-r.y))/n,s=((r.x*r.x+r.y*r.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-r.x)+(t.x*t.x+t.y*t.y)*(r.x-e.x))/n;return!Number.isFinite(i)||!Number.isFinite(s)?null:new T(i,s)}const _E=({brush:r,color:e,opacity:t,className:n})=>{const i=k.useRef(null);sS(i,r.x,r.y);const s=D(Math.max(1,r.w)),o=D(Math.max(1,r.h));return x.jsx("svg",{className:"tl-overlays__item",ref:i,"aria-hidden":"true",children:e?x.jsxs("g",{className:"tl-brush",opacity:t,children:[x.jsx("rect",{width:s,height:o,fill:e,opacity:.75}),x.jsx("rect",{width:s,height:o,fill:"none",stroke:e,opacity:.1})]}):x.jsx("rect",{className:`tl-brush tl-brush__default ${n}`,width:s,height:o})})};var DE={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var mj;function $Se(){return mj||(mj=1,(function(r){(function(){var e={}.hasOwnProperty;function t(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,n(a)))}return s}function n(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}r.exports?(t.default=t,r.exports=t):window.classNames=t})()})(DE)),DE.exports}var RSe=$Se();const oe=ip(RSe),ht={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isDarwin:!1,hasCanvasSupport:!1};typeof window<"u"&&"navigator"in window&&(ht.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ht.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),ht.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),ht.isFirefox=/firefox/i.test(navigator.userAgent),ht.isAndroid=/android/i.test(navigator.userAgent),ht.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,ht.hasCanvasSupport=typeof window<"u"&&"Promise"in window&&"HTMLCanvasElement"in window);const gj={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},FE={duration:0,easing:gr.easeInOutCubic},yj={CAMERA_MOVE:-10},OSe=["top","right","bottom","left"],xj=0,CN=2,VS=1,Sj=5,NSe=128;var zE={};const _Se={},uq=ur("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Yt={logPreventDefaults:ur("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:ur("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:ur("logElementRemoves",{defaults:{all:!1}}),debugSvg:ur("debugSvg",{defaults:{all:!1}}),showFps:ur("showFps",{defaults:{all:!1}}),measurePerformance:ur("measurePerformance",{defaults:{all:!1}}),throwToBlob:ur("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:ur("reconnectOnPing",{defaults:{all:!1}}),debugCursors:ur("debugCursors",{defaults:{all:!1}}),forceSrgb:ur("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ur("debugGeometry",{defaults:{all:!1}}),hideShapes:ur("hideShapes",{defaults:{all:!1}}),editOnType:ur("editOnType",{defaults:{all:!1}}),a11y:ur("a11y",{defaults:{all:!1}}),debugElbowArrows:ur("debugElbowArrows",{defaults:{all:!1}})};if(typeof Element<"u"){const r=Element.prototype.removeChild;Zi("element removal logging",()=>{Yt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),r.call(this,e)}:Element.prototype.removeChild=r})}function ur(r,{defaults:e,shouldStoreForSession:t=!0}){return DSe({name:r,defaults:e,shouldStoreForSession:t})}function DSe(r){const e=zSe(r),t=r.shouldStoreForSession?FSe(r.name):null,n=Ft(`debug:${r.name}`,t??e);return typeof window<"u"&&(r.shouldStoreForSession&&Zi(`debug:${r.name}`,()=>{const i=n.get();i===e?TW(`tldraw_debug:${r.name}`):jO(`tldraw_debug:${r.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${r.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return n.get()},set(i){n.set(i)},configurable:!0})),Object.assign(n,r,{reset:()=>n.set(e)})}function FSe(r){try{return JSON.parse(CW(`tldraw_debug:${r}`)??"null")}catch{return null}}function BE(r){try{return r()}catch{return null}}function zSe(r){switch(BE(()=>zE.TLDRAW_ENV)??BE(()=>zE.VERCEL_PUBLIC_TLDRAW_ENV)??BE(()=>zE.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return r.defaults.production??r.defaults.all;case"preview":case"staging":return r.defaults.staging??r.defaults.all;default:return r.defaults.development??r.defaults.all}}function dv(r){if(r.nodeType===Node.ELEMENT_NODE)return r;if(r.parentElement)return dv(r.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Oe(r){r.preventDefault(),Yt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",r)}function oS(r,e){if(r.setPointerCapture(e.pointerId),Yt.logPointerCaptures.get()){const t=uq.get();t.set(r,(t.get(r)??0)+1),console.warn("setPointerCapture called on element:",r,e)}}function aS(r,e){if(r.hasPointerCapture(e.pointerId)&&(r.releasePointerCapture(e.pointerId),Yt.logPointerCaptures.get())){const t=uq.get();t.get(r)===1?t.delete(r):t.has(r)?t.set(r,t.get(r)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",r,e)}}const dr=(r,e,t)=>{r&&r.style.setProperty(e,t)};function dq(r=!1){const{activeElement:e}=document,t=r?["input","textarea"]:["input","select","button","textarea"];return!!(e&&(e.isContentEditable||t.indexOf(e.tagName.toLowerCase())>-1||e.classList.contains("tlui-slider__thumb")))}const zt=r=>ht.isDarwin?r.metaKey:r.ctrlKey||r.metaKey;function nr(r,e){return r.markEventAsHandled(e),{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:zt(e),pointerId:e.pointerId,button:e.button,isPen:e.pointerType==="pen"}}function TN(r,e){return g1(`${r}_${e}`)}function Ud(r){return g1(`${k.useId()}${r??""}`)}function ro(r){const e=Dn(k.useContext(hq));return g1(`${e}_${r}`)}function g1(r){return r.replace(/:/g,"_")}const hq=k.createContext(null);function BSe({children:r}){const e=Ud();return x.jsx(hq.Provider,{value:e,children:r})}const EN=k.createContext(null);function z(){const r=Be.useContext(EN);if(!r)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return r}function Sn(){return Be.useContext(EN)}function MN({editor:r,children:e}){return x.jsx(EN.Provider,{value:r,children:x.jsx(BSe,{children:e})})}function y1(){const r=z(),e=F("current tool",()=>r.getCurrentTool(),[r]),t=k.useMemo(function(){function i(f){if(!r.wasEventAlreadyHandled(f)){if(f.button===CN){r.dispatch({type:"pointer",target:"canvas",name:"right_click",...nr(r,f)});return}f.button!==0&&f.button!==1&&f.button!==5||(oS(f.currentTarget,f),r.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...nr(r,f)}))}}function s(f){r.wasEventAlreadyHandled(f)||f.button!==0&&f.button!==1&&f.button!==2&&f.button!==5||(aS(f.currentTarget,f),r.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...nr(r,f)}))}function o(f){if(r.wasEventAlreadyHandled(f)||r.getInstanceState().isPenMode&&f.pointerType!=="pen")return;const p=f.pointerType==="mouse"||f.pointerType==="pen";r.updateInstanceState({isHoveringCanvas:p?!0:null})}function a(f){if(r.wasEventAlreadyHandled(f)||r.getInstanceState().isPenMode&&f.pointerType!=="pen")return;const p=f.pointerType==="mouse"||f.pointerType==="pen";r.updateInstanceState({isHoveringCanvas:p?!1:null})}function l(f){r.wasEventAlreadyHandled(f)||(r.markEventAsHandled(f),Oe(f))}function c(f){if(r.wasEventAlreadyHandled(f)||(r.markEventAsHandled(f),!(f.target instanceof HTMLElement)))return;const p=r.getEditingShape()?.id;!(p&&f.target.closest(`[data-shape-id="${p}"]`))&&f.target.tagName!=="A"&&f.target.tagName!=="TEXTAREA"&&!f.target.isContentEditable&&Oe(f)}function u(f){r.wasEventAlreadyHandled(f)||Oe(f)}async function d(f){if(r.wasEventAlreadyHandled(f))return;if(Oe(f),f.stopPropagation(),f.dataTransfer?.files?.length){const m=Array.from(f.dataTransfer.files);await r.putExternalContent({type:"files",files:m,point:r.screenToPage({x:f.clientX,y:f.clientY})});return}const p=f.dataTransfer.getData("url");if(p){await r.putExternalContent({type:"url",url:p,point:r.screenToPage({x:f.clientX,y:f.clientY})});return}}function h(f){r.wasEventAlreadyHandled(f)||f.stopPropagation()}return{onPointerDown:i,onPointerUp:s,onPointerEnter:o,onPointerLeave:a,onDragOver:u,onDrop:d,onTouchStart:l,onTouchEnd:c,onClick:h}},[r]);return k.useEffect(()=>{let n,i;function s(o){if(r.wasEventAlreadyHandled(o)||(r.markEventAsHandled(o),o.clientX===n&&o.clientY===i))return;n=o.clientX,i=o.clientY;const a=!ht.isIos&&e.useCoalescedEvents&&o.getCoalescedEvents?o.getCoalescedEvents():[o];for(const l of a)r.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...nr(r,l)})}return document.body.addEventListener("pointermove",s),()=>{document.body.removeEventListener("pointermove",s)}},[r,e]),t}function jSe(){const r=z();k.useEffect(()=>{let e=r.getInstanceState().isCoarsePointer;const t=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,r.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const n=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=ht.isFirefox&&!ht.isAndroid&&!ht.isIos,s=()=>{const o=i?!1:n.matches;e===o&&(e=o,r.updateInstanceState({isCoarsePointer:o}))};return n&&(n.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),n&&n.removeEventListener("change",s)}},[r])}const fq=k.createContext(null);function pq({container:r,children:e}){return x.jsx(fq.Provider,{value:r,children:e})}function Pn(){return Dn(k.useContext(fq),"useContainer used outside of <Tldraw />")}function LSe(){const r=z(),e=Pn(),t=F("isEditing",()=>r.getEditingShapeId(),[r]),n=F("isFocused",()=>r.getIsFocused(),[r]);k.useEffect(()=>{if(!e)return;function i(s){if(s.isSpecialRedispatchedEvent)return;Oe(s),s.stopPropagation();const o=e.querySelector(".tl-canvas");if(!o)return;const a=new DragEvent(s.type,s);a.isSpecialRedispatchedEvent=!0,o.dispatchEvent(a)}return e.addEventListener("dragover",i),e.addEventListener("drop",i),()=>{e.removeEventListener("dragover",i),e.removeEventListener("drop",i)}},[e]),k.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let i=null;const s=()=>{i?.();const o=`(resolution: ${window.devicePixelRatio}dppx)`,a=matchMedia(o),l=c=>{c.type==="change"&&s()};a.addEventListener?a.addEventListener("change",s):a.addListener&&a.addListener(l),i=()=>{a.removeEventListener?a.removeEventListener("change",s):a.removeListener&&a.removeListener(l)},r.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{i?.()}},[r]),k.useEffect(()=>{if(!n)return;const i=l=>{if(l.altKey&&(r.isIn("zoom")||!r.getPath().endsWith(".idle"))&&!jp(r)&&Oe(l),r.wasEventAlreadyHandled(l))return;r.markEventAsHandled(l);const c=!!r.getSelectedShapeIds().length;switch(l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){Oe(l);return}break}case"Tab":{if(jp(r))return;c&&!t&&Oe(l);break}case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(jp(r))return;c&&(l.metaKey||l.ctrlKey)&&Oe(l);break}case",":return;case"Escape":{if((r.getEditingShape()||r.getSelectedShapeIds().length>0)&&Oe(l),r.menus.getOpenMenus().length>0)return;r.inputs.keys.has("Escape")||(r.inputs.keys.add("Escape"),r.cancel(),e.focus());return}default:if(jp(r))return}const u={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:zt(l)};r.dispatch(u)},s=l=>{if(r.wasEventAlreadyHandled(l)||(r.markEventAsHandled(l),jp(r))||l.key===",")return;const c={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:zt(l)};r.dispatch(c)};function o(l){if(e.contains(l.target)){const c=l.touches[0].pageX,u=l.touches[0].radiusX||0;(c-u<10||c+u>r.getViewportScreenBounds().width-10)&&(l.target?.tagName==="BUTTON"&&l.target?.click(),Oe(l))}}const a=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&Oe(l)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",a,{passive:!1}),document.addEventListener("gesturestart",Oe),document.addEventListener("gesturechange",Oe),document.addEventListener("gestureend",Oe),e.addEventListener("keydown",i),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",a),document.removeEventListener("gesturestart",Oe),document.removeEventListener("gesturechange",Oe),document.removeEventListener("gestureend",Oe),e.removeEventListener("keydown",i),e.removeEventListener("keyup",s)}},[r,e,n,t])}function jp(r){return r.menus.hasOpenMenus()||dq()}function USe({className:r,zoom:e,point:t,color:n,viewport:i,opacity:s=1}){const o=k.useRef(null);sS(o,_e(t.x,i.minX+5/e,i.maxX-5/e),_e(t.y,i.minY+5/e,i.maxY-5/e),1/e,T.Angle(i.center,t));const a=ro("cursor_hint");return x.jsxs("svg",{ref:o,className:oe("tl-overlays__item",r),"aria-hidden":"true",children:[x.jsx("use",{href:`#${a}`,color:n,strokeWidth:3,stroke:"var(--tl-color-background)"}),x.jsx("use",{href:`#${a}`,color:n,opacity:s})]})}const wj=k.memo(function({className:e,zoom:t,point:n,color:i,name:s,chatMessage:o}){const a=k.useRef(null);sS(a,n?.x,n?.y,1/t);const l=ro("cursor");return n?x.jsxs("div",{ref:a,className:oe("tl-overlays__item",e),children:[x.jsx("svg",{className:"tl-cursor","aria-hidden":"true",children:x.jsx("use",{href:`#${l}`,color:i})}),o?x.jsxs(x.Fragment,{children:[s&&x.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),x.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):s&&x.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null}),lS={openWindow(r,e,t=!1){return window.open(r,e,t?"noopener":"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){return await window.__tldraw__hardReset?.()}};function mq(){lS.hardReset()}function WSe(){lS.refreshPage()}const HSe={error:null};class IN extends k.Component{static getDerivedStateFromError(e){return{error:e}}state=HSe;componentDidCatch(e){this.props.onError?.(e)}render(){const{error:e}=this.state;if(e!==null){const{fallback:t}=this.props;return x.jsx(t,{error:e})}return this.props.children}}function Ry({children:r,fallback:e,...t}){return e===null?r:x.jsx(IN,{fallback:e,...t,children:r})}const qSe="https://github.com/tldraw/tldraw/issues/new",gq=({error:r,editor:e})=>{const t=k.useRef(null),[n,i]=k.useState(!1),[s,o]=k.useState(!1),[a,l]=k.useState(!1);let c=null;try{c=Tt().Canvas??null}catch{}const u=r instanceof Error?r.message:String(r),d=r instanceof Error?r.stack:null,h=F("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,p]=k.useState(null);k.useLayoutEffect(()=>{h!==null&&p(h);let w=t.current?.parentElement,b=!1;for(;w;){if(w.classList.contains("tl-theme__dark")||w.classList.contains("tl-theme__light")){b=!0;break}w=w.parentElement}if(b){p(null);return}typeof window<"u"&&window.matchMedia&&p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[h]),k.useEffect(()=>{if(s){const w=e?.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(w)}},[s,e]);const m=()=>{const w=document.createElement("textarea");w.value=d??u,document.body.appendChild(w),w.select(),document.execCommand("copy"),w.remove(),o(!0)},g=()=>{WSe()},y=async()=>{mq()},S=new URL(qSe);return S.searchParams.set("title",u),S.searchParams.set("labels","bug"),S.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${d??u}
\`\`\`

My browser: ${navigator.userAgent}`),x.jsxs("div",{ref:t,className:oe("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[x.jsx("div",{className:"tl-error-boundary__overlay"}),e&&x.jsx(IN,{onError:Ey,fallback:()=>null,children:x.jsx(MN,{editor:e,children:x.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?x.jsx(c,{}):null})})}),x.jsx("div",{className:oe("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":n&&!a}),children:a?x.jsxs(x.Fragment,{children:[x.jsx("h2",{children:"Are you sure?"}),x.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),x.jsxs("div",{className:"tl-error-boundary__content__actions",children:[x.jsx("button",{className:"tlui-button",onClick:()=>l(!1),children:"Cancel"}),x.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:y,children:"Reset data"})]})]}):x.jsxs(x.Fragment,{children:[x.jsx("h2",{children:"Something went wrong"}),x.jsx("p",{children:"Please refresh your browser."}),x.jsx("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),x.jsxs("p",{children:[x.jsx("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,n&&x.jsxs(x.Fragment,{children:["Message:",x.jsx("h4",{children:x.jsx("code",{children:u})}),"Stack trace:",x.jsxs("div",{className:"tl-error-boundary__content__error",children:[x.jsx("pre",{children:x.jsx("code",{children:d??u})}),x.jsx("button",{className:"tlui-button",onClick:m,children:s?"Copied!":"Copy"})]})]}),x.jsxs("div",{className:"tl-error-boundary__content__actions",children:[x.jsx("button",{className:"tlui-button",onClick:()=>i(!n),children:n?"Hide details":"Show details"}),x.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[x.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),x.jsx("button",{className:"tlui-button tl-error-boundary__refresh",onClick:g,children:"Refresh Page"})]})]})]})})]})};function KSe({x:r,y:e,z:t,size:n}){const i=Ud("grid"),s=z(),{gridSteps:o}=s.options;return x.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[x.jsx("defs",{children:o.map(({min:a,mid:l,step:c},u)=>{const d=c*n*t,h=.5+r*t,f=.5+e*t,p=h>0?h%d:d+h%d,m=f>0?f%d:d+f%d,g=t<l?oo(t,[a,l],[0,1]):1;return x.jsx("pattern",{id:TN(i,`${c}`),width:d,height:d,patternUnits:"userSpaceOnUse",children:x.jsx("circle",{className:"tl-grid-dot",cx:p,cy:m,r:1,opacity:g})},u)})}),o.map(({step:a},l)=>x.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${a})`},l))]})}function JSe({handle:r,isCoarse:e,className:t,zoom:n}){const i=z(),s=(e?i.options.coarseHandleRadius:i.options.handleRadius)/n;if(r.type==="clone"){const a=3/n,l=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,c=OSe.indexOf(r.id);return x.jsxs("g",{className:oe(`tl-handle tl-handle__${r.type}`,t),children:[x.jsx("circle",{className:"tl-handle__bg",r:s}),x.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*c})`})]})}const o=(r.type==="create"&&e?3:4)/Math.max(n,.25);return x.jsxs("g",{className:oe(`tl-handle tl-handle__${r.type}`,t),children:[x.jsx("circle",{className:"tl-handle__bg",r:s}),x.jsx("circle",{className:"tl-handle__fg",r:o})]})}const VSe=({children:r})=>x.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:r}),PN="4.2.1",bj={major:"2025-09-18T14:39:22.803Z",minor:"2025-11-19T11:47:45.748Z"};function yq(r,e){const t=k.useRef(r);return e(r,t.current)?t.current:(t.current=r,r)}const GSe=(r,e)=>(r??=null,e??=null,r===e?!0:!r||!e?!1:V0(r,e));function bl(r){return yq(r,GSe)}const YSe=(r,e)=>(r??=null,e??=null,r===e?!0:!r||!e?!1:yW(r,e));function hp(r){return yq(r,YSe)}const xq="TLDRAW_USER_DATA_v3",Sq=st({id:Ze,name:Ze.nullable().optional(),color:Ze.nullable().optional(),locale:Ze.nullable().optional(),animationSpeed:$e.nullable().optional(),areKeyboardShortcutsEnabled:Qe.nullable().optional(),edgeScrollSpeed:$e.nullable().optional(),colorScheme:dd("light","dark","system").optional(),isSnapMode:Qe.nullable().optional(),isWrapMode:Qe.nullable().optional(),isDynamicSizeMode:Qe.nullable().optional(),isPasteAtCursorMode:Qe.nullable().optional(),enhancedA11yMode:Qe.nullable().optional(),inputMode:dd("trackpad","mouse").nullable().optional()}),os={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9,AddShowUiLabels:10,AddPointerPeripheral:11,RenameShowUiLabelsToEnhancedA11yMode:12},AN=Math.max(...Object.values(os));function XSe(r){r.version<os.AddAnimationSpeed&&(r.user.animationSpeed=1),r.version<os.AddIsSnapMode&&(r.user.isSnapMode=!1),r.version<os.MakeFieldsNullable,r.version<os.AddEdgeScrollSpeed&&(r.user.edgeScrollSpeed=1),r.version<os.AddExcalidrawSelectMode&&(r.user.isWrapMode=!1),r.version<os.AllowSystemColorScheme&&(r.user.isDarkMode===!0?r.user.colorScheme="dark":r.user.isDarkMode===!1&&(r.user.colorScheme="light"),delete r.user.isDarkMode),r.version<os.AddDynamicSizeMode&&(r.user.isDynamicSizeMode=!1),r.version<os.AddPasteAtCursor&&(r.user.isPasteAtCursorMode=!1),r.version<os.AddKeyboardShortcuts&&(r.user.areKeyboardShortcutsEnabled=!0),r.version<os.AddShowUiLabels&&(r.user.showUiLabels=!1),r.version<os.RenameShowUiLabelsToEnhancedA11yMode&&(r.user.enhancedA11yMode=r.user.showUiLabels,delete r.user.showUiLabels),r.version<os.AddPointerPeripheral&&(r.user.inputMode=null),r.version=AN}const zP=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function wq(){return zP[Math.floor(Math.random()*zP.length)]}function ZSe(){return typeof window<"u"&&window.matchMedia?window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1:!1}const Wi=Object.freeze({name:"",locale:wSe(),color:wq(),edgeScrollSpeed:1,animationSpeed:ZSe()?0:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,enhancedA11yMode:!1,colorScheme:"light",inputMode:null});function jE(){return{id:ft(),color:wq()}}function bq(r){if(r===null||typeof r!="object"||!("version"in r)||!("user"in r)||typeof r.version!="number")return jE();const e=vn(r);XSe(e);try{return Sq.validate(e.user)}catch{return jE()}}function QSe(){const r=JSON.parse(zO(xq)||"null")??null;return bq(r)}const x1=Ft("globalUserData",null);function ewe(){BO(xq,JSON.stringify({version:AN,user:x1.get()}))}function vq(r){Sq.validate(r),x1.set(r),ewe(),twe()}const kq=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;kq?.addEventListener("message",r=>{const e=r.data;e?.type===Tq&&e?.origin!==Cq()&&x1.set(bq(e.data))});let LE=null;function Cq(){return LE===null&&(LE=ft()),LE}const Tq="tldraw-user-preferences-change";function twe(){kq?.postMessage({type:Tq,origin:Cq(),data:{user:Eq(),version:AN}})}function Eq(){let r=x1.get();return r||(r=QSe(),vq(r)),r}const nwe=q("defaultLocalStorageUserPrefs",()=>Eq());function Mq(r={}){return{userPreferences:r.userPreferences??nwe,setUserPreferences:r.setUserPreferences??vq}}var UE={exports:{}},vj;function rwe(){return vj||(vj=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,S,w;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,p),!0}for(w=1,S=new Array(y-1);w<y;w++)S[w-1]=arguments[w];g.fn.apply(g.context,S)}else{var b=g.length,v;for(w=0;w<b;w++)switch(g[w].once&&this.removeListener(c,g[w].fn,void 0,!0),y){case 1:g[w].fn.call(g[w].context);break;case 2:g[w].fn.call(g[w].context,u);break;case 3:g[w].fn.call(g[w].context,u,d);break;case 4:g[w].fn.call(g[w].context,u,d,h);break;default:if(!S)for(v=1,S=new Array(y-1);v<y;v++)S[v-1]=arguments[v];g[w].fn.apply(g[w].context,S)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&o(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(UE)),UE.exports}var iwe=rwe();const swe=ip(iwe),uf="TLDRAW_TAB_ID_v2",md=globalThis.window;function owe(){return md?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(md.navigator.platform)||ht.isDarwin&&"ontouchend"in document:!1}const hv=md?md[uf]??CW(uf)??"TLDRAW_INSTANCE_STATE_V1_"+ft():"<error>";md&&(md[uf]=hv,owe()?jO(uf,hv):TW(uf));md?.addEventListener("beforeunload",()=>{jO(uf,hv)});const Iq={Initial:0},S1=Math.max(...Object.values(Iq));function awe(r){r.version<Iq.Initial,r.version=S1}const Pq=st({version:$e,currentPageId:Ay.optional(),isFocusMode:Qe.optional(),exportBackground:Qe.optional(),isDebugMode:Qe.optional(),isToolLocked:Qe.optional(),isGridMode:Qe.optional(),pageStates:Bn(st({pageId:Ay,camera:st({x:$e,y:$e,z:$e}).optional(),selectedShapeIds:Bn(Ps).optional(),focusedGroupId:Ps.nullable().optional()})).optional()});function lwe(r){if(!r||typeof r!="object")return console.warn("Invalid instance state"),null;if(!("version"in r)||typeof r.version!="number")return console.warn("No version in instance state"),null;r.version!==S1&&(r=vn(r),awe(r));try{return Pq.validate(r)}catch(e){return console.warn(e),null}}function $N(r){const e=r.query.ids("page");return q("sessionStateSnapshot",()=>{const t=r.get(ci);if(!t)return null;const n=[...e.get()];return{version:S1,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:n.map(i=>{const s=r.get(eo.createId(i)),o=r.get(Jo.createId(i));return{pageId:i,camera:{x:o?.x??0,y:o?.y??0,z:o?.z??1},selectedShapeIds:s?.selectedShapeIds??[],focusedGroupId:s?.focusedGroupId??null}})}},{isEqual:Yl})}function BP(r,e,t){const n=lwe(e);if(!n)return;const i=DH(r.get(ci)),s=t?.forceOverwrite?n:i,o=t?.forceOverwrite?i:n,a=r.schema.types.instance.create({id:ci,...i,currentPageId:n.currentPageId,isDebugMode:s?.isDebugMode??o?.isDebugMode,isFocusMode:s?.isFocusMode??o?.isFocusMode,isToolLocked:s?.isToolLocked??o?.isToolLocked,isGridMode:s?.isGridMode??o?.isGridMode,exportBackground:s?.exportBackground??o?.exportBackground});r.atomic(()=>{for(const l of n.pageStates??[]){if(!r.has(l.pageId))continue;const c=Jo.createId(l.pageId),u=eo.createId(l.pageId),d=r.get(c),h=r.get(u);r.put([Jo.create({id:c,x:l.camera?.x??d?.x,y:l.camera?.y??d?.y,z:l.camera?.z??d?.z}),eo.create({id:u,pageId:l.pageId,selectedShapeIds:l.selectedShapeIds??h?.selectedShapeIds,focusedGroupId:l.focusedGroupId??h?.focusedGroupId})])}r.put([a]),r.ensureStoreIsUsable()})}function cwe(r){const e=[];for(const i of Object.values(r))i.typeName?.match(/^(instance.*|pointer|camera)$/)&&e.push(i);const t=e.filter(i=>i.typeName==="instance"&&i.id!==ci)[0];if(!t)return null;const n={version:S1,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(i=>i.typeName==="instance_page_state"&&i.instanceId===t.id).map(i=>{const s=r[i.cameraId]??{x:0,y:0,z:1};return{pageId:i.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId}})};try{return Pq.validate(n),n}catch{return null}}function Aq(r,e,t){let n={};if("store"in e){const o=r.schema.migrateStoreSnapshot(e);if(o.type!=="success")throw new Error("Failed to migrate store snapshot: "+o.reason);n.document={schema:r.schema.serialize(),store:Hg(o.value,(a,{typeName:l})=>r.scopedTypes.document.has(l))}}else n=e;const i=DH(r.get(ci)),s=$q.get(r,$N).get();r.atomic(()=>{n.document&&r.loadStoreSnapshot(n.document),i&&r.update(ci,o=>({...o,...i})),s&&BP(r,s),n.session&&BP(r,n.session,{forceOverwrite:t?.forceOverwriteSessionState})})}const $q=new Ar;function uwe(r){const t=$q.get(r,$N).get();if(!t)throw new Error("Session state is not ready yet");return{document:r.getStoreSnapshot(),session:t}}function Rq(r){const e=[],t=new Set;for(const n of r){if(t.has(n.type))throw new Error(`Binding type "${n.type}" is defined more than once`);e.push(n),t.add(n.type)}return e}function zl({children:r,className:e="",...t}){return x.jsx("svg",{...t,className:oe("tl-svg-container",e),"aria-hidden":"true",children:r})}class V{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.w=n,this.h=i}x=0;y=0;w=0;h=0;get point(){return new T(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new T(this.x+this.w/2,this.y+this.h/2)}set center(e){this.x=e.x-this.w/2,this.y=e.y-this.h/2}get corners(){return[new T(this.x,this.y),new T(this.x+this.w,this.y),new T(this.x+this.w,this.y+this.h),new T(this.x,this.y+this.h)]}get cornersAndCenter(){return[new T(this.x,this.y),new T(this.x+this.w,this.y),new T(this.x+this.w,this.y+this.h),new T(this.x,this.y+this.h),new T(this.x+this.w/2,this.y+this.h/2)]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new T(this.w,this.h)}toFixed(){return this.x=JS(this.x),this.y=JS(this.y),this.w=JS(this.w),this.h=JS(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,i=0){return this.x=e,this.y=t,this.w=n,this.h=i,this}expand(e){const t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),s=Math.max(this.y+this.h,e.y+e.h);return this.x=t,this.y=n,this.w=i-t,this.h=s-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:n,h:i}=this;return new V(e,t,n,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.x/e)*e,n=Math.round(this.y/e)*e,i=Math.round((this.x+this.w)/e)*e,s=Math.round((this.y+this.h)/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,i-t),this.height=Math.max(1,s-n)}collides(e){return V.Collides(this,e)}contains(e){return V.Contains(this,e)}includes(e){return V.Includes(this,e)}containsPoint(e,t=0){return V.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new T(this.x,this.y);case"top_right":return new T(this.x+this.w,this.y);case"bottom_left":return new T(this.x,this.y+this.h);case"bottom_right":return new T(this.x+this.w,this.y+this.h);case"top":return new T(this.x+this.w/2,this.y);case"right":return new T(this.x+this.w,this.y+this.h/2);case"bottom":return new T(this.x+this.w/2,this.y+this.h);case"left":return new T(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(e,t,n){const{minX:i,minY:s,maxX:o,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=n;break}case"bottom":case"bottom_left":case"bottom_right":{d+=n;break}}const h=(u-l)/(o-i),f=(d-c)/(a-s),p=h<0,m=f<0;if(p){const g=u;u=l,l=g}if(m){const g=d;d=c,c=g}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(e){const t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),s=Math.max(this.y+this.h,e.y+e.h);return this.x=t,this.y=n,this.width=i-t,this.height=s-n,this}static From(e){return new V(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new V(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new V;let t=1/0,n=1/0,i=-1/0,s=-1/0,o;for(let a=0,l=e.length;a<l;a++)o=e[a],t=Math.min(o.x,t),n=Math.min(o.y,n),i=Math.max(o.x,i),s=Math.max(o.y,s);return new V(t,n,i-t,s-n)}static Expand(e,t){const n=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),s=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new V(n,i,s-n,o-i)}static ExpandBy(e,t){return new V(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static ContainsApproximately(e,t,n){return kl(e.minX,t.minX,n)&&kl(e.minY,t.minY,n)&&kl(t.maxX,e.maxX,n)&&kl(t.maxY,e.maxY,n)}static Includes(e,t){return V.Collides(e,t)||V.Contains(e,t)}static ContainsPoint(e,t,n=0){return!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n)}static Common(e){let t=1/0,n=1/0,i=-1/0,s=-1/0;for(let o=0;o<e.length;o++){const a=e[o];t=Math.min(t,a.minX),n=Math.min(n,a.minY),i=Math.max(i,a.maxX),s=Math.max(s,a.maxY)}return new V(t,n,i-t,s-n)}static Sides(e,t=0){const{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]}static Resize(e,t,n,i,s=!1){const{minX:o,minY:a,maxX:l,maxY:c}=e;let{minX:u,minY:d,maxX:h,maxY:f}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=n;break}case"right":case"top_right":case"bottom_right":{h+=n;break}}switch(t){case"top":case"top_left":case"top_right":{d+=i;break}case"bottom":case"bottom_left":case"bottom_right":{f+=i;break}}const p=(h-u)/(l-o),m=(f-d)/(c-a),g=p<0,y=m<0;if(s){const w=(l-o)/(c-a),b=Math.abs(h-u),v=Math.abs(f-d),C=b*(m<0?1:-1)*(1/w),E=v*(p<0?1:-1)*w,M=w<b/v;switch(t){case"top_left":{M?d=f+C:u=h+E;break}case"top_right":{M?d=f+C:h=u-E;break}case"bottom_right":{M?f=d-C:h=u-E;break}case"bottom_left":{M?f=d-C:u=h+E;break}case"bottom":case"top":{const P=(u+h)/2,$=v*w;u=P-$/2,h=P+$/2;break}case"left":case"right":{const P=(d+f)/2,$=b/w;d=P-$/2,f=P+$/2;break}}}if(g){const w=h;h=u,u=w}if(y){const w=f;f=d,d=w}const S=new V(u,d,Math.abs(h-u),Math.abs(f-d));return{box:S,scaleX:+(S.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(S.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return V.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new V(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function dwe(r){switch(r){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return r}}function hwe(r){switch(r){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return r}}function fwe(r){return r==="top_left"||r==="top_right"||r==="bottom_right"||r==="bottom_left"}class J{constructor(e,t,n,i,s,o){this.a=e,this.b=t,this.c=n,this.d=i,this.e=s,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:n,b:i,c:s,d:o,e:a,f:l}=this;return this.a=n*t.a+s*t.b,this.c=n*t.c+s*t.d,this.e=n*t.e+s*t.f+a,this.b=i*t.a+o*t.b,this.d=i*t.c+o*t.d,this.f=i*t.e+o*t.f+l,this}rotate(e,t,n){return e===0?this:t===void 0?this.multiply(J.Rotate(e)):this.translate(t,n).multiply(J.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(J.Translate(e,t))}scale(e,t){return this.multiply(J.Scale(e,t))}invert(){const{a:e,b:t,c:n,d:i,e:s,f:o}=this,a=e*i-t*n;return this.a=i/a,this.b=t/-a,this.c=n/-a,this.d=e/a,this.e=(i*s-n*o)/-a,this.f=(t*s-e*o)/a,this}applyToPoint(e){return J.applyToPoint(this,e)}applyToPoints(e){return J.applyToPoints(this,e)}rotation(){return J.Rotation(this)}point(){return J.Point(this)}decomposed(){return J.Decompose(this)}toCssString(){return J.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return J.Decompose(this)}clone(){return new J(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new J(1,0,0,1,0,0)}static Translate(e,t){return new J(1,0,0,1,e,t)}static Rotate(e,t,n){if(e===0)return J.Identity();const i=Math.cos(e),s=Math.sin(e),o=new J(i,s,-s,i,0,0);return t===void 0?o:J.Compose(J.Translate(t,n),o,J.Translate(-t,-n))}static Scale(e,t,n,i){const s=new J(e,0,0,t,0,0);return n===void 0?s:J.Translate(n,i).multiply(s).translate(-n,-i)}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=J.Identity();for(let n=0,i=e.length;n<i;n++)t.multiply(e[n]);return t}static Point(e){return new T(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const n=(e.b*e.b+e.d*e.d)**.5;t=kn+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return FP(t)}static Decompose(e){let t,n,i;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=s,n=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,n=s,i=kn+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,n=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:FP(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${D(e.a)}, ${D(e.b)}, ${D(e.c)}, ${D(e.d)}, ${D(e.e)}, ${D(e.f)})`}static applyToPoint(e,t){return new T(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(n=>new T(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z))}static applyToBounds(e,t){return new V(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new J(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof J?e:J.From(e)}}function w1(r,e,t,n,i=1e-10){const s=r.x-t.x,o=r.y-t.y,a=n.x-t.x,l=n.y-t.y,c=e.x-r.x,u=e.y-r.y,d=a*o-l*s,h=c*o-u*s,f=l*c-a*u;if(Mn(d,0,i)||Mn(h,0,i)||Mn(f,0,i))return null;if(f!==0){const p=d/f,m=h/f;if(kl(0,p,i)&&kl(p,1,i)&&kl(0,m,i)&&kl(m,1,i))return T.AddXY(r,p*c,p*u)}return null}function cS(r,e,t,n){const i=(e.x-r.x)*(e.x-r.x)+(e.y-r.y)*(e.y-r.y),s=2*((e.x-r.x)*(r.x-t.x)+(e.y-r.y)*(r.y-t.y)),o=t.x*t.x+t.y*t.y+r.x*r.x+r.y*r.y-2*(t.x*r.x+t.y*r.y)-n*n,a=s*s-4*i*o;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-s+l)/(2*i),u=(-s-l)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;const d=[];return 0<=c&&c<=1&&d.push(T.Lrp(r,e,c)),0<=u&&u<=1&&d.push(T.Lrp(r,e,u)),d.length===0?null:d}function pwe(r,e,t){const n=[];let i;for(let s=0,o=t.length-1;s<o;s++)i=w1(r,e,t[s],t[s+1]),i&&n.push(i);return n.length===0?null:n}function Oq(r,e,t){const n=[];let i;for(let s=1,o=t.length;s<o+1;s++)i=w1(r,e,t[s-1],t[s%t.length]),i&&n.push(i);return n.length===0?null:n}function mwe(r,e,t,n){let i=t.x-r.x,s=t.y-r.y;const o=Math.sqrt(i*i+s*s),a=(o*o-n*n+e*e)/(2*o),l=Math.sqrt(e*e-a*a);return i/=o,s/=o,[new T(r.x+i*a-s*l,r.y+s*a+i*l),new T(r.x+i*a+s*l,r.y+s*a-i*l)]}function gwe(r,e,t){const n=[];let i,s,o;for(let a=0,l=t.length;a<l;a++)i=t[a],s=t[(a+1)%t.length],o=cS(i,s,r,e),o&&n.push(...o);return n.length===0?null:n}function ywe(r,e,t){const n=[];let i,s,o;for(let a=1,l=t.length;a<l;a++)i=t[a-1],s=t[a],o=cS(i,s,r,e),o&&n.push(...o);return n.length===0?null:n}function GS(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function RN(r,e,t,n){return GS(r,t,n)!==GS(e,t,n)&&GS(r,e,t)!==GS(r,e,n)}function fv(r,e){const t=new Map;let n,i,s,o;for(let a=0,l=r.length;a<l;a++)if(n=r[a],hi(n,e)){const c=Mb(n);t.has(c)||t.set(c,n)}for(let a=0,l=e.length;a<l;a++)if(n=e[a],hi(n,r)){const c=Mb(n);t.has(c)||t.set(c,n)}for(let a=0,l=r.length;a<l;a++){n=r[a],i=r[(a+1)%r.length];for(let c=0,u=e.length;c<u;c++){s=e[c],o=e[(c+1)%e.length];const d=w1(n,i,s,o);if(d!==null){const h=Mb(d);t.has(h)||t.set(h,d)}}}return t.size===0?null:xwe([...t.values()])}function kj(r,e,t,n){const i=new Map;for(let s=0,o=t?r.length:r.length-1;s<o;s++){const a=r[s],l=r[(s+1)%r.length];for(let c=0,u=n?e.length:e.length-1;c<u;c++){const d=e[c],h=e[(c+1)%e.length],f=w1(a,l,d,h);if(f!==null){const p=Mb(f);i.has(p)||i.set(p,f)}}}return[...i.values()]}function Mb(r){return`${r.x},${r.y}`}function xwe(r){const e=T.Average(r);return r.sort((t,n)=>T.Angle(e,t)-T.Angle(e,n))}function Nq(r,e){let t,n,i,s;for(let o=0,a=r.length;o<a;o++){t=r[o],n=r[(o+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],s=e[(l+1)%c],RN(t,n,i,s))return!0}return!1}function Swe(r,e){let t,n,i,s;for(let o=0,a=r.length;o<a;o++){t=r[o],n=r[(o+1)%a];for(let l=1,c=e.length;l<c;l++)if(i=e[l-1],s=e[l],RN(t,n,i,s))return!0}return!1}const Yo={EXCLUDE_NON_STANDARD:{includeLabels:!1,includeInternal:!1},EXCLUDE_LABELS:{includeLabels:!1,includeInternal:!0}};class oc{isFilled=!1;isClosed=!0;isLabel=!1;isEmptyLabel=!1;isInternal=!1;excludeFromShapeBounds=!1;debugColor;ignore;constructor(e){const{isLabel:t=!1,isEmptyLabel:n=!1,isInternal:i=!1,excludeFromShapeBounds:s=!1}=e;this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.debugColor=e.debugColor,this.ignore=e.ignore,this.isLabel=t,this.isEmptyLabel=n,this.isInternal=i,this.excludeFromShapeBounds=s}isExcludedByFilter(e){return e?!!(this.isLabel&&!e.includeLabels||this.isInternal&&!e.includeInternal):!1}hitTestPoint(e,t=0,n=!1,i){return this.isClosed&&(this.isFilled||n)&&hi(e,this.vertices)?!0:T.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1,n){return T.Dist(e,this.nearestPoint(e,n))*(this.isClosed&&(this.isFilled||t)&&hi(e,this.vertices)?-1:1)}distanceToLineSegment(e,t,n){if(T.Equals(e,t))return this.distanceToPoint(e,!1,n);const{vertices:i}=this;if(i.length===0)throw Error("nearest point not found");if(i.length===1)return T.Dist(e,i[0]);let s,o=1/0,a,l,c;const u=this.isClosed?i.length:i.length-1;for(let d=0;d<i.length;d++){if(l=i[d],d<u){const h=i[(d+1)%i.length];if(RN(e,t,l,h))return 0}c=T.NearestPointOnLineSegment(e,t,l,!0),a=T.Dist2(l,c),a<o&&(o=a,s=c)}if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&hi(s,this.vertices)?-o:o}hitTestLineSegment(e,t,n=0,i){return this.distanceToLineSegment(e,t,i)<=n}intersectLineSegment(e,t,n){return(this.isClosed?Oq(e,t,this.vertices):pwe(e,t,this.vertices))??[]}intersectCircle(e,t,n){return(this.isClosed?gwe(e,t,this.vertices):ywe(e,t,this.vertices))??[]}intersectPolygon(e,t){return kj(e,this.vertices,!0,this.isClosed)}intersectPolyline(e,t){return kj(e,this.vertices,!1,this.isClosed)}interpolateAlongEdge(e,t){const{vertices:n}=this;if(n.length===0)return new T(0,0);if(n.length===1||e<=0)return n[0];const i=e*this.length;let s=0;for(let o=0;o<(this.isClosed?n.length:n.length-1);o++){const a=n[o],l=n[(o+1)%n.length],c=T.Dist(a,l),u=s+c;if(u>=i)return T.Lrp(a,l,Iy(s,u,i));s=u}return this.isClosed?n[0]:n[n.length-1]}uninterpolateAlongEdge(e,t){const{vertices:n,length:i}=this;let s=null,o=1/0,a=0;if(n.length===0||n.length===1)return 0;for(let c=0;c<(this.isClosed?n.length:n.length-1);c++){const u=n[c],d=n[(c+1)%n.length],h=T.NearestPointOnLineSegment(u,d,e,!0),f=T.Dist(h,e);f<o&&(o=f,s={start:u,end:d,nearestPoint:h,distanceToStart:a}),a+=T.Dist(u,d)}return se(s),(s.distanceToStart+T.Dist(s.start,s.nearestPoint))/i}isPointInBounds(e,t=0){const{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}overlapsPolygon(e){const t=e.map(l=>T.From(l)),{vertices:n,center:i,isFilled:s,isEmptyLabel:o,isClosed:a}=this;if(o)return!1;if(n.some(l=>hi(l,t)))return!0;if(a){if(s&&(hi(i,t)||t.every(l=>hi(l,n)))||Nq(t,n))return!0}else if(Swe(t,n))return!0;return!1}transform(e,t){return new ON(this,e,t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(Yo.EXCLUDE_LABELS)),this._vertices}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.vertices}_boundsVertices;get boundsVertices(){return this._boundsVertices||(this._boundsVertices=this.getBoundsVertices()),this._boundsVertices}getBounds(){return V.FromPoints(this.boundsVertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let n=0,i=e.length;n<i;n++){const s=e[n],o=e[(n+1)%i];t+=s.x*o.y-o.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,n=t.length;if(n===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<n;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length?this._length:(this._length=this.getLength(Yo.EXCLUDE_LABELS),this._length)}getLength(e){const t=this.getVertices(e??Yo.EXCLUDE_LABELS);if(t.length===0)return 0;let n=t[0],i=0;for(let s=1;s<t.length;s++){const o=t[s];i+=T.Dist(n,o),n=o}return this.isClosed&&(i+=T.Dist(t[t.length-1],t[0])),i}}class ON extends oc{constructor(e,t,n){super(e),this.geometry=e,this.matrix=t,this.inverse=J.Inverse(t),this.decomposed=J.Decompose(t),n&&(n.isLabel!=null&&(this.isLabel=n.isLabel),n.isInternal!=null&&(this.isInternal=n.isInternal),n.debugColor!=null&&(this.debugColor=n.debugColor),n.ignore!=null&&(this.ignore=n.ignore)),se(Mn(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(e){return this.geometry.getVertices(e).map(t=>J.applyToPoint(this.matrix,t))}getBoundsVertices(){return this.geometry.getBoundsVertices().map(e=>J.applyToPoint(this.matrix,e))}nearestPoint(e,t){return J.applyToPoint(this.matrix,this.geometry.nearestPoint(J.applyToPoint(this.inverse,e),t))}hitTestPoint(e,t=0,n,i){return this.geometry.hitTestPoint(J.applyToPoint(this.inverse,e),t/this.decomposed.scaleX,n,i)}distanceToPoint(e,t=!1,n){return this.geometry.distanceToPoint(J.applyToPoint(this.inverse,e),t,n)*this.decomposed.scaleX}distanceToLineSegment(e,t,n){return this.geometry.distanceToLineSegment(J.applyToPoint(this.inverse,e),J.applyToPoint(this.inverse,t),n)*this.decomposed.scaleX}hitTestLineSegment(e,t,n=0,i){return this.geometry.hitTestLineSegment(J.applyToPoint(this.inverse,e),J.applyToPoint(this.inverse,t),n/this.decomposed.scaleX,i)}intersectLineSegment(e,t,n){return J.applyToPoints(this.matrix,this.geometry.intersectLineSegment(J.applyToPoint(this.inverse,e),J.applyToPoint(this.inverse,t),n))}intersectCircle(e,t,n){return J.applyToPoints(this.matrix,this.geometry.intersectCircle(J.applyToPoint(this.inverse,e),t/this.decomposed.scaleX,n))}intersectPolygon(e,t){return J.applyToPoints(this.matrix,this.geometry.intersectPolygon(J.applyToPoints(this.inverse,e),t))}intersectPolyline(e,t){return J.applyToPoints(this.matrix,this.geometry.intersectPolyline(J.applyToPoints(this.inverse,e),t))}transform(e,t){return new ON(this.geometry,J.Multiply(e,this.matrix),{isLabel:t?.isLabel??this.isLabel,isInternal:t?.isInternal??this.isInternal,debugColor:t?.debugColor??this.debugColor,ignore:t?.ignore??this.ignore})}getSvgPathData(){throw new Error("Cannot get SVG path data for transformed geometry.")}}class ts extends oc{children=[];ignoredChildren=[];constructor(e){super({...e,isClosed:!0,isFilled:!1});const t=n=>{for(const i of n)i instanceof ts?t(i.children):i.ignore?this.ignoredChildren.push(i):this.children.push(i)};if(t(e.children),this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(e){return this.isExcludedByFilter(e)?[]:this.children.filter(t=>!t.isExcludedByFilter(e)).flatMap(t=>t.getVertices(e))}nearestPoint(e,t){let n=1/0,i;const{children:s}=this;if(s.length===0)throw Error("no children");let o,a;for(const l of s)l.isExcludedByFilter(t)||(o=l.nearestPoint(e,t),a=T.Dist2(o,e),a<n&&(n=a,i=o));if(!i)throw Error("nearest point not found");return i}distanceToPoint(e,t=!1,n){let i=1/0;for(const s of this.children){if(s.isExcludedByFilter(n))continue;const o=s.distanceToPoint(e,t,n);o<i&&(i=o)}return i}hitTestPoint(e,t,n,i=Yo.EXCLUDE_LABELS){return!!this.children.filter(s=>!s.isExcludedByFilter(i)).find(s=>s.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n,i=Yo.EXCLUDE_LABELS){return!!this.children.filter(s=>!s.isExcludedByFilter(i)).find(s=>s.hitTestLineSegment(e,t,n))}intersectLineSegment(e,t,n){return this.children.flatMap(i=>i.isExcludedByFilter(n)?gn:i.intersectLineSegment(e,t,n))}intersectCircle(e,t,n){return this.children.flatMap(i=>i.isExcludedByFilter(n)?gn:i.intersectCircle(e,t,n))}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.children.flatMap(e=>e.getBoundsVertices())}intersectPolygon(e,t){return this.children.flatMap(n=>n.isExcludedByFilter(t)?gn:n.intersectPolygon(e,t))}intersectPolyline(e,t){return this.children.flatMap(n=>n.isExcludedByFilter(t)?gn:n.intersectPolyline(e,t))}interpolateAlongEdge(e,t){const n=this.getLength(t),i=e*n;let s=0;for(const o of this.children){if(o.isExcludedByFilter(t))continue;const a=o.length,l=s+a;if(l>=i)return o.interpolateAlongEdge(Iy(s,l,i),t);s=l}return this.children[this.children.length-1].interpolateAlongEdge(1,t)}uninterpolateAlongEdge(e,t){const n=this.getLength(t);let i=null,s=1/0,o=0;for(const c of this.children){if(c.isExcludedByFilter(t))continue;const u=c.getLength(t),d=o+u,h=c.distanceToPoint(e,!1,t);h<s&&(s=h,i={startLength:o,endLength:d,child:c}),o=d}se(i);const a=i.child.uninterpolateAlongEdge(e,t);return Ye(i.startLength,i.endLength,a)/n}transform(e){return new ts({children:this.children.map(t=>t.transform(e)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const n of this.children)e+=n.toSimpleSvgPath();const t=V.FromPoints(this.boundsVertices).corners;for(let n=0,i=t.length;n<i;n++){const s=t[n],o=t[(n-1+i)%i],a=s.dist(o),l=t[(n+1)%i],c=s.dist(l),u=s.clone().lrp(o,4/a),d=s,h=s.clone().lrp(l,4/c);e+=`M${u.x},${u.y} L${d.x},${d.y} L${h.x},${h.y} `}return e}getLength(e){let t=0;for(const n of this.children)n.isExcludedByFilter(e)||(t+=n.length);return t}getSvgPathData(){return this.children.map((e,t)=>e.isLabel?"":e.getSvgPathData(t===0)).join(" ")}overlapsPolygon(e){return this.children.some(t=>t.overlapsPolygon(e))}}class Of extends oc{_start;_end;_d;_u;_ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{start:t,end:n}=e;this._start=t,this._end=n,this._d=t.clone().sub(n),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(e){const{_start:t,_end:n,_d:i,_u:s,_ul:o}=this;if(i.len()===0||o===0)return t;const a=T.Sub(e,t).dpr(s)/o,l=t.x+s.x*a;if(l<Math.min(t.x,n.x))return t.x<n.x?t:n;if(l>Math.max(t.x,n.x))return t.x>n.x?t:n;const c=t.y+s.y*a;return c<Math.min(t.y,n.y)?t.y<n.y?t:n:c>Math.max(t.y,n.y)?t.y>n.y?t:n:new T(l,c)}getSvgPathData(e=!0){const{_start:t,_end:n}=this;return`${e?`M${t.toFixed()}`:""} L${n.toFixed()}`}}class uS extends oc{_points;_segments;constructor(e){super({isClosed:!1,isFilled:!1,...e});const{points:t}=e;if(this._points=t,t.length<2)throw new Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){const i=e[t],s=e[t+1];this._segments.push(new Of({start:i,end:s}))}this.isClosed&&this._segments.push(new Of({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,t)=>e+t.length,0)}getVertices(){return this._points}nearestPoint(e){const{segments:t}=this;let n=this._points[0],i=1/0,s,o;for(let a=0;a<t.length;a++)s=t[a].nearestPoint(e),o=T.Dist2(s,e),o<i&&(n=s,i=o);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(e,t,n=0){const{segments:i}=this;for(let s=0,o=i.length;s<o;s++)if(i[s].hitTestLineSegment(e,t,n))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce((t,n,i)=>i===0?`M ${n.x} ${n.y}`:`${t} L ${n.x} ${n.y}`,"")}}class Oy extends uS{constructor(e){if(super({...e}),this.isClosed=!0,e.points.length<3)throw new Error("Polygon2d: points must be an array of at least 3 points")}}class ao extends Oy{_x;_y;_w;_h;constructor(e){const{x:t=0,y:n=0,width:i,height:s}=e;super({...e,points:[new T(t,n),new T(t+i,n),new T(t+i,n+s),new T(t,n+s)]}),this._x=t,this._y=n,this._w=i,this._h=s}getBounds(){return new V(this._x,this._y,this._w,this._h)}getSvgPathData(){const{_x:e,_y:t,_w:n,_h:i}=this;return this.negativeZeroFix(),`M${e},${t} h${n} v${i} h${-n}z`}negativeZeroFix(){this._x=YS(this._x),this._y=YS(this._y),this._w=YS(this._w),this._h=YS(this._h)}}function YS(r){return Object.is(r,-0)?0:r}class ac{constructor(e){this.editor=e}static configure(e){return class extends this{options={...this.options,...e}}}options={};static props;static migrations;static type;getFontFaces(e){return gn}canSnap(e){return!0}canTabTo(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canResizeChildren(e){return!0}canEditInReadonly(e){return!1}canCrop(e){return!1}canBeLaidOut(e,t){return!0}canCull(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}isExportBoundsContainer(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}getAriaDescriptor(e){}}function _q(r,e,t={}){const{closed:n=!1,snap:i=1,start:s="outset",end:o="outset",lengthRatio:a=2,style:l="dashed",forceSolid:c=!1}=t;let u=0,d=0,h=1,f=0,p=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(l){case"dashed":{h=1,u=Math.min(e*a,r/4);break}case"dotted":{h=100,u=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return n||(s==="outset"?(r+=u/2,p+=u/2):s==="skip"&&(r-=u,p-=u),o==="outset"?r+=u/2:o==="skip"&&(r-=u)),d=Math.floor(r/u/(2*h)),d-=d%i,d<3&&l==="dashed"?r/e<4?(u=r,d=1,f=0):(u=r*(1/3),f=r*(1/3)):(u=r/d/(2*h),n?(p=u/2,f=(r-d*u)/d):f=(r-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,f].join(" "),strokeDashoffset:p.toString()}}function Cj({bounds:r,className:e}){const t=z(),n=F("zoom level",()=>t.getZoomLevel(),[t]);return x.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:r.sides.map((i,s)=>{const{strokeDasharray:o,strokeDashoffset:a}=_q(i[0].dist(i[1]),1/n,{style:"dashed",lengthRatio:4});return x.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:a},s)})})}class wwe extends ac{static type="group";static props=VH;static migrations=GH;hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new ao({width:1,height:1,isFilled:!1}):new ts({children:t.map(n=>{const i=this.editor.getShape(n);return this.editor.getShapeGeometry(n).transform(this.editor.getShapeLocalTransform(i),{isLabel:!1})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),i=n.length>0&&n.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||i))return null;const o=this.editor.getShapeGeometry(e).bounds;return x.jsx(zl,{children:x.jsx(Cj,{className:"tl-group",bounds:o})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return x.jsx(Cj,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}const Dq=[wwe],bwe=new Set(Dq.map(r=>r.type));function Fq(r){const e=[...Dq],t=new Set;for(const n of r){if(bwe.has(n.type))throw new Error(`Shape type "${n.type}" is a core shapes type and cannot be overridden`);if(t.has(n.type))throw new Error(`Shape type "${n.type}" is defined more than once`);e.push(n),t.add(n.type)}return e}function zq(r,e){const t=new Map;return async function(i){const s=t.get(i);if(s)return s;const o=(async()=>{try{const a=await Ua(i,e);return se(a.ok),await r(a)}catch(a){return console.error(a),null}})();return t.set(i,o),o}}const b1=zq(async r=>await mr.blobToDataUrl(await r.blob())),vwe=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,kwe=/@font-face\s*{([^}]+)}/gi,Bq=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,Cwe=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function Twe(r){return Array.from(r.matchAll(vwe),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function jq(r,e){return Array.from(r.matchAll(kwe),t=>{const n=t[1],i=Array.from(n.matchAll(Bq),o=>{const a=o[1]||o[2]||o[3];return{original:a,resolved:je(a,e)?.href??null}}),s=new Set(Array.from(n.matchAll(Cwe),o=>(o[1]||o[2]||o[3]).toLowerCase()));return{fontFace:n,urls:i,fontFamilies:s}})}function Ewe(r){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,n=new Set;for(;;){const i=e.exec(r);if(!i)break;const s=i[1]||i[2]||i[3];if(n.add(s.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(r))break;e.lastIndex=t.lastIndex}return n}function Lq(r){return!(r.startsWith("-")||r.startsWith("animation")||r.startsWith("transition")||r==="cursor"||r==="pointer-events"||r==="user-select"||r==="touch-action")}function Mwe(r,e){return{imports:Twe(r),fontFaces:jq(r,e)}}function Iwe(r){return Array.from(r.matchAll(Bq),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}var Pwe=Object.create,Uq=Object.defineProperty,Awe=Object.getOwnPropertyDescriptor,$we=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Wq=r=>{throw TypeError(r)},Hq=(r,e,t)=>e in r?Uq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rwe=r=>[,,,Pwe(null)],qq=["class","method","getter","setter","accessor","field","value","get","set"],Kq=r=>r!==void 0&&typeof r!="function"?Wq("Function expected"):r,Owe=(r,e,t,n,i)=>({kind:qq[r],name:e,metadata:n,addInitializer:s=>t._?Wq("Already initialized"):i.push(Kq(s||null))}),Nwe=(r,e)=>Hq(e,$we("metadata"),r[3]),_we=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},Dwe=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=qq[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,Awe(i,t)),y=n.length-1;y>=0;y--)l=Owe(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,Kq(o)&&(g[p]=o);return g&&Uq(i,t,g),i},XS=(r,e,t)=>Hq(r,typeof e!="symbol"?e+"":e,t),Jq,v1;const Vq="tldraw-svg-export";Jq=[Yi];class NN{constructor(){_we(v1,5,this),XS(this,"fontFacesPromise",null),XS(this,"foundFontNames",new Set),XS(this,"fontFacesToEmbed",new Set),XS(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){se(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=Fwe()}onFontFamilyValue(e){se(this.fontFacesPromise,"FontEmbedder not started");const t=Ewe(e);for(const n of t){if(this.foundFontNames.has(n))return;this.foundFontNames.add(n),this.pendingPromises.push(this.fontFacesPromise.then(i=>{const s=i.filter(o=>o.fontFamilies.has(n));for(const o of s)if(!this.fontFacesToEmbed.has(o)){this.fontFacesToEmbed.add(o);for(const a of o.urls)!a.resolved||a.embedded||(a.embedded=b1(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let n=`@font-face {${t.fontFace}}`;for(const i of t.urls){if(!i.embedded)continue;const s=await i.embedded;s&&(n=n.replace(i.original,s))}e+=n}return e}}v1=Rwe();Dwe(v1,1,"onFontFamilyValue",Jq,NN);Nwe(v1,NN);async function Fwe(){const r=[],e=Array.from(document.styleSheets).filter(t=>!t.ownerNode?.closest(`.${Vq}`));for(const t of e){let n;try{n=t.cssRules}catch{}if(n){for(const i of t.cssRules)if(i instanceof CSSFontFaceRule)r.push(jq(i.cssText,t.href??document.baseURI));else if(i instanceof CSSImportRule){const s=new URL(i.href,i.parentStyleSheet?.href??document.baseURI);r.push(jP(s.href))}}else t.href&&r.push(jP(t.href))}return Re(await Promise.all(r)).flat()}const jP=zq(async r=>{const e=Mwe(await r.text(),r.url),t=await Promise.all(e.imports.map(({url:n})=>jP(new URL(n,r.url).href)));return[...e.fontFaces,...Re(t).flat()]}),ss=(r,e,{currentColor:t})=>r==="currentColor"||r===t,nt=(r,e,{parentStyles:t})=>t[e]===r,cn=r=>(e,t,{getStyle:n})=>{const i=n(`border-${r}-width`),s=n(`border-${r}-style`);return i==="0px"||s==="none"},Gq={"border-block-end-color":ss,"border-block-start-color":ss,"border-bottom-color":ss,"border-inline-end-color":ss,"border-inline-start-color":ss,"border-left-color":ss,"border-right-color":ss,"border-top-color":ss,"caret-color":ss,"column-rule-color":ss,"outline-color":ss,"text-decoration":(r,e,{currentColor:t})=>r==="none solid currentColor"||r==="none solid "+t,"text-decoration-color":ss,"text-emphasis-color":ss,"border-collapse":nt,"border-spacing":nt,"caption-side":nt,cursor:nt,direction:nt,"empty-cells":nt,"font-family":nt,"font-size":nt,"font-style":nt,"font-variant":nt,"font-weight":nt,"font-size-adjust":nt,"font-stretch":nt,font:nt,"letter-spacing":nt,"line-height":nt,"list-style-image":nt,"list-style-position":nt,"list-style-type":nt,"list-style":nt,orphans:nt,"overflow-wrap":nt,quotes:nt,"stroke-linecap":nt,"stroke-linejoin":nt,"tab-size":nt,"text-align":nt,"text-align-last":nt,"text-indent":nt,"text-justify":nt,"text-shadow":nt,"text-transform":nt,visibility:nt,"white-space":nt,"white-space-collapse":nt,widows:nt,"word-break":nt,"word-spacing":nt,"word-wrap":nt,"border-top":cn("top"),"border-right":cn("right"),"border-bottom":cn("bottom"),"border-left":cn("left"),"border-block-end":cn("block-end"),"border-block-start":cn("block-start"),"border-inline-end":cn("inline-end"),"border-inline-start":cn("inline-start"),"border-top-style":cn("top"),"border-right-style":cn("right"),"border-bottom-style":cn("bottom"),"border-left-style":cn("left"),"border-block-end-style":cn("block-end"),"border-block-start-style":cn("block-start"),"border-inline-end-style":cn("inline-end"),"border-inline-start-style":cn("inline-start"),"border-top-width":cn("top"),"border-right-width":cn("right"),"border-bottom-width":cn("bottom"),"border-left-width":cn("left"),"border-block-end-width":cn("block-end"),"border-block-start-width":cn("block-start"),"border-inline-end-width":cn("inline-end")};function Yq(r){if(r.shadowRoot)return r.shadowRoot.childNodes;if(Lwe(r)){const e=r.assignedNodes();if(e?.length)return e}return r.childNodes}function*LP(r){for(const e of Yq(r))zwe(e)&&(yield e)}function k1(r){return r.ownerDocument?.defaultView??globalThis}function zwe(r){return r instanceof k1(r).Element}function Bwe(r){return r instanceof k1(r).ShadowRoot}function jwe(r){return"getRootNode"in r&&Bwe(r.getRootNode())}function Lwe(r){return jwe(r)&&r instanceof k1(r).HTMLSlotElement}function Uwe(r){return r.style}function _N(r,e){return k1(r).getComputedStyle(r,e)}const Nf={};class Wwe{constructor(e){this.root=e}styles=new Map;fonts=new NN;readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(LP(e));for(;t.length;){const n=t.pop();t.push(...LP(n)),this.readElementStyles(n,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:n=!0}){const i=t?Jwe(e.tagName.toLowerCase()):Nf,s=Object.assign({},Nf);if(n){let a=e.parentElement;for(;a;){const l=this.styles.get(a)?.self;for(const c in l)s[c]||(s[c]=l[c]);a=a.parentElement}}const o={self:Hwe(e,{defaultStyles:i,parentStyles:s}),before:Tj(e,"::before"),after:Tj(e,"::after")};this.styles.set(e,o)}fetchResources(){const e=[];for(const t of this.styles.values())for(const n of pn(t))if(n)for(const[i,s]of Object.entries(n)){if(!s)continue;i==="font-family"&&this.fonts.onFontFamilyValue(s);const o=Iwe(s);o.length!==0&&e.push(...o.map(async({url:a,original:l})=>{const c=await b1(a)??"data:";n[i]=s.replace(l,`url("${c}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(n,i)=>{if(e.has(n))return;e.add(n);const s=n.shadowRoot;if(s){const o=document.createElement("div");this.styles.set(o,this.styles.get(n)),o.setAttribute("data-tl-custom-element",n.tagName),(i??n.parentElement).appendChild(o);for(const a of s.childNodes)a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0));n.remove()}else if(i){if(n.tagName.toLowerCase()==="style")return;const o=n.cloneNode(!1);this.styles.set(o,this.styles.get(n)),i.appendChild(o);for(const a of Yq(n))a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0))}};for(const n of this.styles.keys())t(n,null)}embedStyles(){let e="";for(const[t,n]of this.styles){if(n.after||n.before){const s=`pseudo-${ft()}`;t.classList.add(s),n.before&&(e+=`.${s}::before {${Ej(n.before)}}
`),n.after&&(e+=`.${s}::after {${Ej(n.after)}}
`)}const i=Uwe(t);for(const[s,o]of Object.entries(n.self))o&&i.setProperty(s,o);i.fontKerning==="auto"&&(i.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){Kwe()}}function Hwe(r,{defaultStyles:e,parentStyles:t}){return r.computedStyleMap?Xq(r.computedStyleMap(),{defaultStyles:e,parentStyles:t}):DN(_N(r),{defaultStyles:e,parentStyles:t})}function Tj(r,e){const t=_N(r,e),n=t.getPropertyValue("content");if(!(n===""||n==="none"))return DN(t,{defaultStyles:Nf,parentStyles:Nf})}function Xq(r,{defaultStyles:e,parentStyles:t}){const n={},s={currentColor:r.get("color")?.toString()||"",parentStyles:t,defaultStyles:e,getStyle:o=>r.get(o)?.toString()??""};for(const o of r.keys()){if(!Lq(o))continue;const a=r.get(o).toString();if(e[o]===a)continue;const l=Cn(Gq,o);l&&l(a,o,s)||(n[o]=a)}return n}function DN(r,{defaultStyles:e,parentStyles:t}){const n={},s={currentColor:r.color,parentStyles:t,defaultStyles:e,getStyle:o=>r.getPropertyValue(o)};for(const o in r){if(!Lq(o))continue;const a=r.getPropertyValue(o);if(e[o]===a)continue;const l=Cn(Gq,o);l&&l(a,o,s)||(n[o]=a)}return n}function Ej(r){let e="";for(const[t,n]of Object.entries(r))e+=`${t}: ${n};`;return e}let df;const Mj={};function qwe(){if(!df){const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r);const e=Dn(r.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(n),e.body.appendChild(t),df={iframe:r,foreignObject:n,document:e}}return df}function Kwe(){df&&(document.body.removeChild(df.iframe),df=void 0)}const Ij={defaultStyles:Nf,parentStyles:Nf};function Jwe(r){let e=Mj[r];if(!e){const{foreignObject:t,document:n}=qwe(),i=n.createElement(r);t.appendChild(i),e=i.computedStyleMap?Xq(i.computedStyleMap(),Ij):DN(_N(i),Ij),t.removeChild(i),Mj[r]=e}return e}function Vwe(r,e){Array.from(r.attributes).forEach(n=>{e.setAttribute(n.name,n.value)})}function Pj(r,e){return r.replaceWith(e),e}async function Jg(r,e){const t=document.createElement("img");e&&Vwe(e,t),t.setAttribute("src",r??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function Gwe(r){try{const e=r.toDataURL();return await Jg(e,r)}catch{return await Jg(null,r)}}async function Ywe(r){try{const e=await cs.getVideoFrameAsDataUrl(r);return Jg(e,r)}catch(e){console.error("Could not get video frame",e)}if(r.poster){const e=await b1(r.poster);return Jg(e,r)}return Jg(null,r)}async function Zq(r){if(r instanceof HTMLCanvasElement)return Pj(r,await Gwe(r));if(r instanceof HTMLVideoElement)return Pj(r,await Ywe(r));if(r instanceof HTMLImageElement){const e=r.currentSrc||r.src,t=await b1(e);r.setAttribute("src",t??"data:"),r.setAttribute("decoding","sync"),r.setAttribute("loading","eager");try{await r.decode()}catch{}return r}else r instanceof HTMLInputElement?r.setAttribute("value",r.value):r instanceof HTMLTextAreaElement&&(r.textContent=r.value);await Promise.all(Array.from(LP(r),e=>Zq(e)))}const UP=(r,e)=>r.props===e.props&&r.meta===e.meta,Qq=k.memo(function({id:e,shape:t,util:n,index:i,backgroundIndex:s,opacity:o}){const a=z(),{ShapeErrorFallback:l,ShapeWrapper:c}=Tt(),u=k.useRef(null),d=k.useRef(null);k.useEffect(()=>Zi("load fonts",()=>{const p=a.fonts.getShapeFontFaces(e);a.fonts.requestFonts(p)}),[a,e]);const h=k.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});cd("set shape stuff",()=>{const p=a.getShape(e);if(!p)return;const m=h.current,g=a.getShapeClipPath(e)??"none";g!==m.clipPath&&(dr(u.current,"clip-path",g),dr(d.current,"clip-path",g),m.clipPath=g);const y=a.getShapePageTransform(e),S=J.toCssString(y),w=a.getShapeGeometry(p).bounds;S!==m.transform&&(dr(u.current,"transform",S),dr(d.current,"transform",S),m.transform=S);const b=Math.max(w.width,1),v=Math.max(w.height,1);(b!==m.width||v!==m.height)&&(dr(u.current,"width",b+"px"),dr(u.current,"height",v+"px"),dr(d.current,"width",b+"px"),dr(d.current,"height",v+"px"),m.width=b,m.height=v)},[a]),k.useLayoutEffect(()=>{const p=u.current,m=d.current;dr(p,"opacity",o),dr(m,"opacity",o),dr(p,"z-index",i),dr(m,"z-index",s)},[o,i,s]),cd("set display",()=>{if(!a.getShape(e))return;const g=a.getCulledShapes().has(e);g!==h.current.isCulled&&(dr(u.current,"display",g?"none":"block"),dr(d.current,"display",g?"none":"block"),h.current.isCulled=g)},[a]);const f=k.useCallback(p=>a.annotateError(p,{origin:"shape",willCrashApp:!1}),[a]);return!t||!c?null:x.jsxs(x.Fragment,{children:[n.backgroundComponent&&x.jsx(c,{ref:d,shape:t,isBackground:!0,children:x.jsx(Ry,{fallback:l,onError:f,children:x.jsx(tK,{shape:t,util:n})})}),x.jsx(c,{ref:u,shape:t,isBackground:!1,children:x.jsx(Ry,{fallback:l,onError:f,children:x.jsx(eK,{shape:t,util:n})})})]})}),eK=k.memo(function({shape:e,util:t}){return a1("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(r,e)=>UP(r.shape,e.shape)&&r.util===e.util),tK=k.memo(function({shape:e,util:t}){return a1("InnerShape:"+e.type,()=>t.backgroundComponent?.(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(r,e)=>r.shape.props===e.shape.props&&r.shape.meta===e.shape.meta&&r.util===e.util);function qo(r){const e=k.useRef();return k.useLayoutEffect(()=>{e.current=r}),k.useDebugValue(r),k.useCallback((...t)=>{const n=e.current;return se(n,"fn does not exist"),n(...t)},[])}const FN=k.createContext(null);function Xwe({context:r,editor:e,children:t}){const n=e.options.exportProvider;return x.jsx(MN,{editor:e,children:x.jsx(pq,{container:e.getContainer(),children:x.jsx(FN.Provider,{value:r,children:x.jsx(n,{children:t})})})})}function dS(){return k.useContext(FN)}function Zwe(){const r=k.useContext(FN),[e]=k.useState(_O);return k.useEffect(()=>(r?.waitUntil(e),()=>{e.resolve()}),[e,r]),qo(()=>{e.resolve()})}var Qwe=Object.create,nK=Object.defineProperty,ebe=Object.getOwnPropertyDescriptor,tbe=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),rK=r=>{throw TypeError(r)},iK=(r,e,t)=>e in r?nK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nbe=r=>[,,,Qwe(null)],sK=["class","method","getter","setter","accessor","field","value","get","set"],oK=r=>r!==void 0&&typeof r!="function"?rK("Function expected"):r,rbe=(r,e,t,n,i)=>({kind:sK[r],name:e,metadata:n,addInitializer:s=>t._?rK("Already initialized"):i.push(oK(s||null))}),ibe=(r,e)=>iK(e,tbe("metadata"),r[3]),sbe=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},obe=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=sK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,ebe(i,t)),y=n.length-1;y>=0;y--)l=rbe(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,oK(o)&&(g[p]=o);return g&&nK(i,t,g),i},Aj=(r,e,t)=>iK(r,typeof e!="symbol"?e+"":e,t),aK,C1;aK=[Yi];class zN{constructor(e){this.maxDelayTimeMs=e,sbe(C1,5,this),Aj(this,"isResolved",!1),Aj(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error while waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await kP(0)}async resolve(){const e=kP(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}C1=nbe();obe(C1,1,"waitUntil",aK,zN);ibe(C1,zN);function abe(r,e,t={}){if(!window.document)throw Error("No document");const{scale:n=1,background:i=r.getInstanceState().exportBackground,padding:s=r.options.defaultSvgPadding,preserveAspectRatio:o}=t,a=t.darkMode??r.user.getIsDarkMode(),l=r.getShapeAndDescendantIds(e),c=r.getUnorderedRenderingShapes(!1).filter(({id:y})=>l.has(y)),u=e.length===1&&r.isShapeOfType(r.getShape(e[0]),"frame")?e[0]:null;let d=null;if(t.bounds?d=t.bounds.clone().expandBy(s):d=lbe(r,c,s,u),!d)return;const h=d.width*n,f=d.height*n;try{document.body.focus?.()}catch{}const p=new zN(r.options.maxExportDelayMs),m=_O();return p.waitUntil(m),{jsx:x.jsx(cbe,{editor:r,preserveAspectRatio:o,scale:n,pixelRatio:t.pixelRatio??null,bbox:d,background:i,singleFrameShapeId:u,isDarkMode:a,renderingShapes:c,onMount:m.resolve,waitUntil:p.waitUntil}),width:h,height:f,exportDelay:p}}function lbe(r,e,t,n){let i=!1,s=null;for(const{id:o}of e){const a=r.getShapeMaskedPageBounds(o);if(!a)continue;const l=r.getShape(o),c=r.getShapeUtil(l).isExportBoundsContainer(l);s?c&&V.ContainsApproximately(a,s)?(i=!0,s=a.clone()):(i&&!V.ContainsApproximately(s,a)&&(i=!1),s.union(a)):(i=c,s=a.clone())}return s?(!n&&!i&&s.expandBy(t),s):null}function cbe({editor:r,preserveAspectRatio:e,scale:t,pixelRatio:n,bbox:i,background:s,singleFrameShapeId:o,isDarkMode:a,renderingShapes:l,onMount:c,waitUntil:u}){const d=Ud(),h=sc({isDarkMode:a}),f=rS("export state",{defsById:{},shapeElements:null}),{defsById:p,shapeElements:m}=F(f),g=qo(b=>{f.update(v=>{if(Xi(v.defsById,b.key))return v;const C=Promise.resolve(b.getElement());return u(C.then(E=>{f.update(M=>({...M,defsById:{...M.defsById,[b.key]:{pending:!1,element:E}}}))})),{...v,defsById:{...v.defsById,[b.key]:{pending:!0,element:C}}}})}),y=k.useMemo(()=>({isDarkMode:a,waitUntil:u,addExportDef:g,scale:t,pixelRatio:n,async resolveAssetUrl(b,v){const C=r.getAsset(b);return!C||C.type!=="image"&&C.type!=="video"?null:await r.resolveAssetUrl(b,{screenScale:t*(v/C.props.w),shouldResolveToOriginal:n===null,dpr:n??void 0})}}),[a,u,g,t,n,r]),S=k.useRef(!1);k.useLayoutEffect(()=>{if(S.current)throw new Error("SvgExport should only render once - do not use with react strict mode");S.current=!0,(async()=>{const b={},v=l.map(async({id:E,opacity:M,index:P,backgroundIndex:$})=>{if(E===o)return[];const A=r.getShape(E);if(r.isShapeOfType(A,"group"))return[];const O=[],_=r.getShapeUtil(A);if(_.toSvg||_.toBackgroundSvg){const[I,R]=await Promise.all([_.toSvg?.(A,y),_.toBackgroundSvg?.(A,y)]),B=r.getShapePageTransform(A);let U=B.toCssString(),H=1;"scale"in A.props&&A.props.scale!==1&&(H=A.props.scale,U=`${U} scale(${A.props.scale}, ${A.props.scale})`);const L=r.getShapeMask(A.id),X=L?J.From(J.Inverse(B)).applyToPoints(L):null,G=TN(d,A.id);X&&(b[G]={pending:!1,element:x.jsx("clipPath",{id:G,children:x.jsx("path",{d:`M${X.map(({x:ce,y:ae})=>`${ce/H},${ae/H}`).join("L")}Z`})})}),I&&O.push({zIndex:P,element:x.jsx("g",{transform:U,opacity:M,clipPath:L?`url(#${G})`:void 0,children:I},`fg_${A.id}`)}),R&&O.push({zIndex:$,element:x.jsx("g",{transform:U,opacity:M,clipPath:L?`url(#${G})`:void 0,children:R},`bg_${A.id}`)})}else O.push({zIndex:P,element:x.jsx($j,{shape:A,util:_,component:eK,className:"tl-shape",bbox:i,opacity:M},`fg_${A.id}`)}),_.backgroundComponent&&O.push({zIndex:$,element:x.jsx($j,{shape:A,util:_,component:tK,className:"tl-shape tl-shape-background",bbox:i,opacity:M},`bg_${A.id}`)});return O}),C=(await Promise.all(v)).flat();Jk.flushSync(()=>{f.update(E=>({...E,shapeElements:C.sort((M,P)=>M.zIndex-P.zIndex).map(({element:M})=>M),defsById:{...E.defsById,...b}}))})})()},[i,r,y,d,l,o,f]),k.useEffect(()=>{const b=new Set;for(const{id:v}of l)for(const C of r.fonts.getShapeFontFaces(v))b.add(C);for(const v of b)g({key:ft(),getElement:async()=>{const C=await r.fonts.toEmbeddedCssDeclaration(v);return x.jsx("style",{nonce:r.options.nonce,children:C})}})},[r,l,g]),k.useEffect(()=>{m!==null&&c()},[c,m]);let w=s?h.background:"transparent";if(o&&s)if(r.getShapeUtil("frame")?.options.showColors){const v=r.getShape(o);w=ot(h,v.props.color,"frameFill")}else w=h.solid;return x.jsx(Xwe,{editor:r,context:y,children:x.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:i.width*t,height:i.height*t,viewBox:`${i.minX} ${i.minY} ${i.width} ${i.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:w},"data-color-mode":a?"dark":"light",className:`tl-container tl-theme__force-sRGB ${a?"tl-theme__dark":"tl-theme__light"}`,children:[x.jsx("defs",{children:Object.entries(p).map(([b,v])=>v.pending?null:x.jsx(k.Fragment,{children:v.element},b))}),m]})})}function $j({shape:r,util:e,className:t,component:n,bbox:i,opacity:s}){const o=z(),a=J.Translate(-i.minX,-i.minY).multiply(o.getShapePageTransform(r.id)),l=o.getShapeGeometry(r.id).bounds,c=Math.max(l.width,1),u=Math.max(l.height,1);return x.jsx(IN,{fallback:()=>null,children:x.jsx("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:x.jsx("div",{className:t,"data-shape-type":r.type,style:{clipPath:o.getShapeClipPath(r.id),transform:a.toCssString(),width:c,height:u,opacity:s},children:x.jsx(n,{shape:r,util:e})})})})}let ube=1;async function dbe(r,e,t={}){const n=abe(r,e,t);if(!n)return;const i=r.getContainer(),s=document.createElement("div");s.className=Vq,s.inert=!0,s.tabIndex=-1,Object.assign(s.style,{position:"absolute",top:"0px",left:"0px",width:n.width+"px",height:n.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(s);const o=Dde.createRoot(s,{identifierPrefix:`export_${ube++}_`});try{await Promise.resolve(),Jk.flushSync(()=>{o.render(n.jsx)}),await n.exportDelay.resolve();const a=s.firstElementChild;return se(a instanceof SVGSVGElement,"Expected an SVG element"),await hbe(a),{svg:a,width:n.width,height:n.height}}finally{setTimeout(()=>{o.unmount(),i.removeChild(s)},0)}}async function hbe(r){const e=[...r.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!e.length)return;const t=new Wwe(r);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(s=>Zq(s)));for(const s of e)t.readRootElementStyles(s);await t.fetchResources();const n=await t.getFontFaceCss();t.unwrapCustomElements();const i=t.embedStyles();if(n||i){const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent=`${n}
${i}`,r.prepend(s)}}finally{t.dispose()}}let WE=null;function fbe(){return WE||(WE={maxWidth:HE("width"),maxHeight:HE("height"),maxArea:HE("area")}),WE}/*!
 * Extracted from https://github.com/jhildenbiddle/canvas-size
 * MIT License: https://github.com/jhildenbiddle/canvas-size/blob/master/LICENSE
 * Copyright (c) John Hildenbiddle
 */const Rj=8192,pbe=4096*4096,mbe={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function HE(r){const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");for(const n of mbe[r]){const i=r==="height"?1:n,s=r==="width"?1:n,o=document.createElement("canvas");o.width=i,o.height=s,o.getContext("2d").fillRect(i-1,s-1,1,1),t.drawImage(o,i-1,s-1,1,1,0,0,1,1);const l=t.getImageData(0,0,1,1).data[3]!==0;if(o.width=0,o.height=0,l)return e.width=0,e.height=0,r==="area"?n*n:n}throw e.width=0,e.height=0,Error("Failed to determine maximum canvas dimension")}function gbe(r,e){if(r<=Rj&&e<=Rj&&r*e<=pbe)return[r,e];const{maxWidth:t,maxHeight:n,maxArea:i}=fbe(),s=r/e;if(r>t&&(r=t,e=r/s),e>n&&(e=n,r=e*s),r*e>i){const o=Math.sqrt(i/(r*e));r*=o,e*=o}return[r,e]}async function ybe(r,e){const{type:t,width:n,height:i,quality:s=1,pixelRatio:o=2}=e;let[a,l]=gbe(n*o,i*o);a=Math.floor(a),l=Math.floor(l);const c=a/n,u=await mr.blobToDataUrl(new Blob([r],{type:"image/svg+xml"})),d=await new Promise(f=>{const p=My();p.crossOrigin="anonymous",p.onload=async()=>{ht.isSafari&&await kP(250);const m=document.createElement("canvas"),g=m.getContext("2d");m.width=a,m.height=l,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(p,0,0,a,l),URL.revokeObjectURL(u),f(m)},p.onerror=()=>{f(null)},p.src=u});if(!d)return null;const h=await new Promise(f=>d.toBlob(p=>{(!p||Yt.throwToBlob.get())&&f(null),f(p)},"image/"+t,s));if(!h)return null;if(t==="png"){const f=new DataView(await h.arrayBuffer());return Ko.setPhysChunk(f,c,{type:"image/"+t})}else return h}const ui={menus:Ft("open menus",[]),getOpenMenus(r){return r?this.menus.get().filter(e=>e.endsWith("-"+r)):this.menus.get()},addOpenMenu(r,e=""){const t=e?`${r}-${e}`:r,n=new Set(this.menus.get());n.has(t)||(n.add(t),this.menus.set([...n]))},deleteOpenMenu(r,e=""){const t=e?`${r}-${e}`:r,n=new Set(this.menus.get());n.has(t)&&(n.delete(t),this.menus.set([...n]))},clearOpenMenus(r){this.menus.set(r?this.menus.get().filter(e=>!e.endsWith("-"+r)):[])},_hiddenMenus:[],hideOpenMenus(r){if(this._hiddenMenus=[...this.getOpenMenus(r)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,r)},showOpenMenus(r){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,r);this._hiddenMenus=[]}},isMenuOpen(r,e){return this.getOpenMenus(e).includes(r)},hasOpenMenus(r){return this.getOpenMenus(r).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(r){return{getOpenMenus:()=>this.getOpenMenus(r),addOpenMenu:e=>this.addOpenMenu(e,r),deleteOpenMenu:e=>this.deleteOpenMenu(e,r),clearOpenMenus:()=>this.clearOpenMenus(r),isMenuOpen:e=>this.isMenuOpen(e,r),hasOpenMenus:()=>this.hasOpenMenus(r),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},pv=new tge,xbe={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,uiDragDistanceSquared:16,uiCoarseDragDistanceSquared:625,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,tooltipDelayMs:700,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:k.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0};function Oj(r,e){if(!e)return!1;switch(r.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&r.value===e.value;default:throw at(r)}}class Sbe{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[n,i]of this){if(!Oj(i,e.get(n)))return!1;t.add(n)}for(const[n,i]of e)if(!t.has(n)&&!Oj(i,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class WP extends Sbe{set(e,t){this.map.set(e,t)}applyValue(e,t){const n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:at(n,"type")}}}function wbe(r,e,t){return Ua(r).then(function(n){return n.arrayBuffer()}).then(function(n){return new File([n],e,{type:t})})}const bbe="https://cdn.tldraw.com";function $n(){return`${bbe}/${PN}`}function vbe(r){switch(r.type){case"shapes":return`s${r.shapeIds.map(t=>qE(t.slice(6))).join(".")}`;case"page":return"p"+qE(Ci.parseId(r.pageId));case"viewport":{const{bounds:e,pageId:t}=r;let n=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(n+="."+qE(Ci.parseId(t))),n}default:at(r)}}function kbe(r){switch(r[0]){case"s":return{type:"shapes",shapeIds:r.slice(1).split(".").filter(Boolean).map(n=>Ct(decodeURIComponent(n)))};case"p":return{type:"page",pageId:Ci.createId(decodeURIComponent(r.slice(1)))};case"v":{const[t,n,i,s,o]=r.slice(1).split(".");return{type:"viewport",bounds:new V(Number(t),Number(n),Number(i),Number(s)),pageId:o?Ci.createId(decodeURIComponent(o)):void 0}}default:throw Error("Invalid deep link string")}}function qE(r){return encodeURIComponent(r).replace(/\./g,"%2E")}function Cbe(r,e){let t=r;const n=new Set(e);for(;n.has(t);)t=/^.*(\d+)$/.exec(t)?.[1]?t.replace(/(\d+)(?=\D?)$/,i=>(+i+1).toString()):`${t} 1`;return t}function ZS(r,e,t,n){if(t.length===0)return[];const i=new Map;for(const o of Re(t.map(a=>r.getShape(a)))){const{parentId:a}=o;i.has(a)||i.set(a,{children:Re(r.getSortedChildIdsForParent(a).map(l=>r.getShape(l))),moving:new Set}),i.get(a).moving.add(o)}const s=[];switch(e){case"toBack":{i.forEach(({moving:o,children:a})=>Tbe(o,a,s));break}case"toFront":{i.forEach(({moving:o,children:a})=>Ebe(o,a,s));break}case"forward":{i.forEach(({moving:o,children:a})=>Mbe(r,o,a,s,n));break}case"backward":{i.forEach(({moving:o,children:a})=>Ibe(r,o,a,s,n));break}}return s}function Tbe(r,e,t){const n=e.length;if(r.size===n)return;let i,s;for(let o=0;o<n;o++){const a=e[o];if(r.has(a))i=a.index,r.delete(a);else{s=a.index;break}}if(r.size!==0){const o=ld(i,s,r.size);t.push(...Array.from(r.values()).sort(Fn).map((a,l)=>({...a,index:o[l]})))}}function Ebe(r,e,t){const n=e.length;if(r.size===n)return;let i,s;for(let o=n-1;o>-1;o--){const a=e[o];if(r.has(a))s=a.index,r.delete(a);else{i=a.index;break}}if(r.size!==0){const o=ld(i,s,r.size);t.push(...Array.from(r.values()).sort(Fn).map((a,l)=>({...a,index:o[l]})))}}function lK(r,e){const t=Re(Array.from(e).map(i=>{const s=r.getShapePageBounds(i);return s?{shape:i,bounds:s}:null}));return i=>{const s=r.getShapePageBounds(i);return s?t.some(o=>o.bounds.includes(s)):!1}}function Mbe(r,e,t,n,i){const s=lK(r,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let l=0;l<o;l++){const c=e.has(t[l]);switch(a.name){case"skipping":{if(!c)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(c||!i?.considerAllShapes&&!s(t[l]))continue;const{selectIndex:u}=a;ld(t[l].index,t[l+1]?.index,l-u).forEach((d,h)=>{const f=t[u+h];e.has(f)&&n.push({...f,index:d})}),a={name:"skipping"};break}}}}function Ibe(r,e,t,n,i){const s=lK(r,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let l=o-1;l>-1;l--){const c=e.has(t[l]);switch(a.name){case"skipping":{if(!c)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(c||!i?.considerAllShapes&&!s(t[l]))continue;ld(t[l-1]?.index,t[l].index,a.selectIndex-l).forEach((u,d)=>{const h=t[l+d+1];e.has(h)&&n.push({...h,index:u})}),a={name:"skipping"};break}}}}function cK({editor:r,ids:e}){const t=Re(e.map(o=>r.getShape(o))),n=r.getShapesSharedRotation(e),i=r.getShapesRotatedPageBounds(e);if(!i)return null;const s=i.center.clone().rotWith(i.point,n);return{initialPageCenter:s,initialCursorAngle:s.angle(r.inputs.originPagePoint),initialShapesRotation:n,shapeSnapshots:t.map(o=>({shape:o,initialPagePoint:r.getShapePageTransform(o.id).point()}))}}function Ib({delta:r,editor:e,snapshot:t,stage:n,centerOverride:i}){const{initialPageCenter:s,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:l,initialPagePoint:c})=>{const u=li(l.parentId)?e.getShapePageTransform(l.parentId):J.Identity(),d=T.RotWith(c,i??s,r),h=J.applyToPoint(J.Inverse(u),d),f=cv(l.rotation+r);return{id:l.id,type:l.type,x:h.x,y:h.y,rotation:f}}));const a=[];o.forEach(({shape:l})=>{const c=e.getShape(l.id);if(!c)return;const u=e.getShapeUtil(l);if(n==="start"||n==="one-off"){const h=u.onRotateStart?.(l);h&&a.push(h)}const d=u.onRotate?.(l,c);if(d&&a.push(d),n==="end"||n==="one-off"){const h=u.onRotateEnd?.(l,c);h&&a.push(h)}}),a.length>0&&e.updateShapes(a)}function Nj(r){const e=r.get(),t=new Map;for(const n of e){const{fromId:i,toId:s}=n,o=t.get(i);o?o.push(n):t.set(i,[n]);const a=t.get(s);a?a.push(n):t.set(s,[n])}return t}const Pbe=r=>{const{store:e}=r,t=e.query.filterHistory("binding"),n=e.query.records("binding");return q("arrowBindingsIndex",(i,s)=>{if(Cu(i))return Nj(n);const o=i,a=t.getDiffSince(s);if(a===ds)return Nj(n);let l;function c(h){l??=new Map(o);const p=l.get(h.fromId)?.filter(y=>y.id!==h.id);p?.length?l.set(h.fromId,p):l.delete(h.fromId);const g=l.get(h.toId)?.filter(y=>y.id!==h.id);g?.length?l.set(h.toId,g):l.delete(h.toId)}function u(h){l??=new Map(o);let f=l.get(h);return f?f===o.get(h)&&(f=f.slice(0),l.set(h,f)):(f=[],l.set(h,f)),f}function d(h){u(h.fromId).push(h),u(h.toId).push(h)}for(const h of a){for(const f of pn(h.added))d(f);for(const[f,p]of pn(h.updated))c(f),d(p);for(const f of pn(h.removed))c(f)}return l??o})};function Abe(r){const e=r.getCurrentPageShapeIds(),t=r.getViewportPageBounds(),n=new Set;return e.forEach(i=>{const s=r.getShape(i);if(!s||!r.getShapeUtil(s.type).canCull(s))return;const a=r.getShapePageBounds(i);(a===void 0||!t.includes(a))&&n.add(i)}),n}function $be(r){return q("notVisibleShapes",function(t){const n=Abe(r);if(Cu(t)||t.size!==n.size)return n;for(const i of t)if(!n.has(i))return n;return t})}function _j(r,e){const t={},n=r.get();return Array.from(n,s=>e.get(s)).sort(Fn).forEach(s=>{t[s.parentId]??=[],t[s.parentId].push(s.id)}),t}const Rbe=r=>{const e=r.query.ids("shape"),t=r.query.filterHistory("shape");return q("parentsToChildrenWithIndexes",(n,i)=>{if(Cu(n))return _j(e,r);const s=t.getDiffSince(i);if(s===ds)return _j(e,r);if(s.length===0)return n;let o=null;const a=u=>{o||(o={...n}),o[u]?o[u]===n[u]&&(o[u]=[...o[u]]):o[u]=[]},l=new Set;let c;for(let u=0,d=s.length;u<d;u++){c=s[u];for(const h of Object.values(c.added))tf(h)&&(a(h.parentId),o[h.parentId].push(h.id),l.add(o[h.parentId]));for(const[h,f]of Object.values(c.updated))if(tf(f)&&tf(h)){if(h.parentId!==f.parentId)a(h.parentId),a(f.parentId),o[h.parentId].splice(o[h.parentId].indexOf(f.id),1),o[f.parentId].push(f.id),l.add(o[f.parentId]);else if(h.index!==f.index){a(f.parentId);const p=o[f.parentId].indexOf(f.id);o[f.parentId][p]=f.id,l.add(o[f.parentId])}}for(const h of Object.values(c.removed))tf(h)&&(a(h.parentId),o[h.parentId].splice(o[h.parentId].indexOf(h.id),1))}for(const u of l){const d=Re(u.map(h=>r.get(h)));d.sort(Fn),u.splice(0,u.length,...d.map(h=>h.id))}return o??n})},KE=(r,e,t)=>{for(;!Gn(t.parentId);){const n=r.get(t.parentId);if(!n)return!1;t=n}return t.parentId===e},Obe=(r,e)=>{const t=r.query.ids("shape");let n=null;function i(){const s=e();return n=s,new Set([...t.get()].filter(o=>KE(r,s,r.get(o))))}return q("_shapeIdsInCurrentPage",(s,o)=>{if(Cu(s))return i();const a=e();if(a!==n)return i();const l=r.history.getDiffSince(o);if(l===ds)return i();const c=new Cb(s);for(const d of l){for(const h of Object.values(d.added))tf(h)&&KE(r,a,h)&&c.add(h.id);for(const[h,f]of Object.values(d.updated))tf(f)&&(KE(r,a,f)?c.add(f.id):c.remove(f.id));for(const h of Object.keys(d.removed))li(h)&&c.remove(h)}const u=c.get();return u?Qp(u.value,u.diff):s})};var Nbe=Object.create,uK=Object.defineProperty,_be=Object.getOwnPropertyDescriptor,Dbe=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),dK=r=>{throw TypeError(r)},hK=(r,e,t)=>e in r?uK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fbe=r=>[,,,Nbe(null)],fK=["class","method","getter","setter","accessor","field","value","get","set"],pK=r=>r!==void 0&&typeof r!="function"?dK("Function expected"):r,zbe=(r,e,t,n,i)=>({kind:fK[r],name:e,metadata:n,addInitializer:s=>t._?dK("Already initialized"):i.push(pK(s||null))}),Bbe=(r,e)=>hK(e,Dbe("metadata"),r[3]),jbe=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},mK=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=fK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,_be(i,t)),y=n.length-1;y>=0;y--)l=zbe(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,pK(o)&&(g[p]=o);return g&&uK(i,t,g),i},eh=(r,e,t)=>hK(r,typeof e!="symbol"?e+"":e,t),gK,yK,hS;const Lbe=40;yK=[Yi],gK=[Yi];class T1{constructor(e){this.editor=e,jbe(hS,5,this),eh(this,"_clickId",""),eh(this,"_clickTimeout"),eh(this,"_clickScreenPoint"),eh(this,"_previousScreenPoint"),eh(this,"_clickState","idle"),eh(this,"lastPointerInfo",{})}_getClickTimeout(e,t=ft()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._previousScreenPoint&&T.Dist2(this._previousScreenPoint,this._clickScreenPoint)>Lbe**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&T.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}hS=Fbe();mK(hS,1,"_getClickTimeout",yK,T1);mK(hS,1,"cancelDoubleClickTimeout",gK,T1);Bbe(hS,T1);class Ube{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){const{editor:t}=this,n=this.getEdgeScroll();if(n.x===0&&n.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const i=t.options.edgeScrollEaseDuration>0?gr.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*i,y:n.y*i})}}getEdgeProximityFactors(e,t,n,i,s){const{editor:o}=this,a=o.options.edgeScrollDistance,l=n?o.options.coarsePointerWidth:0,c=e-l,u=e+l,d=i?0:a,h=s?t:t-a;return c<d?Math.min(1,(d-c)/a):u>h?-Math.min(1,(u-h)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[o,a,l,c]}=e.getInstanceState(),u=this.getEdgeProximityFactors(t,i.w,s,c,a),d=this.getEdgeProximityFactors(n,i.h,s,o,l);return{x:u,y:d}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const n=t.getViewportScreenBounds(),i=n.w<1e3?.612:1,s=n.h<1e3?.612:1,o=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,l=a*e.x*i/o,c=a*e.y*s/o,{x:u,y:d,z:h}=t.getCamera();t.setCamera(new T(u+l,d+c,h))}}class Wbe{constructor(e,t){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,s)=>{i.isFocused!==s.isFocused&&this.updateContainerClass()});const n=e.getInstanceState().isFocused;t!==n&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused"),e.classList.add("tl-container__no-focus-ring")}handleKeyDown(e){const t=this.editor.getContainer(),n=document.activeElement;this.editor.isIn("select.editing_shape")&&!n?.closest(".tlui-contextual-toolbar")||n===t&&this.editor.getSelectedShapeIds().length>0||["Tab","ArrowUp","ArrowDown"].includes(e.key)&&t.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}class Hbe{constructor(e,t){this.editor=e,this.assetUrls=t,this.shapeFontFacesCache=e.store.createComputedCache("shape font faces",n=>this.editor.getShapeUtil(n).getFontFaces(n),{areResultsEqual:V0,areRecordsEqual:(n,i)=>n.props===i.props&&n.meta===i.meta}),this.shapeFontLoadStateCache=e.store.createCache(n=>{const i=q("font faces",()=>this.getShapeFontFaces(n));return q("font load state",()=>i.get().map(o=>this.getFontState(o)),{isEqual:V0})})}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(e){const t=typeof e=="string"?e:e.id;return this.shapeFontFacesCache.get(t)??gn}trackFontsForShape(e){const t=typeof e=="string"?e:e.id;this.shapeFontLoadStateCache.get(t)}async loadRequiredFontsForCurrentPage(e=1/0){const t=new Set;for(const i of this.editor.getCurrentPageShapeIds())for(const s of this.getShapeFontFaces(this.editor.getShape(i)))t.add(s);if(t.size>e)return;const n=Array.from(t,i=>this.ensureFontIsLoaded(i));await Promise.all(n)}fontStates=new MP("font states");getFontState(e){return this.fontStates.get(e)??null}ensureFontIsLoaded(e){const t=this.getFontState(e);if(t)return t.loadingPromise;const n=this.findOrCreateFontFace(e),i={state:"loading",instance:n,loadingPromise:n.load().then(()=>{document.fonts.add(n),this.fontStates.update(e,s=>({...s,state:"ready"}))}).catch(s=>{console.error(s),this.fontStates.update(e,o=>({...o,state:"error"}))})};return this.fontStates.set(e,i),i.loadingPromise}fontsToLoad=new Set;requestFonts(e){this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;const t=this.fontsToLoad;this.fontsToLoad=new Set,hs(()=>{for(const n of t)this.ensureFontIsLoaded(n)})});for(const t of e)this.fontsToLoad.add(t)}findOrCreateFontFace(e){for(const i of document.fonts)if(i.family===e.family&&fi(Dj).every(([s,o])=>i[s]===(e[s]??o)))return i;const t=this.assetUrls?.[e.src.url]??e.src.url,n=new FontFace(e.family,`url(${JSON.stringify(t)})`,{...tc(Dj,i=>e[i]),display:"swap"});return document.fonts.add(n),n}async toEmbeddedCssDeclaration(e){const t=this.assetUrls?.[e.src.url]??e.src.url,n=await mr.urlToDataUrl(t),i=Re([`url("${n}")`,e.src.format?`format(${e.src.format})`:null,e.src.tech?`tech(${e.src.tech})`:null]).join(" ");return Re(["@font-face {",`  font-family: "${e.family}";`,e.ascentOverride?`  ascent-override: ${e.ascentOverride};`:null,e.descentOverride?`  descent-override: ${e.descentOverride};`:null,e.stretch?`  font-stretch: ${e.stretch};`:null,e.style?`  font-style: ${e.style};`:null,e.weight?`  font-weight: ${e.weight};`:null,e.featureSettings?`  font-feature-settings: ${e.featureSettings};`:null,e.lineGapOverride?`  line-gap-override: ${e.lineGapOverride};`:null,e.unicodeRange?`  unicode-range: ${e.unicodeRange};`:null,`  src: ${i};`,"}"]).join(`
`)}}const Dj={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};class qbe{store;dispose;state="recording";pendingDiff=new Jbe;stacks=Ft("HistoryManager.stacks",{undos:Lp(),redos:Lp()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??Ey,this.dispose=this.store.addHistoryInterceptor((t,n)=>{if(n==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Lp()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:at(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"diff",diff:e}),redos:n}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(e,t){const n=this.state;n!=="paused"&&t?.history&&(this.state=Kbe[t.history]);try{if(this._isInBatch)return hs(e),this;this._isInBatch=!0;try{hs(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=n}}_undo({pushToRedoStack:e,toMark:t=void 0}){const n=this.state;this.state="paused";try{let{undos:i,redos:s}=this.stacks.get();const o=this.pendingDiff.clear(),a=bH(o),l=IP(o);e&&!a&&(s=s.push({type:"diff",diff:o}));let c=!1;if(a)for(;i.head?.type==="stop";){const u=i.head;if(i=i.tail,e&&(s=s.push(u)),u.id===t){c=!0;break}}if(!c)e:for(;i.head;){const u=i.head;switch(i=i.tail,e&&(s=s.push(u)),u.type){case"diff":qg(l,[IP(u.diff)]);break;case"stop":if(!t)break e;if(u.id===t){c=!0;break e}break;default:at(u)}}if(!c&&t)return this;this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:s})}finally{this.state=n}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:t,redos:n}=this.stacks.get();if(n.length===0)return this;for(;n.head?.type==="stop";)t=t.push(n.head),n=n.tail;const i=ev();for(;n.head;){const s=n.head;if(t=t.push(s),n=n.tail,s.type==="diff")qg(i,[s.diff]);else break}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:t,redos:n})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return e&&this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){let t=this.stacks.get().undos;const n=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&n.push(t.head.diff),t=t.tail;if(!t.head||t.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(n.length===0)return this;const i=ev();return qg(i,n.reverse()),this.stacks.update(({redos:s})=>({undos:t.push({type:"diff",diff:i}),redos:s})),this}_mark(e){hs(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"stop",id:e}),redos:n}))})}clear(){this.stacks.set({undos:Lp(),redos:Lp()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const Kbe={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class Jbe{diff=ev();isEmptyAtom=Ft("PendingDiff.isEmpty",!0);clear(){const e=this.diff;return this.diff=ev(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){qg(this.diff,[e]),this.isEmptyAtom.set(bH(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}function Lp(r){return Gbe}class Vbe{length=0;head=null;tail=this;push(e){return new BN(e,this)}toArray(){return gn}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const Gbe=new Vbe;class BN{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new BN(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class Ybe{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble(e,t=ft()){const n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),n}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,n,i=.5){const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:o}=s,a={x:t,y:n,z:i};return(!o||T.Dist(o,a)>=1)&&(s.next=a),s}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:n,timeoutMs:i,prev:s,next:o,scribble:a}=t;switch(a.state){case"active":{o&&o!==s?(t.prev=o,a.points.push(o),n===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var Xbe=Object.create,xK=Object.defineProperty,Zbe=Object.getOwnPropertyDescriptor,Qbe=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),SK=r=>{throw TypeError(r)},wK=(r,e,t)=>e in r?xK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,e0e=r=>[,,,Xbe(null)],bK=["class","method","getter","setter","accessor","field","value","get","set"],vK=r=>r!==void 0&&typeof r!="function"?SK("Function expected"):r,t0e=(r,e,t,n,i)=>({kind:bK[r],name:e,metadata:n,addInitializer:s=>t._?SK("Already initialized"):i.push(vK(s||null))}),n0e=(r,e)=>wK(e,Qbe("metadata"),r[3]),r0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},E1=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=bK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,Zbe(i,t)),y=n.length-1;y>=0;y--)l=t0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,vK(o)&&(g[p]=o);return g&&xK(i,t,g),i},i0e=(r,e,t)=>wK(r,e+"",t),kK,CK,TK,EK,Wd;const Ae=r=>Math.round(r*10**8)/10**8;function Na(r,e,t,n,i){const s=r.filter(a=>(n==="forward"?a.startNode.id===e:a.endNode.id===e)&&Ae(a.length)===Ae(t)&&Xs(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(s.length===0)return[];const o=new Set;return s.forEach(a=>{const l=n==="forward"?a.endNode.id:a.startNode.id;if(!o.has(l)){o.add(l);const c=Na(r,l,t,n,Xs(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));s.push(...c)}}),s}function s0e(r){r.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=r.length-1;e>0;e--){const t=r[e];for(let n=e-1;n>=0;n--){const i=r[n];if(i.direction===t.direction&&t.gaps.every(s=>i.gaps.some(o=>Ae(s.startEdge[0].x)===Ae(o.startEdge[0].x)&&Ae(s.startEdge[0].y)===Ae(o.startEdge[0].y)&&Ae(s.startEdge[1].x)===Ae(o.startEdge[1].x)&&Ae(s.startEdge[1].y)===Ae(o.startEdge[1].y))&&i.gaps.some(o=>Ae(s.endEdge[0].x)===Ae(o.endEdge[0].x)&&Ae(s.endEdge[0].y)===Ae(o.endEdge[0].y)&&Ae(s.endEdge[1].x)===Ae(o.endEdge[1].x)&&Ae(s.endEdge[1].y)===Ae(o.endEdge[1].y)))){r.splice(e,1);break}}}}EK=[q],TK=[q],CK=[q],kK=[q];class fp{constructor(e){this.manager=e,r0e(Wd,5,this),i0e(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const n=e.getShapePageTransform(t.id);if(!n)return;const s=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!n||!s))return s.map((o,a)=>{const{x:l,y:c}=J.applyToPoint(n,o);return{x:l,y:c,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(const i of t){const s=e.get(i);s&&n.push(...s)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Dn(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let n,i;const s=this.getSnappableGapNodes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<s.length;a++){n=s[a];for(let l=a+1;l<s.length;l++)i=s[l],n.pageBounds.maxX<i.pageBounds.minX&&Bp(n.pageBounds.minY,n.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:n,endNode:i,startEdge:[new T(n.pageBounds.maxX,n.pageBounds.minY),new T(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-n.pageBounds.maxX,breadthIntersection:Xs(n.pageBounds.minY,n.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=s.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<o.length;a++){n=o[a];for(let l=a+1;l<o.length;l++)i=o[l],n.pageBounds.maxY<i.pageBounds.minY&&Bp(n.pageBounds.minX,n.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:n,endNode:i,startEdge:[new T(n.pageBounds.minX,n.pageBounds.maxY),new T(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-n.pageBounds.maxY,breadthIntersection:Xs(n.pageBounds.minX,n.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:i}){const s=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(i),l=n.map(({x:g,y},S)=>({id:"selection:"+S,x:g+i.x,y:y+i.y})),c=o,u=[],d=[],h=new T(s,s);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const f=new T(e==="x"?0:u[0]?.nudge??0,e==="y"?0:d[0]?.nudge??0);h.x=0,h.y=0,u.length=0,d.length=0,l.forEach(g=>{g.x+=f.x,g.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const p=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this.manager.setIndicators([...m,...p]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:i,isResizingFromCenter:s}){const o=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=V.Resize(e,n,s?t.x*2:t.x,s?t.y*2:t.y,i);let u=n;l<0&&(u=hwe(u)),c<0&&(u=dwe(u)),s&&(a.center=e.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",f=Fj(u,a),p=this.getSnappablePoints(),m=[],g=[],y=new T(o,o);this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:f});const S=new T(d?0:m[0]?.nudge??0,h?0:g[0]?.nudge??0);if(i&&fwe(u)&&S.len()!==0){const E=m.length&&g.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":m.length?"x":"y",M=e.aspectRatio;E==="x"?(g.length=0,S.y=S.x/M,(u==="bottom_left"||u==="top_right")&&(S.y=-S.y)):(m.length=0,S.x=S.y*M,(u==="bottom_left"||u==="top_right")&&(S.x=-S.x))}const w=T.Add(t,S),{box:b}=V.Resize(e,n,s?w.x*2:w.x,s?w.y*2:w.y,i);s&&(b.center=e.center);const v=Fj("any",b);m.length=0,g.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:v});const C=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:g});return this.manager.setIndicators([...C]),{nudge:S}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:i,nearestSnapsY:s}){for(const o of e)for(const a of t){const l=T.Sub(o,a),c=Math.abs(l.x),u=Math.abs(l.y);Ae(c)<=Ae(n.x)&&(Ae(c)<Ae(n.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),n.x=c),Ae(u)<=Ae(n.y)&&(Ae(u)<Ae(n.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),n.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:i}){const{horizontal:s,vertical:o}=this.getVisibleGaps();for(const a of s){if(!Bp(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const c=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&Ae(Math.abs(c))<=Ae(t.x)){Ae(Math.abs(c))<Ae(t.x)&&(n.length=0),t.x=Math.abs(c);const y={type:"gap_center",gap:a,nudge:c},S=n.find(({type:b})=>b==="gap_center"),w=S&&Xs(a.breadthIntersection[0],a.breadthIntersection[1],S.gap.breadthIntersection[0],S.gap.breadthIntersection[1]);S&&S.gap.length>a.length&&w?n[n.indexOf(S)]=y:(!S||!w)&&n.push(y)}const d=a.startNode.pageBounds.minX-a.length,h=e.maxX,f=d-h;Ae(Math.abs(f))<=Ae(t.x)&&(Ae(Math.abs(f))<Ae(t.x)&&(n.length=0),t.x=Math.abs(f),n.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const p=a.endNode.pageBounds.maxX+a.length,m=e.minX,g=p-m;Ae(Math.abs(g))<=Ae(t.x)&&(Ae(Math.abs(g))<Ae(t.x)&&(n.length=0),t.x=Math.abs(g),n.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:g}))}for(const a of o){if(!Bp(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const c=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&Ae(Math.abs(c))<=Ae(t.y)){Ae(Math.abs(c))<Ae(t.y)&&(i.length=0),t.y=Math.abs(c);const y={type:"gap_center",gap:a,nudge:c},S=i.find(({type:b})=>b==="gap_center"),w=S&&Bp(S.gap.breadthIntersection[0],S.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);S&&S.gap.length>a.length&&w?i[i.indexOf(S)]=y:(!S||!w)&&i.push(y);continue}const d=a.startNode.pageBounds.minY-a.length,h=e.maxY,f=d-h;Ae(Math.abs(f))<=Ae(t.y)&&(Ae(Math.abs(f))<Ae(t.y)&&(i.length=0),t.y=Math.abs(f),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const p=a.endNode.pageBounds.maxY+a.length,m=e.minY,g=p-m;Ae(Math.abs(g))<=Ae(t.y)&&(Ae(Math.abs(g))<Ae(t.y)&&(i.length=0),t.y=Math.abs(g),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const n={},i={};if(e.length>0){for(const s of e)if(s.type==="points"){const o=Ae(s.points.otherPoint.x);n[o]||(n[o]=[]),n[o].push(s.points)}}if(t.length>0){for(const s of t)if(s.type==="points"){const o=Ae(s.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(s.points)}}return Object.values(n).concat(Object.values(i)).map(s=>({id:ft(),type:"points",points:NO(s.map(o=>T.From(o.otherPoint)).concat(s.map(o=>T.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:f,endEdge:p}}=l;switch(l.type){case"gap_center":{const m=(f-e.width)/2,g=Xs(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:ft(),gaps:[...Na(s,d.id,m,"backward",g),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:p},...Na(s,h.id,m,"forward",g)]});break}case"gap_duplicate":{const m=Xs(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:ft(),gaps:l.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(g=>g.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:p},...Na(s,h.id,f,"forward",m)]:[...Na(s,d.id,f,"backward",m),{startEdge:u,endEdge:p},{startEdge:p.map(g=>g.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(n.length>0)for(const l of n){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:f,endEdge:p}}=l;switch(l.type){case"gap_center":{const m=(f-e.height)/2,g=Xs(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:ft(),gaps:[...Na(i,d.id,m,"backward",g),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:p},...Na(i,l.gap.endNode.id,m,"forward",g)]});break}case"gap_duplicate":{const m=Xs(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:ft(),gaps:l.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(g=>g.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:p},...Na(i,h.id,f,"forward",m)]:[...Na(i,d.id,f,"backward",m),{startEdge:u,endEdge:p},{startEdge:p.map(g=>g.clone().addXY(0,h.pageBounds.height)),endEdge:o.top}]})}break}}return s0e(a),a}}Wd=e0e();E1(Wd,1,"getSnapPointsCache",EK,fp);E1(Wd,1,"getSnappablePoints",TK,fp);E1(Wd,1,"getSnappableGapNodes",CK,fp);E1(Wd,1,"getVisibleGaps",kK,fp);n0e(Wd,fp);function Fj(r,e){const{minX:t,maxX:n,minY:i,maxY:s}=e,o=[];switch(r){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(r){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:n,y:i})}switch(r){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:n,y:s})}switch(r){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:t,y:s})}return o}var o0e=Object.create,MK=Object.defineProperty,a0e=Object.getOwnPropertyDescriptor,l0e=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),IK=r=>{throw TypeError(r)},PK=(r,e,t)=>e in r?MK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,c0e=r=>[,,,o0e(null)],AK=["class","method","getter","setter","accessor","field","value","get","set"],$K=r=>r!==void 0&&typeof r!="function"?IK("Function expected"):r,u0e=(r,e,t,n,i)=>({kind:AK[r],name:e,metadata:n,addInitializer:s=>t._?IK("Already initialized"):i.push($K(s||null))}),d0e=(r,e)=>PK(e,l0e("metadata"),r[3]),h0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},f0e=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=AK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,a0e(i,t)),y=n.length-1;y>=0;y--)l=u0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,$K(o)&&(g[p]=o);return g&&MK(i,t,g),i},p0e=(r,e,t)=>PK(r,e+"",t),RK,M1;const m0e=()=>null,g0e=()=>[];RK=[q];class jN{constructor(e){this.manager=e,h0e(M1,5,this),p0e(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const n=e.getShapeUtil(t).getHandleSnapGeometry(t),i=n.getSelfSnapOutline?n.getSelfSnapOutline.bind(n):m0e,s=n.getSelfSnapPoints?n.getSelfSnapPoints.bind(n):g0e;return{outline:n.outline===void 0?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:i,getSelfSnapPoints:s}})}*iterateSnapPointsInPageSpace(e,t){const n=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(t);if(n&&n.length){const i=Dn(this.editor.getShapePageTransform(e));for(const s of n)yield i.applyToPoint(s)}for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const s=this.getSnapGeometryCache().get(i)?.points;if(!s||!s.length)continue;const o=Dn(this.editor.getShapePageTransform(i));for(const a of s)yield o.applyToPoint(a)}}*iterateSnapOutlines(e,t){const n=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(t);n&&(yield{shapeId:e,outline:n});for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const s=this.getSnapGeometryCache().get(i)?.outline;s&&(yield{shapeId:i,outline:s})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){const i=this.manager.getSnapThreshold();let s=i,o=null;for(const c of this.iterateSnapPointsInPageSpace(e,t))T.DistMin(n,c,s)&&(s=T.Dist(n,c),o=c);if(o)return o;let a=i,l=null;for(const{shapeId:c,outline:u}of this.iterateSnapOutlines(e,t)){const d=Dn(this.editor.getShapePageTransform(c)),h=this.editor.getPointInShapeSpace(c,n),f=u.nearestPoint(h),p=d.applyToPoint(f);T.DistMin(n,p,a)&&(a=T.Dist(n,p),l=p)}return l||null}getHandleSnapData({handle:e,currentShapeId:t}){const n=this.manager.getSnapThreshold(),s=Dn(this.editor.getShapePageTransform(t)).applyToPoint(e);let o=null,a=null,l=n,c=n;for(const f of this.iterateSnapPointsInPageSpace(t,e)){const p=Math.abs(s.x-f.x),m=Math.abs(s.y-f.y);p<l&&(l=p,o=f),m<c&&(c=m,a=f)}if(!o&&!a)return null;const u=new T(o?o.x-s.x:0,a?a.y-s.y:0),d=T.Add(s,u),h=[];if(o){const f=new T(o.x,d.y);h.push({id:ft(),type:"points",points:[o,f]})}if(a){const f=new T(d.x,a.y);h.push({id:ft(),type:"points",points:[a,f]})}return{snaps:h,nudge:u}}snapHandle({currentShapeId:e,handle:t}){const i=Dn(this.editor.getShapePageTransform(e)).applyToPoint(t),s=t.canSnap?"point":t.snapType;if(s==="point"){const o=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:i});return o?(this.manager.setIndicators([{id:ft(),type:"points",points:[o]}]),{nudge:T.Sub(o,i)}):null}if(s==="align"){const o=this.getHandleSnapData({handle:t,currentShapeId:e});return o?(this.manager.setIndicators(o.snaps),{nudge:o.nudge}):null}return null}}M1=c0e();f0e(M1,1,"getSnapGeometryCache",RK,jN);d0e(M1,jN);var y0e=Object.create,OK=Object.defineProperty,x0e=Object.getOwnPropertyDescriptor,S0e=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),NK=r=>{throw TypeError(r)},_K=(r,e,t)=>e in r?OK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w0e=r=>[,,,y0e(null)],DK=["class","method","getter","setter","accessor","field","value","get","set"],FK=r=>r!==void 0&&typeof r!="function"?NK("Function expected"):r,b0e=(r,e,t,n,i)=>({kind:DK[r],name:e,metadata:n,addInitializer:s=>t._?NK("Already initialized"):i.push(FK(s||null))}),v0e=(r,e)=>_K(e,S0e("metadata"),r[3]),k0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},LN=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=DK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,x0e(i,t)),y=n.length-1;y>=0;y--)l=b0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,FK(o)&&(g[p]=o);return g&&OK(i,t,g),i},JE=(r,e,t)=>_K(r,typeof e!="symbol"?e+"":e,t),zK,BK,jK,pp;jK=[q],BK=[q],zK=[q];class fS{constructor(e){this.editor=e,k0e(pp,5,this),JE(this,"shapeBounds"),JE(this,"handles"),JE(this,"_snapIndicators",Ft("snapLines",void 0)),this.shapeBounds=new fp(this),this.handles=new jN(this)}getIndicators(){return this._snapIndicators.get()??gn}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),n=e.getSelectedShapeIds(),i=new Set,s=o=>{if(li(o)){const l=e.getShape(o);l&&e.isShapeOfType(l,"frame")&&i.add(o)}const a=e.getSortedChildIdsForParent(o);for(const l of a){if(n.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const d=e.getShapePageBounds(l);if(d&&t.includes(d)){if(e.isShapeOfType(c,"group")){s(l);continue}i.add(l)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}pp=w0e();LN(pp,1,"getSnapThreshold",jK,fS);LN(pp,1,"getSnappableShapes",BK,fS);LN(pp,1,"getCurrentCommonAncestor",zK,fS);v0e(pp,fS);const C0e=/\r?\n|\r/g;function zj(r){return r.replace(C0e,`
`).split(`
`).map(e=>e||" ").join(`
`)}const T0e={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},E0e=/\s/,Bj=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});class M0e{constructor(e){this.editor=e;const t=document.createElement("div");t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.setAttribute("dir","auto"),t.tabIndex=-1,this.editor.getContainer().appendChild(t),this.elm=t;for(const n of Wg(Bj))t.style.setProperty(n,Bj[n])}elm;setElementStyles(e){const t={};for(const n of Wg(e))if(typeof e[n]=="string"){const i=this.elm.style.getPropertyValue(n);if(i===e[n])continue;t[n]=i,this.elm.style.setProperty(n,e[n])}return()=>{for(const n of Wg(t))this.elm.style.setProperty(n,t[n])}}dispose(){return this.elm.remove()}measureText(e,t){const n=document.createElement("div");return n.textContent=zj(e),this.measureHtml(n.innerHTML,t)}measureHtml(e,t){const{elm:n}=this,i={"font-family":t.fontFamily,"font-style":t.fontStyle,"font-weight":t.fontWeight,"font-size":t.fontSize+"px","line-height":t.lineHeight.toString(),padding:t.padding,"max-width":t.maxWidth?t.maxWidth+"px":void 0,"min-width":t.minWidth?t.minWidth+"px":void 0,"overflow-wrap":t.disableOverflowWrapBreaking?"normal":void 0,...t.otherStyles},s=this.setElementStyles(i);try{n.innerHTML=e;const o=t.measureScrollWidth?n.scrollWidth:0,a=n.getBoundingClientRect();return{x:0,y:0,w:a.width,h:a.height,scrollWidth:o}}finally{s()}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const n=[],i=e.getBoundingClientRect(),s=-i.left,o=-i.top,a=new Range,l=e.childNodes[0];let c=0,u=null,d=null,h=0,f=0,p=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const g of m.textContent??""){a.setStart(l,c),a.setEnd(l,c+g.length);const y=a.getClientRects(),S=y[y.length-1],w=S.top+o,b=S.left+s,v=S.right+s,C=b<f,E=E0e.test(g);if(E!==d||w!==h||!u){if(u){if(t&&w!==h){p=!0;break}n.push(u)}u={box:{x:b,y:w,w:S.width,h:S.height},text:g},f=b}else C&&(u.box.x=b),u.box.w=C?u.box.w+S.width:v-u.box.x,u.text+=g;g===`
`&&(f=0),d=E,h=w,c+=g.length}return u&&n.push(u),{spans:n,didTruncate:p}}measureTextSpans(e,t){if(e==="")return[];const{elm:n}=this,i=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip",s=Math.ceil(t.width-t.padding*2),o={"font-family":t.fontFamily,"font-style":t.fontStyle,"font-weight":t.fontWeight,"font-size":t.fontSize+"px","line-height":t.lineHeight.toString(),width:`${s}px`,height:"min-content","text-align":T0e[t.textAlign],"overflow-wrap":i?"anywhere":void 0,"word-break":i?"break-all":void 0,...t.otherStyles},a=this.setElementStyles(o);try{const l=zj(e);n.textContent=l;const{spans:c,didTruncate:u}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:i});if(t.overflow==="truncate-ellipsis"&&u){n.textContent="";const d=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${s-d}px`),n.textContent=l;const h=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,f=h[h.length-1];return h.push({text:"",box:{x:Math.min(f.box.x+f.box.w,t.width-t.padding-d),y:f.box.y,w:d,h:f.box.h}}),h}return c}finally{a()}}}var I0e=Object.create,LK=Object.defineProperty,P0e=Object.getOwnPropertyDescriptor,A0e=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),UK=r=>{throw TypeError(r)},WK=(r,e,t)=>e in r?LK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$0e=r=>[,,,I0e(null)],HK=["class","method","getter","setter","accessor","field","value","get","set"],qK=r=>r!==void 0&&typeof r!="function"?UK("Function expected"):r,R0e=(r,e,t,n,i)=>({kind:HK[r],name:e,metadata:n,addInitializer:s=>t._?UK("Already initialized"):i.push(qK(s||null))}),O0e=(r,e)=>WK(e,A0e("metadata"),r[3]),N0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},KK=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=HK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,P0e(i,t)),y=n.length-1;y>=0;y--)l=R0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,qK(o)&&(g[p]=o);return g&&LK(i,t,g),i},QS=(r,e,t)=>WK(r,typeof e!="symbol"?e+"":e,t),JK,VK,pS;const jj=LO;VK=[Yi],JK=[Yi];class I1{constructor(e){this.editor=e,N0e(pS,5,this),QS(this,"cancelRaf"),QS(this,"isPaused",!0),QS(this,"now",0),QS(this,"prevPoint",new T),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=jj(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=jj(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:i}}}=this;if(e===0)return;const s=T.Sub(n,t);this.prevPoint=n.clone();const o=s.len(),a=o?s.div(o):new T(0,0),l=i.clone().lrp(a.mul(o/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)}}pS=$0e();KK(pS,1,"tick",VK,I1);KK(pS,1,"dispose",JK,I1);O0e(pS,I1);var _0e=Object.create,GK=Object.defineProperty,D0e=Object.getOwnPropertyDescriptor,F0e=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),YK=r=>{throw TypeError(r)},XK=(r,e,t)=>e in r?GK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,z0e=r=>[,,,_0e(null)],ZK=["class","method","getter","setter","accessor","field","value","get","set"],QK=r=>r!==void 0&&typeof r!="function"?YK("Function expected"):r,B0e=(r,e,t,n,i)=>({kind:ZK[r],name:e,metadata:n,addInitializer:s=>t._?YK("Already initialized"):i.push(QK(s||null))}),j0e=(r,e)=>XK(e,F0e("metadata"),r[3]),L0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},Bi=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=ZK[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,D0e(i,t)),y=n.length-1;y>=0;y--)l=B0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,QK(o)&&(g[p]=o);return g&&GK(i,t,g),i},Lj=(r,e,t)=>XK(r,typeof e!="symbol"?e+"":e,t),eJ,tJ,nJ,rJ,iJ,sJ,oJ,aJ,lJ,cJ,uJ,dJ,hJ,fJ,pJ,Kn;pJ=[q],fJ=[q],hJ=[q],dJ=[q],uJ=[q],cJ=[q],lJ=[q],aJ=[q],oJ=[q],sJ=[q],iJ=[q],rJ=[q],nJ=[q],tJ=[q],eJ=[q];class ar{constructor(e,t){if(this.user=e,this.inferDarkMode=t,L0e(Kn,5,this),Lj(this,"systemColorScheme",Ft("systemColorScheme","light")),Lj(this,"disposables",new Set),typeof window>"u"||!window.matchMedia)return;const n=window.matchMedia("(prefers-color-scheme: dark)");n?.matches&&this.systemColorScheme.set("dark");const i=s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};n?.addEventListener("change",i),this.disposables.add(()=>n?.removeEventListener("change",i))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode(),enhancedA11yMode:this.getEnhancedA11yMode(),inputMode:this.getInputMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Wi.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Wi.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??Wi.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??Wi.name}getLocale(){return this.user.userPreferences.get().locale??Wi.locale}getColor(){return this.user.userPreferences.get().color??Wi.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Wi.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Wi.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Wi.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Wi.isPasteAtCursorMode}getEnhancedA11yMode(){return this.user.userPreferences.get().enhancedA11yMode??Wi.enhancedA11yMode}getInputMode(){return this.user.userPreferences.get().inputMode??Wi.inputMode}}Kn=z0e();Bi(Kn,1,"getUserPreferences",pJ,ar);Bi(Kn,1,"getIsDarkMode",fJ,ar);Bi(Kn,1,"getEdgeScrollSpeed",hJ,ar);Bi(Kn,1,"getAnimationSpeed",dJ,ar);Bi(Kn,1,"getAreKeyboardShortcutsEnabled",uJ,ar);Bi(Kn,1,"getId",cJ,ar);Bi(Kn,1,"getName",lJ,ar);Bi(Kn,1,"getLocale",aJ,ar);Bi(Kn,1,"getColor",oJ,ar);Bi(Kn,1,"getIsSnapMode",sJ,ar);Bi(Kn,1,"getIsWrapMode",iJ,ar);Bi(Kn,1,"getIsDynamicResizeMode",rJ,ar);Bi(Kn,1,"getIsPasteAtCursorMode",nJ,ar);Bi(Kn,1,"getEnhancedA11yMode",tJ,ar);Bi(Kn,1,"getInputMode",eJ,ar);j0e(Kn,ar);const U0e={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},W0e=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class he{constructor(e,t){this.editor=e;const{id:n,children:i,initial:s,isLockable:o,useCoalescedEvents:a}=this.constructor;this.id=n,this._isActive=Ft("toolIsActive"+this.id,!1),this._current=Ft("toolState"+this.id,void 0),this._path=q("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=t??{},t?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.useCoalescedEvents=a,this.performanceTracker=new xW}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(e,t={}){const n=e.split(".");let i=this;for(let s=0;s<n.length;s++){const o=n[s],a=i.getCurrent(),l=i.children?.[o];if(!l)throw Error(`${i.id} - no child state exists with the id ${o}.`);if(a?.id!==l.id&&(a?.exit(t,o),i._current.set(l),l.enter(t,a?.id||"initial"),!l.getIsActive()))break;i=l}return this}handleEvent(e){const t=U0e[e.name],n=this._current.__unsafe__getWithoutCapture();this[t]?.(e),this._isActive.__unsafe__getWithoutCapture()&&n&&n===this._current.__unsafe__getWithoutCapture()&&n.handleEvent(e)}enter(e,t){if(Yt.measurePerformance.get()&&W0e.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,t),this.children&&this.initial&&this.getIsActive()){const n=this.children[this.initial];this._current.set(n),n.enter(e,t)}}exit(e,t){Yt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)}_currentToolIdMask=Ft("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}addChild(e){if(this.type==="leaf")throw new Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});const t=new e(this.editor,this);if(this.children[t.id])throw new Error(`StateNode.addChild: a child with id '${t.id}' already exists`);return this.children[t.id]=t,this}}class H0e extends he{static id="root";static initial="";static children(){return[]}onKeyDown(e){switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}break}}}}var q0e=Object.create,mJ=Object.defineProperty,K0e=Object.getOwnPropertyDescriptor,gJ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),yJ=r=>{throw TypeError(r)},xJ=(r,e,t)=>e in r?mJ(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,J0e=r=>[,,,q0e(r?.[gJ("metadata")]??null)],SJ=["class","method","getter","setter","accessor","field","value","get","set"],wJ=r=>r!==void 0&&typeof r!="function"?yJ("Function expected"):r,V0e=(r,e,t,n,i)=>({kind:SJ[r],name:e,metadata:n,addInitializer:s=>t._?yJ("Already initialized"):i.push(wJ(s||null))}),G0e=(r,e)=>xJ(e,gJ("metadata"),r[3]),Y0e=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},re=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=SJ[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,K0e(i,t)),y=n.length-1;y>=0;y--)l=V0e(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,wJ(o)&&(g[p]=o);return g&&mJ(i,t,g),i},de=(r,e,t)=>xJ(r,typeof e!="symbol"?e+"":e,t),bJ,vJ,kJ,CJ,TJ,EJ,MJ,IJ,PJ,AJ,$J,RJ,OJ,NJ,_J,DJ,FJ,zJ,BJ,jJ,LJ,UJ,WJ,HJ,qJ,KJ,JJ,VJ,GJ,YJ,XJ,ZJ,QJ,eV,tV,nV,rV,iV,sV,oV,aV,lV,cV,uV,dV,hV,fV,pV,mV,gV,yV,xV,SV,wV,bV,vV,kV,CV,TV,EV,MV,IV,PV,AV,$V,RV,OV,NV,_V,DV,FV,HP,te;let ee=class extends(HP=swe,FV=[q],DV=[q],_V=[q],NV=[q],OV=[q],RV=[q],$V=[q],AV=[q],PV=[q],IV=[q],MV=[q],EV=[q],TV=[q],CV=[q],kV=[q],vV=[q],bV=[q],wV=[q],SV=[q],xV=[q],yV=[q],gV=[q],mV=[q],pV=[q],fV=[q],hV=[q],dV=[q],uV=[q],cV=[q],lV=[q],aV=[q],oV=[q],sV=[q],iV=[q],rV=[q],nV=[q],tV=[q],eV=[q],QJ=[q],ZJ=[q],XJ=[q],YJ=[q],GJ=[q],VJ=[q],JJ=[q],KJ=[q],qJ=[q],HJ=[q],WJ=[q],UJ=[q],LJ=[q],jJ=[q],BJ=[q],zJ=[q],FJ=[q],DJ=[q],_J=[q],NJ=[q],OJ=[q],RJ=[q],$J=[q],AJ=[q],PJ=[q],IJ=[q({isEqual:(e,t)=>e.equals(t)})],MJ=[q],EJ=[q],TJ=[q],CJ=[Yi],kJ=[Yi],vJ=[Yi],bJ=[Yi],HP){constructor({store:e,user:t,shapeUtils:n,bindingUtils:i,tools:s,getContainer:o,cameraOptions:a,textOptions:l,initialState:c,autoFocus:u,inferDarkMode:d,options:h,getShapeVisibility:f,fontAssetUrls:p}){super(),Y0e(te,5,this),de(this,"id",ft()),de(this,"_getShapeVisibility"),de(this,"options"),de(this,"contextId",ft()),de(this,"store"),de(this,"root"),de(this,"disposables",new Set),de(this,"isDisposed",!1),de(this,"_tickManager"),de(this,"snaps"),de(this,"timers",pv.forContext(this.contextId)),de(this,"user"),de(this,"textMeasure"),de(this,"fonts"),de(this,"scribbles"),de(this,"sideEffects"),de(this,"edgeScrollManager"),de(this,"focusManager"),de(this,"getContainer"),de(this,"shapeUtils"),de(this,"styleProps"),de(this,"bindingUtils"),de(this,"history"),de(this,"_shouldIgnoreShapeLock",!1),de(this,"_crashingError",null),de(this,"_isChangingStyleTimeout",-1),de(this,"menus",ui.forContext(this.contextId)),de(this,"_currentRichTextEditor",Ft("rich text editor",null)),de(this,"_textOptions"),de(this,"_cameraOptions",Ft("camera options",gj)),de(this,"_viewportAnimation",null),de(this,"_willSetInitialBounds",!0),de(this,"_isLockedOnFollowingUser",Ft("isLockedOnFollowingUser",!1)),de(this,"_cameraState",Ft("camera state","idle")),de(this,"_cameraStateTimeoutRemaining",0),de(this,"_currentPageShapeIds"),de(this,"_shapeGeometryCaches",{}),de(this,"_notVisibleShapes",$be(this)),de(this,"_parentIdsToChildIds"),de(this,"animatingShapes",new Map),de(this,"externalAssetContentHandlers",{file:null,url:null}),de(this,"temporaryAssetPreview",new Map),de(this,"externalContentHandlers",{text:null,files:null,"file-replace":null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),de(this,"inputs",{originPagePoint:new T,originScreenPoint:new T,previousPagePoint:new T,previousScreenPoint:new T,currentPagePoint:new T,currentScreenPoint:new T,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new T}),de(this,"_clickManager",new T1(this)),de(this,"_prevCursor","default"),de(this,"_shiftKeyTimeout",-1),de(this,"_altKeyTimeout",-1),de(this,"_ctrlKeyTimeout",-1),de(this,"_metaKeyTimeout",-1),de(this,"_restoreToolId","select"),de(this,"_pinchStart",1),de(this,"_didPinch",!1),de(this,"_selectedShapeIdsAtPointerDown",[]),de(this,"_longPressTimeout",-1),de(this,"capturedPointerId",null),de(this,"performanceTracker"),de(this,"performanceTrackerTimeout",-1),de(this,"handledEvents",new WeakSet),de(this,"_pendingEventsForNextTick",[]),this._getShapeVisibility=f,this.options={...xbe,...h},this.store=e,this.history=new qbe({store:e,annotateError:A=>{this.annotateError(A,{origin:"history.batch",willCrashApp:!0}),this.crash(A)}}),this.snaps=new fS(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...gj,...a}),this._textOptions=Ft("text options",l??null),this.user=new ar(t??Mq(),d??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=o,this.textMeasure=new M0e(this),this.disposables.add(()=>this.textMeasure.dispose()),this.fonts=new Hbe(this,p),this._tickManager=new I1(this);class m extends H0e{static initial=c??""}this.root=new m(this),this.root.children={},this.markEventAsHandled=this.markEventAsHandled.bind(this);const g=Fq(n),y={},S={},w=new Map;for(const A of g){const O=new A(this);y[A.type]=O;const _=MH(A.props??{});S[A.type]=_;for(const I of _.keys())if(!w.has(I.id))w.set(I.id,I);else if(w.get(I.id)!==I)throw Error(`Multiple style props with id "${I.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=y,this.styleProps=S;const b=Rq(i),v={};for(const A of b){const O=new A(this);v[A.type]=O}this.bindingUtils=v;for(const A of[...s]){if(Xi(this.root.children,A.id))throw Error(`Can't override tool with id "${A.id}"`);this.root.children[A.id]=new A(this,this.root)}this.scribbles=new Ybe(this);const C=(A,O)=>{let _=null;const I=A.selectedShapeIds.filter(U=>!O.has(U));I.length!==A.selectedShapeIds.length&&(_||(_={...A}),_.selectedShapeIds=I);const R=A.erasingShapeIds.filter(U=>!O.has(U));R.length!==A.erasingShapeIds.length&&(_||(_={...A}),_.erasingShapeIds=R),A.hoveredShapeId&&O.has(A.hoveredShapeId)&&(_||(_={...A}),_.hoveredShapeId=null),A.editingShapeId&&O.has(A.editingShapeId)&&(_||(_={...A}),_.editingShapeId=null);const B=A.hintingShapeIds.filter(U=>!O.has(U));return B.length!==A.hintingShapeIds.length&&(_||(_={...A}),_.hintingShapeIds=B),A.focusedGroupId&&O.has(A.focusedGroupId)&&(_||(_={...A}),_.focusedGroupId=null),_};this.sideEffects=this.store.sideEffects;let E=new Map;const M=new Set,P=new Set;let $=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{M.clear();for(const A of P){P.delete(A);const O=this.getShape(A);if(!O)continue;const I=this.getShapeUtil(O).onChildrenChange?.(O);I?.length&&this.updateShapes(I)}if($.size){const A=$;$=new Set;for(const O of A)this.getBindingUtil(O).onOperationComplete?.()}if(E.size){const A=E;E=new Map;for(const O of A.values())this.getBindingUtil(O.binding).onAfterDelete?.(O)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(A,O)=>{for(const _ of this.getBindingsInvolvingShape(O))$.add(_.type),_.fromId===O.id&&this.getBindingUtil(_).onAfterChangeFromShape?.({binding:_,shapeBefore:A,shapeAfter:O,reason:"self"}),_.toId===O.id&&this.getBindingUtil(_).onAfterChangeToShape?.({binding:_,shapeBefore:A,shapeAfter:O,reason:"self"});if(A.parentId!==O.parentId){const _=I=>{const R=this.getShape(I);if(R)for(const B of this.getBindingsInvolvingShape(R))$.add(B.type),B.fromId===R.id&&this.getBindingUtil(B).onAfterChangeFromShape?.({binding:B,shapeBefore:R,shapeAfter:R,reason:"ancestry"}),B.toId===R.id&&this.getBindingUtil(B).onAfterChangeToShape?.({binding:B,shapeBefore:R,shapeAfter:R,reason:"ancestry"})};_(O.id),this.visitDescendants(O.id,_)}if(A.parentId!==O.parentId&&Gn(O.parentId)){const _=new Set([A.id]);this.visitDescendants(A.id,I=>{_.add(I)});for(const I of this.getPageStates()){if(I.pageId===O.parentId)continue;const R=C(I,_);R&&this.store.put([R])}}A.parentId&&li(A.parentId)&&P.add(A.parentId),O.parentId!==A.parentId&&li(O.parentId)&&P.add(O.parentId)},beforeDelete:A=>{if(M.has(A.id))return;A.parentId&&li(A.parentId)&&P.add(A.parentId),M.add(A.id);const O=[];for(const R of this.getBindingsInvolvingShape(A)){$.add(R.type),O.push(R.id);const B=this.getBindingUtil(R);R.fromId===A.id?(B.onBeforeIsolateToShape?.({binding:R,removedShape:A}),B.onBeforeDeleteFromShape?.({binding:R,shape:A})):(B.onBeforeIsolateFromShape?.({binding:R,removedShape:A}),B.onBeforeDeleteToShape?.({binding:R,shape:A}))}O.length&&this.deleteBindings(O);const _=new Set([A.id]),I=Re(this.getPageStates().map(R=>C(R,_)));I.length&&this.store.put(I)}},binding:{beforeCreate:A=>{const O=this.getBindingUtil(A).onBeforeCreate?.({binding:A});return O||A},afterCreate:A=>{$.add(A.type),this.getBindingUtil(A).onAfterCreate?.({binding:A})},beforeChange:(A,O)=>{const _=this.getBindingUtil(O).onBeforeChange?.({bindingBefore:A,bindingAfter:O});return _||O},afterChange:(A,O)=>{$.add(O.type),this.getBindingUtil(O).onAfterChange?.({bindingBefore:A,bindingAfter:O})},beforeDelete:A=>{this.getBindingUtil(A).onBeforeDelete?.({binding:A})},afterDelete:A=>{this.getBindingUtil(A).onAfterDelete?.({binding:A}),$.add(A.type)}},page:{afterCreate:A=>{const O=Jo.createId(A.id),_=eo.createId(A.id);this.store.has(O)||this.store.put([Jo.create({id:O})]),this.store.has(_)||this.store.put([eo.create({id:_,pageId:A.id})])},afterDelete:(A,O)=>{if(this.getInstanceState()?.currentPageId===A.id){const R=this.getPages().find(B=>B.id!==A.id)?.id;R?this.store.put([{...this.getInstanceState(),currentPageId:R}]):O==="user"&&this.store.ensureStoreIsUsable()}const _=Jo.createId(A.id),I=eo.createId(A.id);this.store.remove([_,I])}},instance:{afterChange:(A,O,_)=>{if(!this.store.has(O.currentPageId)){const I=this.store.has(A.currentPageId)?A.currentPageId:this.getPages()[0]?.id;I?this.store.update(O.id,R=>({...R,currentPageId:I})):_==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(A,O)=>{if(A?.selectedShapeIds!==O?.selectedShapeIds){const _=O.selectedShapeIds.filter(R=>{let B=this.getShape(R)?.parentId;for(;li(B);){if(O.selectedShapeIds.includes(B))return!1;B=this.getShape(B)?.parentId}return!0});let I=null;if(_.length>0){const R=this.findCommonAncestor(Re(_.map(B=>this.getShape(B))),B=>this.isShapeOfType(B,"group"));R&&(I=R)}else O?.focusedGroupId&&(I=O.focusedGroupId);(_.length!==O.selectedShapeIds.length||I!==O.focusedGroupId)&&this.store.put([{...O,selectedShapeIds:_,focusedGroupId:I??null}])}}}})),this._currentPageShapeIds=Obe(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=Rbe(this.store),this.disposables.add(this.store.listen(A=>{this.emit("change",A)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new Ube(this),this.focusManager=new Wbe(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new xW,this.store.props.collaboration?.mode){const A=this.store.props.collaboration.mode;this.disposables.add(Zi("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:A.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",e=>{const t=this._getShapeVisibility(e,this);return(Ci.isId(e.parentId)?!1:this.isShapeHidden(e.parentId))?t!=="visible":t==="hidden"}):null}isShapeHidden(e){return this._getShapeVisibility?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}setTool(e,t){if(t??=this.root,Xi(t.children,e.id))throw Error(`Can't override tool with id "${e.id}"`);t.children[e.id]=new e(this,t)}removeTool(e,t){t??=this.root,Xi(t.children,e.id)&&delete t.children[e.id]}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,n=Cn(this.shapeUtils,t);return se(n,`No shape util found for type "${t}"`),n}hasShapeUtil(e){const t=typeof e=="string"?e:e.type;return Xi(this.shapeUtils,t)}getBindingUtil(e){const t=typeof e=="string"?e:e.type,n=Cn(this.bindingUtils,t);return se(n,`No binding util found for type "${t}"`),n}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${ft()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const n=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=t?.ignoreShapeLock??n;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=n}return this}annotateError(e,{origin:t,willCrashApp:n,tags:i,extras:s}){const o=this.createErrorAnnotations(t,n);return DO(e,{tags:{...o.tags,...i},extras:{...o.extras,...s}}),n&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(i=>{const{props:s,...o}=i,{text:a,richText:l,...c}=s;return{...o,props:c}}),selectionCount:this.getSelectedShapes().length,editingShape:n?this.getShape(n):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const i=t.pop();if(!i)return!0;const s=n.getCurrent();if(s?.id===i){if(t.length===0)return!0;n=s;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const i=t.pop();if(!i)return n;const s=n.children?.[i];if(!s)return;n=s}return n}getDocumentSettings(){return this.store.get(NP)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ci)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return eo.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return Re(this.getSelectedShapeIds().map(e=>this.store.get(e)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(s=>typeof s=="string"?s:s.id),{selectedShapeIds:n}=this.getCurrentPageState(),i=new Set(n);if(t.length===i.size&&t.every(s=>i.has(s)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:e?.id??null,n=this.getShape(t);if(!n)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(n,s=>i.includes(s.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(n=>n.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),n=this.getSelectedShapeIds();return n.length>0&&t.length>0&&this.setSelectedShapes(n.filter(i=>!t.includes(i))),this}selectAll(){let e=null;const t=this.getSelectedShapeIds();if(t.length>0)for(const i of t){const s=this.getShape(i);if(s){if(e===null)e=s.parentId;else if(e!==s.parentId)return this}}e||(e=this.getCurrentPageId());const n=this.getSortedChildIdsForParent(e);return n.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(n)),this)}selectAdjacentShape(e){const t=this.getSelectedShapeIds(),n=t[0]?this.getShape(t[0])?.parentId:null,i=n&&t.every(u=>this.getShape(u)?.parentId===n)&&!Gn(n),s=i?this.getCurrentPageShapes().filter(u=>u.parentId===n):this.getCurrentPageShapes().filter(u=>Gn(u.parentId)),o=i?this._getShapesInReadingOrder(s):this.getCurrentPageShapesInReadingOrder(),a=t.length===1?t[0]:o.find(u=>t.includes(u.id))?.id;let l;if(e==="next"||e==="prev"){const u=o.map(f=>f.id),h=((a?u.indexOf(a):-1)+(e==="next"?1:-1)+u.length)%u.length;l=u[h]}else{if(!a)return;l=this.getNearestAdjacentShape(s,a,e)}const c=this.getShape(l);c&&this._selectShapesAndZoom([c.id])}getCurrentPageShapesInReadingOrder(){const e=this.getCurrentPageShapes().filter(t=>Gn(t.parentId));return this._getShapesInReadingOrder(e)}_getShapesInReadingOrder(e){const i=e.filter(a=>this.getShapeUtil(a).canTabTo(a));if(i.length<=1)return i;const s=i.map(a=>({shape:a,center:this.getShapePageBounds(a).center}));s.sort((a,l)=>a.center.y-l.center.y);const o=[];for(const a of s){let l=-1;for(let c=o.length-1;c>=0;c--){const u=o[c],d=u[u.length-1];if(Math.abs(a.center.y-d.center.y)<100){l=c;break}}l===-1?o.push([a]):o[l].push(a)}for(const a of o)a.sort((l,c)=>l.center.x-c.center.x);for(const a of o)if(!(a.length<=2))for(let l=0;l<a.length-2;l++){const c=a[l],u=a[l+1],d=a[l+2],h=T.Dist2(c.center,u.center);T.Dist2(c.center,d.center)<h*.9&&Math.abs(T.Angle(c.center,d.center)*(180/Math.PI))<=20&&([a[l+1],a[l+2]]=[a[l+2],a[l+1]])}return o.flat().map(a=>a.shape)}getNearestAdjacentShape(e,t,n){const i={right:0,left:180,down:90,up:270},s=this.getShape(t);if(!s)return t;const o=e.filter(d=>this.getShapeUtil(d).canTabTo(d)&&d.id!==t);if(!o.length)return t;const a=this.getShapePageBounds(s).center,c=o.map(d=>({shape:d,center:this.getShapePageBounds(d).center})).filter(({center:d})=>{const h=d.x>a.x,f=d.y>a.y,p=d.x-a.x,m=d.y-a.y,g=Math.abs(m)<Math.abs(p)*2,y=Math.abs(p)<Math.abs(m)*2;if(n==="left"||n==="right")return g&&(n==="right"?h:!h);if(n==="up"||n==="down")return y&&(n==="down"?f:!f)});return c.length===0?t:cW(c,({center:d})=>{const h=T.Dist2(a,d),f=["left","right"].includes(n)?"x":"y",p=Math.abs(d[f]-a[f]),m=["left","right"].includes(n)?"y":"x",g=Math.abs(d[m]-a[m]),y=Math.abs(T.Angle(a,d)*(180/Math.PI)),S=Math.abs(y-i[n]);return h*1+g*2+(h-p)*1.5+S*.5}).shape.id}selectParentShape(){const e=this.getOnlySelectedShape();if(!e)return;const t=this.getShape(e.parentId);t&&this._selectShapesAndZoom([t.id])}selectFirstChildShape(){const e=this.getSelectedShapes();if(!e.length)return;const t=e[0],n=this.getSortedChildIdsForParent(t.id).map(s=>this.getShape(s)).filter(s=>s),i=this._getShapesInReadingOrder(n);i.length!==0&&this._selectShapesAndZoom([i[0].id])}_selectShapesAndZoom(e){this.setSelectedShapes(e),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=Re(e.map(n=>this.getShapePageBounds(n)));return t.length===0?null:V.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getSelectionScreenBounds(){const e=this.getSelectionPageBounds();if(!e)return;const{x:t,y:n}=this.pageToScreen(e.point),i=this.getZoomLevel();return new V(t,n,e.width*i,e.height*i)}getShapesSharedRotation(e){let t=!1,n=0;for(let i=0,s=e.length;i<s;i++){const o=this.getShapePageTransform(e[i]);if(o)if(t){if(o.rotation()!==n)return 0}else t=!0,n=o.rotation()}return n}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),s=this.getShapePageTransform(e[0]);return i.point=s.applyToPoint(i.point),i}const n=V.FromPoints(e.flatMap(i=>{const s=this.getShapePageTransform(i);return s?s.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-t)));return n.point=n.point.rot(t),n}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:n}=this.pageToScreen(e.point),i=this.getZoomLevel();return new V(t,n,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:e?.id??null;if(t!==null){const n=this.getShape(t);if(!n)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(n,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${n.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,n=>({...n,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,n=>this.isShapeOfType(n,"group"));this.setFocusedGroup(t?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:e?.id??null;this.setRichTextEditor(null);const n=this.getEditingShapeId();if(t!==n){if(t){const i=this.getShape(t);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{if(this._updateCurrentPageState({editingShapeId:t}),n){const s=this.getShape(n);s&&this.getShapeUtil(s).onEditEnd?.(s)}this.getShapeUtil(i).onEditStart?.(i)},{history:"ignore"}),this}this.run(()=>{if(this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),n){const i=this.getShape(n);i&&this.getShapeUtil(i).onEditEnd?.(i)}},{history:"ignore"})}return this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(e){return this._currentRichTextEditor.set(e),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:e?.id??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return Re(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(n=>n.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:NO(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return Re(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);t.sort();const n=this.getErasingShapeIds();return this.run(()=>{if(t.length===n.length){for(let i=0;i<t.length;i++)if(t[i]!==n[i]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:e?.id??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const n=this.getShape(t),i=this.getShapeUtil(n);n&&i.canCrop(n)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}getTextOptions(){return Dn(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return Jo.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}_getFollowingPresence(e){const t=[this.user.getId()],n=this.getCollaborators();let i=null;for(;e&&!t.includes(e);)i=n.find(s=>s.userId===e)??null,e=i?.followingUserId??null,i&&t.push(i.userId);return i}getViewportPageBoundsForFollowing(){const e=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!e?.camera||!e?.screenBounds)return null;const{w:t,h:n}=e.screenBounds,{x:i,y:s,z:o}=e.camera,a=new V(-i,-s,t/o,n/o),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:n}=Wj(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw at(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:n}=Wj(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw at(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){const t=vn({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return t.zoomSteps?.length<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const n=this.getCamera();let{x:i,y:s,z:o=n.z}=e;if(!t?.force){const a=this.getCameraOptions(),l=a.zoomSteps[0],c=Xn(a.zoomSteps),u=this.getViewportScreenBounds();if(a.constraints){const{constraints:d}=a,h=Math.min(d.padding.y,u.w/2),f=Math.min(d.padding.x,u.h/2),p=V.From(a.constraints.bounds),m=(u.w-f*2)/p.w,g=(u.h-h*2)/p.h,y=this.getBaseZoom(),S=c*y,w=l*y;if(t?.reset&&(o=this.getInitialZoom()),o<w||o>S){const{x:O,y:_,z:I}=n,R=-O+u.w/I/2,B=-_+u.h/I/2;o=_e(o,w,S);const U=-O+u.w/o/2,H=-_+u.h/o/2;i=O+U-R,s=_+H-B}const b=f/o-p.x,v=h/o-p.y,C=(u.w-f*2)/o-p.w,E=(u.h-h*2)/o-p.h,M=b+C*d.origin.x,P=v+E*d.origin.y,$=typeof d.behavior=="string"?d.behavior:d.behavior.x,A=typeof d.behavior=="string"?d.behavior:d.behavior.y;if(t?.reset)i=M,s=P;else{switch($){case"fixed":{i=M;break}case"contain":{o<m?i=M:i=_e(i,b+C,b);break}case"inside":{o<m?i=_e(i,b,(u.w-f)/o-p.w):i=_e(i,b+C,b);break}case"outside":{i=_e(i,f/o-p.w,(u.w-f)/o);break}case"free":break;default:throw at($)}switch(A){case"fixed":{s=P;break}case"contain":{o<g?s=P:s=_e(s,v+E,v);break}case"inside":{o<g?s=_e(s,v,(u.h-h)/o-p.h):s=_e(s,v+E,v);break}case"outside":{s=_e(s,h/o-p.h,(u.h-h)/o);break}case"free":break;default:throw at(A)}}}else if(o>c||o<l){const{x:d,y:h,z:f}=n;o=_e(o,l,c),i=d+(-d+u.w/o/2)-(-d+u.w/f/2),s=h+(-h+u.h/o/2)-(-h+u.h/f/2)}}return{x:i,y:s,z:o}}_setCamera(e,t){const n=this.getCamera(),{x:i,y:s,z:o}=this.getConstrainedCamera(e,t);return n.x===i&&n.y===s&&n.z===o?this:(hs(()=>{const a={...n,x:i,y:s,z:o};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:l,currentPagePoint:c}=this.inputs;(l.x/o-i!==c.x||l.y/o-s!==c.y)&&this.updatePointer({immediate:t?.immediate,pointerId:yj.CAMERA_MOVE}),this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:n}=this._cameraOptions.__unsafe__getWithoutCapture();if(n&&!t?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=T.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(i,t);if(t?.animation){const{width:o,height:a}=this.getViewportScreenBounds();this._animateToViewport(new V(-s.x,-s.y,o/s.z,a/s.z),t)}else this._setCamera(s,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;const{width:i,height:s}=this.getViewportPageBounds();return this.setCamera(new T(-(e.x-i/2),-(e.y-s/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const n=V.Common(Re(t.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(n,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:n,constraints:i}=this.getCameraOptions();if(n&&!t?.force)return this;const s=this.getCamera(),{x:o,y:a,z:l}=s,{x:c,y:u}=e;let d=1;if(i){const h=this.getInitialZoom();l!==h&&(d=h)}return this.setCamera(new T(o+(c/d-c)-(c/l-c),a+(u/d-u)-(u/l-u),d),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;const{x:i,y:s,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const l=this.getBaseZoom();let c=Xn(a)*l;for(let u=1;u<a.length;u++){const d=a[u-1]*l,h=a[u]*l;if(!(h-o<=(h-d)/2)){c=h;break}}this.setCamera(new T(i+(e.x/c-e.x)-(e.x/o-e.x),s+(e.y/c-e.y)-(e.y/o-e.y),c),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;const{zoomSteps:i}=this.getCameraOptions();if(i!==null&&i.length>1){const s=this.getBaseZoom(),{x:o,y:a,z:l}=this.getCamera();let c=i[0]*s;for(let u=i.length-1;u>0;u--){const d=i[u-1]*s,h=i[u]*s;if(!(h-l>=(h-d)/2)){c=d;break}}this.setCamera(new T(o+(e.x/c-e.x)-(e.x/l-e.x),a+(e.y/c-e.y)-(e.y/l-e.y),c),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!e?.force)return this;const n=this.getSelectionPageBounds();return n&&this.zoomToBounds(n,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToSelectionIfOffscreen(e=16,t){const n=this.getSelectionPageBounds(),i=this.getViewportPageBounds();if(n&&!i.contains(n)){const s=n.clone().expandBy(e/this.getZoomLevel()).expand(i),o=i.clone().translate({x:(s.center.x-i.center.x)*2,y:(s.center.y-i.center.y)*2});this.zoomToBounds(o,t)}}zoomToBounds(e,t){const n=this._cameraOptions.__unsafe__getWithoutCapture();if(n.isLocked&&!t?.force)return this;const i=this.getViewportScreenBounds(),s=t?.inset??Math.min(NSe,i.width*.28),o=this.getBaseZoom(),a=n.zoomSteps[0],l=Xn(n.zoomSteps);let c=_e(Math.min((i.width-s)/e.w,(i.height-s)/e.h),a*o,l*o);return t?.targetZoom!==void 0&&(c=Math.min(t.targetZoom,c)),this.setCamera(new T(-e.x+(i.width-e.w*c)/2/c,-e.y+(i.height-e.h*c)/2/c,c),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:n,duration:i,start:s,end:o}=this._viewportAnimation;if(t>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new T(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}const a=i-t,l=n(1-a/i),c=s.minX+(o.minX-s.minX)*l,u=s.minY+(o.minY-s.minY)*l,d=s.maxX+(o.maxX-s.maxX)*l;this._setCamera(new T(-c,-u,this.getViewportScreenBounds().width/(d-c)),{force:!0})}_animateToViewport(e,t={animation:FE}){const{animation:n,...i}=t;if(!n)return;const{duration:s=0,easing:o=gr.easeInOutCubic}=n,a=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),s===0||a===0?this._setCamera(new T(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:s/a,easing:o,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!e?.force)return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:i,friction:s=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let l=Math.min(i,1);const c=()=>{this.off("tick",u),this.off("stop-camera-animation",c)};this.once("stop-camera-animation",c);const u=d=>{const{x:h,y:f,z:p}=this.getCamera(),m=T.Mul(o,l*d/p);l*=1-s,l<a?c():this._setCamera(new T(h+m.x,f+m.y,p))};return this.on("tick",u),this}zoomToUser(e,t={animation:{duration:500}}){const n=this.getCollaborators().find(s=>s.userId===e);if(!n)return this;const i=n.cursor;return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=n.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(n.currentPageId),t&&t.animation&&!s&&(t.animation=void 0),this.centerOnPoint(i,t);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(e);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof V)e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);else{const a=e.getBoundingClientRect();e=new V(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}const n=[e.minY!==0,!Mn(document.body.scrollWidth,e.maxX,1),!Mn(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:i}=this;this._willSetInitialBounds=!1;const{screenBounds:s,insets:o}=this.getInstanceState();if(e.equals(s)&&n.every((a,l)=>a===o[l]))return this;if(i)this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this._setCamera(T.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:n,h:i}=this.getInstanceState().screenBounds;return new V(e,t,n,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new T(e.w/2,e.h/2)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:i,z:s}=this.getCamera();return new V(-n,-i,e/s,t/s)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ci),{x:n,y:i,z:s=1}=this.getCamera();return new T((e.x-t.x)/s-n,(e.y-t.y)/s-i,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ci),{x:n,y:i,z:s=1}=this.getCamera();return new T((e.x+n)*s+t.x,(e.y+i)*s+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:n,z:i=1}=this.getCamera();return new T((e.x+t)*i,(e.y+n)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(n=>n.userId))].sort().map(n=>Ime(e.filter(s=>s.userId===n),s=>s.lastActivityTimestamp??0)):gn}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){if(this.stopFollowingUser(),this.user.getId()||console.warn("You should set the userId for the current instance before following a user"),!this._getFollowingPresence(e))return this;const i=q("latestLeaderPresence",()=>this._getFollowingPresence(e));return hs(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const s=Zi("update current page",()=>{const l=i.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),o=()=>{s(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",o)},a=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const c=this.user.getAnimationSpeed();if(c===0){this._isLockedOnFollowingUser.set(!0);return}const u=this.getViewportPageBoundsForFollowing();if(!u){this.stopFollowingUser();return}const d=this.getViewportPageBounds(),h=Math.abs(u.minX-d.minX)+Math.abs(u.maxX-d.maxX),f=Math.abs(u.minY-d.minY)+Math.abs(u.maxY-d.maxY);if(h<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const p=_e(c*.5,.1,.8),m=new V(Ye(d.minX,u.minX,p),Ye(d.minY,u.minY,p),Ye(d.width,u.width,p),Ye(d.height,u.height,p)),g=new T(-m.x,-m.y,this.getViewportScreenBounds().width/m.width);this.stopCameraAnimation(),this._setCamera(g)};this.once("stop-following",o),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let n=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),o=(l,c,u)=>{const d=this.getShape(l);if(!d)return;if(this.isShapeHidden(d)){const g=u||s.includes(l);for(const y of this.getSortedChildIdsForParent(l))o(y,c,g);return}c*=d.opacity;let h=!1;const f=this.getShapeUtil(d);e&&(h=!u&&s.includes(l),h&&(c*=.32)),t.push({id:l,shape:d,util:f,index:n,backgroundIndex:i,opacity:c}),n+=1,i+=1;const p=this.getSortedChildIdsForParent(l);if(!p.length)return;let m=null;f.providesBackgroundForChildren(d)&&(m=i,i=n,n+=this.options.maxShapesPerPage);for(const g of p)o(g,c,u||h);m!==null&&(i=m)},a=e?[this.getCurrentPage()]:this.getPages();for(const l of a)for(const c of this.getSortedChildIdsForParent(l.id))o(c,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(Xme)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(Fn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map(i=>i.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,n=>({...n,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),n=Cbe(e.name??"Page 1",t.map(o=>o.name));let i=e.index;(!i||t.some(o=>o.index===i))&&(i=_s(t[t.length-1].index));const s=Ci.create({meta:{},...e,name:n,index:i});this.store.put([s])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const n=this.getPages();if(n.length===1)return;const i=this.getPage(t);if(!i)return;if(t===this.getCurrentPageId()){const o=n.findIndex(l=>l.id===t),a=n[o-1]??n[o+1];this.setCurrentPage(a.id)}const s=this.getSortedChildIdsForParent(i.id);this.deleteShapes(s),this.store.remove([i.id])},{ignoreShapeLock:!0}),this}duplicatePage(e,t=Ci.createId()){if(this.getPages().length>=this.options.maxPages)return this;const n=typeof e=="string"?e:e.id,i=this.getPage(n);if(!i)return this;const s={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.run(()=>{const a=this.getPages(),l=Pf(i.index,a[a.indexOf(i)+1]?.index);if(this.createPage({name:i.name+" Copy",id:t,index:l}),this.setCurrentPage(t),this.setCamera(s),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t){const n=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:n,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(n=>n.id);return t.length<=0?this:(this.run(()=>{this.store.props.assets.remove?.(t),this.store.remove(t)},{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const n=this.getAsset(e);if(!n)return null;const{screenScale:i=1,shouldResolveToOriginal:s=!1,dpr:o=this.getInstanceState().devicePixelRatio}=t,l=(u=>Math.pow(2,Math.ceil(Math.log2(u))))(i),c="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(n,{screenScale:i||1,steppedScreenScale:l,dpr:o,networkEffectiveType:c,shouldResolveToOriginal:s})}async uploadAsset(e,t,n){return await this.store.props.assets.upload(e,t,n)}getShapeGeometry(e,t){const n=t?.context??"none";return this._shapeGeometryCaches[n]||(this._shapeGeometryCaches[n]=this.store.createComputedCache("bounds",i=>(this.fonts.trackFontsForShape(i),this.getShapeUtil(i).getGeometry(i,t)),{areRecordsEqual:UP})),this._shapeGeometryCaches[n].get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e),{areRecordsEqual:UP})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return J.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Gn(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??J.Identity();return J.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,n=this.getShape(t);return!n||Gn(n.parentId)?J.Identity():this._getShapePageTransformCache().get(n.parentId)??J.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??J.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this.getShapePageTransform(e);if(t)return V.FromPoints(t.applyToPoints(this.getShapeGeometry(e).boundsVertices))})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const n=this._getShapePageTransformCache().get(e.id);return n?`polygon(${J.applyToPoints(J.Inverse(n),t).map(s=>`${s.x}px ${s.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Gn(e.parentId))return;const t=[];for(const i of this.getShapeAncestors(e.id)){const s=this.getShapeUtil(i),o=s.getClipPath?.(i);if(!o||s.shouldClipChild?.(e)===!1)continue;const a=this.getShapePageTransform(i.id);t.push(a.applyToPoints(o))}return t.length===0?void 0:t.reduce((i,s)=>{const o=fv(i,s);return o?o.map(T.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const n=this._getShapeMaskCache().get(e.id);if(n){if(n.length===0)return;const{corners:i}=t;if(i.every((o,a)=>o&&T.Equals(o,n[a])))return t.clone();const s=fv(n,i);return s?V.FromPoints(s):void 0}return t})}getShapeAncestors(e,t=[]){const n=typeof e=="string"?e:e.id,i=this.getShape(n);if(!i)return t;const s=i.parentId;if(Gn(s))return t.reverse(),t;const o=this.store.get(s);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){const n=typeof e=="string"?e:e.id,i=this.getShape(n);if(!i)return;const s=i.parentId;if(Gn(s))return;const o=this.getShape(s);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){const n=typeof e=="string"?e:e?.id,i=n&&this.getShape(n);return i?i.parentId===t?!0:this.hasAncestor(this.getShapeParent(i),t):!1}findCommonAncestor(e,t){if(e.length===0)return;const n=typeof e[0]=="string"?e:e.map(l=>l.id),i=Re(n.map(l=>this.getShape(l)));if(i.length===1){const l=i[0].parentId;return Gn(l)?void 0:t?this.findShapeAncestor(i[0],t)?.id:l}const[s,...o]=i;let a=this.getShapeParent(s);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(o.every(l=>this.hasAncestor(l,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const t=e&&this.getShape(e);return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}getNotVisibleShapes(){return this._notVisibleShapes.get()}getCulledShapes(){const e=this.getNotVisibleShapes(),t=this.getSelectedShapeIds(),n=this.getEditingShapeId(),i=new Set(e);return n&&i.delete(n),t.forEach(s=>{i.delete(s)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const n=this.getShapeMaskedPageBounds(t);n&&(e?e=e.expand(n):e=n.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(n=>n.type!=="group"&&t.includes(n.id)).reverse().find(n=>this.isPointInShape(n,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const n=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:s,margin:o=0,hitLocked:a=!1,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:u=!1}=t,[d,h]=Array.isArray(o)?o:[o,o];let f=1/0,p=null,m=1/0,g=null;const y=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(S=>{if(S.isLocked&&!a||this.isShapeHidden(S)||this.isShapeOfType(S,"group"))return!1;const w=this.getShapeMask(S);return!(w&&!hi(e,w)||s&&!s(S))});for(let S=y.length-1;S>=0;S--){const w=y[S],b=this.getShapeGeometry(w),v=b instanceof ts,C=this.getPointInShapeSpace(w,e);if(this.isShapeOfType(w,"frame")||(this.isShapeOfType(w,"note")||this.isShapeOfType(w,"arrow")||this.isShapeOfType(w,"geo")&&w.props.fill==="none")&&this.getShapeUtil(w).getText(w)?.trim()){for(const M of b.children)if(M.isLabel&&M.isPointInBounds(C))return w}if(this.isShapeOfType(w,"frame")){const M=b.distanceToPoint(C,u);if(u?M>0&&M<=h||M<=0&&M>-d:M>0&&M<=h)return g||w;if(b.hitTestPoint(C,0,!0))return g||p||(u?w:void 0);continue}let E;if(v){let M=1/0;for(const P of b.children){if(P.isLabel&&!l)continue;const $=P.distanceToPoint(C,c);$<M&&(M=$)}E=M}else h===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(C,h)?E=b.distanceToPoint(C,c):E=1/0;if(b.isClosed){if(E<=h||c&&E<=0&&E>-d){if(b.isFilled||v&&b.children[0].isFilled)return g||w;if(this.getShapePageBounds(w).contains(i))continue;if(c?E>0&&E<=h||E<=0&&E>-d:Math.abs(E)<=Math.max(d,h))Math.abs(E)<m&&(m=Math.abs(E),g=w);else if(!g){const{area:M}=b;M<f&&(f=M,p=w)}}}else if(E<this.options.hitTestMargin/n)return w}return g||p||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapesSorted().filter(n=>!this.isShapeHidden(n)&&this.isPointInShape(n,e,t)).reverse()}isPointInShape(e,t,n={}){const{hitInside:i=!1,margin:s=0}=n,o=typeof e=="string"?e:e.id,a=this.getShapeMask(o);return a&&!hi(t,a)?!1:this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),s,i)}getPointInShapeSpace(e,t){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const n=typeof e=="string"?e:e.id,i=this.getShape(n);if(!i)return new T(0,0);if(Gn(i.parentId))return T.From(t);const s=this.getShapePageTransform(i.parentId);return s?s.clone().invert().applyToPoint(t):T.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let n=0,i=t.length;n<i;n++)zV(this,t[n],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const n=typeof e=="string"?this.getShape(e):e;return n?n.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(li(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e?.id;if(!t)return;const n=this.getShape(t);if(!(n===void 0||!li(n.parentId)))return this.getShape(n.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const n=typeof e=="string"?e:e.id,i=this.getShape(n);if(!i)return!1;let s=!1;if(i.parentId===t)s=!0;else{let o=this.getShape(i.parentId);e:for(;o;){if(o.parentId===t){s=!0;break e}o=this.getShape(o.parentId)}}return s}getAncestorPageId(e){const t=typeof e=="string"?e:e?.id,n=t&&this.getShape(t);if(n)return Gn(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}reparentShapes(e,t,n){const i=typeof e[0]=="string"?e:e.map(h=>h.id);if(i.length===0)return this;const s=[],o=Gn(t)?J.Identity():this.getShapePageTransform(t),a=o.rotation();let l=[];const c=Re(this.getSortedChildIdsForParent(t).map(h=>this.getShape(h)));if(n){const h=c.find(f=>f.index===n);if(h){const f=c[c.indexOf(h)+1];f?l=ld(n,f.index,i.length):l=IC(n,i.length)}else{const f=c.sort(Fn).find(p=>p.index>n);f?l=ld(n,f.index,i.length):l=IC(n,i.length)}}else{const h=c.length&&c[c.length-1];l=h?IC(h.index,i.length):Py(i.length)}const u=o.clone().invert(),d=Re(i.map(h=>this.getShape(h))).sort(Fn);return this.run(()=>{for(let h=0;h<d.length;h++){const f=d[h],p=this.getShapePageTransform(f);if(!p)continue;const m=p.point();if(!m)continue;const g=u.applyToPoint(m),y=p.rotation()-a;if(f.id===t)throw Error("Attempted to reparent a shape to itself!");s.push({id:f.id,type:f.type,parentId:t,x:g.x,y:g.y,rotation:y,index:l[h]})}this.updateShapes(s)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,n=this._parentIdsToChildIds.get()[t];if(!n||n.length===0)return _s(FO);const i=this.getShape(n[n.length-1]);return _s(i.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,n=this._parentIdsToChildIds.get()[t];return n||gn}visitDescendants(e,t){const n=this.getSortedChildIdsForParent(e);for(const i of n)t(i)!==!1&&this.visitDescendants(i,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const n of e.map(i=>this.getShape(i)).sort(Fn))t.add(n.id),this.visitDescendants(n,i=>{t.add(i)});return t}getDraggingOverShape(e,t){const n=Re(t.map(s=>this.getShape(s))).filter(s=>!s.isLocked&&!this.isShapeHidden(s)),i=this.getShapesAtPoint(e,{hitInside:!0,margin:0}).filter(s=>!t.includes(s)&&!s.isLocked&&!this.isShapeHidden(s)&&!n.includes(s));for(const s of i){const o=this.getShapeUtil(s);if(o.onDragShapesOver||o.onDragShapesIn||o.onDragShapesOut||o.onDropShapesOver)return s}}getOutermostSelectableShape(e,t){const n=typeof e=="string"?e:e.id,i=this.getShape(n);let s=i,o=i;const a=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&a?.id!==o.id&&!this.hasAncestor(a,o.id)&&(t?.(o)??!0))s=o;else if(a?.id===o.id)break;o=this.getShapeParent(o)}return s}_getBindingsIndexCache(){const e=Pbe(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id),{areRecordsEqual:()=>!0})}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const n=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(n).filter(i=>i.fromId===n&&i.type===t)}getBindingsToShape(e,t){const n=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(n).filter(i=>i.toId===n&&i.type===t)}getBindingsInvolvingShape(e,t){const n=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(n)??gn;return t?i.filter(s=>s.type===t):i}createBindings(e){const t=[];for(const n of e){const i=this.getShape(n.fromId),s=this.getShape(n.toId);if(!i||!s||!this.canBindShapes({fromShape:i,toShape:s,binding:n}))continue;const a=this.getBindingUtil(n.type).getDefaultProps(),l=this.store.schema.types.binding.create({...n,id:n.id??Tu(),props:{...a,...n.props}});t.push(l)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const n of e){if(!n)continue;const i=this.getBinding(n.id);if(!i)continue;const s=Lo(i,n);if(s===i)continue;const o=this.getShape(s.fromId),a=this.getShape(s.toId);!o||!a||this.canBindShapes({fromShape:o,toShape:a,binding:s})&&t.push(s)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const n=e.map(i=>typeof i=="string"?i:i.id);return t?this.store.atomic(()=>{for(const i of n){const s=this.getBinding(i);if(!s)continue;const o=this.getBindingUtil(s);o.onBeforeIsolateFromShape?.({binding:s,removedShape:this.getShape(s.toId)}),o.onBeforeIsolateToShape?.({binding:s,removedShape:this.getShape(s.fromId)}),this.store.remove([i])}}):this.store.remove(n),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:n}){const i=typeof e=="string"?e:e.type,s=typeof t=="string"?t:t.type,o=typeof n=="string"?n:n.type,a={fromShapeType:i,toShapeType:s,bindingType:o};return i===s?this.getShapeUtil(i).canBind(a):this.getShapeUtil(i).canBind(a)&&this.getShapeUtil(s).canBind(a)}rotateShapesBy(e,t,n){const i=typeof e[0]=="string"?e:e.map(o=>o.id);if(i.length<=0)return this;const s=cK({editor:this,ids:i});return s?(Ib({delta:t,snapshot:s,editor:this,stage:"one-off",centerOverride:n?.center}),this):this}getChangesToTranslateShape(e,t){let n=e;const i=this.getShapeUtil(e),s=i.onTranslateStart?.(n);s&&(n=Lo(n,s)),n=Lo(n,{id:e.id,type:e.type,x:t.x,y:t.y});const o=i.onTranslate?.(e,n);o&&(n=Lo(n,o));const a=i.onTranslateEnd?.(e,n);return a&&(n=Lo(n,a)),n}nudgeShapes(e,t){const n=typeof e[0]=="string"?e:e.map(s=>s.id);if(n.length<=0)return this;const i=[];for(const s of n){const o=this.getShape(s),a=T.From(t),l=this.getShapeParentTransform(o);l&&a.rot(-l.rotation()),i.push(this.getChangesToTranslateShape(o,a.add(o)))}return this.updateShapes(i),this}duplicateShapes(e,t){return this.run(()=>{const n=typeof e[0]=="string"?e:e.map(h=>h.id),i=this._shouldIgnoreShapeLock?n:this._getUnlockedShapeIds(n);if(i.length<=0)return this;const s=new Set(i),o=this.getShapeAndDescendantIds(i),a=[...o].reverse(),l=new Map;for(const h of o)l.set(h,Ct());const{shapesToCreateWithOriginals:c,bindingsToCreate:u}=Uj(this,o,h=>{const f=[];for(const m of h){const g=this.getBinding(m);if(!g)continue;const y=Tu();f.push({...g,id:y,fromId:Dn(l.get(g.fromId)),toId:Dn(l.get(g.toId))})}const p=[];for(const m of a){const g=Dn(l.get(m)),y=this.getShape(m);if(!y)continue;let S=0,w=0;if(t&&s.has(m)){const b=this.getShapeParentTransform(y),v=new T(t.x,t.y).rot(-b.rotation());S=v.x,w=v.y}p.push({shape:{...y,id:g,x:y.x+S,y:y.y+w,index:"a1",parentId:l.get(y.parentId)??y.parentId},originalShape:y})}return{shapesToCreateWithOriginals:p,bindingsToCreate:f}});c.forEach(({shape:h,originalShape:f})=>{const p=f.parentId,m=this.getSortedChildIdsForParent(p),g=m.indexOf(f.id),y=m[g+1],S=y?this.getShape(y):void 0,w=Pf(f.index,S?.index);h.index=w});const d=c.map(({shape:h})=>h);if(!this.canCreateShapes(d)){ew(this);return}if(this.createShapes(d),this.createBindings(u),this.setSelectedShapes(Re(i.map(h=>{const f=l.get(h);return!f||!this.getShape(f)?null:f}))),t!==void 0){const h=this.getSelectionPageBounds(),f=this.getViewportPageBounds();h&&!f.contains(h)&&this.centerOnPoint(h.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const n=typeof e[0]=="string"?e:e.map(a=>a.id);if(n.length===0)return this;if(this.getIsReadonly())return this;const i=this.getCurrentPageId();if(t===i)return this;if(!this.store.has(t))return this;const s=this.getContentFromCurrentPage(n);if(!s)return this;if(this.getPageShapeIds(t).size+s.shapes.length>this.options.maxShapesPerPage)return ew(this,t),this;const o=this.getCamera().z;return this.run(()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:o}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly()||t.length===0)return this;let n=!0,i=!0;const s=[];for(const o of t){const a=this.getShape(o);a&&(s.push(a),a.isLocked?i=!1:n=!1)}return this.run(()=>{i?(this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0}))),this.setSelectedShapes([])):n?this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!1}))):this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),n=ZS(this,"toBack",t,{considerAllShapes:!0});return n&&this.updateShapes(n),this}sendBackward(e,t={}){const n=typeof e[0]=="string"?e:e.map(s=>s.id),i=ZS(this,"backward",n,t);return i&&this.updateShapes(i),this}bringForward(e,t={}){const n=typeof e[0]=="string"?e:e.map(s=>s.id),i=ZS(this,"forward",n,t);return i&&this.updateShapes(i),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),n=ZS(this,"toFront",t);return n&&this.updateShapes(n),this}collectShapesViaArrowBindings(e){const{initialShapes:t,resultShapes:n,resultBounds:i,bindings:s,visited:o}=e;for(const a of s)for(const l of[a.fromId,a.toId])if(!o.has(l)){const c=t.find(u=>u.id===l);if(c&&!o.has(c.id)){o.add(c.id);const u=this.getShapePageBounds(c);if(!u)continue;n.push(c),i.push(u),this.collectShapesViaArrowBindings({...e,bindings:this.getBindingsInvolvingShape(c,"arrow")})}}}flipShapes(e,t){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(l=>l.id),i=Re(n.map(l=>this.getShape(l)));for(const l of i)if(this.isShapeOfType(l,"group")){const c=Re(this.getSortedChildIdsForParent(l.id).map(u=>this.getShape(u)));i.push(...c)}const s=[],o=[];for(const l of i){const c=this.getShapeUtil(l);if(!c.canBeLaidOut(l,{type:"flip",shapes:i}))continue;const u=this.getShapePageBounds(l),d=this.getShapeGeometry(l).bounds,h=this.getShapePageTransform(l.id);u&&d&&h&&(s.push({shape:l,localBounds:d,pageTransform:h,isAspectRatioLocked:c.isAspectRatioLocked(l)}),o.push(u))}if(!s.length)return this;const a=V.Common(o).center;return this.run(()=>{for(const{shape:l,localBounds:c,pageTransform:u,isAspectRatioLocked:d}of s)this.resizeShape(l.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:c,initialPageTransform:u,initialShape:l,isAspectRatioLocked:d,mode:"scale_shape",scaleOrigin:a,scaleAxisRotation:0})}),this}stackShapes(e,t,n){const i=n??this.options.adjacentShapeMargin,s=typeof e[0]=="string"?e:e.map(y=>y.id);if(this.getIsReadonly())return this;const o=Re(s.map(y=>this.getShape(y))),a=[],l=new Set;for(const y of o){if(l.has(y.id))continue;l.add(y.id);const S=this.getShapePageBounds(y);if(!S||!this.getShapeUtil(y).canBeLaidOut?.(y,{type:"stack",shapes:o}))continue;const w=[y],b=[S];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(y.id,"arrow"),initialShapes:o,resultShapes:w,resultBounds:b,visited:l});const v=V.Common(b);v&&a.push({shapes:w,pageBounds:v})}const c=a.length;if(i===0&&c<3||c<2)return this;let u,d,h,f;t==="horizontal"?(u="x",d="minX",h="maxX",f="width"):(u="y",d="minY",h="maxY",f="height");let p=0;if(i===0){const y={};a.sort((w,b)=>w.pageBounds[d]-b.pageBounds[d]);for(let w=0;w<c-1;w++){const b=a[w],C=a[w+1].pageBounds[d]-b.pageBounds[h];y[C]||(y[C]=0),y[C]++}let S=1;for(const[w,b]of Object.entries(y))b>S&&(S=b,p=parseFloat(w));if(S===1){let w=0;for(const[b,v]of Object.entries(y))p+=parseFloat(b)*v,w+=v;p/=w}}else p=i;const m=[];let g=a[0].pageBounds[h];for(let y=1;y<a.length;y++){const{shapes:S,pageBounds:w}=a[y],b=new T;b[u]=g+p-w[u];for(const v of S){const C=b.clone(),E=this.getShapeParent(v);if(E){const M=this.getShapePageTransform(E);M&&C.rot(-M.rotation())}C.add(v),m.push(this.getChangesToTranslateShape(v,C))}g+=w[f]+p}return this.updateShapes(m),this}packShapes(e,t){if(this.getIsReadonly())return this;const n=t??this.options.adjacentShapeMargin,i=typeof e[0]=="string"?e:e.map(v=>v.id),s=Re(i.map(v=>this.getShape(v))),o=[],a=[],l=new Set;for(const v of s){if(l.has(v.id))continue;l.add(v.id);const C=this.getShapePageBounds(v);if(!C||!this.getShapeUtil(v).canBeLaidOut?.(v,{type:"pack",shapes:s}))continue;const E=[v],M=[C];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(v.id,"arrow"),initialShapes:s,resultShapes:E,resultBounds:M,visited:l});const P=V.Common(M);P&&(o.push({shapes:E,pageBounds:P,nextPageBounds:P.clone()}),a.push(P))}if(o.length<2)return this;let c=0;for(const{pageBounds:v}of o)c+=v.width*v.height;const u=V.Common(a),d=u.width;o.sort((v,C)=>v.pageBounds.width-C.pageBounds.width).sort((v,C)=>v.pageBounds.height-C.pageBounds.height);const h=Math.max(Math.ceil(Math.sqrt(c/.95)),d),f=[new V(u.x,u.y,h,1/0)];let p=0,m=0,g,y;for(const{nextPageBounds:v}of o)for(let C=f.length-1;C>=0;C--)if(g=f[C],!(v.width>g.width||v.height>g.height)){v.x=g.x,v.y=g.y,m=Math.max(m,v.maxY),p=Math.max(p,v.maxX),v.width===g.width&&v.height===g.height?(y=f.pop(),C<f.length&&(f[C]=y)):v.height===g.height?(g.x+=v.width+n,g.width-=v.width+n):v.width===g.width?(g.y+=v.height+n,g.height-=v.height+n):(f.push(new V(g.x+(v.width+n),g.y,g.width-(v.width+n),v.height)),g.y+=v.height+n,g.height-=v.height+n);break}const S=V.Common(o.map(v=>v.nextPageBounds)),w=T.Sub(u.center,S.center),b=[];for(const{shapes:v,pageBounds:C,nextPageBounds:E}of o){const M=T.Sub(E.point,C.point).add(w);for(const P of v){const $=M.clone();if(this.getShapeParent(P)){const O=this.getShapeParentTransform(P);O&&$.rot(-O.rotation())}$.add(P),b.push(this.getChangesToTranslateShape(P,$))}}return b.length&&this.updateShapes(b),this}alignShapes(e,t){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(u=>u.id),i=Re(n.map(u=>this.getShape(u))),s=[],o=[],a=new Set;for(const u of i){if(a.has(u.id))continue;a.add(u.id);const d=this.getShapePageBounds(u);if(!d||!this.getShapeUtil(u).canBeLaidOut?.(u,{type:"align",shapes:i}))continue;const h=[u],f=[d];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(u.id,"arrow"),initialShapes:i,resultShapes:h,resultBounds:f,visited:a});const p=V.Common(f);p&&(s.push({shapes:h,pageBounds:p}),o.push(p))}if(s.length<2)return this;const l=V.Common(o),c=[];return s.forEach(({shapes:u,pageBounds:d})=>{const h=new T;switch(t){case"top":{h.y=l.minY-d.minY;break}case"center-vertical":{h.y=l.midY-d.minY-d.height/2;break}case"bottom":{h.y=l.maxY-d.minY-d.height;break}case"left":{h.x=l.minX-d.minX;break}case"center-horizontal":{h.x=l.midX-d.minX-d.width/2;break}case"right":{h.x=l.maxX-d.minX-d.width;break}}for(const f of u){const p=h.clone(),m=this.getShapeParent(f);if(m){const g=this.getShapePageTransform(m);g&&p.rot(-g.rotation())}p.add(f),c.push(this.getChangesToTranslateShape(f,p))}}),this.updateShapes(c),this}distributeShapes(e,t){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(w=>w.id),i=Re(n.map(w=>this.getShape(w))),s=[],o=new Set;for(const w of i){if(o.has(w.id))continue;o.add(w.id);const b=this.getShapePageBounds(w);if(!b||!this.getShapeUtil(w).canBeLaidOut?.(w,{type:"distribute",shapes:i}))continue;const v=[w],C=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(w.id,"arrow"),initialShapes:i,resultShapes:v,resultBounds:C,visited:o});const E=V.Common(C);E&&s.push({shapes:v,pageBounds:E})}if(s.length<3)return this;let a,l,c,u;t==="horizontal"?(a="x",l="minX",c="maxX",u="width"):(a="y",l="minY",c="maxY",u="height");const d=[],h=s.sort((w,b)=>w.pageBounds[l]-b.pageBounds[l])[0],f=s.sort((w,b)=>b.pageBounds[c]-w.pageBounds[c])[0];if(h===f){const w=new Set(h.shapes.map(b=>b.id));return this.distributeShapes(n.filter(b=>!w.has(b)),t)}const p=s.filter(w=>w!==h&&w!==f).sort((w,b)=>w.pageBounds[l]===b.pageBounds[l]?w.shapes[0].id<b.shapes[0].id?-1:1:w.pageBounds[l]-b.pageBounds[l]),m=h.pageBounds[c],g=f.pageBounds[l]-m,y=p.reduce((w,b)=>w+b.pageBounds[u],0),S=(g-y)/(p.length+1);for(let w=m+S,b=0;b<p.length;b++){const{shapes:v,pageBounds:C}=p[b],E=new T;E[a]=w-C[a],w+C[u]>f.pageBounds[c]-1&&(E[a]=f.pageBounds[c]-C[c]-1);for(const M of v){const P=E.clone(),$=this.getShapeParent(M);if($){const A=this.getShapePageTransform($);A&&P.rot(-A.rotation())}P.add(M),d.push(this.getChangesToTranslateShape(M,P))}w+=C[u]+S}return this.updateShapes(d),this}stretchShapes(e,t){const n=typeof e[0]=="string"?e:e.map(h=>h.id);if(this.getIsReadonly())return this;const i=Re(n.map(h=>this.getShape(h))).filter(h=>this.getShapePageTransform(h)?.rotation()%(pt/2)===0),s=[],o=[],a=new Set;for(const h of i){if(a.has(h.id))continue;a.add(h.id);const f=this.getShapePageBounds(h);if(!f)continue;const p=[h],m=[f];if(!this.getShapeUtil(h).canBeLaidOut?.(h,{type:"stretch"}))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(h.id,"arrow"),initialShapes:i,resultShapes:p,resultBounds:m,visited:a});const g=V.Common(m);g&&(s.push({shapes:p,pageBounds:g}),o.push(g))}if(s.length<2)return this;const l=V.Common(o);let c,u,d;return t==="horizontal"?(c="x",u="minX",d="width"):(c="y",u="minY",d="height"),this.run(()=>{s.forEach(({shapes:h,pageBounds:f})=>{const p=new T;p[c]=l[u]-f[u];const m=f.center.clone();m[c]=l[u];const g=new T(1,1);g[c]=l[d]/f[d];for(const y of h){const S=p.clone(),w=this.getShapeParentTransform(y);w&&p.rot(-w.rotation()),S.add(y);const b=this.getChangesToTranslateShape(y,S);this.updateShape(b),this.resizeShape(y.id,g,{initialBounds:this.getShapeGeometry(y).bounds,scaleOrigin:m,isAspectRatioLocked:this.getShapeUtil(y).isAspectRatioLocked(y),scaleAxisRotation:0})}})}),this}resizeShape(e,t,n={}){const i=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new T(1,t.y)),Number.isFinite(t.y)||(t=new T(t.x,1));const s=n.initialShape??this.getShape(i);if(!s)return this;const o=n.scaleOrigin??this.getShapePageBounds(i)?.center;if(!o)return this;const a=n.initialPageTransform?J.Cast(n.initialPageTransform):this.getShapePageTransform(i);if(!a)return this;const l=a.rotation();if(l==null)return this;const c=n.scaleAxisRotation??l,u=n.initialBounds??this.getShapeGeometry(i).bounds;if(!u)return this;const d=n.isAspectRatioLocked??this.getShapeUtil(s).isAspectRatioLocked(s);if(!lq(l,c))return this._resizeUnalignedShape(i,t,{...n,initialBounds:u,scaleOrigin:o,scaleAxisRotation:c,initialPageTransform:a,isAspectRatioLocked:d,initialShape:s});const h=this.getShapeUtil(s);d&&(Math.abs(t.x)>Math.abs(t.y)?t=new T(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new T(Math.sign(t.x)*Math.abs(t.y),t.y));let f=!1;if(h.onResize&&h.canResize(s)){const p=this._scalePagePoint(J.applyToPoint(a,new T(0,0)),o,t,c),m=this.getPointInParentSpace(s.id,p),g=new T(t.x,t.y),y=Mn((l-c)%Math.PI,0);g.x=y?t.x:t.y,g.y=y?t.y:t.x;const S=J.applyToPoint(a,new T),{x:w,y:b}=this.getPointInParentSpace(s.id,S);let v=s;n.skipStartAndEndCallbacks||(v=Lo(s,h.onResizeStart?.(s)??void 0));const C=h.onResize({...s,x:w,y:b},{newPoint:m,handle:n.dragHandle??"bottom_right",mode:n.mode??"scale_shape",scaleX:g.x,scaleY:g.y,initialBounds:u,initialShape:s});C&&(f=!0),v=Lo(v,{id:i,type:s.type,x:m.x,y:m.y,...C}),n.skipStartAndEndCallbacks||(v=Lo(v,h.onResizeEnd?.(s,v)??void 0)),this.updateShapes([v])}if(!f){const p=J.applyToPoint(a,u.center),m=this._scalePagePoint(p,o,t,c),g=this.getPointInParentSpace(s.id,p),y=this.getPointInParentSpace(s.id,m),S=T.Sub(y,g);this.updateShapes([{id:i,type:s.type,x:s.x+S.x,y:s.y+S.y}])}return this}_scalePagePoint(e,t,n,i){const s=T.RotWith(e,t,-i).sub(t),o=T.MulV(s,n);return T.Add(o,t).rotWith(t,i)}_resizeUnalignedShape(e,t,n){const{type:i}=n.initialShape,s=new T(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?s.x=Math.sign(t.x)*Math.abs(t.y):s.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,s,{initialShape:n.initialShape,initialBounds:n.initialBounds,isAspectRatioLocked:n.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:g}=J.Decompose(n.initialPageTransform);g-=2*g,this.updateShapes([{id:e,type:i,rotation:g}])}const o=J.applyToPoint(n.initialPageTransform,n.initialBounds.center),a=this._scalePagePoint(o,n.scaleOrigin,t,n.scaleAxisRotation),l=this.getShapePageBounds(e),c=this.getShapePageTransform(e),u=l.center,d=c.point();if(!u||!d)return this;const h=T.Sub(a,u),f=T.Add(d,h),{x:p,y:m}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:i,x:p,y:m}]),this}getInitialMetaForShape(e){return{}}canCreateShape(e){return this.canCreateShapes([e])}canCreateShapes(e){return e.length+this.getCurrentPageShapeIds().size<=this.options.maxShapesPerPage}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return ew(this),this;const i=this.getFocusedGroupId();return this.run(()=>{const s=this.getCurrentPageShapesSorted(),o=e.map(u=>{if(u.id||(u={id:Ct(),...u}),!u.parentId||!(this.store.has(u.parentId)||e.some(d=>d.id===u.parentId))){let d=this.getFocusedGroupId();if(u.x!==void 0&&u.y!==void 0)for(let p=s.length-1;p>=0;p--){const m=s[p];if(this.getShapeUtil(m).canReceiveNewChildrenOfType(m,u.type)&&!this.isShapeHidden(m)&&this.isPointInShape(m,{x:u.x??0,y:u.y??0},{margin:0,hitInside:!0})){d=m.id;break}}const f=u.parentId;if(d===u.id&&(d=i),d!==f&&(u={...u},u.parentId=d,li(d))){const p=this.getPointInShapeSpace(this.getShape(d),{x:u.x??0,y:u.y??0});u.x=p.x,u.y=p.y,u.rotation=-this.getShapePageTransform(d).rotation()+(u.rotation??0)}}return u}),a=new Map,l=[],{opacityForNextShape:c}=this.getInstanceState();for(const u of o){const d=this.getShapeUtil(u);let h=u.index;if(!h){const g=u.parentId??i;a.has(g)||a.set(g,this.getHighestIndexForParent(g)),h=a.get(g),a.set(g,_s(h))}const f=d.getDefaultProps();for(const[g,y]of this.styleProps[u.type])f[y]=this.getStyleForNextShape(g);let p=this.store.schema.types.shape.create({...u,index:h,opacity:u.opacity??c,parentId:u.parentId??i,props:"props"in u?{...f,...u.props}:f});if(p.index===void 0)throw Error("no index!");const m=this.getShapeUtil(p).onBeforeCreate?.(p);m&&(p=m),l.push(p)}l.forEach(u=>{u.meta={...this.getInitialMetaForShape(u),...u.meta}}),this.emit("created-shapes",l),this.emit("edit"),this.store.put(l)}),this}animateShape(e,t={animation:FE}){return this.animateShapes([e],t)}animateShapes(e,t={animation:FE}){if(!t.animation)return this;const{duration:n=500,easing:i=gr.linear}=t.animation,s=ft();let o=n,a;const l=[];let c,u;for(let h=0,f=e.length;h<f;h++){if(c=e[h],!c)continue;const p=this.getShape(c.id);p&&(u={start:vn(p),end:Lo(vn(p),c)},l.push(u),this.animatingShapes.set(p.id,s))}const d=h=>{if(o-=h,o<0){const{animatingShapes:g}=this,y=e.filter(S=>S&&g.get(S.id)===s);y.length&&this.updateShapes(y),this.off("tick",d);return}a=i(1-o/n);const{animatingShapes:f}=this,p=[];let m;for(let g=0,y=l.length;g<y;g++){const{start:S,end:w}=l[g];m=f.get(S.id),m===s&&p.push({...w,x:S.x+(w.x-S.x)*a,y:S.y+(w.y-S.y)*a,opacity:S.opacity+(w.opacity-S.opacity)*a,rotation:S.rotation+(w.rotation-S.rotation)*a,props:this.getShapeUtil(w).getInterpolatedProps?.(S,w,a)??w.props})}this._updateShapes(p)};return this.on("tick",d),this}groupShapes(e,t={}){const{groupId:n=Ct(),select:i=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s=typeof e[0]=="string"?e:e.map(p=>p.id);if(s.length<=1)return this;const o=Re((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(p=>this.getShape(p))),a=o.sort(Fn).map(p=>p.id),l=V.Common(Re(o.map(p=>this.getShapePageBounds(p)))),{x:c,y:u}=l.point,d=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const h=o.filter(p=>p.parentId===d).sort(Fn),f=h[h.length-1]?.index;return this.run(()=>{this.createShapes([{id:n,type:"group",parentId:d,index:f,x:c,y:u,opacity:1,props:{}}]),this.reparentShapes(a,n),i&&this.select(n)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:n=!0}=t,i=typeof e[0]=="string"?e:e.map(l=>l.id),s=Re((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(l=>this.getShape(l)));if(s.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return s.forEach(l=>{this.isShapeOfType(l,"group")?a.push(l):o.add(l.id)}),a.length===0?this:(this.run(()=>{let l;for(let c=0,u=a.length;c<u;c++){l=a[c];const d=this.getSortedChildIdsForParent(l.id);for(let h=0,f=d.length;h<f;h++)o.add(d[h]);this.reparentShapes(d,l.parentId,l.index)}this.deleteShapes(a.map(c=>c.id)),n&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let n=0,i=e.length;n<i;n++){const s=e[n];if(!s)continue;const o=this.getShape(s.id);if(o){if(!this._shouldIgnoreShapeLock){if(o.isLocked){if(!(Object.hasOwn(s,"isLocked")&&!s.isLocked))continue}else if(this.isShapeOrAncestorLocked(o))continue}this.animatingShapes.delete(s.id),t.push(s)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{const t=[];let n,i;for(let s=0,o=e.length;s<o;s++){const a=e[s];a&&(n=this.getShape(a.id),n&&(i=Lo(n,a),i!==n&&(i=this.getShapeUtil(n).onBeforeUpdate?.(n,i)??i,t.push(i))))}this.emit("edited-shapes",t),this.emit("edit"),this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>!this.getShape(t)?.isLocked)}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(s=>s.id),n=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(n.length===0)return this;const i=new Set(n);for(const s of n)this.visitDescendants(s,o=>{i.add(o)});return this.emit("deleted-shapes",[...i]),this.emit("edit"),this.run(()=>this.store.remove([...i]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const n=this._parentIdsToChildIds.get()[e.id];if(!n)return;for(let i=0,s=n.length;i<s;i++)this._extractSharedStyles(this.getShape(n[i]),t)}else for(const[n,i]of this.styleProps[e.type])t.applyValue(n,Cn(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new WP;for(const n of e)this._extractSharedStyles(n,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const n=this.styleProps[e.type].get(t);if(n!==void 0)return Cn(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new WP;if(!e)return t;if(e.shapeType)if(e.shapeType==="frame"&&!this.getShapeUtil("frame").options.showColors)for(const n of this.styleProps[e.shapeType].keys())n.id!=="tldraw:color"&&t.applyValue(n,this.getStyleForNextShape(n));else for(const n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=i=>{const s=this.getShape(i);if(s)if(this.isShapeOfType(s,"group"))for(const o of this.getSortedChildIdsForParent(s.id))t(o);else e.push(s)};for(const i of this.getSelectedShapeIds())t(i);let n=null;for(const i of e)if(n===null)n=i.opacity;else if(n!==i.opacity)return{type:"mixed"};if(n!==null)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const n=[],i=s=>{if(this.isShapeOfType(s,"group")){const o=this.getSortedChildIdsForParent(s);for(const a of o)i(this.getShape(a))}else n.push(s)};for(const s of t)i(s);this.updateShapes(n.map(s=>({id:s.id,type:s.type,opacity:e})))}return this}setStyleForNextShapes(e,t,n){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t){const n=this.getSelectedShapes();if(n.length>0){const i=[],s=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o.id);for(const l of a)s(this.getShape(l))}else{const a=this.getShapeUtil(o),l=this.styleProps[o.type].get(e);if(l){const c={id:o.id,type:o.type,props:{[l]:t}};i.push({util:a,originalShape:o,updatePartial:c})}}};for(const o of n)s(o);this.updateShapes(i.map(({updatePartial:o})=>o))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const n=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,n),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(n)},this.options.temporaryAssetPreviewLifetimeMs),n}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e,t={}){if(!(!t.force&&this.getIsReadonly()))return this.externalContentHandlers[e.type]?.(e)}async replaceExternalContent(e,t={}){if(!(!t.force&&this.getIsReadonly()))return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);if(!t||t.length===0)return;const n=this.getShapeAndDescendantIds(t);return Uj(this,n,i=>{const s=[];for(const u of i){const d=this.getBinding(u);d&&s.push(d)}const o=[],a=[];for(const u of n){const d=this.getShape(u);if(!d)continue;if(!n.has(d.parentId)){const f=this.getShapePageTransform(d.id),p=f.point();a.push({...d,x:p.x,y:p.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),o.push(d.id)}else a.push(d)}const l=[],c=new Set;for(const u of a){if(!("assetId"in u.props))continue;const d=u.props.assetId;if(!d||c.has(d))continue;c.add(d);const h=this.getAsset(d);h&&l.push(h)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:o,bindings:s,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async n=>{if((n.type==="image"||n.type==="video")&&!n.props.src?.startsWith("data:image")&&!n.props.src?.startsWith("data:video")&&!n.props.src?.startsWith("http")){const i=vn(n),s=await this.store.props.assets.resolve(n,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});i.props.src=await mr.blobToDataUrl(await Ua(s).then(o=>o.blob())),t.push(i)}else t.push(n)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:n=!1,preserveIds:i=!1,preservePosition:s=!1}=t;let{point:o=void 0}=t;const a=this.getCurrentPageId(),{rootShapeIds:l}=e,c=[],u=[],d=[],h={store:{...Object.fromEntries(e.assets.map($=>[$.id,$])),...Object.fromEntries(e.shapes.map($=>[$.id,$])),...Object.fromEntries(e.bindings?.map($=>[$.id,$])??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(h);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const $ of Object.values(f.value))switch($.typeName){case"asset":{c.push($);break}case"shape":{u.push($);break}case"binding":{d.push($);break}}const p=new Map(i?u.map($=>[$.id,$.id]):u.map($=>[$.id,Ct()])),m=new Map(i?d.map($=>[$.id,$.id]):d.map($=>[$.id,Tu()]));let g=this.getCurrentPageId(),y=1/0,S=[];for(const $ of this.getSelectedShapes()){if(y===0)break;const A=this.isShapeOfType($,"frame"),O=this.getShapeAncestors($);A&&O.push($);const _=A?O.length+1:O.length;if(_<y)y=_,S=O,g=A?$.id:$.parentId;else if(_===y){if(S.length!==O.length)throw Error(`Ancestors: ${S.length} !== ${O.length}`);if(S.length===0){g=a;break}else{g=a;for(let I=0;I<S.length&&O[I]===S[I];I++)g=O[I].id}}}let w=!1;if(!Gn(g)){const $=this.getShape(g);if($){if(!this.getViewportPageBounds().includes(this.getShapePageBounds($)))g=a;else if(l.length===1){const A=u.find(O=>O.id===l[0]);this.isShapeOfType($,"frame")&&this.isShapeOfType(A,"frame")&&A.props.w===$?.props.w&&A.props.h===$?.props.h&&(w=!0)}}else g=a}w||(w=p.has(g)),w&&(g=this.getShape(g).parentId);let b=this.getHighestIndexForParent(g);const v=[],C=u.map($=>{const A=p.get($.id),O={...$,id:A};return l.includes($.id)&&(O.parentId=a,v.push(O)),p.has(O.parentId)?O.parentId=p.get($.parentId):(l.push(O.id),O.index=b,b=_s(b)),O});if(C.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return ew(this),this;const E=d.map($=>({...$,id:Dn(m.get($.id)),fromId:Dn(p.get($.fromId)),toId:Dn(p.get($.toId))})),M=[],P=[];for(const $ of c)this.store.has($.id)||(($.type==="image"&&$.props.src?.startsWith("data:image")||$.type==="video"&&$.props.src?.startsWith("data:video"))&&(P.push(vn($)),$.props.src=null),M.push($));return Promise.allSettled(P.map(async $=>{const A=await wbe($.props.src,$.props.name,$.props.mimeType??"image/png"),O=await this.getAssetForExternalContent({type:"file",file:A,assetId:$.id});if(!O){this.deleteAssets([$.id]);return}this.updateAssets([{...O,id:$.id}])})),this.run(()=>{M.length>0&&this.createAssets(M),this.createShapes(C),this.createBindings(E),n&&this.select(...v.map(I=>I.id)),g!==a&&this.reparentShapes(v.map(I=>I.id),g);const $=C.map(I=>this.getShape(I.id)),A=V.Common($.map(I=>this.getShapePageBounds(I)));if(o===void 0)if(Gn(g)){const I=this.getViewportPageBounds();s||I.includes(V.From(A))?o=A.center:o=I.center}else{const I=this.getShape(g);o=J.applyToPoint(this.getShapePageTransform(I),this.getShapeGeometry(I).bounds.center)}if(v.length===1){const I=v[0];if(this.isShapeOfType(I,"frame"))for(;this.getShapesAtPoint(o).some(R=>this.isShapeOfType(R,"frame")&&R.props.w===I.props.w&&R.props.h===I.props.h);)o.x+=A.w+16}const O=V.Common(Re(v.map(({id:I})=>this.getShapePageBounds(I)))).center,_=T.Sub(o,O);this.updateShapes(v.map(({id:I})=>{const R=this.getShape(I),B=this.getShapeParentTransform(I).decompose().rotation,U=T.Rot(_,-B);return{id:R.id,type:R.type,x:R.x+U.x,y:R.y+U.y}}))}),this}async getSvgElement(e,t={}){const n=e.length===0?this.getCurrentPageShapeIdsSorted():typeof e[0]=="string"?e:e.map(i=>i.id);if(n.length!==0)return dbe(this,n,t)}async getSvgString(e,t={}){const n=await this.getSvgElement(e,t);return n?{svg:new XMLSerializer().serializeToString(n.svg),width:n.width,height:n.height}:void 0}async toImage(e,t={}){const n={format:"png",scale:1,pixelRatio:t.format==="svg"?void 0:2,...t},i=await this.getSvgString(e,n);if(!i)throw new Error("Could not create SVG");switch(n.format){case"svg":return{blob:new Blob([i.svg],{type:"image/svg+xml"}),width:i.width,height:i.height};case"jpeg":case"png":case"webp":{const s=await ybe(i.svg,{type:n.format,quality:n.quality,pixelRatio:n.pixelRatio,width:i.width,height:i.height});if(!s)throw new Error("Could not construct image.");return{blob:s,width:i.width,height:i.height}}default:at(n.format)}}async toImageDataUrl(e,t={}){const{blob:n,width:i,height:s}=await this.toImage(e,t);return{url:await mr.blobToDataUrl(n),width:i,height:s}}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:n,previousPagePoint:i,currentScreenPoint:s,currentPagePoint:o,originScreenPoint:a,originPagePoint:l}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(ci),{x:u,y:d,z:h}=em(()=>this.getCamera()),f=e.point.x-c.x,p=e.point.y-c.y,m=e.point.z??.5;n.setTo(s),i.setTo(o),s.set(f,p);const g=f/h-u,y=p/h-d;isFinite(g)&&isFinite(y)&&o.set(g,y,m),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),a.setTo(s),l.setTo(o)),this.run(()=>{this.store.put([{id:ov,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===yj.CAMERA_MOVE?this.store.unsafeGetWithoutCapture(ov)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}updatePointer(e){const t={type:"pointer",target:"canvas",name:"pointer_move",point:e?.point??T.Add(this.inputs.currentScreenPoint,this.store.unsafeGetWithoutCapture(ci).screenBounds),pointerId:e?.pointerId??0,button:e?.button??0,isPen:e?.isPen??this.inputs.isPen,shiftKey:e?.shiftKey??this.inputs.shiftKey,altKey:e?.altKey??this.inputs.altKey,ctrlKey:e?.ctrlKey??this.inputs.ctrlKey,metaKey:e?.metaKey??this.inputs.metaKey,accelKey:e?.accelKey??zt(this.inputs)};return e?.immediate?this._flushEventForTick(t):this.dispatch(t),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return uwe(this.store)}loadSnapshot(e,t){return Aq(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=Re(e.shapeIds.map(o=>this.getShape(o))),n={};for(const o of t){const a=this.getAncestorPageId(o);a&&(n[a]??=[],n[a].push(o))}const[i,s]=Object.entries(n).sort(([o,a],[l,c])=>c.length-a.length)[0]??["",[]];if(!i||!s.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(i);const o=V.Common(s.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(o,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:at(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const n=new URL(e?.url??window.location.href).searchParams.get(e?.param??"d");if(!n)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(kbe(n))}catch(i){console.warn(i),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL(e?.url??window.location.href);return t.searchParams.set(e?.param??"d",vbe(e?.to??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e?.getUrl&&!e?.onChange)throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=q("url with state",()=>{const o=e?.getUrl?.(this)??window.location.href;return this.createDeepLink({param:e?.param,url:o,to:e?.getTarget?.(this)}).toString()}),n=e?.onChange??(()=>{const o=this.createDeepLink({param:e?.param,to:e?.getTarget?.(this)});window.history.replaceState({},document.title,o.toString())}),i=n1(o=>o(),e?.debounceMs??500),s=Zi("update url on state change",()=>n(new URL(t.get()),this),{scheduleEffect:i});return()=>{s(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:zt(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:zt(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:zt(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:zt(this.inputs),code:"MetaLeft"})}markEventAsHandled(e){const t="nativeEvent"in e?e.nativeEvent:e;this.handledEvents.add(t)}wasEventAlreadyHandled(e){const t="nativeEvent"in e?e.nativeEvent:e;return this.handledEvents.has(t)}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const n of t)this._flushEventForTick(n)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;this.emit("before-event",e);const{inputs:t}=this,{type:n}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:i,currentPagePoint:s}=t;t.isPointing||(t.isDragging=!1);const o=this.store.unsafeGetWithoutCapture(ci),a=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(n){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:c=1},delta:{x:u,y:d}}=e,{x:h,y:f}=T.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:p,y:m,z:g}=em(()=>this.getCamera()),{panSpeed:y}=l;this._setCamera(new T(p+u*y/g-h/g+h/c,m+d*y/g-f/g+f/c,c),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,c.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(c)}));return}}}case"wheel":{if(l.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:c,zoomSpeed:u}=l;let d=l.wheelBehavior;const h=this.user.getUserPreferences().inputMode;if(h!==null&&(d=h==="trackpad"?"pan":"zoom"),d!=="none"){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:f,y:p,z:m}=em(()=>this.getCamera()),{x:g,y,z:S=0}=e.delta;let w=d;switch(e.ctrlKey&&(w=d==="pan"?"zoom":"pan"),w){case"zoom":{const{x:b,y:v}=this.inputs.currentScreenPoint;let C=S;d==="zoom"&&(Math.abs(y)>10?C=10*Math.sign(y)/100:C=y/100);const E=m+(C??0)*u*m;this._setCamera(new T(f+b/E-b/m,p+v/E-v/m,E),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new T(f+g*c/m,p+y*c/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:c}=e,{isPenMode:u}=o;switch(e.name){case"pointer_down":{if(u&&!c)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const d=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(d.x,d.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===xj&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!u&&c&&this.updateInstanceState({isPenMode:!0}),e.button===Sj?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===VS&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!c&&u)return;const{x:d,y:h,z:f}=em(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:p,previousScreenPoint:m}=this.inputs,g=T.Sub(p,m);this.setCamera(new T(d+g.x/f,h+g.y/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&T.Dist2(i,s)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),o.isPenMode&&!c)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const d=this.inputs.pointerVelocity,h=Math.min(2,d.len());switch(e.button){case xj:{this.setCursor({type:"grab",rotation:0});break}case VS:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}h>0&&this.slideCamera({speed:h,direction:d})}else e.button===Sj&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let c;switch(e.code){case"ArrowUp":{c=new T(0,-1);break}case"ArrowRight":{c=new T(1,0);break}case"ArrowDown":{c=new T(0,1);break}case"ArrowLeft":{c=new T(-1,0);break}}if(c){const u=this.getViewportPageBounds(),d=u.clone().translate(c.mulV({x:u.w,y:u.h}));this._animateToViewport(d,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(VS)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===VS?e.name="middle_click":e.button===CN&&(e.name="right_click");const{isPenMode:c}=this.store.unsafeGetWithoutCapture(ci);if(e.isPen===c){const u=this._clickManager.handlePointerEvent(e);if(e.name!==u.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(u),this.emit("event",u);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){Yt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}};te=J0e(HP);re(te,1,"getIsShapeHiddenCache",FV,ee);re(te,1,"getCanUndo",DV,ee);re(te,1,"getCanRedo",_V,ee);re(te,1,"getPath",NV,ee);re(te,1,"getCurrentTool",OV,ee);re(te,1,"getCurrentToolId",RV,ee);re(te,1,"getDocumentSettings",$V,ee);re(te,1,"getInstanceState",AV,ee);re(te,1,"getPageStates",PV,ee);re(te,1,"_getPageStatesQuery",IV,ee);re(te,1,"getCurrentPageState",MV,ee);re(te,1,"_getCurrentPageStateId",EV,ee);re(te,1,"getSelectedShapeIds",TV,ee);re(te,1,"getSelectedShapes",CV,ee);re(te,1,"getCurrentPageShapesInReadingOrder",kV,ee);re(te,1,"getOnlySelectedShapeId",vV,ee);re(te,1,"getOnlySelectedShape",bV,ee);re(te,1,"getSelectionPageBounds",wV,ee);re(te,1,"getSelectionRotation",SV,ee);re(te,1,"getSelectionRotatedPageBounds",xV,ee);re(te,1,"getSelectionRotatedScreenBounds",yV,ee);re(te,1,"getFocusedGroupId",gV,ee);re(te,1,"getFocusedGroup",mV,ee);re(te,1,"getEditingShapeId",pV,ee);re(te,1,"getEditingShape",fV,ee);re(te,1,"getRichTextEditor",hV,ee);re(te,1,"getHoveredShapeId",dV,ee);re(te,1,"getHoveredShape",uV,ee);re(te,1,"getHintingShapeIds",cV,ee);re(te,1,"getHintingShape",lV,ee);re(te,1,"getErasingShapeIds",aV,ee);re(te,1,"getErasingShapes",oV,ee);re(te,1,"_unsafe_getCameraId",sV,ee);re(te,1,"getCamera",iV,ee);re(te,1,"getViewportPageBoundsForFollowing",rV,ee);re(te,1,"getCameraForFollowing",nV,ee);re(te,1,"getZoomLevel",tV,ee);re(te,1,"getViewportScreenBounds",eV,ee);re(te,1,"getViewportScreenCenter",QJ,ee);re(te,1,"getViewportPageBounds",ZJ,ee);re(te,1,"_getCollaboratorsQuery",XJ,ee);re(te,1,"getCollaborators",YJ,ee);re(te,1,"getCollaboratorsOnCurrentPage",GJ,ee);re(te,1,"getRenderingShapes",VJ,ee);re(te,1,"_getAllPagesQuery",JJ,ee);re(te,1,"getPages",KJ,ee);re(te,1,"getCurrentPageId",qJ,ee);re(te,1,"getCurrentPageShapeIdsSorted",HJ,ee);re(te,1,"_getAllAssetsQuery",WJ,ee);re(te,1,"_getShapeHandlesCache",UJ,ee);re(te,1,"_getShapePageTransformCache",LJ,ee);re(te,1,"_getShapePageBoundsCache",jJ,ee);re(te,1,"_getShapeClipPathCache",BJ,ee);re(te,1,"_getShapeMaskCache",zJ,ee);re(te,1,"_getShapeMaskedPageBoundsCache",FJ,ee);re(te,1,"getNotVisibleShapes",DJ,ee);re(te,1,"getCulledShapes",_J,ee);re(te,1,"getCurrentPageBounds",NJ,ee);re(te,1,"getCurrentPageShapes",OJ,ee);re(te,1,"getCurrentPageShapesSorted",RJ,ee);re(te,1,"getCurrentPageRenderingShapesSorted",$J,ee);re(te,1,"_getBindingsIndexCache",AJ,ee);re(te,1,"_getSelectionSharedStyles",PJ,ee);re(te,1,"getSharedStyles",IJ,ee);re(te,1,"getSharedOpacity",MJ,ee);re(te,1,"getIsFocused",EJ,ee);re(te,1,"getIsReadonly",TJ,ee);re(te,1,"_setShiftKeyTimeout",CJ,ee);re(te,1,"_setAltKeyTimeout",kJ,ee);re(te,1,"_setCtrlKeyTimeout",vJ,ee);re(te,1,"_setMetaKeyTimeout",bJ,ee);G0e(te,ee);function ew(r,e=r.getCurrentPageId()){const t=r.getPage(e).name;r.emit("max-shapes",{name:t,pageId:e,count:r.options.maxShapesPerPage})}function Lo(r,e){if(!e)return r;let t=null;const n=Object.entries(e);for(let i=0,s=n.length;i<s;i++){const[o,a]=n[i];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==r[o]){if(t||(t={...r}),o==="props"||o==="meta"){t[o]={...r[o]};for(const[l,c]of Object.entries(a))t[o][l]=c;continue}t[o]=a}}return t||r}function zV(r,e,t){const n=r.getShape(e);if(!n)return;t.push(n);const i=r.getSortedChildIdsForParent(e);for(let s=0,o=i.length;s<o;s++)zV(r,i[s],t)}function Uj(r,e,t){let n;if(r.run(()=>{const i=r.store.extractingChanges(()=>{const s=new Set,o=new Set;for(const a of e)if(r.getShape(a))for(const c of r.getBindingsInvolvingShape(a)){const u=e.has(c.fromId),d=e.has(c.toId);if(u&&d){s.add(c.id);continue}(!u||!d)&&o.add(c.id)}r.deleteBindings([...o],{isolateShapes:!0});try{n=Go.ok(t(s))}catch(a){n=Go.err(a)}});r.store.applyDiff(IP(i),{runCallbacks:!1})},{history:"ignore"}),n.ok)return n.value;throw n.error}function Wj(r,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:n}}=e.constraints,i=r.getViewportScreenBounds(),s=V.From(e.constraints.bounds),o=(i.w-t*2)/s.w,a=(i.h-n*2)/s.h;return{zx:o,zy:a}}function P1(){const r=z(),e=dS();return F("isDarkMode",()=>e?.isDarkMode??r.user.getIsDarkMode(),[e,r])}const Hj="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",qj="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",tw='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function ll(r,e,t,n,i,s=16,o=16){const a=(-t-e)*(pt/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${n?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+r.replaceAll('"',"'")+`</g></svg>") ${s} ${o}, pointer`}const X0e=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],Z0e={none:()=>"none","ew-resize":(r,e,t)=>ll(qj,r,0,e,t),"ns-resize":(r,e,t)=>ll(qj,r,90,e,t),"nesw-resize":(r,e,t)=>ll(Hj,r,0,e,t),"nwse-resize":(r,e,t)=>ll(Hj,r,90,e,t),"nwse-rotate":(r,e,t)=>ll(tw,r,0,e,t),"nesw-rotate":(r,e,t)=>ll(tw,r,90,e,t),"senw-rotate":(r,e,t)=>ll(tw,r,180,e,t),"swne-rotate":(r,e,t)=>ll(tw,r,270,e,t)};function as(r,e=0,t="black"){return Z0e[r](PSe(e),!1,t)}function Q0e(){const r=z(),e=Pn(),t=P1();cd("useCursor",()=>{const{type:n,rotation:i}=r.getInstanceState().cursor;if(X0e.includes(n)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${n})`);return}e.style.setProperty("--tl-cursor",as(n,i,t?"white":"black"))},[r,e,t])}function eve(){const r=z(),e=Pn(),t=P1(),n=F(Yt.forceSrgb);Be.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),n?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[r,e,n,t])}function tve(){const[r,e]=k.useState(0);k.useEffect(()=>e(t=>t+1),[])}const nve=r=>r.props.src,rve={upload:async(r,e)=>({src:await mr.blobToDataUrl(e)})};function ive(r){return"schema"in r&&r.schema?r.schema:SSe({shapes:"shapeUtils"in r&&r.shapeUtils?Kj(Fq(r.shapeUtils)):void 0,bindings:"bindingUtils"in r&&r.bindingUtils?Kj(Rq(r.bindingUtils)):void 0,migrations:"migrations"in r?r.migrations:void 0})}function mv({initialData:r,defaultName:e="",id:t,assets:n=rve,onMount:i,collaboration:s,...o}={}){const a=ive(o),l=new dN({id:t,schema:a,initialData:r,props:{defaultName:e,assets:{upload:n.upload,resolve:n.resolve??nve,remove:n.remove??(()=>Promise.resolve())},onMount:c=>{se(c instanceof ee),i?.(c)},collaboration:s}});if(o.snapshot){if(r)throw new Error("Cannot provide both initialData and snapshot");Aq(l,o.snapshot,{forceOverwriteSessionState:!0})}return l}function Kj(r){return Object.fromEntries(r.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const sve=(r,e)=>e.some(t=>r instanceof t);let Jj,Vj;function ove(){return Jj||(Jj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ave(){return Vj||(Vj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const BV=new WeakMap,qP=new WeakMap,jV=new WeakMap,VE=new WeakMap,UN=new WeakMap;function lve(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(Ba(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&BV.set(t,r)}).catch(()=>{}),UN.set(e,r),e}function cve(r){if(qP.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});qP.set(r,e)}let KP={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return qP.get(r);if(e==="objectStoreNames")return r.objectStoreNames||jV.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ba(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function uve(r){KP=r(KP)}function dve(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(GE(this),e,...t);return jV.set(n,e.sort?e.sort():[e]),Ba(n)}:ave().includes(r)?function(...e){return r.apply(GE(this),e),Ba(BV.get(this))}:function(...e){return Ba(r.apply(GE(this),e))}}function hve(r){return typeof r=="function"?dve(r):(r instanceof IDBTransaction&&cve(r),sve(r,ove())?new Proxy(r,KP):r)}function Ba(r){if(r instanceof IDBRequest)return lve(r);if(VE.has(r))return VE.get(r);const e=hve(r);return e!==r&&(VE.set(r,e),UN.set(e,r)),e}const GE=r=>UN.get(r);function LV(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(r,e),a=Ba(o);return n&&o.addEventListener("upgradeneeded",l=>{n(Ba(o.result),l.oldVersion,l.newVersion,Ba(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function UV(r,{blocked:e}={}){const t=indexedDB.deleteDatabase(r);return e&&t.addEventListener("blocked",n=>e(n.oldVersion,n)),Ba(t).then(()=>{})}const fve=["get","getKey","getAll","getAllKeys","count"],pve=["put","add","delete","clear"],YE=new Map;function Gj(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(YE.get(e))return YE.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=pve.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||fve.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return n&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return YE.set(e,s),s}uve(r=>({...r,get:(e,t,n)=>Gj(e,t)||r.get(e,t,n),has:(e,t)=>!!Gj(e,t)||r.has(e,t)}));const mve="TLDRAW_DOCUMENT_v2",gve="TLDRAW_ASSET_STORE_v1",WV="TLDRAW_DB_NAME_INDEX_v2",rt={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function HV(r){const e=mve+r;return xve(e),await LV(e,4,{upgrade(t){t.objectStoreNames.contains(rt.Records)||t.createObjectStore(rt.Records),t.objectStoreNames.contains(rt.Schema)||t.createObjectStore(rt.Schema),t.objectStoreNames.contains(rt.SessionState)||t.createObjectStore(rt.SessionState),t.objectStoreNames.contains(rt.Assets)||t.createObjectStore(rt.Assets)}})}async function yve(r){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(h=>h.name):WN(),t=gve+r;if(!e.find(h=>h===t))return;const i=await LV(t,1,{upgrade(h){h.objectStoreNames.contains("assets")||h.createObjectStore("assets")}});if(!i.objectStoreNames.contains("assets"))return;const s=i.transaction(["assets"],"readonly"),o=s.objectStore("assets"),a=await o.getAllKeys(),l=await Promise.all(a.map(async h=>[h,await o.get(h)]));await s.done;const c=await HV(r),u=c.transaction([rt.Assets],"readwrite"),d=u.objectStore(rt.Assets);for(const[h,f]of l)d.put(f,h);await u.done,i.close(),c.close(),await UV(t)}class Ny{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){Ny.connectedInstances.add(this),this.getDbPromise=(async()=>(await yve(e),await HV(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Ey)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Ny.connectedInstances.delete(this))}tx(e,t,n){const i=(async()=>{se(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e),a=o.done.catch(l=>{if(!this.isClosed)throw l});try{return await n(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[rt.Records,rt.Schema,rt.SessionState],async t=>{const n=t.objectStore(rt.Records),i=t.objectStore(rt.Schema),s=t.objectStore(rt.SessionState);let o=e?(await s.get(e))?.snapshot:null;return o||(o=(await s.getAll()).sort((c,u)=>c.updatedAt-u.updatedAt).pop()?.snapshot),{records:await n.getAll(),schema:await i.get(rt.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:n,sessionStateSnapshot:i}){await this.tx("readwrite",[rt.Records,rt.Schema,rt.SessionState],async s=>{const o=s.objectStore(rt.Records),a=s.objectStore(rt.Schema),l=s.objectStore(rt.SessionState);for(const[c,u]of Object.entries(t.added))await o.put(u,c);for(const[c,u]of Object.values(t.updated))await o.put(u,u.id);for(const c of Object.keys(t.removed))await o.delete(c);a.put(e.serialize(),rt.Schema),i&&n?l.put({snapshot:i,updatedAt:Date.now(),id:n},n):(i||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:n,sessionStateSnapshot:i}){await this.tx("readwrite",[rt.Records,rt.Schema,rt.SessionState],async s=>{const o=s.objectStore(rt.Records),a=s.objectStore(rt.Schema),l=s.objectStore(rt.SessionState);await o.clear();for(const[c,u]of Object.entries(t))await o.put(u,c);a.put(e.serialize(),rt.Schema),i&&n?l.put({snapshot:i,updatedAt:Date.now(),id:n},n):(i||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[rt.SessionState],async e=>{const t=e.objectStore(rt.SessionState),n=(await t.getAll()).sort((s,o)=>s.updatedAt-o.updatedAt);if(n.length<10){await e.done;return}const i=n.slice(0,n.length-10);for(const{id:s}of i)await t.delete(s)})}async getAsset(e){return await this.tx("readonly",[rt.Assets],async t=>await t.objectStore(rt.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[rt.Assets],async n=>{await n.objectStore(rt.Assets).put(t,e)})}async removeAssets(e){await this.tx("readwrite",[rt.Assets],async t=>{const n=t.objectStore(rt.Assets);for(const i of e)await n.delete(i)})}}function WN(){const r=JSON.parse(zO(WV)||"[]")??[];return Array.isArray(r)?r:[]}function xve(r){const e=new Set(WN());e.add(r),BO(WV,JSON.stringify([...e]))}function Sve(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function wve(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const bve=350,vve=1e4,Yj=Symbol("UPDATE_INSTANCE_STATE"),kve=r=>r;class Cve{onmessage;constructor(e){}postMessage(e){}close(){}}const Tve=typeof BroadcastChannel>"u"?Cve:BroadcastChannel;class Eve{constructor(e,{persistenceKey:t,sessionId:n=hv,onLoad:i,onLoadError:s},o=new Tve(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.db=new Ny(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=$N(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(kve({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(Yj),this.schedulePersist()},{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let n;try{n=await this.db.load({sessionId:this.sessionId})}catch(i){t(i),wve();return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){const i=Object.fromEntries(n.records.map(l=>[l.id,l])),s=n.sessionStateSnapshot??cwe(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:n.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),t(new Error(`Failed to migrate store: ${o.reason}`));return}const a=Object.values(o.value).filter(l=>this.documentTypes.has(l.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),s&&BP(this.store,s,{forceOverwrite:!0})}this.channel.onmessage=({data:i})=>{this.debug("got message",i);const s=i,o=this.store.schema.getMigrationsSince(s.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}s.type==="diff"&&(this.debug("applying diff"),hs(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?vve:bve))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(se(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=uN(e.filter(n=>n!==Yj));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),Sve(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function qV(r){const e=k.useRef(r),[t,n]=k.useState(r);t!==e.current&&n(e.current);const i=k.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,n(e.current)},[]);return[t,i]}function Mve(r){const[e,t]=qV({status:"loading"});return r=hp(r),k.useEffect(()=>{const{persistenceKey:n,sessionId:i,...s}=r;if(!n){t({status:"not-synced",store:mv(s)});return}t({status:"loading"});const o=new Ar,a={upload:async(d,h)=>(await u.db.storeAsset(d.id,h),{src:d.id}),resolve:async d=>d.props.src?d.props.src.startsWith("asset:")?await o.get(d,async()=>{const h=await u.db.getAsset(d.id);return h?URL.createObjectURL(h):null}):d.props.src:null,remove:async d=>{await u.db.removeAssets(d)},...s.assets},l=mv({...s,assets:a});let c=!1;const u=new Eve(l,{sessionId:i,persistenceKey:n,onLoad(){c||t({store:l,status:"synced-local"})},onLoadError(d){c||t({status:"error",error:d})}});return()=>{c=!0,u.close()}},[r,t]),e}function Ive(){const r=z();k.useLayoutEffect(()=>Zi("stateAttribute",()=>{r.getContainer().setAttribute("data-state",r.getPath())}),[r])}function Pve(){const r=z(),e=Pn();k.useEffect(()=>{const t=s=>e.style.setProperty("--tl-zoom",s.toString()),n=n1(t,100),i=new Bd("useZoomCss",()=>{r.getCurrentPageShapeIds().size<300?t(r.getZoomLevel()):n(r.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),n.cancel()}},[r,e])}function JP(r){const e=new ArrayBuffer(r.length),t=new Uint8Array(e);for(let n=0,i=r.length;n<i;n++)t[n]=r.charCodeAt(n);return e}function Ave(r){const e=atob(r),t=JP(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const $ve=30,Wo={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8,EVALUATION_LICENSE:16,NATIVE_LICENSE:32},Rve=Math.max(...Object.values(Wo)),tm={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},Ove=Object.keys(tm).length,th="sales@tldraw.com",Nve=`${$n()}/watermarks/watermark-track.svg`;class A1{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=Ft("license state","pending");verbose=!0;constructor(e,t){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(n=>{const i=_ve(n,s=>this.outputMessages(s),this.isDevelopment);this.maybeTrack(n,i),this.state.set(i)}).catch(n=>{console.error("License validation failed:",n),this.state.set("unlicensed")})}getIsDevelopment(){return!["https:","vscode-webview:"].includes(window.location.protocol)||window.location.hostname==="localhost"||!1}getTrackType(e,t){return t==="unlicensed-production"?"unlicensed":this.isDevelopment||!e.isLicenseParseable?null:e.isEvaluationLicense?"evaluation":t==="licensed-with-watermark"?"with_watermark":null}maybeTrack(e,t){const n=this.getTrackType(e,t);if(!n)return;const i=new URL(Nve);if(i.searchParams.set("version",PN),i.searchParams.set("license_type",n),"license"in e){i.searchParams.set("license_id",e.license.id);const s=this.isFlagEnabled(e.license.flags,Wo.EVALUATION_LICENSE)?"evaluation":this.isFlagEnabled(e.license.flags,Wo.ANNUAL_LICENSE)?"annual":this.isFlagEnabled(e.license.flags,Wo.PERPETUAL_LICENSE)?"perpetual":"unknown";i.searchParams.set("sku",s)}i.searchParams.set("url",window.location.href),i.searchParams.set("environment","production"),fetch(i.toString())}async extractLicenseKey(e){const[t,n]=e.split("."),[i,s]=t.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await Ave(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(JP(atob(n))),new Uint8Array(JP(atob(s))))}catch(c){throw console.error(c),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return l.length>Ove&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[tm.ID],hosts:l[tm.HOSTS],flags:l[tm.FLAGS],expiryDate:l[tm.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const n=await this.extractLicenseKey(t),i=new Date(n.expiryDate),s=this.isFlagEnabled(n.flags,Wo.ANNUAL_LICENSE),o=this.isFlagEnabled(n.flags,Wo.PERPETUAL_LICENSE),a=this.isFlagEnabled(n.flags,Wo.EVALUATION_LICENSE),l=this.getDaysSinceExpiry(i),c={license:n,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(n),expiryDate:i,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(n.flags,Wo.INTERNAL_LICENSE),isNativeLicense:this.isNativeLicense(n),isLicensedWithWatermark:this.isFlagEnabled(n.flags,Wo.WITH_WATERMARK),isEvaluationLicense:a,isEvaluationLicenseExpired:a&&this.isEvaluationLicenseExpired(i),daysSinceExpiry:l};return this.outputLicenseInfoIfNeeded(c),c}catch(n){return this.outputInvalidLicenseKey(n.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(n=>{const i=n.toLowerCase().trim();if(i===t||`www.${i}`===t||i===`www.${t}`||n==="*")return!0;if(this.isNativeLicense(e))return new RegExp(i).test(window.location.href);if(n.includes("*")){const s=new RegExp(n.replace(/\*/g,".*?"));return s.test(t)||s.test(`www.${t}`)}if(window.location.protocol==="vscode-webview:"){const o=new URL(window.location.href).searchParams.get("extensionId");if(i===o)return!0}return!1})}isNativeLicense(e){return this.isFlagEnabled(e.flags,Wo.NATIVE_LICENSE)}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+$ve+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e);return new Date>=t}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),n={major:new Date(bj.major),minor:new Date(bj.minor)};return n.major>=t||n.minor>=t}getDaysSinceExpiry(e){const t=new Date,n=this.getExpirationDateWithoutGracePeriod(e),i=t.getTime()-n.getTime(),s=Math.floor(i/(1e3*60*60*24));return Math.max(0,s)}isEvaluationLicenseExpired(e){const t=new Date,n=this.getExpirationDateWithoutGracePeriod(e);return t>=n}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.license.flags>=Rve*2&&this.outputMessages(["Warning: This tldraw license contains some unknown flags.","This will still work, however, you may want to update tldraw packages to a newer version to get access to new functionality."],"warning")}outputMessages(e,t="error"){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const n of e){const i=t==="warning"?"orange":"crimson",s=t==="warning"?"orange":"crimson";console.log(`%c${n}`,`color: ${i}; background: ${s}; padding: 2px; border-radius: 3px;`)}this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}function _ve(r,e,t){if(!r.isLicenseParseable)return t?"unlicensed":(r.reason==="no-key-provided"?e(["No tldraw license key provided!","A license is required for production deployments.",`Please reach out to ${th} to purchase a license.`]):e(["Invalid license key. tldraw requires a valid license for production use.",`Please reach out to ${th} to purchase a license.`]),"unlicensed-production");if(!r.isDomainValid&&!r.isDevelopment)return e(["License key is not valid for this domain.","A license is required for production deployments.",`Please reach out to ${th} to purchase a license.`]),"unlicensed-production";if(r.isEvaluationLicense)return r.isEvaluationLicenseExpired?(e(["Your tldraw evaluation license has expired!",`Please reach out to ${th} to purchase a full license.`]),"expired"):"licensed";if(r.isPerpetualLicenseExpired||r.isAnnualLicenseExpired)return e(["Your tldraw license has been expired for more than 30 days!",`Please reach out to ${th} to renew your license.`]),"expired";const n=r.daysSinceExpiry;return n>0&&!r.isEvaluationLicense?(e(["Your tldraw license has expired.",`License expired ${n} days ago.`,`Please reach out to ${th} to renew your license.`]),"licensed"):r.isLicensedWithWatermark?"licensed-with-watermark":"licensed"}var nh={};const KV=k.createContext({}),Dve=()=>k.useContext(KV);function Xj(r){return r==="expired"||r==="unlicensed-production"}const Fve=5e3;function zve({licenseKey:r=jve()??void 0,children:e}){const[t]=k.useState(()=>new A1(r)),n=F(t.state),[i,s]=k.useState(!0);return k.useEffect(()=>{if(Xj(n)&&i){const o=setTimeout(()=>{s(!1)},Fve);return()=>clearTimeout(o)}},[n,i]),Xj(n)&&!i?x.jsx(Bve,{}):x.jsx(KV.Provider,{value:t,children:e})}function Bve(){return x.jsx("div",{"data-testid":"tl-license-expired",style:{display:"none"}})}let nw;function jve(){return nw!==void 0||(nw=Is(()=>nh.TLDRAW_LICENSE_KEY)||Is(()=>nh.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||Is(()=>nh.REACT_APP_TLDRAW_LICENSE_KEY)||Is(()=>nh.GATSBY_TLDRAW_LICENSE_KEY)||Is(()=>nh.VITE_TLDRAW_LICENSE_KEY)||Is(()=>nh.PUBLIC_TLDRAW_LICENSE_KEY)||Is(()=>{})||Is(()=>{})||Is(()=>{})||Is(()=>{})||Is(()=>{})||Is(()=>{})||null),nw}function Is(r){try{return r()}catch{return}}function ya(r){if(!r)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Pn(),t=Sn();k.useEffect(()=>{function n(s){if(!t?.getInstanceState().isFocused||s.isSpecialRedispatchedEvent)return;const o=r.current;if(o&&o.scrollHeight>o.clientHeight)return;Oe(s);const a=e.querySelector(".tl-canvas");if(!a)return;const l=new WheelEvent("wheel",s);l.isSpecialRedispatchedEvent=!0,a.dispatchEvent(l)}const i=r.current;if(i)return i.addEventListener("wheel",n,{passive:!1}),()=>{i.removeEventListener("wheel",n)}},[e,t,r])}const Lve='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',Uve='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function Wve(r){return F("watermarkState",()=>r.state.get(),[r])}const Hve=`data:image/svg+xml;utf8,${encodeURIComponent(Lve)}`,qve=`data:image/svg+xml;utf8,${encodeURIComponent(Uve)}`,Kve=k.memo(function(){const e=Dve(),t=z(),n=F("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),i=Wve(e);return["licensed-with-watermark","unlicensed"].includes(i)?x.jsxs(x.Fragment,{children:[x.jsx(Gve,{}),x.jsx(Vve,{src:n?qve:Hve,isUnlicensed:i==="unlicensed"})]}):null}),Jve=k.memo(function({isDebugMode:e,isMobile:t}){const n=z(),i=y1(),s=k.useRef(null);ya(s);const o="https://tldraw.dev/pricing?utm_source=sdk&utm_medium=organic&utm_campaign=watermark";return x.jsx("div",{ref:s,className:A1.className,"data-debug":e,"data-mobile":t,"data-unlicensed":!0,"data-testid":"tl-watermark-unlicensed",draggable:!1,...i,children:x.jsx("button",{draggable:!1,role:"button",onPointerDown:a=>{n.markEventAsHandled(a),Oe(a)},title:"The tldraw SDK requires a license key to work in production. You can get a free 100-day trial license at tldraw.dev/pricing.",onClick:()=>{lS.openWindow(o,"_blank",!0)},children:"Get a license for production"})})}),Vve=k.memo(function({src:e,isUnlicensed:t}){const n=z(),i=F("debug mode",()=>n.getInstanceState().isDebugMode,[n]),s=F("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),o=y1(),a=k.useRef(null);ya(a);const l=`url('${e}') center 100% / 100% no-repeat`,c="https://tldraw.dev/?utm_source=sdk&utm_medium=organic&utm_campaign=watermark";return t?x.jsx(Jve,{isDebugMode:i,isMobile:s}):x.jsx("div",{ref:a,className:A1.className,"data-debug":i,"data-mobile":s,"data-testid":"tl-watermark-licensed",draggable:!1,...o,children:x.jsx("button",{draggable:!1,role:"button",onPointerDown:u=>{n.markEventAsHandled(u),Oe(u)},title:"Build infinite canvas applications with the tldraw SDK. Learn more at https://tldraw.dev.",onClick:()=>{lS.openWindow(c,"_blank")},style:{mask:l,WebkitMask:l}})})}),Gve=k.memo(function(){const e=z(),t=A1.className,n=`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${t} {
	position: absolute;
	bottom: max(var(--tl-space-2), env(safe-area-inset-bottom));
	right: max(var(--tl-space-2), env(safe-area-inset-right));
	width: 96px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: var(--tl-layer-watermark) !important;
	background-color: color-mix(in srgb, var(--tl-color-background) 62%, transparent);
	opacity: 1;
	border-radius: 5px;
	pointer-events: all;
	padding: 2px;
	box-sizing: content-box;
}

.${t} > button {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: all;
	cursor: inherit;
	color: var(--tl-color-text);
	opacity: .38;
	border: 0;
	padding: 0;
	background-color: currentColor;
}

.${t}[data-debug='true'] {
	bottom: max(46px, env(safe-area-inset-bottom));
}

.${t}[data-mobile='true'] {
	border-radius: 4px 0px 0px 4px;
	right: max(-2px, calc(env(safe-area-inset-right) - 2px));
	width: 8px;
	height: 48px;
}

.${t}[data-mobile='true'] > button {
	width: 8px;
	height: 32px;
}

.${t}[data-unlicensed='true'] > button {
	font-size: 100px;
	position: absolute;
	pointer-events: all;
	cursor: pointer;
	color: var(--tl-color-text);
	opacity: 0.8;
	border: 0;
	padding: 0;
	background-color: transparent;
	font-size: 11px;
	font-weight: 600;
	text-align: center;
}

.${t}[data-mobile='true'][data-unlicensed='true'] > button {
	display: none;
}

@media (hover: hover) {
	.${t} > button {
		pointer-events: none;
	}

	.${t}:hover {
		background-color: var(--tl-color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}

	.${t}:hover > button {
		animation: ${t}_delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}

	.${t} > button:focus-visible {
		opacity: 1;
	}
}

@keyframes ${t}_delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}`;return x.jsx("style",{nonce:e.options.nonce,children:n})}),Yve=[],Xve=[],Zve=[],Qve="tl-container",eke=k.memo(function({store:e,components:t,className:n,user:i,options:s,...o}){const[a,l]=k.useState(null),c=k.useMemo(()=>i??Mq(),[i]),u=t?.ErrorFallback===void 0?gq:t?.ErrorFallback,d={...o,shapeUtils:o.shapeUtils??Yve,bindingUtils:o.bindingUtils??Xve,tools:o.tools??Zve,components:t,options:hp(s)};return x.jsx("div",{ref:l,"data-tldraw":PN,draggable:!1,className:oe(`${Qve} tl-theme__light`,n),tabIndex:-1,role:"application","aria-label":s?.branding??"tldraw",children:x.jsx(Ry,{fallback:u,onError:h=>DO(h,{tags:{origin:"react.tldraw-before-app"}}),children:a&&x.jsx(zve,{licenseKey:o.licenseKey,children:x.jsx(pq,{container:a,children:x.jsx(mke,{overrides:t,children:e?e instanceof dN?x.jsx(VV,{...d,store:e,user:c}):x.jsx(JV,{...d,store:e,user:c}):x.jsx(tke,{...d,store:e,user:c})})})})})})});function tke(r){const{defaultName:e,snapshot:t,initialData:n,shapeUtils:i,bindingUtils:s,persistenceKey:o,sessionId:a,user:l,assets:c,migrations:u}=r,d=Mve({shapeUtils:i,bindingUtils:s,initialData:n,persistenceKey:o,sessionId:a,defaultName:e,snapshot:t,assets:c,migrations:u});return x.jsx(JV,{...r,store:d,user:l})}const JV=k.memo(function({store:e,user:t,...n}){const i=Pn();k.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);const{LoadingScreen:s}=Tt();switch(e.status){case"error":throw e.error;case"loading":return s?x.jsx(s,{}):null}return x.jsx(VV,{...n,store:e.store,user:t})}),XE=()=>document.location.search.includes("tldraw_preserve_focus");function VV({onMount:r,children:e,store:t,tools:n,shapeUtils:i,bindingUtils:s,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:u,textOptions:d,options:h,licenseKey:f,deepLinks:p,getShapeVisibility:m,assetUrls:g}){const{ErrorFallback:y}=Tt(),S=Pn(),[w,b]=qV(null),v=k.useRef(null),C=hp(p===!0?{}:p),E=k.useRef({autoFocus:l&&!XE(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:C});k.useLayoutEffect(()=>{E.current={autoFocus:l&&!XE(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:C}},[l,c,a,u,C]),k.useLayoutEffect(()=>{const{autoFocus:I,inferDarkMode:R,initialState:B,cameraOptions:U,deepLinks:H}=E.current,L=new ee({store:t,shapeUtils:i,bindingUtils:s,tools:n,getContainer:()=>S,user:o,initialState:B,autoFocus:I,inferDarkMode:R,cameraOptions:U,textOptions:d,options:h,licenseKey:f,getShapeVisibility:m,fontAssetUrls:g?.fonts});return L.updateViewportScreenBounds(v.current??S),H&&(H?.getUrl?L.navigateToDeepLink({...H,url:H.getUrl(L)}):L.navigateToDeepLink(H)),b(L),()=>{L.dispose()}},[s,S,h,i,t,n,o,b,f,m,d,g]),k.useLayoutEffect(()=>{if(w&&C)return w.registerDeepLinkListener(C)},[w,C]),k.useLayoutEffect(()=>{w&&u&&w.setCameraOptions(u)},[w,u]);const M=k.useSyncExternalStore(k.useCallback(I=>w?(w.on("crash",I),()=>w.off("crash",I)):()=>{},[w]),()=>w?.getCrashingError()??null);k.useEffect(function(){if(!w)return;function R(){w&&w.focus()}function B(){w&&w.blur()}if(l&&XE())return w.getContainer().addEventListener("pointerdown",R),document.body.addEventListener("pointerdown",B),()=>{w.getContainer()?.removeEventListener("pointerdown",R),document.body.removeEventListener("pointerdown",B)}},[w,l]);const[P,$]=k.useState(null);let A=P;w!==A?.editor&&(A=null),k.useLayoutEffect(()=>{if(!w)return;if(w.options.maxFontsToLoadBeforeRender===0){$({editor:w,isLoaded:!0});return}let I=!1;return $({editor:w,isLoaded:!1}),w.fonts.loadRequiredFontsForCurrentPage(w.options.maxFontsToLoadBeforeRender).finally(()=>{I||$({editor:w,isLoaded:!0})}),()=>{I=!0}},[w]);const{Canvas:O,LoadingScreen:_}=Tt();return!w||!A?.isLoaded?x.jsxs(x.Fragment,{children:[_&&x.jsx(_,{}),x.jsx("div",{className:"tl-canvas",ref:v})]}):x.jsx(Ry,{fallback:y,onError:I=>w.annotateError(I,{origin:"react.tldraw",willCrashApp:!0}),children:M?x.jsx(rke,{crashingError:M}):x.jsx(MN,{editor:w,children:x.jsxs(nke,{onMount:r,children:[e??(O?x.jsx(O,{},w.contextId):null),x.jsx(Kve,{})]})})})}function nke({children:r,onMount:e}){return Pve(),Q0e(),eve(),tve(),Ive(),YV(t=>{const n=t.store.props.onMount(t),i=e?.(t);return()=>{n?.(),i?.()}}),r}function rke({crashingError:r}){throw r}function GV({children:r}){return x.jsx("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:r})}function YV(r){const e=z(),t=qo(n=>{let i;return n.run(()=>{i=r?.(n),n.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});Be.useLayoutEffect(()=>{if(e)return t?.(e)},[e,t])}const ike=()=>{const{Spinner:r}=Tt();return x.jsx(GV,{children:r?x.jsx(r,{}):null})};function XV(r,e=!0){const t=r.length;if(t<2)return"";let n=r[0],i=r[1];if(t===2)return`M${Zn(n)}L${Zn(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)n=r[o],i=r[o+1],s+=Ji(n,i);return e?`M${Ji(r[0],r[1])}Q${Zn(r[1])}${Ji(r[1],r[2])}T${s}${Ji(r[t-1],r[0])}${Ji(r[0],r[1])}Z`:`M${Zn(r[0])}Q${Zn(r[1])}${Ji(r[1],r[2])}${r.length>3?"T":""}${s}L${Zn(r[t-1])}`}function Zj({scribble:r,zoom:e,color:t,opacity:n,className:i}){return r.points.length?x.jsx("svg",{className:i&&oe("tl-overlays__item",i),children:x.jsx("path",{className:"tl-scribble",d:XV(r.points,!1),stroke:t??`var(--tl-color-${r.color})`,fill:"none",strokeWidth:8/e,opacity:n??r.opacity})}):null}function ske({bounds:r,rotation:e}){const t=z(),n=k.useRef(null),i=F("only selected shape",()=>t.getOnlySelectedShape(),[t]),s=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return sS(n,r?.x,r?.y,1,e,{x:-s,y:-s}),r=s instanceof V?r.clone().expand(s).zeroFix():r.clone().expandBy(s).zeroFix(),x.jsx("svg",{ref:n,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:x.jsx("rect",{className:oe("tl-selection__fg__outline"),width:D(r.width),height:D(r.height)})})}const oke=()=>x.jsx("div",{className:"tl-shape-error-boundary"}),ake=k.memo(({shape:r,util:e})=>a1("Indicator: "+r.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(r.id))),(r,e)=>r.shape.props===e.shape.props&&r.shape.meta===e.shape.meta),lke=k.memo(({editor:r,id:e})=>{const t=F("shape for indicator",()=>r.store.get(e),[r,e]),{ShapeIndicatorErrorFallback:n}=Tt();return!t||t.isLocked?null:x.jsx(Ry,{fallback:n,onError:i=>r.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:x.jsx(ake,{shape:t,util:r.getShapeUtil(t)},t.id)})}),Qj=k.memo(function({shapeId:e,className:t,color:n,hidden:i,opacity:s}){const o=z(),a=k.useRef(null);return cd("indicator transform",()=>{if(i)return;const l=a.current;if(!l)return;const c=o.getShapePageTransform(e);c&&l.style.setProperty("transform",c.toCssString())},[o,e,i]),k.useLayoutEffect(()=>{const l=a.current;l&&l.style.setProperty("display",i?"none":"block")},[i]),x.jsx("svg",{ref:a,className:oe("tl-overlays__item",t),"aria-hidden":"true",children:x.jsx("g",{className:"tl-shape-indicator",stroke:n??"var(--tl-color-selected)",opacity:s,children:x.jsx(lke,{editor:o,id:e})})})}),cke=()=>x.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),ZV=k.memo(function({hideAll:e,showAll:t}){const n=z();if(e&&t)throw Error("You cannot set both hideAll and showAll props to true, cmon now");const i=k.useRef(new Set),s=F("should display selected ids",()=>{const l=i.current,c=new Set,u=n.getInstanceState(),d=u.isChangingStyle,h=n.isInAny("select.idle","select.editing_shape"),f=n.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(d||!(h||f))return i.current=c,c;for(const p of n.getSelectedShapeIds())c.add(p);if(h&&u.isHoveringCanvas&&!u.isCoarsePointer){const p=n.getHoveredShapeId();p&&c.add(p)}if(l.size!==c.size)return i.current=c,c;for(const p of c)if(!l.has(p))return i.current=c,c;return l},[n]),o=F("rendering shapes",()=>n.getRenderingShapes(),[n]),{ShapeIndicator:a}=Tt();return a?o.map(({id:l})=>x.jsx(a,{shapeId:l,hidden:!t&&(e||!s.has(l))},l+"_indicator")):null}),uke=k.forwardRef(function({children:e,shape:t,isBackground:n,...i},s){const o="fill"in t.props&&t.props.fill!=="none";return x.jsx("div",{ref:s,"data-shape-type":t.type,"data-shape-is-filled":n?void 0:o,"data-shape-id":t.id,draggable:!1,...i,className:oe("tl-shape",n&&"tl-shape-background",i.className),children:e})});function dke({points:r,zoom:e}){const t=2.5/e,n=r.reduce((h,f)=>Math.min(h,f.x),1/0),i=r.reduce((h,f)=>Math.max(h,f.x),-1/0),s=r.reduce((h,f)=>Math.min(h,f.y),1/0),o=r.reduce((h,f)=>Math.max(h,f.y),-1/0),a=r.some(h=>h.x===n&&h.y===s);let l,c,u,d;return a?(l=n,c=s,u=i,d=o):(l=n,c=o,u=i,d=s),x.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[x.jsx("line",{x1:l,y1:c,x2:u,y2:d}),r.map((h,f)=>x.jsx("g",{transform:`translate(${h.x},${h.y})`,children:x.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},f))]})}function hke({gaps:r,direction:e,zoom:t}){const n=3.5/t;let i=[-1/0,1/0],s=null;const o=e==="horizontal";for(const l of r){if(s=Xs(i[0],i[1],o?l.startEdge[0].y:l.startEdge[0].x,o?l.startEdge[1].y:l.startEdge[1].x),s)i=s;else continue;if(s=Xs(i[0],i[1],o?l.endEdge[0].y:l.endEdge[0].x,o?l.endEdge[1].y:l.endEdge[1].x),s)i=s;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return x.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:r.map(({startEdge:l,endEdge:c},u)=>x.jsx(k.Fragment,{children:o?x.jsxs(x.Fragment,{children:[x.jsx("line",{x1:l[0].x,y1:a-2*n,x2:l[1].x,y2:a+2*n}),x.jsx("line",{x1:c[0].x,y1:a-2*n,x2:c[1].x,y2:a+2*n}),x.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),x.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-n,x2:(l[0].x+c[0].x)/2,y2:a+n})]}):x.jsxs(x.Fragment,{children:[x.jsx("line",{x1:a-2*n,y1:l[0].y,x2:a+2*n,y2:l[1].y}),x.jsx("line",{x1:a-2*n,y1:c[0].y,x2:a+2*n,y2:c[1].y}),x.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),x.jsx("line",{x1:a-n,y1:(l[0].y+c[0].y)/2,x2:a+n,y2:(l[0].y+c[0].y)/2})]})},u))})}function fke({className:r,line:e,zoom:t}){return x.jsx("svg",{className:oe("tl-overlays__item",r),"aria-hidden":"true",children:e.type==="points"?x.jsx(dke,{...e,zoom:t}):e.type==="gaps"?x.jsx(hke,{...e,zoom:t}):null})}function QV(r){return x.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...r,className:oe("tl-spinner",r.className),children:x.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[x.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),x.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}const pke=()=>null,eG=k.createContext(null);function mke({overrides:r={},children:e}){const t=hp(r),n=k.useMemo(()=>({Background:kSe,Brush:_E,Canvas:$1e,CollaboratorBrush:_E,CollaboratorCursor:wj,CollaboratorHint:USe,CollaboratorScribble:Zj,CollaboratorShapeIndicator:Qj,Cursor:wj,Grid:KSe,Handle:JSe,Handles:VSe,InFrontOfTheCanvas:null,LoadingScreen:ike,OnTheCanvas:null,Overlays:null,Scribble:Zj,SelectionBackground:null,SelectionForeground:ske,ShapeIndicator:Qj,ShapeIndicators:ZV,ShapeWrapper:uke,SnapIndicator:fke,Spinner:QV,SvgDefs:pke,ZoomBrush:_E,ErrorFallback:gq,ShapeErrorFallback:oke,ShapeIndicatorErrorFallback:cke,...t}),[t]);return x.jsx(eG.Provider,{value:n,children:e})}function Tt(){const r=k.useContext(eG);if(!r)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return r}const gke=["textarea","input"];function yke(r){const e=z();k.useEffect(()=>{const t=r.current;if(!t)return;const n=i=>{if(i instanceof PointerEvent&&i.pointerType==="pen"){e.markEventAsHandled(i);const{target:s}=i;if(gke.includes(s.tagName?.toLocaleLowerCase())||s.isContentEditable||e.isIn("select.editing_shape"))return;Oe(i)}};return t.addEventListener("touchstart",n),t.addEventListener("touchend",n),()=>{t.removeEventListener("touchstart",n),t.removeEventListener("touchend",n)}},[e,r])}function xke(r,e,t){return Math.max(e,Math.min(r,t))}const rr={toVector(r,e){return r===void 0&&(r=e),Array.isArray(r)?r:[r,r]},add(r,e){return[r[0]+e[0],r[1]+e[1]]},sub(r,e){return[r[0]-e[0],r[1]-e[1]]},addTo(r,e){r[0]+=e[0],r[1]+=e[1]},subTo(r,e){r[0]-=e[0],r[1]-=e[1]}};function eL(r,e,t){return e===0||Math.abs(e)===1/0?Math.pow(r,t*5):r*e*t/(e+t*r)}function tL(r,e,t,n=.15){return n===0?xke(r,e,t):r<e?-eL(e-r,t-e,n)+e:r>t?+eL(r-t,t-e,n)+t:r}function Ske(r,[e,t],[n,i]){const[[s,o],[a,l]]=r;return[tL(e,s,o,n),tL(t,a,l,i)]}function wke(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function bke(r){var e=wke(r,"string");return typeof e=="symbol"?e:String(e)}function pr(r,e,t){return e=bke(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function nL(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function un(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nL(Object(t),!0).forEach(function(n){pr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):nL(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const tG={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function rL(r){return r?r[0].toUpperCase()+r.slice(1):""}const vke=["enter","leave"];function kke(r=!1,e){return r&&!vke.includes(e)}function Cke(r,e="",t=!1){const n=tG[r],i=n&&n[e]||e;return"on"+rL(r)+rL(i)+(kke(t,i)?"Capture":"")}const Tke=["gotpointercapture","lostpointercapture"];function Eke(r){let e=r.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=Tke.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(n);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function Mke(r,e=""){const t=tG[r],n=t&&t[e]||e;return r+n}function nG(r){return"touches"in r}function Ike(r){return nG(r)?"touch":"pointerType"in r?r.pointerType:"mouse"}function Pke(r){return Array.from(r.touches).filter(e=>{var t,n;return e.target===r.currentTarget||((t=r.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function VP(r,e){try{const t=e.clientX-r.clientX,n=e.clientY-r.clientY,i=(e.clientX+r.clientX)/2,s=(e.clientY+r.clientY)/2,o=Math.hypot(t,n);return{angle:-(Math.atan2(t,n)*180)/Math.PI,distance:o,origin:[i,s]}}catch{}return null}function Ake(r){return Pke(r).map(e=>e.identifier)}function iL(r,e){const[t,n]=Array.from(r.touches).filter(i=>e.includes(i.identifier));return VP(t,n)}const sL=40,oL=800;function rG(r){let{deltaX:e,deltaY:t,deltaMode:n}=r;return n===1?(e*=sL,t*=sL):n===2&&(e*=oL,t*=oL),[e,t]}function $ke(r){const e={};if("buttons"in r&&(e.buttons=r.buttons),"shiftKey"in r){const{shiftKey:t,altKey:n,metaKey:i,ctrlKey:s}=r;Object.assign(e,{shiftKey:t,altKey:n,metaKey:i,ctrlKey:s})}return e}function gv(r,...e){return typeof r=="function"?r(...e):r}function Rke(){}function Oke(...r){return r.length===0?Rke:r.length===1?r[0]:function(){let e;for(const t of r)e=t.apply(this,arguments)||e;return e}}function aL(r,e){return Object.assign({},e,r||{})}const Nke=32;class iG{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:i}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?gv(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,$ke(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const C=t._delta.map(Math.abs);rr.addTo(t._distance,C)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[l,c]=n.threshold,{_step:u,values:d}=t;if(n.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&d[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[C,E]=d;h[0]=u[0]!==!1?C-u[0]:0,h[1]=u[1]!==!1?E-u[1]:0}else h[0]=u[0]!==!1?o-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const f=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=gv(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[m,g]=t.offset,[[y,S],[w,b]]=t._bounds;t.overflow=[m<y?-1:m>S?1:0,g<w?-1:g>b?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const v=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=Ske(t._bounds,t.offset,v),t.delta=rr.sub(t.offset,f),this.computeMovement(),p&&(!t.last||s>Nke)){t.delta=rr.sub(t.offset,f);const C=t.delta.map(Math.abs);rr.addTo(t.distance,C),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[C[0]/s,C[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const i=this.handler(un(un(un({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function _ke([r,e],t){const n=Math.abs(r),i=Math.abs(e);if(n>i&&n>t)return"x";if(i>n&&i>t)return"y"}class Dke extends iG{constructor(...e){super(...e),pr(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=rr.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=rr.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const i=typeof n.axisThreshold=="object"?n.axisThreshold[Ike(e)]:n.axisThreshold;t.axis=_ke(t._movement,i)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Fke=r=>r,lL=.15,sG={enabled(r=!0){return r},eventOptions(r,e,t){return un(un({},t.shared.eventOptions),r)},preventDefault(r=!1){return r},triggerAllEvents(r=!1){return r},rubberband(r=0){switch(r){case!0:return[lL,lL];case!1:return[0,0];default:return rr.toVector(r)}},from(r){if(typeof r=="function")return r;if(r!=null)return rr.toVector(r)},transform(r,e,t){const n=r||t.shared.transform;return this.hasCustomTransform=!!n,n||Fke},threshold(r){return rr.toVector(r,0)}},zke=0,mS=un(un({},sG),{},{axis(r,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(r=zke){return r},bounds(r={}){if(typeof r=="function")return s=>mS.bounds(r(s));if("current"in r)return()=>r.current;if(typeof HTMLElement=="function"&&r instanceof HTMLElement)return r;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:i=1/0}=r;return[[e,t],[n,i]]}}),gS=typeof window<"u"&&window.document&&window.document.createElement;function oG(){return gS&&"ontouchstart"in window}function Bke(){return oG()||gS&&window.navigator.maxTouchPoints>1}function jke(){return gS&&"onpointerdown"in window}function Lke(){return gS&&"exitPointerLock"in window.document}function Uke(){try{return"constructor"in GestureEvent}catch{return!1}}const Os={isBrowser:gS,gesture:Uke(),touch:oG(),touchscreen:Bke(),pointer:jke(),pointerLock:Lke()},Wke=250,Hke=180,qke=.5,Kke=50,Jke=250,Vke=10,cL={mouse:0,touch:0,pen:8};un(un({},mS),{},{device(r,e,{pointer:{touch:t=!1,lock:n=!1,mouse:i=!1}={}}){return this.pointerLock=n&&Os.pointerLock,Os.touch&&t?"touch":this.pointerLock?"mouse":Os.pointer&&!i?"pointer":Os.touch?"touch":"mouse"},preventScrollAxis(r,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&r?Wke:void 0,!(!Os.touchscreen||t===!1))return r||(t!==void 0?"y":void 0)},pointerCapture(r,e,{pointer:{capture:t=!0,buttons:n=1,keys:i=!0}={}}){return this.pointerButtons=n,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(r,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:i=void 0}){const s=rr.toVector(r,t?n:i?1:0);return this.filterTaps=t,this.tapsThreshold=n,s},swipe({velocity:r=qke,distance:e=Kke,duration:t=Jke}={}){return{velocity:this.transform(rr.toVector(r)),distance:this.transform(rr.toVector(e)),duration:t}},delay(r=0){switch(r){case!0:return Hke;case!1:return 0;default:return r}},axisThreshold(r){return r?un(un({},cL),r):cL},keyboardDisplacement(r=Vke){return r}});function aG(r){const[e,t]=r.overflow,[n,i]=r._delta,[s,o]=r._direction;(e<0&&n>0&&s<0||e>0&&n<0&&s>0)&&(r._movement[0]=r._movementBound[0]),(t<0&&i>0&&o<0||t>0&&i<0&&o>0)&&(r._movement[1]=r._movementBound[1])}const Gke=30,Yke=100;class Xke extends iG{constructor(...e){super(...e),pr(this,"ingKey","pinching"),pr(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;e==="wheel"?this.state.offset=rr.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const i=Math.abs(t)*Gke-Math.abs(n);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>n.has(s))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const i=iL(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(o=>i.has(o))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=VP(...Array.from(n.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=iL(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=VP(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,i=n._values[1],s=t.angle-i;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=rr.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(n=>e[n]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const n=this.state;n._delta=[-rG(e)[1]/Yke*n.offset[0],0],rr.addTo(n._movement,n._delta),aG(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const Zke=un(un({},sG),{},{device(r,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!Os.touch&&Os.gesture)return"gesture";if(Os.touch&&n)return"touch";if(Os.touchscreen){if(Os.pointer)return"pointer";if(Os.touch)return"touch"}},bounds(r,e,{scaleBounds:t={},angleBounds:n={}}){const i=o=>{const a=aL(gv(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=aL(gv(n,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof n!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(r,e,t){return this.lockDirection=t.axis==="lock",rr.toVector(r,this.lockDirection?[.1,3]:0)},modifierKey(r){return r===void 0?"ctrlKey":r},pinchOnWheel(r=!0){return r}});un(un({},mS),{},{mouseOnly:(r=!0)=>r});class Qke extends Dke{constructor(...e){super(...e),pr(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=rG(e),rr.addTo(t._movement,t._delta),aG(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const e1e=mS;un(un({},mS),{},{mouseOnly:(r=!0)=>r});const HN=new Map,GP=new Map;function t1e(r){HN.set(r.key,r.engine),GP.set(r.key,r.resolver)}const n1e={key:"pinch",engine:Xke,resolver:Zke},r1e={key:"wheel",engine:Qke,resolver:e1e};function i1e(r,e){if(r==null)return{};var t={},n=Object.keys(r),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function s1e(r,e){if(r==null)return{};var t=i1e(r,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}const o1e={target(r){if(r)return()=>"current"in r?r.current:r},enabled(r=!0){return r},window(r=Os.isBrowser?window:void 0){return r},eventOptions({passive:r=!0,capture:e=!1}={}){return{passive:r,capture:e}},transform(r){return r}},a1e=["target","eventOptions","window","enabled","transform"];function Pb(r={},e){const t={};for(const[n,i]of Object.entries(e))switch(typeof i){case"function":t[n]=i.call(t,r[n],n,r);break;case"object":t[n]=Pb(r[n],i);break;case"boolean":i&&(t[n]=r[n]);break}return t}function l1e(r,e,t={}){const n=r,{target:i,eventOptions:s,window:o,enabled:a,transform:l}=n,c=s1e(n,a1e);if(t.shared=Pb({target:i,eventOptions:s,window:o,enabled:a,transform:l},o1e),e){const u=GP.get(e);t[e]=Pb(un({shared:t.shared},c),u)}else for(const u in c){const d=GP.get(u);d&&(t[u]=Pb(un({shared:t.shared},c[u]),d))}return t}class lG{constructor(e,t){pr(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,i,s){const o=this._listeners,a=Mke(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=un(un({},l),s);e.addEventListener(a,i,c);const u=()=>{e.removeEventListener(a,i,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class c1e{constructor(){pr(this,"_timeouts",new Map)}add(e,t,n=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class u1e{constructor(e){pr(this,"gestures",new Set),pr(this,"_targetEventStore",new lG(this)),pr(this,"gestureEventStores",{}),pr(this,"gestureTimeoutStores",{}),pr(this,"handlers",{}),pr(this,"config",{}),pr(this,"pointerIds",new Set),pr(this,"touchIds",new Set),pr(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),d1e(this,e)}setEventIds(e){if(nG(e))return this.touchIds=new Set(Ake(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=l1e(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],l=uL(n,a.eventOptions,!!i);if(a.enabled){const c=HN.get(o);new c(this,e,o).bind(l)}}const s=uL(n,t.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](un(un({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in n)n[s]=Oke(...n[s]);if(!i)return n;for(const s in n){const{device:o,capture:a,passive:l}=Eke(s);this._targetEventStore.add(i,o,"",n[s],{capture:a,passive:l})}}}}function rh(r,e){r.gestures.add(e),r.gestureEventStores[e]=new lG(r,e),r.gestureTimeoutStores[e]=new c1e}function d1e(r,e){e.drag&&rh(r,"drag"),e.wheel&&rh(r,"wheel"),e.scroll&&rh(r,"scroll"),e.move&&rh(r,"move"),e.pinch&&rh(r,"pinch"),e.hover&&rh(r,"hover")}const uL=(r,e,t)=>(n,i,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,d=(c=o.passive)!==null&&c!==void 0?c:e.passive;let h=a?n:Cke(n,i,u);t&&d&&(h+="Passive"),r[h]=r[h]||[],r[h].push(s)},h1e=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function f1e(r){const e={},t={},n=new Set;for(let i in r)h1e.test(i)?(n.add(RegExp.lastMatch),t[i]=r[i]):e[i]=r[i];return[t,e,n]}function ih(r,e,t,n,i,s){if(!r.has(t)||!HN.has(n))return;const o=t+"Start",a=t+"End",l=c=>{let u;return c.first&&o in e&&e[o](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};i[n]=l,s[n]=s[n]||{}}function p1e(r,e){const[t,n,i]=f1e(r),s={};return ih(i,t,"onDrag","drag",s,e),ih(i,t,"onWheel","wheel",s,e),ih(i,t,"onScroll","scroll",s,e),ih(i,t,"onPinch","pinch",s,e),ih(i,t,"onMove","move",s,e),ih(i,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:n}}function m1e(r,e={},t,n){const i=Be.useMemo(()=>new u1e(r),[]);if(i.applyHandlers(r,n),i.applyConfig(e,t),Be.useEffect(i.effect.bind(i)),Be.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function g1e(r){return r.forEach(t1e),function(t,n){const{handlers:i,nativeHandlers:s,config:o}=p1e(t,n||{});return m1e(i,o,void 0,s)}}const dL=10,y1e=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function cG(r){let{deltaY:e,deltaX:t}=r,n=0;return r.ctrlKey||r.altKey||r.metaKey?n=(Math.abs(e)>dL?dL*Math.sign(e):e)/100:r.shiftKey&&!y1e&&(t=e,e=0),{x:-t,y:-e,z:-n}}const x1e=g1e([r1e,n1e]);let sh;const S1e=r=>sh===void 0?(sh=r,!1):r-sh>120&&r-sh<160?(sh=r,!0):(sh=r,!1);function w1e(r){const e=z(),t=k.useMemo(()=>{let n="not sure";const i=({event:p})=>{if(!e.getInstanceState().isFocused||(n="not sure",S1e(Date.now())))return;const m=e.getEditingShapeId();if(m){const S=e.getShape(m);if(S&&e.getShapeUtil(S).canScroll(S)&&e.getShapePageBounds(m)?.containsPoint(e.inputs.currentPagePoint))return}Oe(p),p.stopPropagation();const g=cG(p);if(g.x===0&&g.y===0)return;const y={type:"wheel",name:"wheel",delta:g,point:new T(p.clientX,p.clientY),shiftKey:p.shiftKey,altKey:p.altKey,ctrlKey:p.metaKey||p.ctrlKey,metaKey:p.metaKey,accelKey:zt(p)};e.dispatch(y)};let s=1,o=1,a=0;const l=new T,c=new T,u=p=>{const m=r.current;n="not sure";const{event:g,origin:y,da:S}=p;g instanceof WheelEvent||(g.target===m||m?.contains(g.target))&&(c.x=y[0],c.y=y[1],l.x=y[0],l.y=y[1],s=S[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:y[0],y:y[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey,metaKey:g.metaKey,accelKey:zt(g)}))},d=p=>{if(p&&(n="zooming"),n==="zooming")return;const m=Math.abs(a-s),g=T.Dist(l,c);switch(n){case"not sure":{m>24?n="zooming":g>16&&(n="panning");break}case"panning":{m>64&&(n="zooming");break}}};return{onWheel:i,onPinchStart:u,onPinchEnd:p=>{const m=r.current,{event:g,origin:y,offset:S}=p;if(g instanceof WheelEvent||!(g.target===m||m?.contains(g.target)))return;const w=S[0]**e.getCameraOptions().zoomSpeed;n="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:y[0],y:y[1],z:w},delta:{x:y[0],y:y[1]},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey,metaKey:g.metaKey,accelKey:zt(g)})})},onPinch:p=>{const m=r.current,{event:g,origin:y,offset:S,da:w}=p;if(g instanceof WheelEvent||!(g.target===m||m?.contains(g.target)))return;const b=p.type==="gesturechange"||p.type==="gestureend";a=w[0];const v=y[0]-c.x,C=y[1]-c.y;switch(c.x=y[0],c.y=y[1],d(b),n){case"zooming":{const E=S[0]**e.getCameraOptions().zoomSpeed;e.dispatch({type:"pinch",name:"pinch",point:{x:y[0],y:y[1],z:E},delta:{x:v,y:C},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey,metaKey:g.metaKey,accelKey:zt(g)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:y[0],y:y[1],z:o},delta:{x:v,y:C},shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey,metaKey:g.metaKey,accelKey:zt(g)});break}}}}},[e,r]);x1e(t,{target:r,eventOptions:{passive:!1},pinch:{from:()=>{const{zoomSpeed:n}=e.getCameraOptions();return[e.getZoomLevel()**(1/n),0]},scaleBounds:()=>{const n=e.getBaseZoom(),{zoomSteps:i,zoomSpeed:s}=e.getCameraOptions(),o=i[0]*n;return{max:(i[i.length-1]*n)**(1/s),min:o**(1/s)}}}})}function ZE(r,e,t){const n=r.getShape(e),i=r.getShapeHandles(n);return{shape:n,handle:i.find(s=>s.id===t)}}function b1e(r,e){const t=z();return k.useMemo(()=>{const n=l=>{if(t.wasEventAlreadyHandled(l))return;const c=dv(l.currentTarget);oS(c,l);const{shape:u,handle:d}=ZE(t,r,e);d&&t.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_down",...nr(t,l)})};let i,s;return{onPointerDown:n,onPointerMove:l=>{if(t.wasEventAlreadyHandled(l)||l.clientX===i&&l.clientY===s)return;i=l.clientX,s=l.clientY;const{shape:c,handle:u}=ZE(t,r,e);u&&t.dispatch({type:"pointer",target:"handle",handle:u,shape:c,name:"pointer_move",...nr(t,l)})},onPointerUp:l=>{if(t.wasEventAlreadyHandled(l))return;const c=dv(l.currentTarget);aS(c,l);const{shape:u,handle:d}=ZE(t,r,e);d&&t.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_up",...nr(t,l)})}}},[t,r,e])}function v1e(r){const e=z();k.useLayoutEffect(()=>{const t=lW(()=>{r.current&&e.updateViewportScreenBounds(r.current)},200,{trailing:!0}),n=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const i=new ResizeObserver(a=>{a[0].contentRect&&t()}),s=r.current;let o=null;return s&&(i.observe(s),o=k1e(s),o.addEventListener("scroll",t)),()=>{clearInterval(n),window.removeEventListener("resize",t),i.disconnect(),o?.removeEventListener("scroll",t),t.cancel()}},[e,r])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const k1e=r=>{let e=r.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};function C1e(r=!0){const[e,t]=k.useState(0),n=z();k.useEffect(()=>{if(!r)return;const i=()=>t(s=>s+1);return n.on("tick",i),()=>{n.off("tick",i)}},[n,r])}const T1e=In(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){const i=z();C1e(n);const s=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:a}}=i;return x.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(l=>{const c=i.getShape(l.id);if(c.type==="group")return null;const u=i.getShapeGeometry(c),d=i.getShapePageTransform(c),h=i.getPointInShapeSpace(c,a),f=u.nearestPoint(h),p=u.distanceToPoint(h,!0),m=Math.abs(p)*s,g=p<0,{vertices:y}=u;return x.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&x.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:x.jsx(uG,{geometry:u})}),t&&y.map((S,w)=>x.jsx("circle",{cx:S.x,cy:S.y,r:2/s,fill:`hsl(${oo(w,[0,y.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${w}`)),n&&m<150&&x.jsx("line",{x1:f.x,y1:f.y,x2:h.x,y2:h.y,opacity:1-m/150,stroke:g?"goldenrod":"dodgerblue",strokeWidth:2/s})]},l.id+"_outline")})})});function uG({geometry:r}){return r instanceof ts?x.jsx("g",{stroke:r.debugColor,children:[...r.children,...r.ignoredChildren].map((e,t)=>x.jsx(uG,{geometry:e},t))}):x.jsx("path",{d:r.toSimpleSvgPath(),stroke:r.debugColor})}function dG(r){return Mme(r)}function hG(){const r=z(),e=Mye("userIds",()=>dG(r.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,n)=>t.join(",")===n.join?.(",")},[r]);return F(e)}function $1(r){const e=z();return F(`latestPresence:${r}`,()=>e.getCollaborators().find(n=>n.userId===r),[e,r])??null}const E1e=In(function(){return hG().map(t=>x.jsx(M1e,{collaboratorId:t},t))}),M1e=In(function({collaboratorId:e}){const t=z(),n=$1(e),i=P1e(t,n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:s,highlightedUserIds:o}=t.getInstanceState();if(!(s===n.userId||o.includes(n.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||s.includes(n.userId)))return null;break}}return x.jsx(I1e,{latestPresence:n})}),I1e=In(function({latestPresence:e}){const t=z(),{CollaboratorBrush:n,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:o,CollaboratorShapeIndicator:a}=Tt(),l=t.getZoomLevel(),c=t.getViewportPageBounds(),{userId:u,chatMessage:d,brush:h,scribbles:f,selectedShapeIds:p,userName:m,cursor:g,color:y}=e;if(!g)return null;const S=!(g.x<c.minX-12/l||g.y<c.minY-16/l||g.x>c.maxX-12/l||g.y>c.maxY-16/l);return x.jsxs(x.Fragment,{children:[h&&n?x.jsx(n,{className:"tl-collaborator__brush",userId:u,brush:h,color:y,opacity:.1},u+"_brush"):null,S&&s?x.jsx(s,{className:"tl-collaborator__cursor",userId:u,point:g,color:y,zoom:l,name:m!=="New User"?m:null,chatMessage:d??""},u+"_cursor"):o?x.jsx(o,{className:"tl-collaborator__cursor-hint",userId:u,point:g,color:y,zoom:l,viewport:c},u+"_cursor_hint"):null,i&&f.length?x.jsx(x.Fragment,{children:f.map(w=>x.jsx(i,{className:"tl-collaborator__scribble",userId:u,scribble:w,color:y,zoom:l,opacity:w.color==="laser"?.5:.1},u+"_scribble_"+w.id))}):null,a&&p.filter(w=>!t.isShapeHidden(w)).map(w=>x.jsx(a,{className:"tl-collaborator__shape-indicator",userId:u,shapeId:w,color:y,opacity:.5},u+"_"+w))]})});function hL(r,e){return e>r.options.collaboratorInactiveTimeoutMs?"inactive":e>r.options.collaboratorIdleTimeoutMs?"idle":"active"}function P1e(r,e){const t=k.useRef(e?.lastActivityTimestamp??-1),[n,i]=k.useState(()=>hL(r,Date.now()-t.current));return k.useEffect(()=>{const s=r.timers.setInterval(()=>{i(hL(r,Date.now()-t.current))},r.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[r]),e&&(t.current=e.lastActivityTimestamp??1/0),n}function A1e(){const r=z(),e=F("is menu open",()=>r.menus.hasAnyOpenMenus(),[r]),[t,n]=k.useState(!1),i=e||t,s=y1(),o=k.useRef({isDown:!1,isDragging:!1,start:new T}),a=k.useCallback(d=>{d.button===0&&(n(!0),o.current={isDown:!0,isDragging:!1,start:new T(d.clientX,d.clientY)},l.current=!1),r.menus.clearOpenMenus()},[r]),l=k.useRef(!1),c=k.useCallback(d=>{if(!o.current.isDown)return;const{x:h,y:f}=o.current.start;l.current||T.Dist2(o.current.start,new T(d.clientX,d.clientY))>r.options.dragDistanceSquared&&(l.current=!0,o.current={...o.current,isDown:!0,isDragging:!0},s.onPointerDown?.({...d,clientX:h,clientY:f,button:0})),l.current&&r.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...nr(r,d)})},[s,r]),u=k.useCallback(d=>{s.onPointerUp?.(d),n(!1),o.current={isDown:!1,isDragging:!1,start:new T(d.clientX,d.clientY)},l.current=!1},[s]);return i&&x.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...s,onPointerDown:a,onPointerMove:c,onPointerUp:u})}function $1e({className:r}){const e=z(),{SelectionBackground:t,Background:n,SvgDefs:i,ShapeIndicators:s}=Tt(),o=k.useRef(null),a=k.useRef(null),l=k.useRef(null),c=Pn();v1e(o),LSe(),jSe(),w1e(o),yke(o);const u=k.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});cd("position layers",function(){const{x:w,y:b,z:v}=e.getCamera();if(u.current.allowTextOutline&&ht.isSafari&&(c.style.setProperty("--tl-text-outline","none"),u.current.allowTextOutline=!1),u.current.allowTextOutline&&v<e.options.textShadowLod!==u.current.lodDisableTextOutline){const M=v<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",M?"none":"var(--tl-text-outline-reference)"),u.current.lodDisableTextOutline=M}const C=v>=1?oo(v,[1,8],[.125,.5],!0):oo(v,[.1,1],[-2,.125],!0),E=`scale(${D(v)}) translate(${D(w+C)}px,${D(b+C)}px)`;dr(a.current,"transform",E),dr(l.current,"transform",E)},[e,c]);const d=y1(),h=F("shapeSvgDefs",()=>{const S=new Map;for(const w of pn(e.shapeUtils)){if(!w)return;const b=w.getCanvasSvgDefs();for(const{key:v,component:C}of b)S.has(v)||S.set(v,x.jsx(C,{},v))}return[...S.values()]},[e]),f=F("debug_shapes",()=>Yt.hideShapes.get(),[Yt]),p=F("debug_svg",()=>Yt.debugSvg.get(),[Yt]),m=F("debug_geometry",()=>Yt.debugGeometry.get(),[Yt]),g=F("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),y=F("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return x.jsxs(x.Fragment,{children:[x.jsxs("div",{ref:o,draggable:!1,"data-iseditinganything":g,"data-isselectinganything":y,className:oe("tl-canvas",r),"data-testid":"canvas",...d,children:[x.jsx("svg",{className:"tl-svg-context","aria-hidden":"true",children:x.jsxs("defs",{children:[h,x.jsx(K1e,{}),x.jsx(J1e,{}),i&&x.jsx(i,{})]})}),n&&x.jsx("div",{className:"tl-background__wrapper",children:x.jsx(n,{})}),x.jsx(O1e,{}),x.jsxs("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[x.jsx(X1e,{}),t&&x.jsx(Y1e,{}),f?null:p?x.jsx(U1e,{}):x.jsx(H1e,{})]}),x.jsx("div",{className:"tl-overlays",children:x.jsxs("div",{ref:l,className:"tl-html-layer",children:[m?x.jsx(T1e,{}):null,x.jsx(_1e,{}),x.jsx(N1e,{}),x.jsx(D1e,{}),s&&x.jsx(s,{}),x.jsx(q1e,{}),x.jsx(F1e,{}),x.jsx(G1e,{}),x.jsx(z1e,{}),x.jsx(L1e,{}),x.jsx(E1e,{})]})}),x.jsx(Z1e,{})]}),x.jsx("div",{className:"tl-canvas__in-front",onPointerDown:e.markEventAsHandled,onPointerUp:e.markEventAsHandled,onTouchStart:e.markEventAsHandled,onTouchEnd:e.markEventAsHandled,children:x.jsx(R1e,{})}),x.jsx(A1e,{})]})}function R1e(){const{InFrontOfTheCanvas:r}=Tt();return r?x.jsx(r,{}):null}function O1e(){const r=z(),e=F("gridSize",()=>r.getDocumentSettings().gridSize,[r]),{x:t,y:n,z:i}=F("camera",()=>r.getCamera(),[r]),s=F("isGridMode",()=>r.getInstanceState().isGridMode,[r]),{Grid:o}=Tt();return o&&s?x.jsx(o,{x:t,y:n,z:i,size:e}):null}function N1e(){const r=z(),e=F("scribbles",()=>r.getInstanceState().scribbles,[r]),t=F("zoomLevel",()=>r.getZoomLevel(),[r]),{Scribble:n}=Tt();return n&&e.length?e.map(i=>x.jsx(n,{className:"tl-user-scribble",scribble:i,zoom:t},i.id)):null}function _1e(){const r=z(),e=F("brush",()=>r.getInstanceState().brush,[r]),{Brush:t}=Tt();return t&&e?x.jsx(t,{className:"tl-user-brush",brush:e}):null}function D1e(){const r=z(),e=F("zoomBrush",()=>r.getInstanceState().zoomBrush,[r]),{ZoomBrush:t}=Tt();return t&&e?x.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function F1e(){const r=z(),e=F("snapLines",()=>r.snaps.getIndicators(),[r]),t=F("zoomLevel",()=>r.getZoomLevel(),[r]),{SnapIndicator:n}=Tt();return n&&e.length>0?e.map(i=>x.jsx(n,{className:"tl-user-snapline",line:i,zoom:t},i.id)):null}function z1e(){const r=z(),e=F("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:n}=r.getInstanceState();if(t||n)return!1;const i=r.getOnlySelectedShape();return!i||!r.getShapeHandles(i)?!1:i.id},[r]);return e?x.jsx(B1e,{shapeId:e}):null}function B1e({shapeId:r}){const e=z(),{Handles:t}=Tt(),n=F("zoomLevel",()=>e.getZoomLevel(),[e]),i=F("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=F("handles transform",()=>e.getShapePageTransform(r),[e,r]),o=F("handles",()=>{const l=e.getShapeHandles(r);if(!l)return null;const c=(i?e.options.coarseHandleRadius:e.options.handleRadius)/n*2;return l.filter(u=>u.type!=="virtual"||!l.some(d=>d!==u&&d.type==="vertex"&&T.Dist(u,d)<c)).sort(u=>u.type==="vertex"?1:-1)},[e,n,i,r]),a=F("isHidden",()=>e.isShapeHidden(r),[e,r]);return!t||!o||!s||a?null:x.jsx(t,{children:x.jsx("g",{transform:J.toCssString(s),children:o.map(l=>x.jsx(j1e,{shapeId:r,handle:l,zoom:n,isCoarse:i},l.id))})})}function j1e({shapeId:r,handle:e,zoom:t,isCoarse:n}){const i=b1e(r,e.id),{Handle:s}=Tt();return s?x.jsx("g",{role:"button","aria-label":e.label||"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:x.jsx(s,{shapeId:r,handle:e,zoom:t,isCoarse:n})}):null}function L1e(){const{Overlays:r}=Tt();return r?x.jsx("div",{className:"tl-custom-overlays tl-overlays__item",children:x.jsx(r,{})}):null}function U1e(){const r=z();return F("rendering shapes",()=>r.getRenderingShapes(),[r]).map(t=>x.jsxs(k.Fragment,{children:[x.jsx(Qq,{...t}),x.jsx(V1e,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function W1e(){const r=z(),e=k.useRef(new Set);return cd("reflow for culled shapes",()=>{const t=r.getCulledShapes();if(e.current.size===t.size&&[...t].every(i=>e.current.has(i)))return;e.current=t;const n=document.getElementsByClassName("tl-canvas");n.length!==0&&n[0].offsetHeight},[r]),null}function H1e(){const r=z(),e=F("rendering shapes",()=>r.getRenderingShapes(),[r]);return x.jsxs(x.Fragment,{children:[e.map(t=>x.jsx(Qq,{...t},t.id+"_shape")),ht.isSafari&&x.jsx(W1e,{})]})}function q1e(){const r=z(),{ShapeIndicator:e}=Tt(),t=F("hinting shape ids",()=>NO(r.getHintingShapeIds()),[r]);return!t.length||!e?null:t.map(n=>x.jsx(e,{className:"tl-user-indicator__hint",shapeId:n},n+"_hinting"))}function K1e(){return x.jsxs("g",{id:ro("cursor"),children:[x.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[x.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),x.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),x.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[x.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),x.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),x.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[x.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),x.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function J1e(){const r=ro("cursor_hint");return x.jsx("path",{id:r,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function V1e({id:r,mode:e}){const t=z(),[n,i]=k.useState(null),s=F("is in root",()=>t.getShape(r)?.parentId===t.getCurrentPageId(),[t,r]);return k.useEffect(()=>{if(!s)return;let o=null;const a=Zi("shape to svg",async()=>{const l=Math.random();o=l;const u=t.isShapeOfType(r,"frame")?0:10;let d=t.getShapePageBounds(r);if(!d)return;d=d.clone().expandBy(u);const h=await t.getSvgString([r],{padding:u});if(o!==l||!h)return;const f=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;i({src:f,bounds:d})});return()=>{o=null,a()}},[t,r,s]),!s||!n?null:e==="iframe"?x.jsx("iframe",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):x.jsx("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function G1e(){const r=z(),e=F("selection rotation",function(){return r.getSelectionRotation()},[r]),t=F("selection bounds",()=>r.getSelectionRotatedPageBounds(),[r]),{SelectionForeground:n}=Tt();return!t||!n?null:x.jsx(n,{bounds:t,rotation:e})}function Y1e(){const r=z(),e=F("selection rotation",()=>r.getSelectionRotation(),[r]),t=F("selection bounds",()=>r.getSelectionRotatedPageBounds(),[r]),{SelectionBackground:n}=Tt();return!t||!n?null:x.jsx(n,{bounds:t,rotation:e})}function X1e(){const{OnTheCanvas:r}=Tt();return r?x.jsx(r,{}):null}function Z1e(){const r=z(),e=F("camera state",()=>r.getCameraState(),[r]);return x.jsx("div",{className:oe("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function Pl({children:r,className:e="",...t}){return x.jsx("div",{...t,className:oe("tl-html-container",e),children:r})}class Q1e{constructor(e){this.editor=e}static props;static migrations;static type}function R1(r,e,t={}){const{newPoint:n,handle:i,scaleX:s,scaleY:o}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let d=r.props.w*s,h=r.props.h*o;const f=new T(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=d-a;break}case"top":case"bottom":{f.x=(d-a)/2;break}default:f.x=0}d=a}}else if(f.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-d;break}default:f.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{f.y=h-c;break}case"right":case"left":{f.y=(h-c)/2;break}default:f.y=0}h=c}}else if(f.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{f.y=-h;break}default:f.y=-c}h=c}const{x:p,y:m}=f.rot(r.rotation).add(n);return{...r,x:p,y:m,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class mp extends ac{getGeometry(e){return new ao({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return R1(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,n){return{...t.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n)}}}function fG(r,{initialBounds:e,scaleX:t,scaleY:n,newPoint:i,handle:s}){let o;switch(s){case"bottom_left":case"bottom_right":case"top_left":case"top_right":{o=Math.max(.01,Math.max(Math.abs(t),Math.abs(n)));break}case"left":case"right":{o=Math.max(.01,Math.abs(t));break}case"bottom":case"top":{o=Math.max(.01,Math.abs(n));break}default:throw at(s)}const a=new T(0,0);t<0&&(a.x=-(e.width*o)),n<0&&(a.y=-(e.height*o));const{x:l,y:c}=T.Add(i,a.rot(r.rotation));return{x:l,y:c,props:{scale:o*r.props.scale}}}let eCe=class extends he{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},tCe=class extends he{static id="pointing";onPointerMove(e){const{editor:t}=this;if(t.inputs.isDragging){const{originPagePoint:n}=t.inputs,i=this.parent.shapeType,s=Ct(),o=t.markHistoryStoppingPoint(`creating_box:${s}`),a=ms(n,t);if(this.editor.createShapes([{id:s,type:i,x:a.x,y:a.y,props:{w:1,h:1}}]),!t.getShape(s)){this.cancel();return}t.select(s);const c=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:c.onCreate?u=>c.onCreate?.(u):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,n=Ct();this.editor.markHistoryStoppingPoint(`creating_box:${n}`),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(n);if(!i){this.cancel();return}let{w:s,h:o}=i.props;const a=new T(s/2,o/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation());let c=1;this.editor.user.getIsDynamicResizeMode()&&(c=1/this.editor.getZoomLevel(),s*=c,o*=c,a.mul(c));const u=vn(i),d=ms(new T(i.x-a.x,i.y-a.y),this.editor);u.x=d.x,u.y=d.y,u.props.w=s,u.props.h=o,"scale"in i.props&&(u.props.scale=c),this.editor.updateShape(u),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};function ms(r,e){const t=e.getInstanceState().isGridMode,n=e.getDocumentSettings().gridSize;return t?r.clone().snapToGrid(n):r.clone()}class nCe extends he{static id="box";static initial="idle";static children(){return[eCe,tCe]}}function rCe(r,e,t){const n=k.useRef(!1),i=k.useCallback(o=>{n.current=o,o?ui.addOpenMenu(r):ui.deleteOpenMenu(r),e?.(o)},[r,e]),s=F("is menu open",()=>ui.getOpenMenus().includes(r),[r]);return k.useEffect(()=>(n.current&&(t?.("open-menu"),ui.addOpenMenu(r)),()=>{n.current&&(ui.deleteOpenMenu(r),ui.getOpenMenus().forEach(o=>{o.startsWith(r)&&(t?.("close-menu"),ui.deleteOpenMenu(o))}),n.current=!1)}),[r,t]),[s,i]}function yS(r){const e=z();return F("isEditing",()=>e.getEditingShapeId()===r,[e,r])}function iCe(r){if(!r)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Pn(),t=Sn();k.useEffect(()=>{function n(s){if(!t?.getInstanceState().isFocused||s.isSpecialRedispatchedEvent)return;Oe(s);const o=e.querySelector(".tl-canvas");if(!o)return;const a=new PointerEvent(s.type,s);a.isSpecialRedispatchedEvent=!0,o.dispatchEvent(a)}const i=r.current;if(i)return i.addEventListener("mouseover",n,{passive:!1}),()=>{i.removeEventListener("mouseover",n)}},[e,t,r])}function Ho(r){const e=z();return k.useMemo(function(){const i=c=>{if(e.wasEventAlreadyHandled(c))return;if(c.button===CN){e.dispatch({type:"pointer",target:"selection",handle:r,name:"right_click",...nr(e,c)});return}if(c.button!==0)return;const u=dv(c.currentTarget);function d(){u.removeEventListener("pointerup",d),aS(u,c)}oS(u,c),u.addEventListener("pointerup",d),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:r,...nr(e,c)}),e.markEventAsHandled(c)};let s,o;function a(c){e.wasEventAlreadyHandled(c)||c.button===0&&(c.clientX===s&&c.clientY===o||(s=c.clientX,o=c.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:r,...nr(e,c)})))}return{onPointerDown:i,onPointerMove:a,onPointerUp:c=>{e.wasEventAlreadyHandled(c)||c.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:r,...nr(e,c)})}}},[e,r])}function sCe(r){const[e,t]=k.useState(()=>({store:mv(r),opts:r}));if(!yW(e.opts,r)){const n={store:mv(r),opts:r};return t(n),n.store}return e.store}const oCe=20,aCe=8;function O1(r,e=oCe){return Math.max(aCe,Math.ceil(r/e))}class pG extends oc{_center;_radius;_start;_end;_largeArcFlag;_sweepFlag;_measure;_angleStart;_angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});const{center:t,sweepFlag:n,largeArcFlag:i,start:s,end:o}=e;if(s.equals(o))throw Error("Arc must have different start and end points.");this._angleStart=T.Angle(t,s),this._angleEnd=T.Angle(t,o),this._radius=T.Dist(t,s),this._measure=ASe(this._angleStart,this._angleEnd,n,i),this._start=s,this._end=o,this._sweepFlag=n,this._largeArcFlag=i,this._center=t}nearestPoint(e){const{_center:t,_measure:n,_radius:i,_angleEnd:s,_angleStart:o,_start:a,_end:l}=this,c=pj(n,o,s,t.angle(e));if(c<=0)return a;if(c>=1)return l;const u=T.Sub(e,t).uni().mul(i).add(t);let d,h=1/0,f;for(const p of[a,l,u])f=T.Dist2(e,p),f<h&&(d=p,h=f);if(!d)throw Error("nearest point not found");return d}hitTestLineSegment(e,t){const{_center:n,_radius:i,_measure:s,_angleStart:o,_angleEnd:a}=this,l=cS(e,t,n,i);return l===null?!1:l.some(c=>{const u=pj(s,o,a,n.angle(c));return u>=0&&u<=1})}getVertices(){const{_center:e,_measure:t,length:n,_radius:i,_angleStart:s}=this,o=[];for(let a=0,l=O1(Math.abs(n));a<l+1;a++){const c=a/l*t,u=s+c;o.push(kN(e,i,u))}return o}getSvgPathData(e=!0){const{_start:t,_end:n,_radius:i,_largeArcFlag:s,_sweepFlag:o}=this;return`${e?`M${t.toFixed()}`:""} A${i} ${i} 0 ${s} ${o} ${n.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}}class yv extends oc{constructor(e){super({isClosed:!0,...e}),this.config=e;const{x:t=0,y:n=0,radius:i}=e;this._x=t,this._y=n,this._center=new T(i+t,i+n),this._radius=i}_center;_radius;_x;_y;getBounds(){return new V(this._x,this._y,this._radius*2,this._radius*2)}getVertices(){const{_center:e,_radius:t}=this,n=At*t,i=[];for(let s=0,o=O1(n);s<o;s++){const a=s/o*At;i.push(kN(e,t,a))}return i}nearestPoint(e){const{_center:t,_radius:n}=this;return t.equals(e)?T.AddXY(t,n,0):T.Sub(e,t).uni().mul(n).add(t)}hitTestLineSegment(e,t,n=0){const{_center:i,_radius:s}=this;return cS(e,t,i,s+n)!==null}getSvgPathData(){const{_center:e,_radius:t}=this;return`M${e.x+t},${e.y} a${t},${t} 0 1,0 ${t*2},0a${t},${t} 0 1,0 -${t*2},0`}}class qN extends uS{_a;_b;_c;_d;_resolution;constructor(e){const{start:t,cp1:n,cp2:i,end:s}=e;super({...e,points:[t,s]}),this._a=t,this._b=n,this._c=i,this._d=s,this._resolution=e.resolution??10}getVertices(){const e=[],{_a:t,_b:n,_c:i,_d:s}=this;for(let o=0,a=this._resolution;o<=a;o++){const l=o/a;e.push(new T((1-l)*(1-l)*(1-l)*t.x+3*((1-l)*(1-l))*l*n.x+3*(1-l)*(l*l)*i.x+l*l*l*s.x,(1-l)*(1-l)*(1-l)*t.y+3*((1-l)*(1-l))*l*n.y+3*(1-l)*(l*l)*i.y+l*l*l*s.y))}return e}nearestPoint(e){let t,n=1/0,i,s;for(const o of this.segments)s=o.nearestPoint(e),i=T.Dist2(s,e),i<n&&(t=s,n=i);if(!t)throw Error("nearest point not found");return t}getSvgPathData(e=!0){const{_a:t,_b:n,_c:i,_d:s}=this;return`${e?`M ${t.toFixed()} `:""} C${n.toFixed()} ${i.toFixed()} ${s.toFixed()}`}static GetAtT(e,t){const{_a:n,_b:i,_c:s,_d:o}=e;return new T((1-t)*(1-t)*(1-t)*n.x+3*((1-t)*(1-t))*t*i.x+3*(1-t)*(t*t)*s.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+3*((1-t)*(1-t))*t*i.y+3*(1-t)*(t*t)*s.y+t*t*t*o.y)}getLength(e,t=32){let n,i=this._a,s=0;for(let o=1;o<=t;o++)n=qN.GetAtT(this,o/t),s+=T.Dist(i,n),i=n;return s}}class lCe extends oc{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:t,height:n}=e;this._w=t,this._h=n}_w;_h;_edges;get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){const i=e[t],s=e[(t+1)%n];this._edges.push(new Of({start:i,end:s}))}}return this._edges}getVertices(){const e=Math.max(1,this._w),t=Math.max(1,this._h),n=e/2,i=t/2,s=Math.pow(n-i,2)/Math.pow(n+i,2),o=pt*(n+i)*(1+3*s/(10+Math.sqrt(4-3*s))),a=O1(o),l=At/a,c=Math.cos(l),u=Math.sin(l);let d=0,h=1,f=0,p=1;const m=Array(a);for(let g=0;g<a;g++)m[g]=new T(_e(n+n*h,0,e),_e(i+i*d,0,t)),f=u*h+c*d,p=c*h-u*d,d=f,h=p;return m}nearestPoint(e){let t,n=1/0,i,s;for(const o of this.edges)s=o.nearestPoint(e),i=T.Dist2(s,e),i<n&&(t=s,n=i);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.edges.some(n=>n.hitTestLineSegment(e,t))}getBounds(){return new V(0,0,this._w,this._h)}getLength(){const{_w:e,_h:t}=this,n=e/2,i=t/2,s=Math.max(0,n),o=Math.max(0,i);return ESe(s,o)}getSvgPathData(e=!1){const{_w:t,_h:n}=this,i=t/2,s=n/2,o=Math.max(0,i),a=Math.max(0,s);return`${e?`M${i-o},${s}`:""} a${o},${a},0,1,1,${o*2},0a${o},${a},0,1,1,-${o*2},0`}}function wt(r,e,t){const n=new Set;for(const a of e){const l=r.getShape(a);if(!l)continue;n.add(l);const c=r.getShape(l.parentId);c&&n.add(c)}const i=new Map;for(const a of n){const l=r.getSortedChildIdsForParent(a);if(t?.filter&&!t.filter(a))i.set(a,l);else{const c=cCe(r,a.id,l);c.length<l.length&&i.set(a,l.filter(u=>!c.includes(u)))}}const s=r.getCurrentPageShapesSorted().map(a=>a.id),o={};for(const[a,l]of i){const c=Re(l.map(h=>r.getShape(h))),{reparenting:u,remainingShapesToReparent:d}=uCe(r,c,(h,f)=>t?.filter&&!t.filter(f)?!1:f.id!==a.id&&s.indexOf(f.id)<s.indexOf(h.id));if(u.forEach((h,f)=>{h.length!==0&&(o[f]||(o[f]={parentId:f,shapeIds:[]}),o[f].shapeIds.push(...h.map(p=>p.id)))}),d.size>0){const h=r.findShapeAncestor(a,f=>r.isShapeOfType(f,"group"))?.id??r.getCurrentPageId();d.forEach(f=>{if(!o[h]){let p;const m=r.getSortedChildIdsForParent(h),g=m.indexOf(a.id);if(g>-1){const y=m[g+1],S=y?r.getShape(y).index:_s(a.index);p=Pf(a.index,S)}o[h]={parentId:h,shapeIds:[],index:p}}o[h].shapeIds.push(f.id)})}}r.run(()=>{Object.values(o).forEach(({parentId:a,shapeIds:l,index:c})=>{l.length!==0&&(l.sort((u,d)=>s.indexOf(u)<s.indexOf(d)?-1:1),r.reparentShapes(l,a,c))})})}function cCe(r,e,t){if(t.length===0)return gn;const n=r.getShapePageBounds(e);if(!n)return gn;const i=r.getShapeGeometry(e),o=r.getShapePageTransform(e).applyToPoints(i.vertices),a=r.getShape(e);if(!a)return gn;const l=r.getShapePageTransform(e),c=r.getShapeUtil(a.type).getClipPath?.(a),u=c?l.applyToPoints(c):void 0,d=u?fv(u,o):o;return d?t.filter(h=>{const f=r.getShapePageBounds(h);if(!f||!n.includes(f))return!1;const p=r.getShapePageTransform(h).clone().invert().applyToPoints(d);return r.getShapeGeometry(h).overlapsPolygon(p)}):gn}function uCe(r,e,t){const n=new Set(e),i=new Set;for(const c of e){const u=r.getShapeParent(c);u&&r.isShapeOfType(u,"group")&&(i.has(u)||i.add(u))}for(const c of i){const u=Re(r.getSortedChildIdsForParent(c).map(d=>r.getShape(d)));for(const d of u)n.delete(d);n.add(c)}const s=new Map,o=new Map,a=new Set(n),l=r.getCurrentPageShapesSorted().filter(c=>r.getShapeUtil(c).canReceiveNewChildrenOfType?.(c,c.type)&&!a.has(c));e:for(let c=l.length-1;c>=0;c--){const u=l[c],d=r.findShapeAncestor(u,S=>r.isShapeOfType(S,"group"))?.id,h=r.getShapeGeometry(u),f=r.getShapePageTransform(u),p=r.getShapeMask(u),m=f.applyToPoints(h.vertices),g=p?fv(p,m):m;if(!g)continue e;const y=[];t:for(const S of a){if(u.id===S.id||t&&!t(S,u)||(s.has(S.id)||s.set(S.id,r.findShapeAncestor(S,v=>r.isShapeOfType(v,"group"))?.id),s.get(S.id)!==d)||r.findShapeAncestor(u,v=>S.id===v.id))continue t;const b=r.getShapePageTransform(S).clone().invert().applyToPoints(g);if(r.getShapeGeometry(S).overlapsPolygon(b)){if(!r.getShapeUtil(u).canReceiveNewChildrenOfType?.(u,S.type))continue t;S.parentId!==u.id&&y.push(S),a.delete(S);continue t}}y.length&&o.set(u.id,y)}return{reparenting:o,remainingShapesToReparent:a}}function mG(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=mG(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function gG(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=gG(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let we=class Xr{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Xr(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new Xr(n,i)}cutByIndex(e,t){return e==t?Xr.empty:e==0&&t==this.content.length?this:new Xr(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new Xr(i,s)}addToStart(e){return new Xr([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Xr(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return mG(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return gG(this,e,t,n)}findIndex(e){if(e==0)return rw(0,e);if(e==this.size)return rw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?rw(t+1,s):rw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Xr.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Xr(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Xr.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new Xr(t||e,n)}static from(e){if(!e)return Xr.empty;if(e instanceof Xr)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Xr([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};we.empty=new we([],0);const QE={index:0,offset:0};function rw(r,e){return QE.index=r,QE.offset=e,QE}function xv(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!xv(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!xv(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let Xt=class YP{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&xv(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return YP.none;if(e instanceof YP)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};Xt.none=[];let Sv=class extends Error{},Le=class mh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=xG(this.content,e+this.openStart,t);return n&&new mh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new mh(yG(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return mh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new mh(we.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new mh(e,n,i)}};Le.empty=new Le(we.empty,0,0);function yG(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(yG(s.content,e-i-1,t-i-1)))}function xG(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=xG(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function dCe(r,e,t){if(t.openStart>r.depth)throw new Sv("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Sv("Inconsistent open depths");return SG(r,e,t,0)}function SG(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=SG(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Mu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=hCe(t,r);return Mu(s,bG(r,o,a,e,n))}else return Mu(s,wv(r,e,n))}function wG(r,e){if(!e.type.compatibleContent(r.type))throw new Sv("Cannot join "+e.type.name+" onto "+r.type.name)}function XP(r,e,t){let n=r.node(t);return wG(n,e.node(t)),n}function Eu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function Vg(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Eu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Eu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Eu(e.nodeBefore,n)}function Mu(r,e){return r.type.checkContent(e),r.copy(e)}function bG(r,e,t,n,i){let s=r.depth>i&&XP(r,e,i+1),o=n.depth>i&&XP(t,n,i+1),a=[];return Vg(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(wG(s,o),Eu(Mu(s,bG(r,e,t,n,i+1)),a)):(s&&Eu(Mu(s,wv(r,e,i+1)),a),Vg(e,t,i,a),o&&Eu(Mu(o,wv(t,n,i+1)),a)),Vg(n,null,i,a),new we(a)}function wv(r,e,t){let n=[];if(Vg(null,r,t,n),r.depth>t){let i=XP(r,e,t+1);Eu(Mu(i,wv(r,e,t+1)),n)}return Vg(e,null,t,n),new we(n)}function hCe(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(we.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let fL=class ZP{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Xt.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new mCe(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new ZP(t,n,s)}static resolveCached(e,t){let n=pL.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else pL.set(e,n=new fCe);let i=n.elts[n.i]=ZP.resolve(e,t);return n.i=(n.i+1)%pCe,i}},fCe=class{constructor(){this.elts=[],this.i=0}};const pCe=12,pL=new WeakMap;let mCe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const gCe=Object.create(null);let Al=class QP{constructor(e,t,n,i=Xt.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||we.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&xv(this.attrs,t||e.defaultAttrs||gCe)&&Xt.sameSet(this.marks,n||Xt.none)}copy(e=null){return e==this.content?this:new QP(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new QP(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Le.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Le(c,i.depth-o,s.depth-o)}replace(e,t,n){return dCe(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return fL.resolveCached(this,e)}resolveNoCache(e){return fL.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),vG(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=we.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Xt.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Xt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=we.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Al.prototype.text=void 0;let yCe=class eA extends Al{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):vG(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new eA(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new eA(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function vG(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let _y=class kG{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new xCe(e,t);if(n.next==null)return kG.empty;let i=CG(n);n.next&&n.err("Unexpected trailing text");let s=TCe(CCe(i));return ECe(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return we.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};_y.empty=new _y(!0);let xCe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function CG(r){let e=[];do e.push(SCe(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function SCe(r){let e=[];do e.push(wCe(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function wCe(r){let e=kCe(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=bCe(r,e);else break;return e}function mL(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function bCe(r,e){let t=mL(r),n=t;return r.eat(",")&&(r.next!="}"?n=mL(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function vCe(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function kCe(r){if(r.eat("(")){let e=CG(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=vCe(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function CCe(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function TG(r,e){return e-r}function gL(r,e){let t=[];return n(e),t.sort(TG);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function TCe(r){let e=Object.create(null);return t(gL(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);gL(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new _y(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(TG);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function ECe(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function EG(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function MG(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function IG(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function PG(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new ICe(r,n,e[n]);return t}let yL=class AG{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=PG(e,n.attrs),this.defaultAttrs=EG(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==_y.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:MG(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Al(this,this.computeAttrs(e),we.from(t),Xt.setFrom(n))}createChecked(e=null,t,n){return t=we.from(t),this.checkContent(t),new Al(this,this.computeAttrs(e),t,Xt.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=we.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(we.empty,!0);return s?new Al(this,e,t.append(s),Xt.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){IG(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Xt.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new AG(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function MCe(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let ICe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?MCe(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},$G=class RG{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=PG(e,i.attrs),this.excluded=null;let s=EG(this.attrs);this.instance=s?new Xt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Xt(this,MG(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new RG(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){IG(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},OG=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=yL.compile(this.spec.nodes,this),this.marks=$G.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=_y.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?xL(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:xL(this,o.split(" "))}this.nodeFromJSON=i=>Al.fromJSON(this,i),this.markFromJSON=i=>Xt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof yL){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new yCe(n,n.defaultAttrs,e,Xt.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function xL(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function PCe(r){return r.tag!=null}function ACe(r){return r.style!=null}let eM=class tA{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(PCe(i))this.tags.push(i);else if(ACe(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new wL(this,t,!1);return n.addAll(e,Xt.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new wL(this,t,!0);return n.addAll(e,Xt.none,t.from,t.to),Le.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(OCe(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=bL(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=bL(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new tA(e,tA.schemaRules(e)))}};const NG={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},$Ce={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},_G={ol:!0,ul:!0},Dy=1,nA=2,Gg=4;function SL(r,e,t){return e!=null?(e?Dy:0)|(e==="full"?nA:0):r&&r.whitespace=="pre"?Dy|nA:t&~Gg}let iw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=Xt.none,this.match=s||(o&Gg?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(we.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Dy)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=we.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(we.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!NG.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},wL=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=SL(null,t.preserveWhitespace,0)|(n?Gg:0);i?s=new iw(i.type,i.attrs,Xt.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new iw(null,null,Xt.none,!0,null,o):s=new iw(e.schema.topNodeType,null,Xt.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&nA?"full":this.localPreserveWS||(i.options&Dy)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;_G.hasOwnProperty(o)&&this.parser.normalizeLists&&RCe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:$Ce.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(NG.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Xt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):vL(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=SL(e,s,o.options);o.options&Gg&&o.content.length==0&&(a|=Gg);let l=Xt.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):vL(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new iw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Dy)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function RCe(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&_G.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function OCe(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function bL(r){let e={};for(let t in r)e[t]=r[t];return e}function vL(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const DG=65535,FG=Math.pow(2,16);function NCe(r,e){return r+e*FG}function kL(r){return r&DG}function _Ce(r){return(r-(r&DG))/FG}const zG=1,BG=2,Ab=4,jG=8;let rA=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&jG)>0}get deletedBefore(){return(this.delInfo&(zG|Ab))>0}get deletedAfter(){return(this.delInfo&(BG|Ab))>0}get deletedAcross(){return(this.delInfo&Ab)>0}},gd=class gh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&gh.empty)return gh.empty}recover(e){let t=0,n=kL(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+_Ce(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:NCe(a/3,e-l),m=e==l?BG:e==d?zG:Ab;return(t<0?e!=l:e!=d)&&(m|=jG),new rA(f,m,p)}i+=u-c}return n?e+i:new rA(e+i,0,null)}touches(e,t){let n=0,i=kL(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new gh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?gh.empty:new gh(e<0?[0,-e,0]:[0,0,e])}};gd.empty=new gd([]);let DCe=class iA{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new iA(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new iA;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new rA(e,i,null)}};const tM=Object.create(null);let Nr=class{getMap(){return gd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=tM[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in tM)throw new RangeError("Duplicate use of step JSON ID "+e);return tM[e]=t,t.prototype.jsonID=e,t}},pi=class nm{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new nm(e,null)}static fail(e){return new nm(null,e)}static fromReplace(e,t,n,i){try{return nm.ok(e.replace(t,n,i))}catch(s){if(s instanceof Sv)return nm.fail(s.message);throw s}}};function KN(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(KN(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return we.fromArray(n)}let JN=class rm extends Nr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Le(KN(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return pi.fromReplace(e,this.from,this.to,s)}invert(){return new gp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new rm(t.pos,n.pos,this.mark)}merge(e){return e instanceof rm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new rm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new rm(t.from,t.to,e.markFromJSON(t.mark))}};Nr.jsonID("addMark",JN);let gp=class im extends Nr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Le(KN(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return pi.fromReplace(e,this.from,this.to,n)}invert(){return new JN(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new im(t.pos,n.pos,this.mark)}merge(e){return e instanceof im&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new im(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new im(t.from,t.to,e.markFromJSON(t.mark))}};Nr.jsonID("removeMark",gp);let VN=class sm extends Nr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return pi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return pi.fromReplace(e,this.pos,this.pos+1,new Le(we.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new sm(this.pos,t.marks[i]);return new sm(this.pos,this.mark)}}return new bv(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new sm(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new sm(t.pos,e.markFromJSON(t.mark))}};Nr.jsonID("addNodeMark",VN);let bv=class sA extends Nr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return pi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return pi.fromReplace(e,this.pos,this.pos+1,new Le(we.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new VN(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new sA(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new sA(t.pos,e.markFromJSON(t.mark))}};Nr.jsonID("removeNodeMark",bv);let ea=class Xc extends Nr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&oA(e,this.from,this.to)?pi.fail("Structure replace would overwrite content"):pi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new gd([this.from,this.to-this.from,this.slice.size])}invert(e){return new Xc(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Xc(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Xc)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Le.empty:new Le(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Xc(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Le.empty:new Le(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Xc(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Xc(t.from,t.to,Le.fromJSON(e,t.slice),!!t.structure)}};Nr.jsonID("replace",ea);let lc=class $b extends Nr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(oA(e,this.from,this.gapFrom)||oA(e,this.gapTo,this.to)))return pi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return pi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?pi.fromReplace(e,this.from,this.to,n):pi.fail("Content does not fit in gap")}getMap(){return new gd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new $b(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new $b(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new $b(t.from,t.to,t.gapFrom,t.gapTo,Le.fromJSON(e,t.slice),t.insert,!!t.structure)}};Nr.jsonID("replaceAround",lc);function oA(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function FCe(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new gp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new JN(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function zCe(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof $G){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new gp(o.from,o.to,o.style)))}function GN(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new ea(a,u,Le.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new gp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Le(we.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ea(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(we.empty,!0);r.replace(a,a,new Le(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function BCe(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function jCe(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!BCe(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function LCe(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=we.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=we.from(n.node(p).copy(u)),d++):l--;let h=we.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=we.from(i.node(p).copy(h)),f++):c++;r.step(new lc(l,c,o,a,new Le(u.append(h),d,f),u.size-d,!0))}function UCe(r,e,t){let n=we.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=we.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new lc(i,s,i,s,new Le(n,0,0),t.length,!0))}function WCe(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&HCe(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&UG(r,o,a,s),GN(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new lc(d,h,d+1,h-1,new Le(we.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&LG(r,o,a,s),!1}})}function LG(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function UG(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function HCe(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function qCe(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new lc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Le(we.from(o),0,0),1,!0))}function Rb(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function KCe(r,e,t=1,n){let i=r.doc.resolve(e),s=we.empty,o=we.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=we.from(i.node(a).copy(s));let u=n&&n[c];o=we.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new ea(e,e,new Le(s.append(o),t,t),!0))}function WG(r,e){let t=r.resolve(e),n=t.index();return HG(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function JCe(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function HG(r,e){return!!(r&&e&&!r.isLeaf&&JCe(r,e))}function qG(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&HG(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function VCe(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);UG(r,u.node(),u.before(),a)}o.inlineContent&&GN(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new ea(c,l.map(e+t,-1),Le.empty,!0)),n===!0){let u=r.doc.resolve(c);LG(r,u.node(),u.before(),r.steps.length)}return r}function GCe(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function YCe(r,e,t=e,n=Le.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return KG(i,s,n)?new ea(e,t,n):new XCe(i,s,n).fit()}function KG(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let XCe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=we.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=we.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Le(s,o,a);return e>-1?new lc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new ea(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=nM(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(we.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=nM(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Le(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=nM(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Le(om(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Le(om(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(JG(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=am(this.placed,t,we.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Le.empty:new Le(om(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Le(om(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!rM(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=rM(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=rM(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=am(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=am(this.placed,this.depth,we.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(we.empty,!0);t.childCount&&(this.placed=am(this.placed,this.frontier.length,t))}};function om(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(om(r.firstChild.content,e-1,t)))}function am(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(am(r.lastChild.content,e-1,t)))}function nM(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function JG(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,JG(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(we.empty,!0)))),r.copy(n)}function rM(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!ZCe(t,s.content,o)?a:null}function ZCe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function QCe(r){return r.spec.defining||r.spec.definingForContent}function eTe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(KG(i,s,n))return r.step(new ea(e,t,n));let o=GG(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=QCe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Le(VG(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function VG(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(VG(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(we.empty,!0))}return r}function tTe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=GCe(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Le(we.from(n),0,0))}function nTe(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=GG(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function GG(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let YG=class Ob extends Nr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return pi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return pi.fromReplace(e,this.pos,this.pos+1,new Le(we.from(i),0,t.isLeaf?0:1))}getMap(){return gd.empty}invert(e){return new Ob(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ob(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ob(t.pos,t.attr,t.value)}};Nr.jsonID("attr",YG);let XG=class aA extends Nr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return pi.ok(n)}getMap(){return gd.empty}invert(e){return new aA(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new aA(t.attr,t.value)}};Nr.jsonID("docAttr",XG);let _f=class extends Error{};_f=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};_f.prototype=Object.create(Error.prototype);_f.prototype.constructor=_f;_f.prototype.name="TransformError";let rTe=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new DCe}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new _f(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Le.empty){let i=YCe(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Le(we.from(n),0,0))}delete(e,t){return this.replace(e,t,Le.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return eTe(this,e,t,n),this}replaceRangeWith(e,t,n){return tTe(this,e,t,n),this}deleteRange(e,t){return nTe(this,e,t),this}lift(e,t){return LCe(this,e,t),this}join(e,t=1){return VCe(this,e,t),this}wrap(e,t){return UCe(this,e,t),this}setBlockType(e,t=e,n,i=null){return WCe(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return qCe(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new YG(e,t,n)),this}setDocAttribute(e,t){return this.step(new XG(e,t)),this}addNodeMark(e,t){return this.step(new VN(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof Xt)t.isInSet(n.marks)&&this.step(new bv(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new bv(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return KCe(this,e,t,n),this}addMark(e,t,n){return FCe(this,e,t,n),this}removeMark(e,t,n){return zCe(this,e,t,n),this}clearIncompatible(e,t,n){return GN(this,e,t,n),this}};const iM=Object.create(null);let Ut=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new iTe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Le.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Le.empty:t),a==0&&EL(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),EL(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Ti(e):yh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?yh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):yh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new hf(e.node(0))}static atStart(e){return yh(e,e,0,0,1)||new hf(e)}static atEnd(e){return yh(e,e,e.content.size,e.childCount,-1)||new hf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=iM[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in iM)throw new RangeError("Duplicate use of selection JSON ID "+e);return iM[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ti.between(this.$anchor,this.$head).getBookmark()}};Ut.prototype.visible=!0;let iTe=class{constructor(e,t){this.$from=e,this.$to=t}},CL=!1;function TL(r){!CL&&!r.parent.inlineContent&&(CL=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Ti=class lm extends Ut{constructor(e,t=e){TL(e),TL(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Ut.near(n);let i=e.resolve(t.map(this.anchor));return new lm(i.parent.inlineContent?i:n,n)}replace(e,t=Le.empty){if(super.replace(e,t),t==Le.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof lm&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ZG(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new lm(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Ut.findFrom(t,n,!0)||Ut.findFrom(t,-n,!0);if(s)t=s.$head;else return Ut.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Ut.findFrom(e,-n,!0)||Ut.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new lm(e,t)}};Ut.jsonID("text",Ti);let ZG=class QG{constructor(e,t){this.anchor=e,this.head=t}map(e){return new QG(e.map(this.anchor),e.map(this.head))}resolve(e){return Ti.between(e.resolve(this.anchor),e.resolve(this.head))}},Bl=class cm extends Ut{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Ut.near(s):new cm(s)}content(){return new Le(we.from(this.node),0,0)}eq(e){return e instanceof cm&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new sTe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new cm(e.resolve(t.anchor))}static create(e,t){return new cm(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Bl.prototype.visible=!1;Ut.jsonID("node",Bl);let sTe=class eY{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new ZG(n,n):new eY(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Bl.isSelectable(n)?new Bl(t):Ut.near(t)}},hf=class Nb extends Ut{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Le.empty){if(t==Le.empty){e.delete(0,e.doc.content.size);let n=Ut.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Nb(e)}map(e){return new Nb(e)}eq(e){return e instanceof Nb}getBookmark(){return oTe}};Ut.jsonID("all",hf);const oTe={map(){return this},resolve(r){return new hf(r)}};function yh(r,e,t,n,i,s=!1){if(e.inlineContent)return Ti.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Bl.isSelectable(a))return Bl.create(r,t-(i<0?a.nodeSize:0))}else{let l=yh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function EL(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof ea||i instanceof lc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Ut.near(r.doc.resolve(o),t))}function ML(r,e){return!e||!r?r:r.bind(e)}let sw=class{constructor(e,t,n){this.name=e,this.init=ML(t.init,n),this.apply=ML(t.apply,n)}};new sw("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new sw("selection",{init(r,e){return r.selection||Ut.atStart(e.doc)},apply(r){return r.selection}}),new sw("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new sw("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function tY(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=tY(i,e,{})),t[n]=i}return t}let Hd=class{constructor(e){this.spec=e,this.props={},e.props&&tY(e.props,this,this.props),this.key=e.key?e.key.key:nY("plugin")}getState(e){return e[this.key]}};const sM=Object.create(null);function nY(r){return r in sM?r+"$"+ ++sM[r]:(sM[r]=0,r+"$")}let qd=class{constructor(e="key"){this.key=nY(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var aTe=Object.defineProperty,rY=(r,e)=>{for(var t in e)aTe(r,t,{get:e[t],enumerable:!0})};function iY(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var lTe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:iY({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}};function cTe(r,e){const t=new rTe(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}var sY=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&sY(n)}return r};function ow(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return sY(t)}function Fy(r,e,t){if(r instanceof Al||r instanceof we)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return we.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),Fy("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new OG({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?eM.fromSchema(l).parseSlice(ow(r),t.parseOptions):eM.fromSchema(l).parse(ow(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=eM.fromSchema(e);return t.slice?s.parseSlice(ow(r),t.parseOptions).content:s.parse(ow(r),t.parseOptions)}return Fy("",e,t)}function uTe(r,e,t={},n={}){return Fy(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}function dTe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function hTe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function YN(r){return e=>hTe(e.$from,r)}function lt(r,e,t){return r.config[e]===void 0&&r.parent?lt(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?lt(r.parent,e,t):null}):r.config[e]}function oY(r){return r.map(e=>{const t={name:e.name,options:e.options,storage:e.storage},n=lt(e,"addExtensions",t);return n?[e,...oY(n())]:e}).flat(10)}function fTe(r){return typeof r=="function"}function fn(r,e=void 0,...t){return fTe(r)?e?r.bind(e)(...t):r(...t):r}function pTe(r={}){return Object.keys(r).length===0&&r.constructor===Object}function XN(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function mTe(r){const e=[],{nodeExtensions:t,markExtensions:n}=XN(r),i=[...t,...n],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=lt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{e.push({type:d,name:h,attribute:{...s,...f}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=lt(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...s,...d};typeof h?.default=="function"&&(h.default=h.default()),h?.isRequired&&h?.default===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function gTe(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function IL(r,e){return e.filter(t=>t.type===r.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,n)=>gTe(t,n),{})}function yTe(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function PL(r,e){return"style"in r?r:{...r,getAttrs:t=>{const n=r.getAttrs?r.getAttrs(t):r.attrs;if(n===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):yTe(t.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...n,...i}}}}function AL(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&pTe(t)?!1:t!=null))}function xTe(r,e){var t;const n=mTe(r),{nodeExtensions:i,markExtensions:s}=XN(r),o=(t=i.find(c=>lt(c,"topNode")))==null?void 0:t.name,a=Object.fromEntries(i.map(c=>{const u=n.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((y,S)=>{const w=lt(S,"extendNodeSchema",d);return{...y,...w?w(c):{}}},{}),f=AL({...h,content:fn(lt(c,"content",d)),marks:fn(lt(c,"marks",d)),group:fn(lt(c,"group",d)),inline:fn(lt(c,"inline",d)),atom:fn(lt(c,"atom",d)),selectable:fn(lt(c,"selectable",d)),draggable:fn(lt(c,"draggable",d)),code:fn(lt(c,"code",d)),whitespace:fn(lt(c,"whitespace",d)),linebreakReplacement:fn(lt(c,"linebreakReplacement",d)),defining:fn(lt(c,"defining",d)),isolating:fn(lt(c,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var S,w;return[y.name,{default:(S=y?.attribute)==null?void 0:S.default,validate:(w=y?.attribute)==null?void 0:w.validate}]}))}),p=fn(lt(c,"parseHTML",d));p&&(f.parseDOM=p.map(y=>PL(y,u)));const m=lt(c,"renderHTML",d);m&&(f.toDOM=y=>m({node:y,HTMLAttributes:IL(y,u)}));const g=lt(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(s.map(c=>{const u=n.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((g,y)=>{const S=lt(y,"extendMarkSchema",d);return{...g,...S?S(c):{}}},{}),f=AL({...h,inclusive:fn(lt(c,"inclusive",d)),excludes:fn(lt(c,"excludes",d)),group:fn(lt(c,"group",d)),spanning:fn(lt(c,"spanning",d)),code:fn(lt(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y,S;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(S=g?.attribute)==null?void 0:S.validate}]}))}),p=fn(lt(c,"parseHTML",d));p&&(f.parseDOM=p.map(g=>PL(g,u)));const m=lt(c,"renderHTML",d);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:IL(g,u)})),[c.name,f]}));return new OG({topNode:o,nodes:a,marks:l})}function STe(r){const e=r.filter((t,n)=>r.indexOf(t)!==n);return Array.from(new Set(e))}function wTe(r){return r.sort((t,n)=>{const i=lt(t,"priority")||100,s=lt(n,"priority")||100;return i>s?-1:i<s?1:0})}function bTe(r){const e=wTe(oY(r)),t=STe(e.map(n=>n.name));return t.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${t.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function vTe(r,e){const t=bTe(r);return xTe(t,e)}function kTe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function CTe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function cc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}function TTe(r,e){const t=cc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function xr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function aY(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function ETe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function MTe(r){const e=ETe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function ITe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),MTe(n)}function PTe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function vv(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:PTe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function lY(r,e,t={}){return r.find(n=>n.type===e&&vv(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function $L(r,e,t={}){return!!lY(r,e,t)}function cY(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!lY([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&$L([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&$L([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function _b(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function ATe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?cc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>vv(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>vv(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function ZN(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?xr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>vv(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}function RL(r,e){const{nodeExtensions:t}=XN(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=fn(lt(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function uY(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(uY(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function dY(r){return r instanceof Ti}function uu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function $Te(r,e=null){if(!e)return null;const t=Ut.atStart(r),n=Ut.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Ti.create(r,uu(0,i,s),uu(r.content.size,i,s)):Ti.create(r,uu(e,i,s),uu(e,i,s))}function RTe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof ea||i instanceof lc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Ut.near(r.doc.resolve(o),t))}function OTe(r){return Object.prototype.toString.call(r).slice(8,-1)}function aw(r){return OTe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function hY(r,e){const t={...r};return aw(r)&&aw(e)&&Object.keys(e).forEach(n=>{aw(e[n])&&aw(r[n])?t[n]=hY(r[n],e[n]):t[n]=e[n]}),t}var NTe=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...fn(lt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...fn(lt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>hY(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},_Te={};rY(_Te,{ClipboardTextSerializer:()=>DTe,Commands:()=>qEe,Delete:()=>KEe,Drop:()=>JEe,Editable:()=>VEe,FocusEvents:()=>GEe,Keymap:()=>YEe,Paste:()=>XEe,Tabindex:()=>ZEe,focusEventsPluginKey:()=>gY});var Ga=class fY extends NTe{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new fY(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},DTe=Ga.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Hd({key:new qd("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=CTe(t);return kTe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),pY={};rY(pY,{blur:()=>FTe,clearContent:()=>zTe,clearNodes:()=>BTe,command:()=>jTe,createParagraphNear:()=>LTe,cut:()=>UTe,deleteCurrentNode:()=>WTe,deleteNode:()=>HTe,deleteRange:()=>qTe,deleteSelection:()=>KTe,enter:()=>JTe,exitCode:()=>VTe,extendMarkRange:()=>GTe,first:()=>YTe,focus:()=>ZTe,forEach:()=>QTe,insertContent:()=>eEe,insertContentAt:()=>nEe,joinBackward:()=>sEe,joinDown:()=>iEe,joinForward:()=>oEe,joinItemBackward:()=>aEe,joinItemForward:()=>lEe,joinTextblockBackward:()=>cEe,joinTextblockForward:()=>uEe,joinUp:()=>rEe,keyboardShortcut:()=>hEe,lift:()=>fEe,liftEmptyBlock:()=>pEe,liftListItem:()=>mEe,newlineInCode:()=>gEe,resetAttributes:()=>yEe,scrollIntoView:()=>xEe,selectAll:()=>SEe,selectNodeBackward:()=>wEe,selectNodeForward:()=>bEe,selectParentNode:()=>vEe,selectTextblockEnd:()=>kEe,selectTextblockStart:()=>CEe,setContent:()=>TEe,setMark:()=>MEe,setMeta:()=>IEe,setNode:()=>PEe,setNodeSelection:()=>AEe,setTextSelection:()=>$Ee,sinkListItem:()=>REe,splitBlock:()=>OEe,splitListItem:()=>NEe,toggleList:()=>_Ee,toggleMark:()=>DEe,toggleNode:()=>FEe,toggleWrap:()=>zEe,undoInputRule:()=>BEe,unsetAllMarks:()=>jEe,unsetMark:()=>LEe,updateAttributes:()=>UEe,wrapIn:()=>WEe,wrapInList:()=>HEe});var FTe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),zTe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),BTe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=jCe(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},jTe=r=>e=>r(e),LTe=()=>({state:r,dispatch:e})=>uo(r,e),UTe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Ti(n.doc.resolve(Math.max(o-1,0)))),!0},WTe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1},HTe=r=>({tr:e,state:t,dispatch:n})=>{const i=xr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},qTe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},KTe=()=>({state:r,dispatch:e})=>ho(r,e),JTe=()=>({commands:r})=>r.keyboardShortcut("Enter"),VTe=()=>({state:r,dispatch:e})=>fo(r,e),GTe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=cc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=cY(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ti.create(o,d.from,d.to);t.setSelection(h)}}return!0},YTe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function XTe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function QN(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var ZTe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(QN()||XTe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!dY(t.state.selection))return o(),!0;const a=$Te(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},QTe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),eEe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),tEe=r=>!("type"in r),nEe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{Fy(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=Fy(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((tEe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof we){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&RTe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},rEe=()=>({state:r,dispatch:e})=>po(r,e),iEe=()=>({state:r,dispatch:e})=>mo(r,e),sEe=()=>({state:r,dispatch:e})=>go(r,e),oEe=()=>({state:r,dispatch:e})=>yo(r,e),aEe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=qG(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},lEe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=qG(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},cEe=()=>({state:r,dispatch:e})=>xo(r,e),uEe=()=>({state:r,dispatch:e})=>So(r,e);function mY(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function dEe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))QN()||mY()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var hEe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=dEe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0},fEe=(r,e={})=>({state:t,dispatch:n})=>{const i=xr(r,t.schema);return ZN(t,i,e)?wo(t,n):!1},pEe=()=>({state:r,dispatch:e})=>bo(r,e),mEe=r=>({state:e,dispatch:t})=>{const n=xr(r,e.schema);return vo(n)(e,t)},gEe=()=>({state:r,dispatch:e})=>ko(r,e);function OL(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var yEe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=aY(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(s=xr(r,n.schema)),a==="mark"&&(o=cc(r,n.schema)),i&&t.selection.ranges.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&t.setNodeMarkup(u,void 0,OL(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&t.addMark(u,u+c.nodeSize,o.create(OL(d.attrs,e)))})})}),!0):!1},xEe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),SEe=()=>({tr:r,dispatch:e})=>{if(e){const t=new hf(r.doc);r.setSelection(t)}return!0},wEe=()=>({state:r,dispatch:e})=>Co(r,e),bEe=()=>({state:r,dispatch:e})=>To(r,e),vEe=()=>({state:r,dispatch:e})=>Eo(r,e),kEe=()=>({state:r,dispatch:e})=>Mo(r,e),CEe=()=>({state:r,dispatch:e})=>Io(r,e),TEe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=uTe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function EEe(r,e,t){var n;const{selection:i}=e;let s=null;if(dY(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var MEe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=cc(r,n.schema);if(i)if(o){const c=TTe(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return EEe(n,t,l)},IEe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),PEe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=xr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},AEe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=uu(r,0,n.content.size),s=Bl.create(n,i);e.setSelection(s)}return!0},$Ee=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Ti.atStart(n).from,a=Ti.atEnd(n).to,l=uu(i,o,a),c=uu(s,o,a),u=Ti.create(n,l,c);e.setSelection(u)}return!0},REe=r=>({state:e,dispatch:t})=>{const n=xr(r,e.schema);return Po(n)(e,t)};function NL(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var OEe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=_b(c,a.node().type.name,a.node().attrs);if(s instanceof Bl&&s.node.isBlock)return!a.parentOffset||!Rb(o,a.pos)?!1:(n&&(r&&NL(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:dTe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=Rb(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Rb(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Ti&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&NL(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},NEe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=xr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=we.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=we.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={..._b(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(we.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Le(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Ti.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={..._b(h,d.type.name,d.attrs),...e},m={..._b(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!Rb(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},oM=(r,e)=>{const t=YN(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&WG(r.doc,t.pos)&&r.join(t.pos),!0},aM=(r,e)=>{const t=YN(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&WG(r.doc,n)&&r.join(n),!0},_Ee=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=xr(r,o.schema),p=xr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=YN(C=>RL(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(RL(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>oM(s,f)).command(()=>aM(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>oM(s,f)).command(()=>aM(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>oM(s,f)).command(()=>aM(s,f)).run()},DEe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=cc(r,n.schema);return ATe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},FEe=(r,e,t={})=>({state:n,commands:i})=>{const s=xr(r,n.schema),o=xr(e,n.schema),a=ZN(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},zEe=(r,e={})=>({state:t,commands:n})=>{const i=xr(r,t.schema);return ZN(t,i,e)?n.lift(i):n.wrapIn(i,e)},BEe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},jEe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},LEe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=cc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=cY(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},UEe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=aY(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(s=xr(r,n.schema)),a==="mark"&&(o=cc(r,n.schema)),i&&t.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,h,f,p;t.selection.empty?n.doc.nodesBetween(c,u,(m,g)=>{s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m)}):n.doc.nodesBetween(c,u,(m,g)=>{g<c&&s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m),g>=c&&g<=u&&(s&&s===m.type&&t.setNodeMarkup(g,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const S=Math.max(g,c),w=Math.min(g+m.nodeSize,u);t.addMark(S,w,o.create({...y.attrs,...e}))}}))}),h&&(d!==void 0&&t.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(m=>{o===m.type&&t.addMark(f,p,o.create({...m.attrs,...e}))}))}),!0):!1},WEe=(r,e={})=>({state:t,dispatch:n})=>{const i=xr(r,t.schema);return Ao(i,e)(t,n)},HEe=(r,e={})=>({state:t,dispatch:n})=>{const i=xr(r,t.schema);return $o(i,e)(t,n)},qEe=Ga.create({name:"commands",addCommands(){return{...pY}}}),KEe=Ga.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=cTe(r.before,[r,...e]);ITe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof gp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),JEe=Ga.create({name:"drop",addProseMirrorPlugins(){return[new Hd({key:new qd("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),VEe=Ga.create({name:"editable",addProseMirrorPlugins(){return[new Hd({key:new qd("editable"),props:{editable:()=>this.editor.options.editable}})]}}),gY=new qd("focusEvents"),GEe=Ga.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Hd({key:gY,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),YEe=Ga.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Ut.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return QN()||mY()?s:i},addProseMirrorPlugins(){return[new Hd({key:new qd("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Ut.atStart(e.doc).from,c=Ut.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!uY(t.doc))return;const h=t.tr,f=iY({state:t,transaction:h}),{commands:p}=new lTe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),XEe=Ga.create({name:"paste",addProseMirrorPlugins(){return[new Hd({key:new qd("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),ZEe=Ga.create({name:"tabindex",addProseMirrorPlugins(){return[new Hd({key:new qd("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});const QEe=new Ar;function eMe(r){return QEe.get(r,()=>vTe(r.extensions??[]))}function N1(r,e,t){const{tipTapConfig:n,addFontsFromNode:i}=r.getTextOptions();se(n,"textOptions.tipTapConfig must be set to use rich text"),se(i,"textOptions.addFontsFromNode must be set to use rich text");const s=eMe(n),o=Al.fromJSON(s,e),a=new Set;function l(u){a.add(u)}function c(u,d){d=i(u,d,l);for(const h of u.children)c(h,d)}return c(o,t),Array.from(a)}async function tMe({shouldReload:r=!0}={}){Qme();for(const e of Ny.connectedInstances)await e.close();await Promise.all(WN().map(e=>UV(e))),Zme(),r&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=tMe);function e_(r,e="_blank",t){return lS.openWindow(r,e,t)}ec("@tldraw/editor","4.2.1","esm");class dt{static lineThroughPoints(e,t){const n=new dt;n.moveTo(e[0].x,e[0].y,{...t,offset:t?.endOffsets??t?.offset});for(let i=1;i<e.length;i++){const s=i===e.length-1;n.lineTo(e[i].x,e[i].y,s?{offset:t?.endOffsets}:void 0)}return n}static cubicSplineThroughPoints(e,t){const n=new dt,i=e.length,s=i-2,o=1.25;n.moveTo(e[0].x,e[0].y,{...t,offset:t?.endOffsets??t?.offset});for(let a=0;a<i-1;a++){const l=a===0?e[0]:e[a-1],c=e[a],u=e[a+1],d=a===s?u:e[a+2];let h,f,p,m;a===0?(h=l.x,f=l.y):(h=c.x+(u.x-l.x)/6*o,f=c.y+(u.y-l.y)/6*o);let g;a===s?(p=u.x,m=u.y,g={offset:t?.endOffsets}):(p=u.x-(d.x-c.x)/6*o,m=u.y-(d.y-c.y)/6*o),n.cubicBezierTo(u.x,u.y,h,f,p,m,g)}return n}constructor(){}commands=[];lastMoveTo=null;assertHasMoveTo(){return se(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(e,t,n){return this.lastMoveTo={type:"move",x:e,y:t,closeIdx:null,isClose:!1,opts:n},this.commands.push(this.lastMoveTo),this}lineTo(e,t,n){return this.assertHasMoveTo(),this.commands.push({type:"line",x:e,y:t,isClose:!1,opts:n}),this}circularArcTo(e,t,n,i,s,o){return this.arcTo(e,e,t,n,0,i,s,o)}arcTo(e,t,n,i,s,o,a,l){this.assertHasMoveTo();const c=this.commands[this.commands.length-1].x,u=this.commands[this.commands.length-1].y;if(c===o&&u===a)return this;if(e===0||t===0)return this.lineTo(o,a,l);const d=s,h=Math.sin(d),f=Math.cos(d);let p=Math.abs(e),m=Math.abs(t);const g=(c-o)/2,y=(u-a)/2,S=f*g+h*y,w=-h*g+f*y,b=S*S/(p*p)+w*w/(m*m);if(b>1){const ne=Math.sqrt(b);p*=ne,m*=ne}const v=n!==i?1:-1,C=p*p*m*m-p*p*w*w-m*m*S*S,E=p*p*w*w+m*m*S*S;let M=C/E;M=M<0?0:M;const P=v*Math.sqrt(M),$=P*(p*w/m),A=P*(-(m*S)/p),O=f*$-h*A+(c+o)/2,_=h*$+f*A+(u+a)/2,I=(S-$)/p,R=(w-A)/m,B=(-S-$)/p,U=(-w-A)/m,H=Math.atan2(R,I);let L=Math.atan2(U,B);!i&&L>H?L-=2*Math.PI:i&&L<H&&(L+=2*Math.PI);const X=L-H,G=Math.max(p,m)*Math.abs(X),ce=Math.min(4,Math.ceil(Math.abs(X)/(Math.PI/2))),ae=Math.ceil(O1(G)/ce),ge=X/ce,De=ne=>({x:O+p*Math.cos(ne)*f-m*Math.sin(ne)*h,y:_+p*Math.cos(ne)*h+m*Math.sin(ne)*f}),Ne=ne=>({x:-p*Math.sin(ne)*f-m*Math.cos(ne)*h,y:-p*Math.sin(ne)*h+m*Math.cos(ne)*f});for(let ne=0;ne<ce;ne++){const ue=H+ne*ge,ze=H+(ne+1)*ge,xe=ze-ue,hn=De(ue),An=De(ze),Bt=Ne(ue),Rt=Ne(ze),Ot=4/3*Math.tan(xe/4),Jr=hn.x+Ot*Bt.x,Vr=hn.y+Ot*Bt.y,rs=An.x-Ot*Rt.x,Js=An.y-Ot*Rt.y,Fo=ne===0?l:{...l,mergeWithPrevious:!0};this.cubicBezierToWithResolution(An.x,An.y,Jr,Vr,rs,Js,Fo,ae)}return this}cubicBezierTo(e,t,n,i,s,o,a){return this.cubicBezierToWithResolution(e,t,n,i,s,o,a)}cubicBezierToWithResolution(e,t,n,i,s,o,a,l){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:e,y:t,cp1:{x:n,y:i},cp2:{x:s,y:o},isClose:!1,opts:a,resolution:l}),this}close(){const e=this.assertHasMoveTo(),t=this.commands[this.commands.length-1];return Mn(e.x,t.x)&&Mn(e.y,t.y)?t.isClose=!0:this.commands.push({type:"line",x:e.x,y:e.y,isClose:!0}),e.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(e={}){const{startIdx:t=0,endIdx:n=this.commands.length,onlyFilled:i=!1}=e,s=[];let o=!1,a=!1,l=!1;const c=u=>{if(a||u===0)return;a=!0;const d=this.commands[u-1];s.push("M",D(d.x),D(d.y))};for(let u=t;u<n;u++){const d=this.commands[u];switch(d.type){case"move":{const h=d.opts?.geometry===!1?!1:d.opts?.geometry?.isFilled??!1;i&&!h?o=!0:(o=!1,a=!0,l=!0,s.push("M",D(d.x),D(d.y)));break}case"line":if(o)break;c(u),d.isClose&&l?s.push("Z"):s.push("L",D(d.x),D(d.y));break;case"cubic":if(o)break;c(u),s.push("C",D(d.cp1.x),D(d.cp1.y),D(d.cp2.x),D(d.cp2.y),D(d.x),D(d.y));break;default:at(d,"type")}}return s.join(" ")}toSvg(e){if(e.forceSolid)return this.toSolidSvg(e);switch(e.style){case"solid":return this.toSolidSvg(e);case"dashed":case"dotted":return this.toDashedSvg(e);case"draw":return this.toDrawSvg(e);default:at(e,"style")}}toGeometry(){const e=[];let t=null;for(let n=0;n<this.commands.length;n++){const i=this.commands[n];i.type==="move"&&(t&&t.opts?.geometry!==!1&&e.push(new lA(this,t.startIdx,n,{...t.opts?.geometry,isFilled:t.opts?.geometry?.isFilled??!1,isClosed:t.moveCommand.closeIdx!==null})),t={startIdx:n,moveCommand:i,opts:i.opts,isClosed:!1}),i.isClose&&(se(t,"No current move command"),t.isClosed=!0)}return t&&t.opts?.geometry!==!1&&e.push(new lA(this,t.startIdx,this.commands.length,{...t.opts?.geometry,isFilled:t.opts?.geometry?.isFilled??!1,isClosed:t.moveCommand.closeIdx!==null})),se(e.length>0),e.length===1?e[0]:new ts({children:e})}toSolidSvg(e){const{strokeWidth:t,props:n}=e;return x.jsx("path",{strokeWidth:t,d:this.toD({onlyFilled:e.onlyFilled}),...n})}toDashedSvg(e){const{style:t,strokeWidth:n,snap:i,lengthRatio:s,props:{markerStart:o,markerEnd:a,...l}={}}=e,c=[];let u=!1,d=!1,h,f=null;const p=()=>{if(!f)return;const{startIdx:m,endIdx:g,isFirst:y,isLast:S,length:w,lineOpts:b,pathIsClosed:v}=f;if(f=null,m===g&&this.commands[m].type==="move")return;const C=b?.dashStart??e.start,E=b?.dashEnd??e.end,{strokeDasharray:M,strokeDashoffset:P}=_q(w,n,{style:t,snap:i,lengthRatio:s,start:y?C??(v?"outset":"none"):"outset",end:S?E??(v?"outset":"none"):"outset"}),$=this.toD({startIdx:m,endIdx:g+1});c.push(x.jsx("path",{d:$,strokeDasharray:M,strokeDashoffset:P,markerStart:y?o:void 0,markerEnd:S?a:void 0},c.length))};for(let m=0;m<this.commands.length;m++){const g=this.commands[m],y=this.commands[m-1];if(g.type==="move"){u=g.closeIdx!==null;const v=g.opts?.geometry===!1?!1:g.opts?.geometry?.isFilled??!1;e.onlyFilled&&!v?d=!0:(d=!1,h=g.opts);continue}if(d)continue;const S=this.calculateSegmentLength(y,g),w=y.type==="move",b=g.isClose||m===this.commands.length-1||this.commands[m+1]?.type==="move";f&&g.opts?.mergeWithPrevious?(f.length+=S,f.endIdx=m,f.isLast=b):(p(),f={startIdx:m,endIdx:m,isFirst:w,isLast:b,length:S,lineOpts:h,pathIsClosed:u})}return p(),x.jsx("g",{strokeWidth:n,...l,children:c})}toDrawSvg(e){return x.jsx("path",{strokeWidth:e.strokeWidth,d:this.toDrawD(e),...e.props})}toDrawD(e){const{strokeWidth:t,randomSeed:n,offset:i=t/3,roundness:s=t*2,passes:o=2,onlyFilled:a=!1}=e,l=[],c=this.getCommandInfo(),u=[];let d=null;for(let h=0;h<this.commands.length;h++){const f=this.commands[h],p=f.opts?.offset??i,m=f.opts?.roundness??s;f.type==="move"&&(d=h);const g=f.isClose?Dn(d)+1:!this.commands[h+1]||this.commands[h+1].type==="move"?void 0:h+1,y=g!==void 0&&this.commands[g]&&this.commands[g]?.type!=="move"?c[g]:void 0,S=_L[f.type],w=g!==void 0?_L[this.commands[g].type]:!1,b=c[h],v=b?.tangentEnd,C=y?.tangentStart,E=S&&w&&v&&C&&T.Len2(v)>.01&&T.Len2(C)>.01?oo(Math.abs(T.AngleBetween(v,C)),[Math.PI/2,Math.PI],[m,0],!0):0,P=Math.min(b?.length??1/0,y?.length??1/0)-E*2,$=_e(p,0,P/4),A=Math.min(E,(b?.length??1/0)/4),O=Math.min(E,(y?.length??1/0)/4),_={command:f,offsetAmount:$,roundnessBefore:A,roundnessAfter:O,tangentToPrev:c[h]?.tangentEnd,tangentToNext:y?.tangentStart,moveDidClose:!1};if(u.push(_),f.isClose&&d!==null){const I=u[d];I.moveDidClose=!0,I.roundnessAfter=O}else f.type==="move"&&(d=h)}for(let h=0;h<o;h++){const f=Dd(n+h);let p={x:0,y:0},m=!1;for(const{command:g,offsetAmount:y,roundnessBefore:S,roundnessAfter:w,tangentToNext:b,tangentToPrev:v}of u){const C=g.isClose?p:{x:f()*y,y:f()*y};if(g.type==="move"){p=C;const $=g.opts?.geometry===!1?!1:g.opts?.geometry?.isFilled??!1;a&&!$?m=!0:m=!1}if(m)continue;const E=T.Add(g,C),M=b&&w>0?T.Mul(b,-w).add(E):E,P=v&&S>0?T.Mul(v,S).add(E):E;if(M===E||P===E)switch(g.type){case"move":l.push("M",D(M.x),D(M.y));break;case"line":l.push("L",D(M.x),D(M.y));break;case"cubic":{const $=T.Add(g.cp1,C),A=T.Add(g.cp2,C);l.push("C",D($.x),D($.y),D(A.x),D(A.y),D(M.x),D(M.y));break}default:at(g,"type")}else switch(g.type){case"move":l.push("M",D(M.x),D(M.y));break;case"line":l.push("L",D(P.x),D(P.y),"Q",D(E.x),D(E.y),D(M.x),D(M.y));break;case"cubic":{const $=T.Add(g.cp1,C),A=T.Add(g.cp2,C);l.push("C",D($.x),D($.y),D(A.x),D(A.y),D(E.x),D(E.y));break}default:at(g,"type")}}}return l.join(" ")}calculateSegmentLength(e,t){switch(t.type){case"move":return 0;case"line":return T.Dist(e,t);case"cubic":return um.length(e.x,e.y,t.cp1.x,t.cp1.y,t.cp2.x,t.cp2.y,t.x,t.y);default:at(t,"type")}}getCommands(){return this.commands}getCommandInfo(){const e=[];for(let t=1;t<this.commands.length;t++){const n=this.commands[t-1],i=this.commands[t];if(i._info){e[t]=i._info;continue}if(i.type==="move")continue;let s,o;switch(i.type){case"line":s=o=T.Sub(n,i).uni();break;case"cubic":{s=T.Sub(i.cp1,n).uni(),o=T.Sub(i.cp2,i).uni();break}default:at(i,"type")}i._info={tangentStart:s,tangentEnd:o,length:this.calculateSegmentLength(n,i)},e[t]=i._info}return e}}const _L={line:!0,move:!0,cubic:!1};class lA extends oc{constructor(e,t,n,i){super(i),this.path=e,this.startIdx=t,this.endIdx=n}_segments=null;getSegments(){if(this._segments)return this._segments;this._segments=[];let e=this.path.commands[this.startIdx];se(e.type==="move");for(let t=this.startIdx+1;t<this.endIdx;t++){const n=this.path.commands[t];switch(se(n.type!=="move"),n.type){case"line":this._segments.push(new Of({start:T.From(e),end:T.From(n)}));break;case"cubic":{this._segments.push(new qN({start:T.From(e),cp1:T.From(n.cp1),cp2:T.From(n.cp2),end:T.From(n),resolution:n.resolution}));break}default:at(n,"type")}e=n}return this._segments}getVertices(e){const t=this.getSegments().flatMap(n=>n.getVertices(e)).filter((n,i,s)=>{const o=s[i-1];return o?!T.Equals(o,n):!0});if(this.isClosed){const n=t[t.length-1],i=t[0];T.Equals(n,i)||t.push(i)}return t}nearestPoint(e,t){let n=null,i=1/0;for(const s of this.getSegments()){const o=s.nearestPoint(e),a=T.Dist2(e,o);a<i&&(i=a,n=o)}return se(n,"No nearest point found"),n}hitTestLineSegment(e,t,n=0,i){return super.hitTestLineSegment(e,t,n,i)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}}/*!
 * Adapted from https://github.com/adobe-webplatform/Snap.svg/tree/master
 * Apache License: https://github.com/adobe-webplatform/Snap.svg/blob/master/LICENSE
 * https://github.com/adobe-webplatform/Snap.svg/blob/c8e483c9694517e24b282f8f59f985629f4994ce/dist/snap.svg.js#L5786
 */const um={base3(r,e,t,n,i){const s=-3*e+9*t-9*n+3*i,o=r*s+6*e-12*t+6*n;return r*o-3*e+3*t},length(r,e,t,n,i,s,o,a,l=1){l=l>1?1:l<0?0:l;const c=l/2,u=12;let d=0;d=0;for(let h=0;h<u;h++){const f=c*um.Tvalues[h]+c,p=um.base3(f,r,t,i,o),m=um.base3(f,e,n,s,a),g=p*p+m*m;d+=um.Cvalues[h]*Math.sqrt(g)}return c*d},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function yY(){const r=Sn(),e=F("animationSpeed",()=>r?.user.getAnimationSpeed(),[r]),[t,n]=k.useState(!1);return k.useEffect(()=>{if(e!==void 0){n(e===0);return}if(typeof window>"u"||!("matchMedia"in window))return;const i=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{n(i.matches)};return s(),i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[e]),t}const cA=k.createContext(null);function nMe({children:r}){const e=rS("a11y",{msg:"",priority:"assertive"}),t=k.useContext(cA),n=k.useMemo(()=>({currentMsg:e,announce(i){i&&e.set(i)}}),[e]);return t?x.jsx(x.Fragment,{children:r}):x.jsx(cA.Provider,{value:n,children:r})}function _1(){const r=k.useContext(cA);if(!r)throw new Error("useA11y must be used within a A11yContext.Provider");return r}const xY=k.createContext(null);function SY({assetUrls:r,children:e}){return k.useEffect(()=>{for(const t of Object.values(r.icons)){if(!t)continue;const n=My();n.crossOrigin="anonymous",n.src=t,n.decode()}for(const t of Object.values(r.embedIcons)){if(!t)continue;const n=My();n.crossOrigin="anonymous",n.src=t,n.decode()}},[r]),x.jsx(xY.Provider,{value:r,children:e})}function t_(){const r=k.useContext(xY);if(!r)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return r}const uA={"action.toggle-auto-pan":"Auto (trackpad)","action.toggle-auto-zoom":"Auto (mouse)","action.toggle-auto-none":"Auto","action.toggle-mouse":"Mouse","action.toggle-trackpad":"Trackpad","action.convert-to-bookmark":"Convert to bookmark","action.convert-to-embed":"Convert to embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Open keyboard shortcuts","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Enable keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.enhanced-a11y-mode.menu":"Enhanced accessibility mode","action.enhanced-a11y-mode":"Toggle enhanced accessibility mode","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.maximum-size":"Maximum file size is {size}","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldnt load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","fill-style.lined-fill":"Lined fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.rhombus-2":"Rhombus left","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.image-crop-confirm":"Confirm","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.rotate-shape-cw":"Rotate shape clockwise","a11y.rotate-shape-ccw":"Rotate shape counterclockwise","a11y.rotate-shape-cw-fine":"Rotate shape clockwise (fine)","a11y.rotate-shape-ccw-fine":"Rotate shape counterclockwise (fine)","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Open context menu","a11y.open-keyboard-shortcuts":"Open keyboard shortcuts","menu.title":"Menu","menu.theme":"Theme","menu.accessibility":"Accessibility","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","menu.input-mode":"Input mode","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project cant be shared because its too large. Were working on it!","share-menu.upload-failed":"Sorry, we couldnt upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following you","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the sites URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","style-panel.selected":"selected","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesnt look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Dont ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Dont ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Dont ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"Weve updated this document to work with the current version of tldraw. If youd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Dont ask again","cursor-chat.type-to-chat":"Type to chat","app.loading":"Loading tldraw","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},rMe=new Set(["ar","fa","he","ur","ku"]),oh={locale:"en",label:"English",messages:uA,dir:"ltr"};async function iMe(r,e){if(!(await Ua(e.translations.en)).ok)return console.warn("No main translations found."),oh;if(r==="en")return oh;const n=$y.find(o=>o.locale===r);if(!n)return console.warn(`No translation found for locale ${r}`),oh;const s=await(await Ua(e.translations[n.locale])).json();if(!s)return console.warn(`No messages found for locale ${r}`),oh;for(const o in oh.messages)s[o];return{locale:r,label:n.label,dir:rMe.has(n.locale)?"rtl":"ltr",messages:{...oh.messages,...s}}}const n_=k.createContext(null);function sMe(){const r=k.useContext(n_);if(!r)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return r}function wY({overrides:r,locale:e,children:t}){const n=t_(),[i,s]=k.useState(()=>r&&r.en?{locale:"en",label:"English",dir:"ltr",messages:{...uA,...r.en}}:{locale:"en",label:"English",dir:"ltr",messages:uA});return k.useEffect(()=>{let o=!1;async function a(){const l=await iMe(e,n);l&&!o&&(r&&r[e]?s({...l,messages:{...l.messages,...r[e]}}):s(l))}return a(),()=>{o=!0}},[n,e,r]),x.jsx(n_.Provider,{value:i,children:t})}function ie(){const r=sMe();return k.useCallback(function(t){return r.messages[t]??t},[r])}const oMe={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},et=k.forwardRef(function({children:e,type:t,htmlButtonType:n,isActive:i,...s},o){return x.jsx("button",{ref:o,type:n||"button",draggable:!1,"data-isactive":i,...s,className:oe("tlui-button",oMe[t],s.className),children:e})});function aMe(){const r=z(),e=ie(),t=k.useRef(null),n=k.useCallback(i=>{r.markEventAsHandled(i),t.current?.blur();const s=r.getCurrentPageShapesInReadingOrder();s.length&&(r.setSelectedShapes([s[0].id]),r.zoomToSelectionIfOffscreen(256,{animation:{duration:r.options.animationMediumMs},inset:0}),r.timers.setTimeout(()=>r.getContainer().focus(),100))},[r]);return x.jsx(et,{ref:t,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:n,children:e("a11y.skip-to-main-content")})}const lMe=k.memo(function(){const e=_1(),t=ie(),n=F("a11y-msg",()=>e.currentMsg.get(),[]);return uMe(n.msg),cMe(),n.msg&&x.jsx("div",{"aria-label":t("a11y.status"),"aria-live":n.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:n.msg})});function bY(r){const{editor:e,selectedShapeIds:t,msg:n}=r;let i="";const s=t.length;if(s>1)i=n("a11y.multiple-shapes").replace("{num}",s.toString());else if(s===1){const o=t[0],a=e.getShape(o);if(!a)return"";const l=e.getShapeUtil(a.type),c=["image","video"].includes(a.type);let u="";a.type==="geo"?u=n(`geo-style.${a.props.geo}`):c?u=n(`a11y.shape-${a.type}`):u=n(`tool.${a.type}`);const d=e.getCurrentPageShapesInReadingOrder(),h=(d.findIndex(g=>g.id===o)+1).toString(),f=d.length.toString(),p=n("a11y.shape-index").replace("{num}",h).replace("{total}",f),m=l.getAriaDescriptor(a)||l.getText(a)||"";i=(m?`${m}, `:"")+`${u}. ${p}`}return i}const cMe=()=>{const r=Sn(),e=_1(),t=ie(),n=k.useRef([]);tN("announce selection",()=>{if(!r)return;if(r.isIn("select.idle")){const s=r.getSelectedShapeIds();s!==n.current&&(n.current=s,em(()=>{const o=bY({editor:r,selectedShapeIds:s,msg:t});o&&e.announce({msg:o})}))}},[r,e,t])},uMe=r=>{const e=Pn();k.useEffect(()=>{if(Yt.a11y.get()){const t=i=>{console.debug(`%ca11y%c: ${i}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},n=i=>{const s=document.activeElement;if(i.key==="Tab"&&s&&s!==document.body&&!s.classList.contains("tl-container")){const o=s.getAttribute("aria-label")||s.getAttribute("title")||s.textContent;o&&t(o)}};return r&&t(r),document.addEventListener("keyup",n),()=>document.removeEventListener("keyup",n)}},[e,r])},zy=300,r_=320,dA=46,dMe=101;function vY(r,e){const t=e?r.getAsset(e):null;return t&&!t.props.image?t.props.title?dMe:dA:r_}function DL(r,e){return{...e,props:{...e.props,h:vY(r,e.props.assetId)}}}const hMe=r=>{try{return new URL(r).hostname.replace(/^www\./,"")}catch{return r}};function fMe(r,e){const{url:t}=e.props,n=Ld.createId(dW(t));r.getAsset(n)?e.props.assetId!==n&&r.updateShapes([{id:e.id,type:e.type,props:{assetId:n}}]):(r.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),pMe(r,e))}const pMe=n1(async(r,e)=>{if(r.isDisposed)return;const{url:t}=e.props,n=await r.getAssetForExternalContent({type:"url",url:t});n&&r.run(()=>{r.createAssets([n]),r.updateShapes([{id:e.id,type:e.type,props:{assetId:n.id}}])})},500);async function kY(r,{url:e,center:t=r.getViewportPageBounds().center}){try{const n=await r.getAssetForExternalContent({type:"url",url:e}),i=Ct(),s={id:i,type:"bookmark",x:t.x-zy/2,y:t.y-r_/2,rotation:0,opacity:1,props:{url:e,assetId:n?.id||null,w:zy,h:vY(r,n?.id)}};r.run(()=>{n&&r.createAssets([n]),r.createShapes([s])});const o=r.getShape(i);return Go.ok(o)}catch(n){return Go.err(n instanceof Error?n.message:"Failed to create bookmark")}}function mMe(r,e){const t=Re(e.map(i=>r.getShape(i)).filter(i=>i&&r.isShapeOfType(i,"frame")));if(!t.length)return;const n=[];r.run(()=>{t.map(i=>{const s=r.getSortedChildIdsForParent(i.id);s.length&&(wt(r,s,{filter:o=>!t.find(a=>a.id===o.id)}),n.push(...s))}),r.setSelectedShapes(n),r.deleteShapes(e)})}const FL=50;function CY(r,e,t={padding:FL}){const n=V.FromPoints(r.flatMap(c=>{if(!c)return[];const u=e.getShapeGeometry(c.id);return e.getShapeLocalTransform(c)?.applyToPoints(u.vertices)??[]})),i=t.padding??FL,s=n.w+2*i,o=n.h+2*i,a=i-n.minX,l=i-n.minY;return{w:s,h:o,dx:a,dy:l}}function TY(r,e,t={}){const n=r.getShape(e);if(!n)return;const i=r.getSortedChildIdsForParent(n.id),s=Re(i.map(d=>r.getShape(d)));if(!s.length)return;const{w:o,h:a,dx:l,dy:c}=CY(s,r,t);if(l===0&&c===0&&n.props.w===o&&n.props.h===a)return;const u=new T(l,c).rot(n.rotation);r.run(()=>{const d=i.map(h=>{const f=r.getShape(h);return{id:f.id,type:f.type,x:f.x+l,y:f.y+c}});d.push({id:n.id,type:n.type,x:n.x-u.x,y:n.y-u.y,props:{w:o,h:a}}),r.updateShapes(d)})}function Tn({children:r}){return x.jsx("span",{className:"tlui-button__label",children:r})}const ta=k.memo(function({label:e,small:t,invertIcon:n,icon:i,color:s,className:o,...a}){return typeof i=="string"?x.jsx(gMe,{label:e,small:t,invertIcon:n,icon:i,color:s,className:o,...a}):k.cloneElement(i,{...a,className:oe({"tlui-icon__small":t},o,i.props.className),"aria-label":e,style:{color:s,transform:n?"scale(-1, 1)":void 0,...i.props.style}})});function gMe({label:r,small:e,invertIcon:t,icon:n,color:i,className:s,...o}){const a=t_(),l=a.icons[n]??a.icons["question-mark-circle"],c=k.useRef(null);return k.useLayoutEffect(()=>{l||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),c?.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,n]),n==="none"?x.jsx("div",{className:oe("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s),...o}):x.jsx("div",{...o,ref:c,"aria-label":r,role:"img",className:oe("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${l}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}function be({icon:r,small:e,invertIcon:t}){return x.jsx(ta,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:r,small:e,invertIcon:t})}function D1({className:r,children:e}){return x.jsx("div",{className:oe("tlui-dialog__header",r),children:e})}function F1({className:r,children:e,style:t}){return x.jsx(Fde,{dir:"ltr",className:oe("tlui-dialog__header__title",r),style:t,children:e})}function z1(){const r=ie();return x.jsx("div",{className:"tlui-dialog__header__close",children:x.jsx(zde,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:x.jsx(et,{type:"icon","aria-label":r("ui.close"),onTouchEnd:e=>e.target.click(),children:x.jsx(be,{small:!0,icon:"cross-2"})})})})}function By({className:r,children:e,style:t}){return x.jsx("div",{className:oe("tlui-dialog__body",r),style:t,tabIndex:0,children:e})}function i_({className:r,children:e}){return x.jsx("div",{className:oe("tlui-dialog__footer",r),children:e})}const yp=k.forwardRef(function({className:e,label:t,icon:n,iconLeft:i,iconLabel:s,autoSelect:o=!1,autoFocus:a=!1,defaultValue:l,placeholder:c,onComplete:u,onValueChange:d,onCancel:h,onFocus:f,onBlur:p,shouldManuallyMaintainScrollPositionWhenFocused:m=!1,children:g,value:y,"data-testid":S,disabled:w,"aria-label":b},v){const C=Sn(),E=k.useRef(null);k.useImperativeHandle(v,()=>E.current);const M=ie(),P=k.useRef(l??""),$=k.useRef(l??""),A=k.useRef(!1),[O,_]=k.useState(!1),I=k.useCallback(X=>{_(!0);const G=X.currentTarget;$.current=G.value,C?C.timers.requestAnimationFrame(()=>{o&&G.select()}):pv.requestAnimationFrame("anon",()=>{o&&G.select()}),f?.()},[o,C,f]),R=k.useCallback(X=>{const G=X.currentTarget.value;$.current=G,d?.(G)},[d]),B=k.useCallback(X=>{switch(X.key){case"Enter":{if(A.current)return;X.currentTarget.blur(),X.stopPropagation(),u?.(X.currentTarget.value);break}case"Escape":{X.currentTarget.value=P.current,h?.(X.currentTarget.value),X.currentTarget.blur(),X.stopPropagation();break}}},[u,h]),U=k.useCallback(X=>{_(!1);const G=X.currentTarget.value;p?.(G)},[p]),H=k.useCallback(()=>A.current=!0,[]),L=k.useCallback(()=>A.current=!1,[]);return k.useEffect(()=>{if(!ht.isIos)return;const X=window.visualViewport;if(O&&m&&X){const G=()=>{E.current?.scrollIntoView({block:"center"})};return X.addEventListener("resize",G),X.addEventListener("scroll",G),C?C.timers.requestAnimationFrame(()=>{E.current?.scrollIntoView({block:"center"})}):pv.requestAnimationFrame("anon",()=>{E.current?.scrollIntoView({block:"center"})}),()=>{X.removeEventListener("resize",G),X.removeEventListener("scroll",G)}}},[O,C,m]),x.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[g,t&&x.jsx("label",{children:M(t)}),i&&x.jsx(ta,{label:s?M(s):"",icon:i,className:"tlui-icon-left",small:!0}),x.jsx("input",{ref:E,className:oe("tlui-input",e),type:"text",defaultValue:l,onKeyDownCapture:B,onChange:R,onFocus:I,onBlur:U,onCompositionStart:H,onCompositionEnd:L,autoFocus:a,"aria-label":b,placeholder:c,value:y,"data-testid":S,disabled:w}),n&&x.jsx(ta,{label:s?M(s):"",icon:n,small:!!t})]})});function zL(r){return ps.isValid(r)?{isValid:!0,hasProtocol:!0}:ps.isValid("https://"+r)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const yMe=In(function({onClose:e}){const n=z().getOnlySelectedShape();return n&&"url"in n.props&&typeof n.props.url=="string"?x.jsx(xMe,{onClose:e,selectedShape:n}):null}),xMe=In(function({onClose:e,selectedShape:t}){const n=z(),i=ie(),s=k.useRef(null);k.useEffect(()=>{n.timers.requestAnimationFrame(()=>s.current?.focus())},[n]);const o=k.useRef(t.props.url),[a,l]=k.useState(()=>{const p=zL(t.props.url),m=p.isValid===!0?p.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:m,safe:m,valid:!0}}),c=k.useCallback(p=>{const m=p.replace(/https?:\/\/(https?:\/\/)/,(S,w)=>w),g=zL(m),y=g.isValid===!0?g.hasProtocol?m:"https://"+m:"https://";l({actual:m,safe:y,valid:g.isValid})},[]),u=k.useCallback(()=>{const p=n.getOnlySelectedShape();p&&(n.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),e())},[n,e]),d=k.useCallback(()=>{const p=n.getOnlySelectedShape();p&&(p&&"url"in p.props&&p.props.url!==a.safe&&n.updateShapes([{id:p.id,type:p.type,props:{url:a.safe}}]),e())},[n,e,a]),h=k.useCallback(()=>{e()},[e]);if(!t)return e(),null;const f=o.current&&!a.valid;return x.jsxs(x.Fragment,{children:[x.jsxs(D1,{children:[x.jsx(F1,{children:i("edit-link-dialog.title")}),x.jsx(z1,{})]}),x.jsx(By,{children:x.jsxs("div",{className:"tlui-edit-link-dialog",children:[x.jsx(yp,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:a.actual,onValueChange:c,onComplete:d,onCancel:h}),x.jsx("div",{children:a.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),x.jsxs(i_,{className:"tlui-dialog__footer__actions",children:[x.jsx(et,{type:"normal",onClick:h,onTouchEnd:h,children:x.jsx(Tn,{children:i("edit-link-dialog.cancel")})}),f?x.jsx(et,{type:"danger",onTouchEnd:u,onClick:u,children:x.jsx(Tn,{children:i("edit-link-dialog.clear")})}):x.jsx(et,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:x.jsx(Tn,{children:i("edit-link-dialog.save")})})]})]})});var SMe={};const BL=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,s_=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(BL))return e.searchParams.append("embed","true"),r},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(BL))return e.searchParams.delete("embed"),r},embedOnPaste:!1},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:r=>{if(r.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!r.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${r}`},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}},embedOnPaste:!0},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:r=>{if(r.includes("/maps/embed?"))return r;if(r.includes("/maps/")){const e=r.match(/@(.*?),(.*?),(.*?)(z|m)/);let t;if(e){const[,n,i,s,o]=e,a=o==="z"?"roadmap":"satellite",l=a==="roadmap"?s:-Math.log2(parseInt(s)/14772321)/.8;t=`https://${new URL(r).host.replace("www.","")}/maps/embed/v1/view?key=${SMe.NEXT_PUBLIC_GC_API_KEY}&center=${n},${i}&zoom=${l}&maptype=${a}`}else t="";return t}},fromEmbedUrl:r=>{const e=je(r);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const n=e.searchParams.get("zoom")??"12",i=e.searchParams.get("maptype")??"roadmap",s=i==="roadmap"?n:14772321*Math.pow(2,parseInt(n)*-.8),[o,a]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${a},${s}${i==="roadmap"?"z":"m"}`}},embedOnPaste:!0},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`},embedOnPaste:!0},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:r=>{const e=je(r),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`},embedOnPaste:!0},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=r.match(e);if(t){const[n,i,s]=t;return`https://codepen.io/${i}/embed/${s}`}},fromEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}},embedOnPaste:!0},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,embedOnPaste:!0,toEmbedUrl:r=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=r.match(e);if(t){const[n,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:r=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be"){const n=e.pathname.split("/").filter(Boolean)[0],i=new URLSearchParams(e.search),s=i.get("t");s&&(i.set("start",s),i.delete("t"));const o=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${n}${o}`}else if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/)){const n=e.searchParams.get("v"),i=new URLSearchParams(e.search);i.delete("v");const s=i.get("t");s&&(i.set("start",s),i.delete("t"));const o=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${n}${o}`}},fromEmbedUrl:r=>{const e=je(r);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const n=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(n){const i=new URLSearchParams(e.search);i.set("v",n?.[1]??"");const s=i.get("start");return s&&(i.set("t",s),i.delete("start")),`https://www.youtube.com/watch?${i.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r),t=e?.searchParams.get("cid");if(e?.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const n=Array.from(e.searchParams.keys());for(const i of n)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:r=>{const e=je(r),t=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const n=Array.from(e.searchParams.keys());for(const i of n)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/pub\/?$/)){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}},fromEmbedUrl:r=>{const e=je(r);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return r.split("/").pop()?r:void 0},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return r.split("/").pop()?r:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return e.searchParams.append("embed","true"),e.href},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:r=>{const e=je(r);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,embedOnPaste:!0,toEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${r}?embed`},fromEmbedUrl:r=>{const e=je(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return r.replace("?embed","")}}],wMe={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},bMe=s_.map(r=>r.type);function vMe(r){return bMe.includes(r)}function kMe(r){return"icon"in r}function EY(){const r=Sn();if(r&&r.hasShapeUtil("embed"))return r.getShapeUtil("embed")}function o_(){const r=EY();return e=>r?r.getEmbedDefinition(e):void 0}function CMe(){const r=EY();return r?r.getEmbedDefinitions():[]}const MY=In(function({onClose:e}){const t=z(),n=ie(),i=t_(),[s,o]=k.useState(null),[a,l]=k.useState(""),[c,u]=k.useState(null),[d,h]=k.useState(!1),f=k.useRef(-1),p=CMe(),m=o_();return x.jsxs(x.Fragment,{children:[x.jsxs(D1,{children:[x.jsx(F1,{children:s?`${n("embed-dialog.title")}  ${s.title}`:n("embed-dialog.title")}),x.jsx(z1,{})]}),s?x.jsxs(x.Fragment,{children:[x.jsxs(By,{className:"tlui-embed-dialog__enter",children:[x.jsx(yp,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:g=>{l(g);const y=m(g);u(y&&y.definition.type===s.type?y:null),h(!1),clearTimeout(f.current),f.current=t.timers.setTimeout(()=>h(!y),320)}}),a===""?x.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[x.jsx("span",{children:n("embed-dialog.instruction")})," ",s.instructionLink&&x.jsxs(x.Fragment,{children:[x.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):x.jsx("div",{className:"tlui-embed-dialog__warning",children:d?n("embed-dialog.invalid-url"):""})]}),x.jsxs(i_,{className:"tlui-dialog__footer__actions",children:[x.jsx(et,{type:"normal",onClick:()=>{o(null),u(null),l("")},children:x.jsx(Tn,{children:n("embed-dialog.back")})}),x.jsx("div",{className:"tlui-embed__spacer"}),x.jsx(et,{type:"normal",onClick:e,children:x.jsx(Tn,{children:n("embed-dialog.cancel")})}),x.jsx(et,{type:"primary",disabled:!c,onClick:()=>{c&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:c.definition}),e())},children:x.jsx(Tn,{children:n("embed-dialog.create")})})]})]}):x.jsx(x.Fragment,{children:x.jsx(By,{className:"tlui-embed-dialog__list",children:p.map(g=>{const y=vMe(g.type)?i.embedIcons[g.type]:kMe(g)?g.icon:void 0;return x.jsxs(et,{type:"menu",onClick:()=>o(g),children:[x.jsx(Tn,{children:g.title}),y&&x.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${y})`}})]},g.type)})})})]})}),Db=[0,389,436,476,580,640,840,1023];var an=(r=>(r[r.ZERO=0]="ZERO",r[r.MOBILE_XXS=1]="MOBILE_XXS",r[r.MOBILE_XS=2]="MOBILE_XS",r[r.MOBILE_SM=3]="MOBILE_SM",r[r.MOBILE=4]="MOBILE",r[r.TABLET_SM=5]="TABLET_SM",r[r.TABLET=6]="TABLET",r[r.DESKTOP=7]="DESKTOP",r))(an||{});const IY=Be.createContext(null);function TMe({forceMobile:r=!1,children:e}){const t=Sn(),n=F("breakpoint",()=>{const{width:i}=t?.getViewportScreenBounds()??{width:window.innerWidth},s=r?an.MOBILE_SM:Db.length-1;for(let o=0;o<s;o++)if(i>Db[o]&&i<=Db[o+1])return o;return s},[t]);return x.jsx(IY.Provider,{value:n,children:e})}function Jn(){const r=k.useContext(IY);if(r===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return r}const PY=k.createContext(null);function B1(){const r=k.useContext(PY);if(!r)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return r}function Ni({type:r,sourceId:e,children:t}){return x.jsx(PY.Provider,{value:{type:r,sourceId:e},children:t})}function j1(){return Sn()?.store.props.collaboration!==void 0}function EMe(){const r=Sn();return F("sync status",()=>r?.store.props.collaboration?.status?r.store.props.collaboration.status.get():null,[r])}function Ss(){const r=Sn();return F("isReadonlyMode",()=>!!r?.getIsReadonly(),[r])}const jL=ht.isDarwin?"":"__CTRL__",MMe=ht.isDarwin?"":"__CTRL__",LL=ht.isDarwin?"":"__ALT__";function AY(r){return r===","?[","]:r.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(e=>e.startsWith("[[")?e.replace(/[[\]]/g,""):e.replace(/cmd\+/g,jL).replace(/ctrl\+/g,MMe).replace(/alt\+/g,LL).replace(/shift\+/g,"").replace(/\$/g,jL).replace(/\?/g,LL).replace(/!/g,"").match(/__CTRL__|__ALT__|./g)||[]).flat().map((e,t)=>{if(e[0]==="+")return[];let n;return e==="__CTRL__"?n="Ctrl":e==="__ALT__"?n="Alt":n=e[0].toUpperCase()+e.slice(1),ht.isDarwin||!t?n:["+",n]}).flat()}function kv(r){return" "+AY(r).join("")}function $Y(r){const e=ie();return x.jsx(QV,{"aria-label":e("app.loading"),...r})}const RY=()=>{},OY=k.createContext(null);function IMe({onEvent:r,children:e}){return x.jsx(OY.Provider,{value:r??RY,children:e})}function ln(){return k.useContext(OY)??RY}function Ya(r,e){const t=Sn(),n=k.useCallback(o=>{o&&t?.complete(),e?.(o)},[t,e]),i=ln(),s=k.useCallback(o=>{i(o,{source:"unknown",id:r})},[r,i]);return rCe(t?`${r}-${t.contextId}`:r,n,s)}function L1({id:r,children:e,modal:t=!1,debugOpen:n=!1}){const[i,s]=Ya(r);return x.jsx(yO,{open:n||i,dir:"ltr",modal:t,onOpenChange:s,children:e})}function U1({children:r,...e}){return x.jsx(xO,{dir:"ltr",asChild:!0,onTouchEnd:t=>Oe(t),...e,children:r})}function W1({className:r,side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:i=8,children:s}){const o=Pn();return x.jsx(Zk,{container:o,children:x.jsx(SO,{className:oe("tlui-menu",r),side:e,sideOffset:n,align:t,alignOffset:i,collisionPadding:4,children:s})})}function PMe({id:r,children:e}){const[t,n]=Ya(r);return x.jsx(Bfe,{open:t,onOpenChange:n,children:e})}function AMe({id:r,label:e,title:t,disabled:n}){return x.jsx(jfe,{dir:"ltr",asChild:!0,disabled:n,children:x.jsxs(et,{"data-testid":r,type:"menu",className:"tlui-menu__submenu__trigger",disabled:n,title:t,children:[x.jsx(Tn,{children:e}),x.jsx(be,{icon:"chevron-right",small:!0})]})})}function $Me({id:r,alignOffset:e=-1,sideOffset:t=-6,size:n="small",children:i}){const s=Pn();return x.jsx(Zk,{container:s,children:x.jsx(Lfe,{"data-testid":r,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":n,children:i})})}function RMe({className:r,children:e}){return x.jsx("div",{dir:"ltr",className:oe("tlui-menu__group",r),children:e})}function OMe({noClose:r,children:e}){return x.jsx(Ffe,{dir:"ltr",asChild:!0,onClick:r?Oe:void 0,children:e})}function NMe({children:r,onSelect:e,...t}){const n=ie();return x.jsxs(o7,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:i=>{e?.(i),Oe(i)},...t,children:[x.jsx("div",{className:"tlui-button__checkbox__indicator",children:x.jsx(zfe,{dir:"ltr",children:x.jsx(ta,{label:n("ui.checked"),icon:"check",small:!0})})}),r]})}function Yg({children:r,visibleOnMobileLayout:e=!1}){const t=Jn();return!e&&t<an.MOBILE?null:x.jsx("kbd",{className:"tlui-kbd",children:AY(r).map((n,i)=>x.jsx("span",{children:n},i))})}const NY=k.createContext({orientation:"horizontal",tooltipSide:"bottom"});function H1({children:r,orientation:e,tooltipSide:t}){const n=xS(),i=t??(e===n.orientation?n.tooltipSide:e==="horizontal"?"bottom":"right");return x.jsx(NY.Provider,{value:{orientation:e,tooltipSide:i},children:r})}function xS(){return k.useContext(NY)}const Kd=k.forwardRef(({asChild:r,className:e,tooltipSide:t,...n},i)=>{const s=r?EO:"div";return x.jsx(H1,{orientation:"horizontal",tooltipSide:t,children:x.jsx(s,{ref:i,className:oe("tlui-row",e),...n})})}),a_=k.forwardRef(({asChild:r,className:e,tooltipSide:t,...n},i)=>{const s=r?EO:"div";return x.jsx(H1,{orientation:"vertical",tooltipSide:t,children:x.jsx(s,{ref:i,className:oe("tlui-column",e),...n})})}),q1=k.forwardRef(({asChild:r,className:e,tooltipSide:t,...n},i)=>{const s=r?EO:"div";return x.jsx(H1,{orientation:"horizontal",tooltipSide:t,children:x.jsx(s,{ref:i,className:oe("tlui-grid",e),...n})})}),_Me=700;class nf{static instance=null;currentTooltip=Ft("current tooltip",null);destroyTimeoutId=null;static getInstance(){return nf.instance||(nf.instance=new nf),nf.instance}showTooltip(e,t,n,i,s,o,a){this.destroyTimeoutId&&(clearTimeout(this.destroyTimeoutId),this.destroyTimeoutId=null),this.currentTooltip.set({id:e,content:t,side:i,sideOffset:s,showOnMobile:o,targetElement:n,delayDuration:a})}updateCurrentTooltip(e,t){this.currentTooltip.update(n=>n?.id===e?t(n):n)}hideTooltip(e,t,n=!1){const i=()=>{this.currentTooltip.get()?.id===t&&(this.currentTooltip.set(null),this.destroyTimeoutId=null)};e&&!n?this.destroyTimeoutId=e.timers.setTimeout(i,300):i()}hideAllTooltips(){this.currentTooltip.set(null),this.destroyTimeoutId=null}getCurrentTooltipData(){const e=this.currentTooltip.get();return!e||!this.supportsHover()&&!e.showOnMobile?null:e}supportsHoverAtom=null;supportsHover(){if(!this.supportsHoverAtom){const e=window.matchMedia("(hover: hover)"),t=Ft("has hover",e.matches);this.supportsHoverAtom=t,e.addEventListener("change",n=>{t.set(n.matches)})}return this.supportsHoverAtom.get()}}const As=nf.getInstance(),_Y=k.createContext(!1);function DMe({children:r}){return x.jsx(Bde,{skipDelayDuration:700,children:x.jsxs(_Y.Provider,{value:!0,children:[r,x.jsx(FMe,{})]})})}function FMe(){const[r,e]=k.useState(!1),t=k.useRef(null),n=k.useRef(!0),i=Sn(),s=F("current tooltip",()=>As.getCurrentTooltipData(),[]),o=F("camera state",()=>i?.getCameraState(),[i]);return k.useEffect(()=>{o==="moving"&&r&&s&&As.hideTooltip(i,s.id,!0)},[o,r,s,i]),k.useEffect(()=>{function a(l){l.key==="Escape"&&s&&r&&(As.hideTooltip(i,s.id),l.stopPropagation())}return document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0})}},[i,s,r]),k.useEffect(()=>{let a=null;if(s&&t.current){const l=s.targetElement.getBoundingClientRect(),c=t.current;c.style.position="fixed",c.style.left=`${l.left}px`,c.style.top=`${l.top}px`,c.style.width=`${l.width}px`,c.style.height=`${l.height}px`,c.style.pointerEvents="none",c.style.zIndex="9999",n.current?a=setTimeout(()=>{e(!0),n.current=!1},s.delayDuration):e(!0)}else e(!1),n.current=!0;return()=>{a!==null&&clearTimeout(a)}},[s]),s?x.jsxs(jU,{open:r,delayDuration:0,children:[x.jsx(LU,{asChild:!0,children:x.jsx("div",{ref:t})}),x.jsxs(UU,{className:"tlui-tooltip",side:s.side,sideOffset:s.sideOffset,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[s.content,x.jsx(WU,{className:"tlui-tooltip__arrow"})]})]}):null}const K1=k.forwardRef(({children:r,content:e,side:t,sideOffset:n=5,disabled:i=!1,showOnMobile:s=!1,delayDuration:o},a)=>{const l=Sn(),c=k.useRef(ft()),u=k.useContext(_Y),d=F("enhancedA11yMode",()=>l?.user.getEnhancedA11yMode(),[l]),h=xS(),f=t??h.tooltipSide;if(k.useEffect(()=>{const v=c.current;return()=>{u&&As.hideTooltip(l,v,!0)}},[l,u]),k.useLayoutEffect(()=>{u&&As.getCurrentTooltipData()?.id===c.current&&As.updateCurrentTooltip(c.current,v=>({...v,content:e,side:f,sideOffset:n,showOnMobile:s}))},[e,f,n,s,u]),i||!e)return x.jsx(x.Fragment,{children:r});let p;if(d?p=0:p=o??(l?.options.tooltipDelayMs||_Me),!u||d)return x.jsxs(jU,{delayDuration:p,disableHoverableContent:!d,children:[x.jsx(LU,{asChild:!0,ref:a,children:r}),x.jsxs(UU,{className:"tlui-tooltip",side:f,sideOffset:n,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[e,x.jsx(WU,{className:"tlui-tooltip__arrow"})]})]});const m=Be.Children.only(r);se(Be.isValidElement(m),"TldrawUiTooltip children must be a single element");const g=v=>{m.props.onMouseEnter?.(v),As.showTooltip(c.current,e,v.currentTarget,f,n,s,p)},y=v=>{m.props.onMouseLeave?.(v),As.hideTooltip(l,c.current)},S=v=>{m.props.onFocus?.(v),As.showTooltip(c.current,e,v.currentTarget,f,n,s,p)},w=v=>{m.props.onBlur?.(v),As.hideTooltip(l,c.current)};return Be.cloneElement(r,{onMouseEnter:g,onMouseLeave:y,onFocus:S,onBlur:w})}),zMe={horizontal:Kd,vertical:a_,grid:q1},_i=Be.forwardRef(({children:r,className:e,label:t,orientation:n="horizontal",tooltipSide:i,...s},o)=>{const a=zMe[n];return x.jsx(a,{asChild:!0,tooltipSide:i,children:x.jsx(pme,{ref:o,...s,className:oe("tlui-toolbar",e),"aria-label":t,orientation:n==="grid"?"horizontal":n,children:r})})}),Mt=Be.forwardRef(({asChild:r,children:e,type:t,isActive:n,tooltip:i,...s},o)=>{const a=x.jsx(mme,{ref:o,asChild:r,draggable:!1,"data-isactive":n,...s,"aria-label":s.title,title:void 0,className:oe("tlui-button",`tlui-button__${t}`,s.className),children:e}),l=i||s.title;return x.jsx(K1,{content:l,children:a})}),BMe=({children:r,className:e,type:t,asChild:n,...i})=>x.jsx(gme,{asChild:n,type:t,...i,role:"radiogroup",className:oe("tlui-toolbar-toggle-group",e),children:r}),jMe=({children:r,className:e,type:t,value:n,tooltip:i,...s})=>{const o=x.jsx(yme,{...s,title:void 0,className:oe("tlui-button",`tlui-button__${t}`,"tlui-toolbar-toggle-group-item",e),value:n,children:r}),a=i||s.title;return x.jsx(K1,{content:a,children:o})};function it({disabled:r=!1,spinner:e=!1,readonlyOk:t=!1,id:n,kbd:i,label:s,icon:o,iconLeft:a,onSelect:l,noClose:c,isSelected:u,onDragStart:d}){const{type:h,sourceId:f}=B1(),p=ie(),[m,g]=k.useState(!1);if(Ss()&&!t)return null;const S=Zy(s,h),w=i?kv(i):void 0,b=S?p(S):void 0,v=b&&w?`${b} ${w}`:b;switch(h){case"menu":return x.jsx(OMe,{children:x.jsxs(et,{type:"menu","data-testid":`${f}.${n}`,disabled:r,onClick:C=>{c&&Oe(C),m?g(!1):l(f)},children:[a&&x.jsx(be,{icon:a,small:!0}),x.jsx(Tn,{children:b}),i&&x.jsx(Yg,{children:i})]})});case"context-menu":return r?null:x.jsxs(pfe,{dir:"ltr",draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${f}.${n}`,onSelect:C=>{c&&Oe(C),m?g(!1):l(f)},children:[x.jsx("span",{className:"tlui-button__label",draggable:!1,children:b}),a&&x.jsx(be,{icon:a,small:!0}),i&&x.jsx(Yg,{children:i}),e&&x.jsx($Y,{})]});case"small-icons":case"icons":return x.jsx(Mt,{"data-testid":`${f}.${n}`,type:"icon",title:v,disabled:r,onClick:()=>l(f),children:x.jsx(be,{icon:o,small:!0})});case"keyboard-shortcuts":return i?x.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${f}.${n}`,children:[x.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:b}),x.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:x.jsx(Yg,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return x.jsxs(et,{type:"low",onClick:()=>l(f),children:[x.jsx(be,{icon:o}),x.jsx(Tn,{children:b})]});case"toolbar":return d?x.jsx(UL,{id:n,icon:o,onSelect:l,onDragStart:d,labelStr:b,titleStr:v,disabled:r,isSelected:u}):x.jsx(Mt,{"aria-label":b,"aria-pressed":u?"true":"false","data-testid":`tools.${n}`,"data-value":n,disabled:r,onClick:()=>l("toolbar"),onTouchStart:C=>{Oe(C),l("toolbar")},title:v,type:"tool",children:x.jsx(be,{icon:o})});case"toolbar-overflow":return d?x.jsx(UL,{id:n,icon:o,onSelect:l,onDragStart:d,labelStr:b,titleStr:v,disabled:r,isSelected:u,overflow:!0}):x.jsx(Mt,{"aria-label":b,"aria-pressed":u?"true":"false",isActive:u,"data-testid":`tools.more.${n}`,"data-value":n,disabled:r,onClick:()=>l("toolbar"),title:v,type:"icon",children:x.jsx(be,{icon:o})});default:throw at(h)}}function LMe(r,e){const t=z();return k.useMemo(()=>{let i={name:"idle"};function s(c){i={name:"pointing",screenSpaceStart:{x:c.clientX,y:c.clientY}},c.currentTarget.setPointerCapture(c.pointerId)}function o(c){if(!c.isSpecialRedispatchedEvent&&i.name==="pointing"&&T.Dist2(i.screenSpaceStart,{x:c.clientX,y:c.clientY})>(t.getInstanceState().isCoarsePointer?t.options.uiCoarseDragDistanceSquared:t.options.uiDragDistanceSquared)){const d=i.screenSpaceStart;i={name:"dragging",screenSpaceStart:d},t.run(()=>{t.setCurrentTool("select"),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...nr(t,c),point:d}),t.selectNone(),r?.("toolbar",{type:"pointer",target:"canvas",name:"pointer_move",...nr(t,c),point:d}),As.hideAllTooltips(),t.getContainer().focus()})}}function a(c){c.isSpecialRedispatchedEvent||(c.currentTarget.releasePointerCapture(c.pointerId),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...nr(t,c)}))}function l(){if(i.name==="dragging"||i.name==="dragged")return i={name:"idle"},!0;i={name:"idle"},e?.("toolbar")}return{onPointerDown:s,onPointerMove:o,onPointerUp:a,onClick:l}},[r,t,e])}function UL({id:r,labelStr:e,titleStr:t,disabled:n,isSelected:i,icon:s,onSelect:o,onDragStart:a,overflow:l}){const c=LMe(a,o);return l?x.jsx(Mt,{"aria-label":e,"aria-pressed":i?"true":"false",isActive:i,className:"tlui-button-grid__button","data-testid":`tools.more.${r}`,"data-value":r,disabled:n,title:t,type:"icon",...c,children:x.jsx(be,{icon:s})}):x.jsx(Mt,{"aria-label":e,"aria-pressed":i?"true":"false","data-testid":`tools.${r}`,"data-value":r,disabled:n,onTouchStart:u=>{Oe(u),o("toolbar")},title:t,type:"tool",...c,children:x.jsx(be,{icon:s})})}function K({actionId:r="",...e}){const n=wa()[r];return n?x.jsx(it,{...n,...e}):null}function Xe({id:r,label:e,className:t,children:n}){const i=B1(),{orientation:s}=xS(),o=ie(),a=Zy(e,i.type),l=a?o(a):void 0;switch(i.type){case"menu":return x.jsx(RMe,{className:t,"data-testid":`${i.sourceId}-group.${r}`,children:n});case"context-menu":return x.jsx("div",{dir:"ltr",className:oe("tlui-menu__group",t),"data-testid":`${i.sourceId}-group.${r}`,children:n});case"keyboard-shortcuts":return x.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i.sourceId}-group.${r}`,children:[x.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),x.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});case"toolbar":{const c=s==="horizontal"?Kd:a_;return x.jsx(c,{className:"tlui-main-toolbar__group","data-testid":`${i.sourceId}-group.${r}`,children:n})}case"toolbar-overflow":return x.jsx(q1,{className:"tlui-main-toolbar__group","data-testid":`${i.sourceId}-group.${r}`,children:n});default:return n}}const hA=k.createContext(null);function UMe({context:r,children:e}){const t=k.useContext(hA),n=ln(),i=rS("dialogs",[]),s=k.useMemo(()=>({dialogs:i,addDialog(o){const a=o.id??ft();return i.update(l=>[...l.filter(c=>c.id!==o.id),{...o,id:a}]),n("open-menu",{source:"dialog",id:a}),ui.addOpenMenu(a,r),a},removeDialog(o){const a=i.get().find(l=>l.id===o);return a&&(a.onClose?.(),n("close-menu",{source:"dialog",id:o}),ui.deleteOpenMenu(o,r),i.update(l=>l.filter(c=>c!==a))),o},clearDialogs(){const o=i.get();o.length!==0&&(o.forEach(a=>{a.onClose?.(),n("close-menu",{source:"dialog",id:a.id}),ui.deleteOpenMenu(a.id,r)}),i.set([]))}}),[n,i,r]);return t?x.jsx(x.Fragment,{children:e}):x.jsx(hA.Provider,{value:s,children:e})}function SS(){const r=k.useContext(hA);if(!r)throw new Error("useDialogs must be used within a DialogsProvider");return r}const fA=k.createContext(null);function WMe({children:r}){const e=rS("toasts",[]),t=k.useContext(fA),n=k.useMemo(()=>({toasts:e,addToast(i){const s=i.id??ft();return e.update(o=>[...o.filter(a=>a.id!==i.id),{...i,id:s}]),s},removeToast(i){return e.update(s=>s.filter(o=>o.id!==i)),i},clearToasts(){e.set([])}}),[e]);return t?x.jsx(x.Fragment,{children:r}):x.jsx(Ype,{children:x.jsx(fA.Provider,{value:n,children:r})})}function Xa(){const r=k.useContext(fA);if(!r)throw new Error("useToasts must be used within a ToastsProvider");return r}function WL(r){return new Promise(e=>{const{allowMultiple:t=!0,mimeTypes:n=[]}=r||{},i=document.createElement("input");i.type="file",i.accept=n?.join(","),i.multiple=t,i.style.display="none";function s(){i.removeEventListener("change",o),i.removeEventListener("cancel",a),i.remove()}async function o(l){const c=l.target.files;if(!c||c.length===0){e([]),s();return}const u=Array.from(c);i.value="",e(u),s()}function a(){e([]),s()}document.body.appendChild(i),i.addEventListener("cancel",a),i.addEventListener("change",o),i?.click()})}var lM={exports:{}},HL;function HMe(){return HL||(HL=1,(function(r){var e=(function(){var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(l,c){if(!s[l]){s[l]={};for(var u=0;u<l.length;u++)s[l][l.charAt(u)]=u}return s[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return n.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return o(n,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var f=c.charCodeAt(d);u[d*2]=f>>>8,u[d*2+1]=f%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(f){h.push(t(f))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return o(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,f={},p={},m="",g="",y="",S=2,w=3,b=2,v=[],C=0,E=0,M;for(M=0;M<l.length;M+=1)if(m=l.charAt(M),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=w++,p[m]=!0),g=y+m,Object.prototype.hasOwnProperty.call(f,g))y=g;else{if(Object.prototype.hasOwnProperty.call(p,y)){if(y.charCodeAt(0)<256){for(d=0;d<b;d++)C=C<<1,E==c-1?(E=0,v.push(u(C)),C=0):E++;for(h=y.charCodeAt(0),d=0;d<8;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1}else{for(h=1,d=0;d<b;d++)C=C<<1|h,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=0;for(h=y.charCodeAt(0),d=0;d<16;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1}S--,S==0&&(S=Math.pow(2,b),b++),delete p[y]}else for(h=f[y],d=0;d<b;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1;S--,S==0&&(S=Math.pow(2,b),b++),f[g]=w++,y=String(m)}if(y!==""){if(Object.prototype.hasOwnProperty.call(p,y)){if(y.charCodeAt(0)<256){for(d=0;d<b;d++)C=C<<1,E==c-1?(E=0,v.push(u(C)),C=0):E++;for(h=y.charCodeAt(0),d=0;d<8;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1}else{for(h=1,d=0;d<b;d++)C=C<<1|h,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=0;for(h=y.charCodeAt(0),d=0;d<16;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1}S--,S==0&&(S=Math.pow(2,b),b++),delete p[y]}else for(h=f[y],d=0;d<b;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1;S--,S==0&&(S=Math.pow(2,b),b++)}for(h=2,d=0;d<b;d++)C=C<<1|h&1,E==c-1?(E=0,v.push(u(C)),C=0):E++,h=h>>1;for(;;)if(C=C<<1,E==c-1){v.push(u(C));break}else E++;return v.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,f=4,p=3,m="",g=[],y,S,w,b,v,C,E,M={val:u(0),position:c,index:1};for(y=0;y<3;y+=1)d[y]=y;for(w=0,v=Math.pow(2,2),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;switch(w){case 0:for(w=0,v=Math.pow(2,8),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;E=t(w);break;case 1:for(w=0,v=Math.pow(2,16),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;E=t(w);break;case 2:return""}for(d[3]=E,S=E,g.push(E);;){if(M.index>l)return"";for(w=0,v=Math.pow(2,p),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;switch(E=w){case 0:for(w=0,v=Math.pow(2,8),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;d[f++]=t(w),E=f-1,h--;break;case 1:for(w=0,v=Math.pow(2,16),C=1;C!=v;)b=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(b>0?1:0)*C,C<<=1;d[f++]=t(w),E=f-1,h--;break;case 2:return g.join("")}if(h==0&&(h=Math.pow(2,p),p++),d[E])m=d[E];else if(E===f)m=S+S.charAt(0);else return null;g.push(m),d[f++]=S+m.charAt(0),h--,S=m,h==0&&(h=Math.pow(2,p),p++)}}};return a})();r!=null?r.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(lM)),lM.exports}var qMe=HMe();const pA=ip(qMe),l_="web image/vnd.tldraw+png",KMe={png:l_},JMe={[l_]:"image/png"};function VMe(r){return Cn(KMe,r)??null}function GMe(r){return Cn(JMe,r)??r}function YMe(r){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(r)}function XMe(r){const e=Object.entries(r);for(const[t,n]of e)n.catch(i=>console.error(i));return navigator.clipboard.write([new ClipboardItem(r)]).catch(t=>(console.error(t),Promise.all(e.map(async([n,i])=>[n,await i])).then(n=>{const i=gW(n);return navigator.clipboard.write([new ClipboardItem(i)])})))}async function ZMe(r,e,t,n){const i=e.map(s=>s instanceof File?s:new File([s],"tldrawFile",{type:s.type}));r.markHistoryStoppingPoint("paste"),await r.putExternalContent({type:"files",files:i,point:t,sources:n})}async function mA(r,e,t,n){return r.markHistoryStoppingPoint("paste"),await r.putExternalContent({type:"url",point:t,url:e,sources:n})}const QMe=[l_,"image/png","image/jpeg","image/webp","image/svg+xml"];function cM(r){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=r.trim(),e.body.textContent||e.body.innerText||""}const eIe=r=>{try{const e=new URL(r);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},tIe=r=>{const e=r.split(/[\n\s]/);for(const t of e)try{const n=new URL(t);if(!(n.protocol==="http:"||n.protocol==="https:"))return}catch{return}return dG(e)},nIe=r=>/^<svg/.test(r),rIe=["input","select","textarea"];function uM(r){const{activeElement:e}=document;return r.menus.hasAnyOpenMenus()||e&&(e.isContentEditable||rIe.indexOf(e.tagName.toLowerCase())>-1)}const lw=(r,e,t,n)=>{const i=tIe(e);if(i)for(const s of i)mA(r,s,t);else eIe(e)?mA(r,e,t):nIe(e)?(r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"svg-text",text:e,point:t,sources:n})):(r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"text",text:e,point:t,sources:n}))},iIe=async(r,e,t)=>{if(r.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const n=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{n.push({type:"file",source:new Promise(s=>s(i.getAsFile()))});break}case"string":{i.type==="text/html"?n.push({type:"html",source:new Promise(s=>i.getAsString(s))}):i.type==="text/plain"?n.push({type:"text",source:new Promise(s=>i.getAsString(s))}):n.push({type:i.type,source:new Promise(s=>i.getAsString(s))});break}}FY(r,n,t)},DY=async({editor:r,clipboardItems:e,point:t,fallbackFiles:n})=>{const i=[];for(const s of e){for(const o of QMe)if(s.types.includes(o)){const a=s.getType(o).then(l=>mr.rewriteMimeType(l,GMe(o)));i.push({type:"blob",source:a});break}s.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const o=await s.getType("text/html");return await mr.blobToText(o)})()}),s.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const o=await s.getType("text/uri-list");return await mr.blobToText(o)})()}),s.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const o=await s.getType("text/plain");return await mr.blobToText(o)})()})}return n?.length&&i.length===1&&i[0].type==="text"?(i.pop(),i.push(...n.map(s=>({type:"file",source:Promise.resolve(s)})))):n?.length&&i.length===0&&i.push(...n.map(s=>({type:"file",source:Promise.resolve(s)}))),await FY(r,i,t)};async function FY(r,e,t){const n=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(n.length){if(n.length>r.options.maxFilesAtOnce)throw Error("Too many files");const s=Re(await Promise.all(n.map(o=>o.source)));return await ZMe(r,s,t)}const i=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(o=>{const a=s;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{const c=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(c)try{let u;try{u=JSON.parse(c)}catch{const d=pA.decompressFromBase64(c);if(d===null){o({type:"error",data:null,reason:"found tldraw data comment but could not parse"});return}u=JSON.parse(d)}if(u.type!=="application/tldraw"){o({type:"error",data:u,reason:`found tldraw data comment but JSON was of a different type: ${u.type}`});return}if(u.version===3)try{const d=JSON.parse(pA.decompressFromBase64(u.data.otherCompressed)||"{}"),h={assets:u.data.assets||[],...d};o({type:"tldraw",data:h});return}catch(d){o({type:"error",data:u,reason:`failed to decompress version 2 clipboard data: ${d}`});return}if(u.version===2)o({type:"tldraw",data:u.data});else{if(typeof u.data=="string"){o({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:u.data});return}}catch{o({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:l,subtype:"url"});return}try{const u=JSON.parse(l);if(u.type==="excalidraw/clipboard"){o({type:"excalidraw",data:u});return}else{o({type:"text",data:l,subtype:"json"});return}}catch{o({type:"text",data:l,subtype:"text"});return}}o({type:"error",data:l,reason:"unhandled case"})})})));for(const s of i)if(s.type==="tldraw"){r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"tldraw",content:s.data,point:t});return}for(const s of i)if(s.type==="excalidraw"){r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"excalidraw",content:s.data,point:t});return}for(const s of i){if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const c=a.firstElementChild.getAttribute("href");lw(r,c,t,i);return}if(!i.some(c=>c.type==="text"&&c.subtype!=="html")&&s.data.trim()&&(cM(s.data)??"")){lw(r,cM(s.data),t,i);return}if(i.some(c=>c.type==="text"&&c.subtype!=="html")){const c=cM(s.data)??"";if(c){r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"text",text:c,html:s.data,point:t,sources:i});return}}}if(s.type==="text"&&s.subtype==="text"&&s.data.startsWith("<iframe ")){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="IFRAME"&&a.firstElementChild.hasAttribute("src")&&a.firstElementChild.getAttribute("src")!==""){const c=a.firstElementChild.getAttribute("src");lw(r,c,t,i);return}}}for(const s of i)if(s.type==="text"&&s.subtype==="url"){mA(r,s.data,t,i);return}for(const s of i)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){lw(r,s.data,t,i);return}}const Cv=async r=>{const e=r.getContainer().ownerDocument?.defaultView?.navigator??globalThis.navigator,t=await r.resolveAssetsInContent(r.getContentFromCurrentPage(r.getSelectedShapeIds()));if(!t){e&&e.clipboard&&e.clipboard.writeText("");return}const{assets:n,...i}=t,s={type:"application/tldraw",kind:"content",version:3,data:{assets:n||[],otherCompressed:pA.compressToBase64(JSON.stringify(i))}},o=JSON.stringify(s);if(!(typeof e>"u")){const a=t.shapes.map(l=>r.getShapeUtil(l).getText(l)).filter(nge);if(e.clipboard?.write){const l=new Blob([`<div data-tldraw>${o}</div>`],{type:"text/html"});let c=a.join(" ");c===""&&(c=" "),e.clipboard.write([new ClipboardItem({"text/html":l,"text/plain":new Blob([c],{type:"text/plain"})})])}else e.clipboard.writeText&&e.clipboard.writeText(`<div data-tldraw>${o}</div>`)}};function sIe(){const r=Sn(),e=ln(),t=k.useCallback(async function(o){se(r,"editor is required for copy"),r.getSelectedShapeIds().length!==0&&(await Cv(r),e("copy",{source:o}))},[r,e]),n=k.useCallback(async function(o){r&&r.getSelectedShapeIds().length!==0&&(await Cv(r),r.deleteShapes(r.getSelectedShapeIds()),e("cut",{source:o}))},[r,e]),i=k.useCallback(async function(o,a,l){r&&r.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(DY({editor:r,clipboardItems:o,point:l}),e("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{i(c,a,l)}))},[r,e]);return{copy:t,cut:n,paste:i}}function oIe(){const r=z(),e=r.getContainer().ownerDocument,t=ln(),n=F("editor.isFocused",()=>r.getInstanceState().isFocused,[r]);k.useEffect(()=>{if(!n)return;const i=async c=>{r.getSelectedShapeIds().length===0||r.getEditingShapeId()!==null||uM(r)||(Oe(c),await Cv(r),t("copy",{source:"kbd"}))};async function s(c){r.getSelectedShapeIds().length===0||r.getEditingShapeId()!==null||uM(r)||(Oe(c),await Cv(r),r.deleteShapes(r.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let o=!1;const a=c=>{c.button===1&&(o=!0,r.timers.requestAnimationFrame(()=>{o=!1}))},l=c=>{if(o){r.markEventAsHandled(c);return}if(r.getEditingShapeId()!==null||uM(r))return;let u,d=!1;r.inputs.shiftKey&&(d=!0),r.user.getIsPasteAtCursorMode()&&(d=!d),d&&(u=r.inputs.currentPagePoint);const h=()=>{c.clipboardData&&iIe(r,c.clipboardData,u)};if(navigator.clipboard?.read){const f=Array.from(c.clipboardData?.files||[]);navigator.clipboard.read().then(p=>{Array.isArray(p)&&p[0]instanceof ClipboardItem&&DY({editor:r,clipboardItems:p,point:u,fallbackFiles:f})},()=>{h()})}else h();Oe(c),t("paste",{source:"kbd"})};return e?.addEventListener("copy",i),e?.addEventListener("cut",s),e?.addEventListener("paste",l),e?.addEventListener("pointerup",a),()=>{e?.removeEventListener("copy",i),e?.removeEventListener("cut",s),e?.removeEventListener("paste",l),e?.removeEventListener("pointerup",a)}},[r,t,n,e])}const qL={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function aIe(r,e,t={}){const n=e?.length?e:[...r.getCurrentPageShapeIds()],i=t.format??"png";return{blobPromise:r.toImage(n,t).then(s=>mr.rewriteMimeType(s.blob,qL[i])),mimeType:qL[i]}}function lIe(r,e,t){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:n,mimeType:i}=aIe(r,e,t),s={[i]:n},o=VMe(t.format);return o&&YMe(o)&&(s[o]=n.then(a=>mr.rewriteMimeType(a,o))),XMe(s)}switch(t.format){case"svg":return cIe(async()=>{const n=await r.getSvgString(e,t);if(!n)throw new Error("Failed to copy");return n.svg});case"png":throw new Error("Copy not supported");default:at(t.format)}}async function cIe(r){await navigator.clipboard?.writeText?.(await r())}function uIe(){const r=Sn(),{addToast:e}=Xa(),t=ie();return k.useCallback((n,i="svg")=>{se(r,"useCopyAs: editor is required"),lIe(r,n,{format:i}).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[r,e,t])}async function dIe(r,e,t){let n=t.name;if(!n&&(n=`shapes at ${KL()}`,e.length===1)){const o=r.getShape(e[0]);r.isShapeOfType(o,"frame")?n=o.props.name||"frame":n=`${g1(o.id)} at ${KL()}`}n+=`.${t.format}`;const{blob:i}=await r.toImage(e,t),s=new File([i],n,{type:i.type});hIe(s)}function KL(){const r=new Date,e=String(r.getFullYear()).slice(2),t=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0"),i=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0"),o=String(r.getSeconds()).padStart(2,"0");return`${e}-${t}-${n} ${i}.${s}.${o}`}function hIe(r){const e=document.createElement("a"),t=URL.createObjectURL(r);e.href=t,e.download=r.name,e.click(),URL.revokeObjectURL(t)}function fIe(){const r=Sn(),{addToast:e}=Xa(),t=ie();return k.useCallback((n,i={})=>{se(r,"useExportAs: editor is required");const{format:s="png",name:o,scale:a=1}=i;dIe(r,n,{format:s,name:o,scale:a}).catch(l=>{console.error(l.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[r,e,t])}function pIe(){const r=Sn(),e=k.useRef(null),t=k.useRef(null);return k.useCallback(async function(){se(r,"usePrint: editor is required");const i=document.createElement("div"),s=document.createElement("style"),o=(y,S)=>{y&&(y.innerHTML=""),S&&document.head.contains(S)&&document.head.removeChild(S),y&&document.body.contains(y)&&document.body.removeChild(y)};o(e.current,t.current),e.current=i,t.current=s;const a=`tl-print-surface-${ft()}`;i.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(s),document.body.appendChild(i)},c=()=>{r.once("tick",()=>{o(i,s)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",c);function u(y,S,w){try{i.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${y.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${w}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${S?"":"hide"}">
          ${S??""}
        </div>
      </div>`}catch(b){console.error(b)}}function d(){ht.isChromeForIos?(l(),window.print()):ht.isSafari?(l(),document.execCommand("print",!1)):window.print()}const h=r.getSelectedShapeIds(),f=r.getCurrentPageId(),p=r.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(r.getSelectedShapeIds().length>0){const y=await r.getSvgString(h,g);if(y){const S=p.find(w=>w.id===f);u(`tldraw  ${S?.name}`,null,y.svg),d()}}else{const y=r.getCurrentPage(),S=await r.getSvgString(r.getSortedChildIdsForParent(y.id),g);S&&(u(`tldraw  ${y.name}`,null,S.svg),d())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",c)},[r])}const zY=k.createContext([]);function c_(){const r=Sn(),{addToast:e,removeToast:t,clearToasts:n}=Xa(),{addDialog:i,clearDialogs:s,removeDialog:o}=SS(),a=ie(),l=pIe(),{cut:c,copy:u,paste:d}=sIe(),h=uIe(),f=fIe(),p=o_(),g=Jn()<an.TABLET_SM,y=bl(k.useContext(zY)),S=k.useCallback(async()=>{if(!r)return;const C=await WL({allowMultiple:!0,mimeTypes:y});C.length&&(r.markHistoryStoppingPoint("insert media"),r.putExternalContent({type:"files",files:C,point:r.getViewportPageBounds().center}))},[r,y]),w=k.useCallback(async C=>{if(!r)return;const E=await WL({allowMultiple:!1,mimeTypes:y?.filter($=>C?$.startsWith("image/"):$.startsWith("video/"))});if(!E.length)return;const M=r.getOnlySelectedShape();if(!M||C&&M.type!=="image"||!C&&M.type!=="video")return;r.markHistoryStoppingPoint("replace media");const P=E[0];r.replaceExternalContent({type:"file-replace",file:P,shapeId:M.id,isImage:C})},[r,y]),b=k.useCallback(()=>w(!0),[w]),v=k.useCallback(()=>w(!1),[w]);return k.useMemo(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:i,removeDialog:o,clearDialogs:s,msg:a,isMobile:g,insertMedia:S,replaceImage:b,replaceVideo:v,printSelectionOrPages:l,cut:c,copy:u,paste:d,copyAs:h,exportAs:f,getEmbedDefinition:p}),[e,t,n,i,o,s,a,g,S,b,v,l,c,u,d,h,f,p])}function mIe(r,e){const t={};for(const n of r)if(n.translations)for(const[i,s]of fi(n.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return{actions:(n,i,s)=>{for(const o of r)o.actions&&(i=o.actions(n,i,s));return i},tools:(n,i,s)=>{for(const o of r)o.tools&&(i=o.tools(n,i,{...e,...s}));return i},translations:t}}function BY(r){return k.useMemo(()=>r,r)}function jY(r){const e=BY(r==null?[]:Array.isArray(r)?r:[r]);return k.useMemo(()=>{const t={};for(const n of e)if(n.translations)for(const[i,s]of fi(n.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return t},[e])}function gIe(r){const e=c_(),t=BY(r==null?[]:Array.isArray(r)?r:[r]);return k.useMemo(()=>mIe(t,e),[t,e])}const LY=k.createContext(null);function yIe({overrides:r,children:e}){const t=Sn(),n=ln(),i=_1(),s=ie(),o=c_(),a=k.useCallback((c,u,d)=>{i.announce({msg:s(u.label)}),n("select-tool",{source:c,id:d??u.id})},[i,s,n]),l=k.useMemo(()=>{if(!t)return{};const c=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(d){if(t.isIn("select")){const h=t.root.getCurrent();h.exit({},h.id),h.enter({},h.id)}t.setCurrentTool("select"),a(d,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(d){t.setCurrentTool("hand"),a(d,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(d){t.setCurrentTool("eraser"),a(d,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(d){t.setCurrentTool("draw"),a(d,this)}},...[...Vo.values].map(d=>({id:d,label:`tool.${d}`,meta:{geo:d},kbd:d==="rectangle"?"r":d==="ellipse"?"o":void 0,icon:"geo-"+d,onSelect(h){t.run(()=>{t.setStyleForNextShapes(Vo,d),t.setCurrentTool("geo"),a(h,this,`geo-${d}`)})},onDragStart(h,f){ah(t,f,{createShape:p=>t.createShape({id:p,type:"geo",props:{w:200,h:200,geo:d}})}),n("drag-tool",{source:h,id:"geo"})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(d){t.setCurrentTool("arrow"),a(d,this)},onDragStart(d,h){ah(t,h,{createShape:f=>t.createShape({id:f,type:"arrow",props:{start:{x:0,y:200},end:{x:200,y:0}}})}),n("drag-tool",{source:d,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(d){t.setCurrentTool("line"),a(d,this)},onDragStart(d,h){ah(t,h,{createShape:f=>{const[p,m]=ld(null,null,2);t.createShape({id:f,type:"line",props:{points:{[p]:{id:p,index:p,x:0,y:200},[m]:{id:m,index:m,x:200,y:0}}}})}}),n("drag-tool",{source:d,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(d){t.setCurrentTool("frame"),a(d,this)},onDragStart(d,h){ah(t,h,{createShape:f=>t.createShape({id:f,type:"frame"})}),n("drag-tool",{source:d,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(d){t.setCurrentTool("text"),a(d,this)},onDragStart(d,h){ah(t,h,{createShape:f=>t.createShape({id:f,type:"text",props:{richText:ir("Text")}}),onDragEnd:f=>{t.setEditingShape(f),t.emit("select-all-text",{shapeId:f})}}),n("drag-tool",{source:d,id:"text"})}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(d){o.insertMedia(),a(d,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(d){t.setCurrentTool("note"),a(d,this)},onDragStart(d,h){ah(t,h,{createShape:f=>t.createShape({id:f,type:"note"}),onDragEnd:f=>{t.setEditingShape(f),t.emit("select-all-text",{shapeId:f})}}),n("drag-tool",{source:d,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(d){t.setCurrentTool("laser"),a(d,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(d){o.addDialog({component:MY}),a(d,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(d){t.setCurrentTool("highlight"),a(d,this)}}];c.forEach(d=>d.onSelect=d.onSelect.bind(d));const u=Object.fromEntries(c.map(d=>[d.id,d]));return r?r(t,u,o):u},[r,t,o,a,n]);return x.jsx(LY.Provider,{value:l,children:e})}function u_(){const r=k.useContext(LY);if(!r)throw new Error("useTools must be used within a ToolProvider");return r}function ah(r,e,t){const{x:n,y:i}=r.inputs.currentPagePoint,s=r.markHistoryStoppingPoint("drag shape tool");r.setCurrentTool("select.translating");const o=Ct();t.createShape(o);const a=Dn(r.getShape(o),"Shape not found"),{w:l,h:c}=r.getShapePageBounds(o);r.updateShape({id:o,type:a.type,x:n-l/2,y:i-c/2}),r.select(o),r.setCurrentTool("select.translating",{...e,target:"shape",shape:r.getShape(o),isCreating:!0,creatingMarkId:s,onCreate(){r.setCurrentTool("select.idle"),r.select(o),t.onDragEnd?.(o)}}),r.getCurrentTool().setCurrentToolIdMask(a.type)}function Hi({toolId:r="",...e}){const n=u_()[r];return n?x.jsx(it,{...n,...e}):null}function xIe(){const r=j1();return x.jsxs(x.Fragment,{children:[x.jsxs(Xe,{label:"shortcuts-dialog.tools",id:"tools",children:[x.jsx(K,{actionId:"toggle-tool-lock"}),x.jsx(K,{actionId:"insert-media"}),x.jsx(Hi,{toolId:"select"}),x.jsx(Hi,{toolId:"draw"}),x.jsx(Hi,{toolId:"eraser"}),x.jsx(Hi,{toolId:"hand"}),x.jsx(Hi,{toolId:"rectangle"}),x.jsx(Hi,{toolId:"ellipse"}),x.jsx(Hi,{toolId:"arrow"}),x.jsx(Hi,{toolId:"line"}),x.jsx(Hi,{toolId:"text"}),x.jsx(Hi,{toolId:"frame"}),x.jsx(Hi,{toolId:"note"}),x.jsx(Hi,{toolId:"laser"}),x.jsx(it,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),x.jsxs(Xe,{label:"shortcuts-dialog.preferences",id:"preferences",children:[x.jsx(K,{actionId:"toggle-dark-mode"}),x.jsx(K,{actionId:"toggle-focus-mode"}),x.jsx(K,{actionId:"toggle-grid"})]}),x.jsxs(Xe,{label:"shortcuts-dialog.edit",id:"edit",children:[x.jsx(K,{actionId:"undo"}),x.jsx(K,{actionId:"redo"}),x.jsx(K,{actionId:"cut"}),x.jsx(K,{actionId:"copy"}),x.jsx(K,{actionId:"paste"}),x.jsx(K,{actionId:"select-all"}),x.jsx(K,{actionId:"delete"}),x.jsx(K,{actionId:"duplicate"})]}),x.jsxs(Xe,{label:"shortcuts-dialog.view",id:"view",children:[x.jsx(K,{actionId:"zoom-in"}),x.jsx(K,{actionId:"zoom-out"}),x.jsx(K,{actionId:"zoom-to-100"}),x.jsx(K,{actionId:"zoom-to-fit"}),x.jsx(K,{actionId:"zoom-to-selection"})]}),x.jsxs(Xe,{label:"shortcuts-dialog.transform",id:"transform",children:[x.jsx(K,{actionId:"bring-to-front"}),x.jsx(K,{actionId:"bring-forward"}),x.jsx(K,{actionId:"send-backward"}),x.jsx(K,{actionId:"send-to-back"}),x.jsx(K,{actionId:"group"}),x.jsx(K,{actionId:"ungroup"}),x.jsx(K,{actionId:"flip-horizontal"}),x.jsx(K,{actionId:"flip-vertical"}),x.jsx(K,{actionId:"align-top"}),x.jsx(K,{actionId:"align-center-vertical"}),x.jsx(K,{actionId:"align-bottom"}),x.jsx(K,{actionId:"align-left"}),x.jsx(K,{actionId:"align-center-horizontal"}),x.jsx(K,{actionId:"align-right"})]}),x.jsxs(Xe,{label:"shortcuts-dialog.text-formatting",id:"text",children:[x.jsx(it,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),x.jsx(it,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),x.jsx(it,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),x.jsx(it,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),x.jsx(it,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),x.jsx(it,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),x.jsx(it,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+alt+[[1-6]]",onSelect:()=>{}}),x.jsx(it,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),x.jsx(it,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),x.jsxs(Xe,{label:"shortcuts-dialog.a11y",id:"a11y",children:[x.jsx(it,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+[[]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+[[]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+[[]]",onSelect:()=>{}}),x.jsx(it,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),x.jsx(it,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"[[]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+[[]]",onSelect:()=>{}}),x.jsx(it,{id:"a11y-rotate-shape-cw",label:"a11y.rotate-shape-cw",kbd:"shift+",onSelect:()=>{}}),x.jsx(it,{id:"a11y-rotate-shape-cw-fine",label:"a11y.rotate-shape-cw-fine",kbd:"shift+alt+",onSelect:()=>{}}),x.jsx(it,{id:"a11y-rotate-shape-ccw",label:"a11y.rotate-shape-ccw",kbd:"shift+",onSelect:()=>{}}),x.jsx(it,{id:"a11y-rotate-shape-ccw-fine",label:"a11y.rotate-shape-ccw-fine",kbd:"shift+alt+",onSelect:()=>{}}),x.jsx(K,{actionId:"enlarge-shapes"}),x.jsx(K,{actionId:"shrink-shapes"}),x.jsx(K,{actionId:"a11y-repeat-shape-announce"}),x.jsx(it,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),r&&x.jsx(Xe,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:x.jsx(K,{actionId:"open-cursor-chat"})})]})}const UY=k.memo(function({children:e}){const t=ie(),n=Jn(),i=e??x.jsx(xIe,{});return x.jsxs(x.Fragment,{children:[x.jsxs(D1,{className:"tlui-shortcuts-dialog__header",children:[x.jsx(F1,{children:t("shortcuts-dialog.title")}),x.jsx(z1,{})]}),x.jsx(By,{className:oe("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=an.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=an.TABLET}),children:x.jsx(Ni,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),x.jsx("div",{className:"tlui-dialog__scrim"})]})});async function SIe(r,e,t){const n=Re(e.map(a=>{const l=r.getShape(a);if(!(!l||r.getShapeUtil(l.type).toSvg===void 0))return l}));if(n.length===0)return;if(n.length===1){const a=n[0];if(!a||r.isShapeOfType(a,"image"))return}const i=[];if(t!==void 0){const a=n.map(l=>({shape:l,bounds:r.getShapeMaskedPageBounds(l).clone().expandBy(t)}));for(let l=0;l<a.length;l++){const c=a[l];if(l===0){i[0]={shapes:[c.shape],bounds:c.bounds};continue}let u=!1;for(const d of i)if(d.bounds.includes(c.bounds)){d.shapes.push(c.shape),d.bounds.expand(c.bounds),u=!0;break}u||i.push({shapes:[c.shape],bounds:c.bounds})}}else{const a=V.Common(n.map(l=>r.getShapeMaskedPageBounds(l)));i.push({shapes:n,bounds:a})}const s=r.options.flattenImageBoundsPadding;for(const a of i){t!==void 0&&a.bounds.expandBy(-t);const l=await r.getSvgString(a.shapes,{padding:s,background:!1});if(!l?.svg)continue;const c=await r.getAssetForExternalContent({type:"file",file:new File([l.svg],"asset.svg",{type:"image/svg+xml"})});c&&(a.asset=c)}const o=[];return hs(()=>{for(const a of i){const{asset:l,bounds:c,shapes:u}=a;if(!l)continue;const d=r.findCommonAncestor(u)??r.getCurrentPageId();if(!d)continue;let h="a1";for(const y of u)if(y.parentId===d){y.index>h&&(h=y.index);break}let f,p,m;if(li(d)){const y=r.getShape(d);if(!y)continue;const S=r.getPointInShapeSpace(y,{x:c.x,y:c.y});m=r.getShapePageTransform(d).rotation(),S.sub(new T(s,s).rot(-m)),f=S.x,p=S.y}else f=c.x-s,p=c.y-s,m=0;r.deleteShapes(u),r.createAssets([{...l,id:l.id}]);const g=Ct();r.createShape({id:g,type:"image",index:h,parentId:d,x:f,y:p,rotation:-m,props:{assetId:l.id,w:c.w+s*2,h:c.h+s*2}}),o.push(g)}}),o}function yd({id:r,children:e,onOpenChange:t,open:n,className:i}){const[s,o]=Ya(r,t);return x.jsx(bO,{onOpenChange:o,open:n||s,children:x.jsx("div",{className:oe("tlui-popover",i),children:e})})}function xd({children:r}){return x.jsx(vO,{asChild:!0,dir:"ltr",children:r})}function Sd({side:r,children:e,align:t="center",sideOffset:n=8,alignOffset:i=0,disableEscapeKeyDown:s=!1,autoFocusFirstButton:o=!0}){const a=Pn(),l=Be.useRef(null),c=Be.useCallback(()=>{if(!o)return;const h=[...l.current?.querySelectorAll("button:not([disabled])")??[]].filter(f=>f.offsetWidth||f.offsetHeight)[0];h&&h.focus()},[o]);return x.jsx(kO,{container:a,children:x.jsx(CO,{className:"tlui-popover__content",side:r,sideOffset:n,align:t,alignOffset:i,dir:"ltr",ref:l,onOpenAutoFocus:c,onEscapeKeyDown:u=>s&&u.preventDefault(),children:e})})}function Tv(r,e,t){const{arrowheadStart:n,arrowheadEnd:i}=e.props,s=sf(r,e,t),o=s.start.clone(),a=s.end.clone(),l=T.Med(o,a);if(T.Equals(o,a))return{bindings:t,type:"straight",start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=T.Sub(a,o).uni(),u=Mv(r,e,"start"),d=Mv(r,e,"end"),h=r.getShapePageTransform(e);JL(a,s.start,h,d),JL(o,s.end,h,u);let f=0,p=0,m=0,g=0,y=of*e.props.scale;const S=u&&d&&u.shape===d.shape,w=u&&d?d_(r,u.shape.id,d.shape.id):"safe";w==="safe"&&u&&d&&!S&&!u.isExact&&!d.isExact&&(d.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(a.clone().add(c.clone().mul(of*e.props.scale))):d.didIntersect||d.isClosed&&a.setTo(o.clone().sub(c.clone().mul(of*e.props.scale))));const b=T.Sub(a,o),v=T.Len(b)?b.uni():T.From(b),C=!T.Equals(v,c);S||(w!=="start-contains-end"&&u&&n!=="none"&&!u.isExact&&(m=us[e.props.size]/2+("size"in u.shape.props?us[u.shape.props.size]/2:0),f=(Ly+m)*e.props.scale,y+=m*e.props.scale),w!=="end-contains-start"&&d&&i!=="none"&&!d.isExact&&(g=us[e.props.size]/2+("size"in d.shape.props?us[d.shape.props.size]/2:0),p=(Ly+g)*e.props.scale,y+=g*e.props.scale));const E=o.clone().add(v.clone().mul(f*(C?-1:1))),M=a.clone().sub(v.clone().mul(p*(C?-1:1)));T.DistMin(E,M,y)&&(f!==0&&p!==0?(f*=-1.5,p*=-1.5):f!==0?f*=-1:p!==0&&(p*=-1)),o.add(v.clone().mul(f*(C?-1:1))),a.sub(v.clone().mul(p*(C?-1:1))),C?(u&&d&&a.setTo(T.Add(o,v.clone().mul(-of*e.props.scale))),l.setTo(T.Med(s.start,s.end))):l.setTo(T.Med(o,a));const P=T.Dist(o,a);return{bindings:t,type:"straight",start:{handle:s.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:P>0,length:P}}function JL(r,e,t,n){if(n===void 0||n.isExact)return;const i=J.applyToPoint(t,e),s=J.applyToPoint(t,r),o=J.applyToPoint(J.Inverse(n.transform),i),a=J.applyToPoint(J.Inverse(n.transform),s),l=Array.from(n.geometry.intersectLineSegment(o,a,{includeLabels:!1,includeInternal:!1}));let c;if(l.length&&(c=l.sort((h,f)=>T.Dist2(h,o)-T.Dist2(f,o))[0]??(n.isClosed?void 0:a)),c===void 0&&(c=n.geometry.nearestPoint(a,{includeLabels:!1,includeInternal:!1}),!T.DistMin(c,a,1)))return;const u=J.applyToPoint(n.transform,c),d=J.applyToPoint(J.Inverse(t),u);r.setTo(d),n.didIntersect=!0}function wIe(r,e,t){const{arrowheadEnd:n,arrowheadStart:i}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(WIe*e.props.scale)))return Tv(r,e,t);const o=sf(r,e,t),a=T.Med(o.start,o.end),l=T.Sub(o.end,o.start),c=T.Len(l)?l.uni():T.From(l),u=T.Add(a,c.per().mul(-s)),d=Mv(r,e,"start"),h=Mv(r,e,"end"),f=o.start.clone(),p=o.end.clone(),m=u.clone();if(T.Equals(f,p))return{bindings:t,type:"straight",start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:p,point:p,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const g=e.props.bend<0,y=g?vN:MSe,S=VL(f,p,m),w=T.Angle(S.center,f),b=T.Angle(S.center,p),v=y(w,b);if(S.length===0||S.size===0||!fj(S.length)||!fj(S.size))return Tv(r,e,t);const C=f.clone(),E=p.clone(),M=m.clone(),P=r.getShapePageTransform(e);let $=0,A=0,O=of*e.props.scale;if(d&&!d.isExact){const X=J.applyToPoint(P,C),G=J.applyToPoint(P,S.center),ce=J.applyToPoint(P,E),ae=J.Inverse(d.transform),ge=J.applyToPoint(ae,X),De=J.applyToPoint(ae,G),Ne=J.applyToPoint(ae,ce),{isClosed:ne}=d;let ue,ze=Array.from(d.geometry.intersectCircle(De,S.radius,{includeLabels:!1,includeInternal:!1}));if(ze.length){const xe=De.angle(ge),hn=De.angle(Ne),An=y(xe,hn);ze=ze.filter(Rt=>y(xe,De.angle(Rt))<=An);const Bt=An*.25;ze.sort(ne?(Rt,Ot)=>Math.abs(y(xe,De.angle(Rt))-Bt)<Math.abs(y(xe,De.angle(Ot))-Bt)?-1:1:(Rt,Ot)=>y(xe,De.angle(Rt))<y(xe,De.angle(Ot))?-1:1),ue=ze[0]}if(!ue)if(ne){const xe=d.geometry.nearestPoint(ge,{includeInternal:!1,includeLabels:!1});T.DistMin(xe,ge,1)&&(ue=xe)}else ue=ge;if(ue&&(C.setTo(r.getPointInShapeSpace(e,J.applyToPoint(d.transform,ue))),d.didIntersect=!0,i!=="none")){const xe=us[e.props.size]/2+("size"in d.shape.props?us[d.shape.props.size]/2:0);$=(Ly+xe)*e.props.scale,O+=xe*e.props.scale}}if(h&&!h.isExact){const X=J.applyToPoint(P,C),G=J.applyToPoint(P,E),ce=J.applyToPoint(P,S.center),ae=J.Inverse(h.transform),ge=J.applyToPoint(ae,X),De=J.applyToPoint(ae,ce),Ne=J.applyToPoint(ae,G),ne=h.isClosed;let ue,ze=Array.from(h.geometry.intersectCircle(De,S.radius,{includeLabels:!1,includeInternal:!1}));if(ze.length){const xe=De.angle(ge),hn=De.angle(Ne),An=y(xe,hn),Bt=An*.75;ze=ze.filter(Rt=>y(xe,De.angle(Rt))<=An),ze.sort(ne?(Rt,Ot)=>Math.abs(y(xe,De.angle(Rt))-Bt)<Math.abs(y(xe,De.angle(Ot))-Bt)?-1:1:(Rt,Ot)=>y(xe,De.angle(Rt))<y(xe,De.angle(Ot))?-1:1),ue=ze[0]}if(!ue)if(ne){const xe=h.geometry.nearestPoint(Ne,{includeInternal:!1,includeLabels:!1});T.DistMin(xe,Ne,1)&&(ue=xe)}else ue=Ne;if(ue&&(E.setTo(r.getPointInShapeSpace(e,J.applyToPoint(h.transform,ue))),h.didIntersect=!0,n!=="none")){const xe=us[e.props.size]/2+("size"in h.shape.props?us[h.shape.props.size]/2:0);A=(Ly+xe)*e.props.scale,O+=xe*e.props.scale}}let _=T.Angle(S.center,C),I=T.Angle(S.center,E),R=y(_,I),B=R*S.radius;const U=C.clone(),H=E.clone();if($!==0&&U.setTo(S.center).add(T.FromAngle(_+R*($/B*(g?1:-1))).mul(S.radius)),A!==0&&H.setTo(S.center).add(T.FromAngle(I+R*(A/B*(g?-1:1))).mul(S.radius)),T.DistMin(U,H,O)){$!==0&&A!==0?($*=-1.5,A*=-1.5):$!==0?$*=-2:A!==0&&(A*=-2);const X=.1-y(w,_)*S.radius,G=.1-y(I,b)*S.radius;$=Math.max($,X),A=Math.max(A,G)}if($!==0&&C.setTo(S.center).add(T.FromAngle(_+R*($/B*(g?1:-1))).mul(S.radius)),A!==0&&E.setTo(S.center).add(T.FromAngle(I+R*(A/B*(g?-1:1))).mul(S.radius)),d&&h&&!d.isExact&&!h.isExact){_=T.Angle(S.center,C),I=T.Angle(S.center,E),R=y(_,I),B=R*S.radius;const X=d_(r,d.shape.id,h.shape.id);X==="double-bound"&&B<30?(C.setTo(f),E.setTo(p),M.setTo(m)):X==="safe"&&(d&&!d.didIntersect&&C.setTo(f),(h&&!h.didIntersect||y(w,_)>y(w,I))&&E.setTo(S.center).add(T.FromAngle(_+R*(Math.min(.9,of*e.props.scale/B)*(g?1:-1))).mul(S.radius)))}bIe(S.center,S.radius,C,E,M,v,g),C.equals(E)&&(C.setTo(M.clone().addXY(1,1)),E.setTo(M.clone().subXY(1,1))),f.setTo(C),p.setTo(E),m.setTo(M);const L=VL(f,p,m);return{bindings:t,type:"arc",start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:p,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:S,bodyArc:L,isValid:L.length!==0&&isFinite(L.center.x)&&isFinite(L.center.y)}}function VL(r,e,t){const n=cq(r,e,t)??T.Med(r,e),i=T.Dist(n,r),s=+T.Clockwise(r,t,e),o=((r.y-e.y)**2+(r.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,l=((t.y-r.y)**2+(t.x-r.x)**2)**.5,c=Math.acos((a*a+l*l-o*o)/(2*a*l))*2,u=+(pt>c),d=(At-c)*(s?1:-1),h=d*i;return{center:n,radius:i,size:d,length:h,largeArcFlag:u,sweepFlag:s}}function bIe(r,e,t,n,i,s,o){const a=T.Angle(r,t),l=T.Angle(r,n);let c=vN(a,l);if(o||(c=At-c),i.setTo(r).add(T.FromAngle(a+c*(.5*(o?1:-1))).mul(e)),c>s){i.rotWith(r,pt);const u=n.clone();n.setTo(t),t.setTo(u)}}const GL=["right","bottom","left","top"],vIe={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},kIe={left:"x",right:"x",top:"y",bottom:"y"},lh={top:"bottom",right:"left",bottom:"top",left:"right"},jy={x:{v:(r,e)=>new T(r,e),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(r,e)=>new T(e,r),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function CIe(r,e){const t={min:r.min-e,max:r.max+e};return t.min>t.max?null:t}function TIe(r,e){return se(r.min<=r.max&&e.min<=e.max),r.min<=e.min&&e.max<=r.max?[{min:r.min,max:e.min},{min:e.max,max:r.max}]:e.max<=r.min||e.min>=r.max?[r]:e.min<=r.min&&r.max<=e.max?[]:Ev(r.min,e)?[{min:e.max,max:r.max}]:Ev(r.max,e)?[{min:r.min,max:e.min}]:[]}function dM(r,e){return{min:Math.min(r,e),max:Math.max(r,e)}}function Ev(r,e){return r>=e.min&&r<=e.max}function YL(r){return r.max-r.min}function cw(r){if(!r)return;const e=r.cross.min;r.cross.min=-r.cross.max,r.cross.max=-e,r.crossTarget=-r.crossTarget}function uw(r){r&&(r.value=-r.value,r.expanded=r.expanded===null?null:-r.expanded)}const Rn={Identity:{x:1,y:1,transpose:!1},Rotate90:{x:-1,y:1,transpose:!0},Rotate180:{x:-1,y:-1,transpose:!1},Rotate270:{x:1,y:-1,transpose:!0},FlipY:{x:1,y:-1,transpose:!1}};function EIe(r){return r.transpose?{x:r.y,y:r.x,transpose:!0}:r}function MIe(r,e){const t={...r};return e.transpose&&(Cl(t,"x","y"),t.transpose=!t.transpose),e.x===-1&&(t.x=-t.x),e.y===-1&&(t.y=-t.y),t}function Cl(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function XL(r,e){e.x=r.x*e.x,e.y=r.y*e.y,r.transpose&&Cl(e,"x","y")}function ch(r,e){r.x===-1&&(e.x=-(e.x+e.width)),r.y===-1&&(e.y=-(e.y+e.height)),r.transpose&&(Cl(e,"x","y"),Cl(e,"width","height"))}function ZL(r,e){r.x===-1&&(Cl(e,"left","right"),cw(e.top),cw(e.bottom),uw(e.left),uw(e.right)),r.y===-1&&(Cl(e,"top","bottom"),cw(e.left),cw(e.right),uw(e.top),uw(e.bottom)),r.transpose&&(Cl(e,"left","top"),Cl(e,"right","bottom"))}class IIe{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(e){this.options=e.options,this.A=e.A,this.B=e.B,this.common=e.common,this.midX=e.midX,this.midY=e.midY,this.gapX=e.gapX,this.gapY=e.gapY,this.bias=new T(1,1)}transform=Rn.Identity;inverse=Rn.Identity;apply(e){if(this.transform=MIe(e,this.transform),this.inverse=EIe(this.transform),ch(e,this.A.original),ch(e,this.B.original),ch(e,this.common.original),ch(e,this.A.expanded),ch(e,this.B.expanded),ch(e,this.common.expanded),ZL(e,this.A.edges),ZL(e,this.B.edges),XL(e,this.bias),e.x===-1&&(this.gapX=-this.gapX,this.midX=this.midX===null?null:-this.midX),e.y===-1&&(this.gapY=-this.gapY,this.midY=this.midY===null?null:-this.midY),e.transpose){let t=this.midX;this.midX=this.midY,this.midY=t,t=this.gapX,this.gapX=this.gapY,this.gapY=t}}reset(){this.apply(this.inverse)}vec(e,t){const n=new T(e,t);return XL(this.inverse,n),n}}const uh=.01;class Vi{constructor(e,t){this.info=e,this.name=t}points=[];add(e,t){return this.points.push(this.info.vec(e,t)),this}_midpointHandle=null;midpointHandle(e){se(this._midpointHandle===null,"midX/midY called multiple times");const t=T.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?e==="x"?"y":"x":e,point:t,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){const e=[];for(let t=0;t<this.points.length;t++){const n=this.points[t],i=e[e.length-1],s=e[e.length-2];if(!i||!s)e.push(n);else{const o=Math.abs(n.x-i.x),a=Math.abs(n.y-i.y),l=Math.abs(n.x-s.x),c=Math.abs(n.y-s.y);o<uh&&a<uh||(o<uh&&l<uh?i.y=n.y:a<uh&&c<uh?i.x=n.x:e.push(n))}}return{name:this.name,points:e,distance:PIe(e),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function PIe(r){let e=0;for(let t=0;t<r.length-1;t++){const n=r[t],i=r[t+1];e+=Math.abs(i.x-n.x)+Math.abs(i.y-n.y)}return e}function dw(r){const e=r.A.edges.right,t=r.B.edges.left;if(!e||!t)return null;if(e.crossTarget>t.crossTarget&&r.apply(Rn.FlipY),r.gapX>0&&r.midX!==null)return new Vi(r,"to left 1").add(e.value,e.crossTarget).add(r.midX,e.crossTarget).add(r.midX,t.crossTarget).midpointHandle("x").add(t.value,t.crossTarget).build();if(e.expanded===null||t.expanded===null)return null;if(r.midY!==null)return new Vi(r,"to left 2").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.midY).add(t.expanded,r.midY).midpointHandle("y").add(t.expanded,t.crossTarget).add(t.value,t.crossTarget).build();const n=Math.abs(e.value-r.common.expanded.right)+Math.abs(e.crossTarget-r.common.expanded.bottom)+Math.abs(r.common.expanded.right-t.expanded)+Math.abs(r.common.expanded.bottom-t.crossTarget)+r.options.expandElbowLegLength+6,i=r.options.expandElbowLegLength+Math.abs(e.crossTarget-r.common.expanded.top)+Math.abs(e.expanded-r.common.expanded.left)+Math.abs(r.common.expanded.top-t.crossTarget)+Math.abs(r.common.expanded.left-t.value)+6+r.bias.y,s=r.gapX<0&&r.midX!==null?r.options.expandElbowLegLength+Math.abs(e.crossTarget-r.A.expanded.bottom)+r.common.expanded.width+Math.abs(r.A.expanded.bottom-r.B.expanded.top)+Math.abs(r.B.expanded.top-t.crossTarget)+r.options.expandElbowLegLength+8:1/0;return n<i&&n<s?new Vi(r,"to left 3").add(e.value,e.crossTarget).add(r.common.expanded.right,e.crossTarget).add(r.common.expanded.right,r.common.expanded.bottom).add(t.expanded,r.common.expanded.bottom).add(t.expanded,t.crossTarget).add(t.value,t.crossTarget).build():i<s?new Vi(r,"to left 4").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.common.expanded.top).add(r.common.expanded.left,r.common.expanded.top).add(r.common.expanded.left,t.crossTarget).add(t.value,t.crossTarget).build():r.midX!==null?new Vi(r,"to left 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.A.expanded.bottom).add(r.midX,r.A.expanded.bottom).add(r.midX,r.B.expanded.top).midpointHandle("y").add(t.expanded,r.B.expanded.top).add(t.expanded,t.crossTarget).add(t.value,t.crossTarget).build():null}function dm(r){const e=r.A.edges.right,t=r.B.edges.top;if(!e||!t)return null;if(e.crossTarget<(t.expanded??t.value)&&t.crossTarget>(e.expanded??e.value)||r.A.isPoint&&r.B.expanded.containsPoint(r.A.original.center))return new Vi(r,"to top 1").add(e.value,e.crossTarget).add(t.crossTarget,e.crossTarget).add(t.crossTarget,t.value).build();if(r.gapX>0&&r.midX!==null&&t.expanded!==null)return new Vi(r,"to top 2").add(e.value,e.crossTarget).add(r.midX,e.crossTarget).add(r.midX,t.expanded).midpointHandle("x").add(t.crossTarget,t.expanded).add(t.crossTarget,t.value).build();if(r.gapY>0&&e.expanded!==null&&t.crossTarget<e.expanded&&r.midY!==null)return new Vi(r,"to top 3").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.midY).add(t.crossTarget,r.midY).midpointHandle("y").add(t.crossTarget,t.value).build();const n=Math.abs(e.value-r.common.expanded.right)+Math.abs(e.crossTarget-r.common.expanded.top)+Math.abs(t.crossTarget-r.common.expanded.right)+Math.abs(t.value-r.common.expanded.top),i=e.expanded!==null&&r.midY!==null&&t.expanded!==null?Math.abs(e.value-e.expanded)+Math.abs(r.B.expanded.left-e.expanded)+Math.abs(r.B.expanded.left-t.crossTarget)+Math.abs(e.crossTarget-r.B.expanded.top)+Math.abs(t.value-t.expanded):1/0,s=e.expanded!==null&&r.midX!==null&&t.expanded!==null?Math.abs(e.value-r.common.expanded.right)+Math.abs(e.crossTarget-r.A.expanded.bottom)+Math.abs(e.expanded-t.crossTarget)+Math.abs(r.A.expanded.bottom-t.expanded)+Math.abs(t.expanded-t.value):1/0;return n<i&&n<s?new Vi(r,"to top 4").add(e.value,e.crossTarget).add(r.common.expanded.right,e.crossTarget).add(r.common.expanded.right,r.common.expanded.top).add(t.crossTarget,r.common.expanded.top).add(t.crossTarget,t.value).build():t.expanded!==null&&e.expanded!==null&&r.midY!==null&&i<s?new Vi(r,"to top 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.midY).add(r.B.expanded.left,r.midY).midpointHandle("y").add(r.B.expanded.left,t.expanded).add(t.crossTarget,t.expanded).add(t.crossTarget,t.value).build():t.expanded!==null&&e.expanded!==null&&r.midX!==null?new Vi(r,"to top 6").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.A.expanded.bottom).add(r.midX,r.A.expanded.bottom).add(r.midX,t.expanded).midpointHandle("x").add(t.crossTarget,t.expanded).add(t.crossTarget,t.value).build():null}function hw(r){return r.apply(Rn.FlipY),dm(r)}function fw(r){const e=r.A.edges.right,t=r.B.edges.right;if(!e||!t)return null;if((r.gapX<=0||e.crossTarget>r.B.expanded.bottom||e.crossTarget<r.B.expanded.top)&&(t.value>r.A.original.left||t.crossTarget>r.A.expanded.bottom||t.crossTarget<r.A.expanded.top))return new Vi(r,"to right 1").add(e.value,e.crossTarget).add(r.common.expanded.right,e.crossTarget).add(r.common.expanded.right,t.crossTarget).add(t.value,t.crossTarget).build();if(r.midX===null)return null;if(t.expanded!==null&&r.gapX>=0){const n=Math.abs(t.crossTarget-r.B.expanded.bottom)+Math.abs(e.crossTarget-r.B.expanded.bottom),i=Math.abs(t.crossTarget-r.B.expanded.top)+Math.abs(e.crossTarget-r.B.expanded.top),s=n<i?"bottom":"top";return new Vi(r,`to right 2 via ${s}`).add(e.value,e.crossTarget).add(r.midX,e.crossTarget).add(r.midX,r.B.expanded[s]).midpointHandle("x").add(t.expanded,r.B.expanded[s]).add(t.expanded,t.crossTarget).add(t.value,t.crossTarget).build()}if(e.expanded!==null&&r.gapX<=0){const n=Math.abs(t.crossTarget-r.A.expanded.bottom)+Math.abs(e.crossTarget-r.A.expanded.bottom),i=Math.abs(t.crossTarget-r.A.expanded.top)+Math.abs(e.crossTarget-r.A.expanded.top),s=n<i?"bottom":"top";return new Vi(r,`to right 3 via ${s}`).add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,r.A.expanded[s]).add(r.midX,r.A.expanded[s]).add(r.midX,t.crossTarget).midpointHandle("x").add(t.value,t.crossTarget).build()}return null}const AIe={top:{top:[Rn.Rotate270,fw],left:[Rn.Rotate270,dm],bottom:[Rn.Rotate270,dw],right:[Rn.Rotate270,hw]},right:{top:[Rn.Identity,dm],right:[Rn.Identity,fw],bottom:[Rn.Identity,hw],left:[Rn.Identity,dw]},bottom:{top:[Rn.Rotate90,dw],left:[Rn.Rotate90,hw],bottom:[Rn.Rotate90,fw],right:[Rn.Rotate90,dm]},left:{top:[Rn.Rotate180,hw],left:[Rn.Rotate180,fw],bottom:[Rn.Rotate180,dm],right:[Rn.Rotate180,dw]}};function On(r,e,t){const[n,i]=AIe[e][t];r.apply(n);const s=i(r);return r.reset(),s}function $Ie(r,e){let t=null;if(Math.abs(r.gapX)+1>Math.abs(r.gapY)&&r.midX!==null)r.gapX>0?t=On(r,"right","left"):t=On(r,"left","right");else{const o=r.A.edges.right,a=r.A.edges.left,l=r.B.edges.top,c=r.B.edges.bottom;r.A.isPoint&&r.B.isPoint?r.gapY>0?t=On(r,"bottom","top"):t=On(r,"top","bottom"):o&&l&&(o.expanded??o.value)<=l.crossTarget&&o.crossTarget<=(l.expanded??l.value)?t=On(r,"right","top"):o&&c&&(o.expanded??o.value)<=c.crossTarget&&o.crossTarget>=(c.expanded??c.value)?t=On(r,"right","bottom"):a&&l&&(a.expanded??a.value)>=l.crossTarget&&a.crossTarget<=(l.expanded??l.value)?t=On(r,"left","top"):a&&c&&(a.expanded??a.value)>=c.crossTarget&&a.crossTarget>=(c.expanded??c.value)?t=On(r,"left","bottom"):r.gapY>0&&r.midY!==null?t=On(r,"bottom","top"):r.gapY<0&&r.midY!==null&&(t=On(r,"top","bottom"))}if(t)return t.aEdgePicking=e,t.bEdgePicking=e,t;const n=GL.filter(o=>r.A.edges[o]),i=GL.filter(o=>r.B.edges[o]),s=n.flatMap(o=>i.map(a=>[o,a,e,e]));return rf(r,s)}function RIe(r,e){let t=null;const n=r.A.edges.right,i=r.A.edges.left,s=r.B.edges.top,o=r.B.edges.bottom;switch(e){case"right":r.gapX>0&&r.gapX>Math.abs(r.gapY)&&r.midX!==null?t=On(r,"right","left"):n&&s&&(n.expanded??n.value)<=s.crossTarget&&n.crossTarget<=(s.expanded??s.value)?t=On(r,"right","top"):n&&o&&(n.expanded??n.value)<=o.crossTarget&&n.crossTarget>=(o.expanded??o.value)&&(t=On(r,"right","bottom"));break;case"left":r.gapX<0&&Math.abs(r.gapX)>Math.abs(r.gapY)&&r.midX!==null?t=On(r,"left","right"):i&&s&&(i.expanded??i.value)>=s.crossTarget&&i.crossTarget<=(s.expanded??s.value)?t=On(r,"left","top"):i&&o&&(i.expanded??i.value)>=o.crossTarget&&i.crossTarget>=(o.expanded??o.value)&&(t=On(r,"left","bottom"));break;case"top":case"bottom":break;default:at(e)}if(t)return t.aEdgePicking="manual",t.bEdgePicking="auto",t;switch(e){case"top":return rf(r,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return rf(r,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return rf(r,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return rf(r,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}function OIe(r,e,t){const n=On(r,e,t);return n||(r.A.isPoint&&r.B.isPoint?rf(r,[[lh[e],lh[t],"manual","manual"],[e,lh[t],"manual","auto"],[lh[e],t,"auto","manual"]]):r.A.isPoint?On(r,lh[e],t):r.B.isPoint?On(r,e,lh[t]):null)}function rf(r,e){let t=null,n=1/0,i=1/0,s=0;for(const[o,a,l,c]of e){s+=1;const u=On(r,o,a);u&&(u.aEdgePicking=l,u.bEdgePicking=c,u.points.length<n?(n=u.points.length,i=u.distance,t=u):u.points.length===n&&u.distance+s<i&&(i=u.distance,t=u))}return t}function WY(r,e,t){const n=r.getShapeUtil(e.type).options,i={elbowMidpoint:e.props.elbowMidPoint,expandElbowLegLength:n.expandElbowLegLength[e.props.size]*e.props.scale,minElbowLegLength:n.minElbowLegLength[e.props.size]*e.props.scale};let s=QL(r,e,t.start,e.props.start),o=QL(r,e,t.end,e.props.end);s=r3(s,o,i),o=r3(o,s,i);const a=!!(!s.side&&o.side);let{aTerminal:l,bTerminal:c}=a?{aTerminal:o,bTerminal:s}:{aTerminal:s,bTerminal:o},u={top:cr(l,c,"top",i),right:cr(l,c,"right",i),bottom:cr(l,c,"bottom",i),left:cr(l,c,"left",i)},d={top:cr(c,l,"top",i),right:cr(c,l,"right",i),bottom:cr(c,l,"bottom",i),left:cr(c,l,"left",i)};const h=e3(u,l.side),f=e3(d,c.side);let p=!1;(!h||!f)&&(p=!0,h||(c=hm(c)),f||(l=hm(l)),c.bounds.containsPoint(l.target,i.expandElbowLegLength)&&(c=hm(c)),l.bounds.containsPoint(c.target,i.expandElbowLegLength)&&(l=hm(l))),p&&(u={top:cr(l,c,"top",i),right:cr(l,c,"right",i),bottom:cr(l,c,"bottom",i),left:cr(l,c,"left",i)},d={top:cr(c,l,"top",i),right:cr(c,l,"right",i),bottom:cr(c,l,"bottom",i),left:cr(c,l,"left",i)});const m=l.isPoint?l.bounds:l.bounds.clone().expandBy(i.expandElbowLegLength),g=c.isPoint?c.bounds:c.bounds.clone().expandBy(i.expandElbowLegLength),y={original:V.Common([l.bounds,c.bounds]),expanded:V.Common([m,g])};let S=c.bounds.minX-l.bounds.maxX;S<0&&(S=l.bounds.minX-c.bounds.maxX,S<0&&(S=0),S=-S);let w=c.bounds.minY-l.bounds.maxY;w<0&&(w=l.bounds.minY-c.bounds.maxY,w<0&&(w=0),w=-w);const b=l.minEndSegmentLength*3,v=c.minEndSegmentLength*3,C=(l.isPoint?b:i.minElbowLegLength)+(c.isPoint?v:i.minElbowLegLength);let E=null;S>C?E={a:l.isPoint?l.bounds.maxX+b:m.maxX,b:c.isPoint?c.bounds.minX-v:g.minX}:S<-C&&(E={a:l.isPoint?l.bounds.minX-b:m.minX,b:c.isPoint?c.bounds.maxX+v:g.maxX});let M=null;w>C?M={a:l.isPoint?l.bounds.maxY+b:m.maxY,b:c.isPoint?c.bounds.minY-v:g.minY}:w<-C&&(M={a:l.isPoint?l.bounds.minY-b:m.minY,b:c.isPoint?c.bounds.maxY+v:g.maxY});const P=a?1-i.elbowMidpoint:i.elbowMidpoint,$=E?Ye(E.a,E.b,P):null,A=M?Ye(M.a,M.b,P):null,O={options:i,swapOrder:a,A:{isPoint:l.isPoint,target:l.target,isExact:l.isExact,arrowheadOffset:l.arrowheadOffset,minEndSegmentLength:l.minEndSegmentLength,original:l.bounds,expanded:m,edges:u,geometry:l.geometry},B:{isPoint:c.isPoint,target:c.target,isExact:c.isExact,arrowheadOffset:c.arrowheadOffset,minEndSegmentLength:c.minEndSegmentLength,original:c.bounds,expanded:g,edges:d,geometry:c.geometry},common:y,gapX:S,gapY:w,midX:$,midY:A},_=new IIe(O),I=t3(l,c,O.A.edges),R=t3(c,l,O.B.edges);let B;return I&&R?B=OIe(_,I,R):I&&!R&&(B=RIe(_,I)),B||(B=$Ie(_,I||R?"fallback":"auto")),B&&(n3("first",O.A,O.B,B),n3("last",O.B,O.A,B),zIe(B,l,c),a&&B.points.reverse()),{...O,route:B,midXRange:E?a?{lo:E.b,hi:E.a}:{lo:E.a,hi:E.b}:null,midYRange:M?a?{lo:M.b,hi:M.a}:{lo:M.a,hi:M.b}:null}}function NIe(r,e){const t=r.swapOrder?r.B.target:r.A.target,n=r.swapOrder?r.A.target:r.B.target,i=T.ManhattanDist(e.points[0],e.points[1]),s=T.ManhattanDist(e.points[e.points.length-2],e.points[e.points.length-1]),o=T.ManhattanDist(t,e.points[1]),a=T.ManhattanDist(e.points[e.points.length-2],n),l=i-o,c=s-a,u=[t,...e.points,n];return{name:e.name,distance:e.distance+l+c,points:u.filter(d=>!e.skipPointsWhenDrawing.has(d)),aEdgePicking:e.aEdgePicking,bEdgePicking:e.bEdgePicking,skipPointsWhenDrawing:e.skipPointsWhenDrawing,midpointHandle:e.midpointHandle}}function _Ie(r){return Mn(r.x,.5)&&Mn(r.y,.5)?null:Math.abs(r.x-.5)>Math.abs(r.y-.5)-1e-4?r.x<.5?"left":"right":r.y<.5?"top":"bottom"}function QL(r,e,t,n){const i=us[e.props.size]*e.props.scale/2,s=i*e.props.scale*3;if(t){const o=r.getShape(t.toId),a=DIe(r,e,t.toId,t.props);if(a&&o){let l=0;const c=t.props.terminal==="start"?"arrowheadStart":"arrowheadEnd";if(e.props[c]!=="none"){const h="scale"in o.props?o.props.scale:1,f="size"in o.props?(us[o.props.size]??0)*h/2:0;l=i+f+Ly*e.props.scale}let u=null;const d=a.target;return t.props.isPrecise&&(u=_Ie(T.RotWith(t.props.normalizedAnchor,{x:.5,y:.5},a.shapeToArrowTransform.rotation()))),{targetShapeId:t.toId,isPoint:!1,isExact:t.props.isExact,bounds:a.bounds,geometry:a.geometry,target:d,arrowheadOffset:l,minEndSegmentLength:s,side:u,snap:t.props.snap}}}return{targetShapeId:null,bounds:V.FromCenter(n,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:T.From(n),arrowheadOffset:0,minEndSegmentLength:s,side:null,snap:"none"}}function DIe(r,e,t,n){const i=n.terminal==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",s=r.getShapeGeometry(t,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!s)return null;const o=r.getShapePageTransform(e.id),a=r.getShapePageTransform(t),l=o.clone().invert().multiply(a),c=s.transform(l),u={x:.5,y:.5},d=n.isPrecise?n.normalizedAnchor:u,h={x:Ye(s.bounds.minX,s.bounds.maxX,d.x),y:Ye(s.bounds.minY,s.bounds.maxY,d.y)},f={x:Ye(s.bounds.minX,s.bounds.maxX,u.x),y:Ye(s.bounds.minY,s.bounds.maxY,u.y)},p=J.applyToPoint(l,h),m=J.applyToPoint(l,f);return{bounds:c.bounds,geometry:c,target:p,center:m,shapeToArrowTransform:l}}const FIe={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function cr(r,e,t,n){const i=FIe[t],s=r.targetShapeId===e.targetShapeId&&r.targetShapeId!==null&&(r.snap==="edge"||r.snap==="edge-point")&&(e.snap==="edge"||e.snap==="edge-point"),o=r.bounds[i.main],a=r.isPoint?null:o+i.expand*n.expandElbowLegLength,l=dM(r.bounds[i.crossMin],r.bounds[i.crossMax]);let c=l;if(!c)return null;se(l);const u=dM(e.bounds[i.main],e.bounds[i.opposite]);e.isPoint||(u[i.bRangeExpand]-=n.minElbowLegLength*2*i.expand);const d=CIe(dM(e.bounds[i.crossMin],e.bounds[i.crossMax]),n.expandElbowLegLength);se(u&&d);let h=!1;if(Ev(o,u)&&!r.isPoint&&!e.isPoint&&!s){const p=TIe(c,d);switch(p.length){case 0:return null;case 1:h=p[0]!==c,c=p[0];break;case 2:h=!0,c=YL(p[0])>YL(p[1])?p[0]:p[1];break;default:at(p)}}if(!Ev(r.target[i.crossAxis],c))return null;const f=r.target[i.crossAxis];return{value:o,expanded:a,cross:c,crossTarget:f,isPartial:h}}function e3(r,e){return e===null?!!(r.bottom||r.left||r.right||r.top):e==="x"?!!r.left||!!r.right:e==="y"?!!r.top||!!r.bottom:!!r[e]}function t3(r,e,t){switch(r.side){case null:return null;case"x":return r.bounds.center.x>e.bounds.center.x&&t?.left?"left":t?.right?"right":null;case"y":return r.bounds.center.y>e.bounds.center.y&&t?.top?"top":t?.bottom?"bottom":null;default:return r.side}}function hm(r){if(r.isPoint)return r;let e=null,t=0;return(r.snap==="edge"||r.snap==="edge-point")&&(t=r.arrowheadOffset,(r.side==="x"||r.side==="left"||r.side==="right")&&(e="x"),(r.side==="y"||r.side==="top"||r.side==="bottom")&&(e="y")),{targetShapeId:r.targetShapeId,side:e,bounds:new V(r.target.x,r.target.y,0,0),geometry:r.geometry,target:r.target,arrowheadOffset:t,minEndSegmentLength:r.minEndSegmentLength,isExact:r.isExact,isPoint:!0,snap:r.snap}}function n3(r,e,t,n){if(!e.geometry)return;const i=r==="first"?n.points[0]:n.points[n.points.length-1],s=r==="first"?n.points[1]:n.points[n.points.length-2],o=e.geometry.isClosed?s:e.target,a=T.ManhattanDist(i,o);let l=null,c=1/0;if(e.isExact)l=e.target;else if(e.geometry){const u=e.geometry.intersectLineSegment(s,e.target,{includeLabels:!1,includeInternal:!1});e.geometry.hitTestPoint(e.target,Math.max(1,e.arrowheadOffset),!0,Yo.EXCLUDE_NON_STANDARD)&&u.push(e.target);for(const d of u){const h=T.ManhattanDist(o,d);h<c&&(c=h,l=d)}}if(l){let u=e.arrowheadOffset;const d=T.ManhattanDist(s,l),h=e.arrowheadOffset*2;if(d<h){const g=h-e.arrowheadOffset;u=d-g}u<e.minEndSegmentLength&&(e.geometry.bounds.containsPoint(t.target)?u=Math.max(0,u):u=-e.arrowheadOffset);let f=l,p=!1;if(!e.isExact&&u!==0){const g=T.Nudge(l,s,u);f=g,u<0&&!e.geometry.hitTestPoint(g,0,!0,Yo.EXCLUDE_NON_STANDARD)?f=l:(u<0&&(p=!0),f=g)}const m=T.ManhattanDist(s,f);if(n.distance+=m-a,i.x=f.x,i.y=f.y,p){const g=T.Lrp(s,i,.5);n.skipPointsWhenDrawing.add(g),n.points.splice(r==="first"?1:n.points.length-1,0,g)}}}function zIe(r,e,t){if(r){if(r.points.length>=3){const n=r.points[0],i=r.points[1];if(T.ManhattanDist(n,i)<e.minEndSegmentLength&&(r.points.splice(1,1),r.points.length>=3)){const o=Mn(n.x,i.x)?"y":"x";r.points[1][o]=n[o]}}if(r.points.length>=3){const n=r.points[r.points.length-1],i=r.points[r.points.length-2];if(T.ManhattanDist(n,i)<t.minEndSegmentLength&&(r.points.splice(r.points.length-2,1),r.points.length>=3)){const o=Mn(n.x,i.x)?"y":"x";r.points[r.points.length-2][o]=n[o]}}}}function r3(r,e,t){if(!r.geometry||r.geometry.isClosed)return r;const n=r.geometry.uninterpolateAlongEdge(r.target,Yo.EXCLUDE_NON_STANDARD),i=r.geometry.interpolateAlongEdge(n-.01/r.geometry.length),o=r.geometry.interpolateAlongEdge(n+.01/r.geometry.length).sub(i).per().uni(),a=Math.abs(o.x)>Math.abs(o.y)?jy.x:jy.y;if(r.geometry.bounds.containsPoint(e.target,t.expandElbowLegLength))return r.side=a.self,hm(r);const l=a.v(r.target[a.self]-r.bounds[a.size]*2,r.target[a.cross]),c=a.v(r.target[a.self]+r.bounds[a.size]*2,r.target[a.cross]);let u=null,d=0,h=null,f=0,p=a.self;for(const m of r.geometry.intersectLineSegment(l,c,Yo.EXCLUDE_NON_STANDARD))Math.abs(m[a.self]-r.target[a.self])<1||(m[a.self]<r.target[a.self]?T.ManhattanDist(m,r.target)>d&&(d=T.ManhattanDist(m,r.target),u=m):T.ManhattanDist(m,r.target)>f&&(f=T.ManhattanDist(m,r.target),h=m));return u&&h?d>f?p=a.hiEdge:p=a.loEdge:u&&!h?p=a.hiEdge:!u&&h&&(p=a.loEdge),r.side=p,r}const BIe=8;function jIe(r){return r.props.kind!=="arc"?!1:Math.abs(r.props.bend)<BIe*r.props.scale}function Mv(r,e,t){const n=r.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===t);if(!n)return;const i=r.getShape(n.toId);if(!i)return;const s=r.getShapePageTransform(i),o=t==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",a=r.getShapeGeometry(i,o?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:i,transform:s,isClosed:a.isClosed,isExact:n.props.isExact,didIntersect:!1,geometry:a}}function i3(r,e,t,n){const i=r.getShape(t.toId);if(i){const{point:s,size:o}=r.getShapeGeometry(i).bounds,a=T.Add(s,T.MulV(t.props.isPrecise||n?t.props.normalizedAnchor:{x:.5,y:.5},o)),l=J.applyToPoint(r.getShapePageTransform(i),a);return J.applyToPoint(J.Inverse(e),l)}else return new T(0,0)}const LIe=d1("arrow bindings",(r,e)=>{const t=r.getBindingsFromShape(e.id,"arrow");return{start:t.find(n=>n.props.terminal==="start"),end:t.find(n=>n.props.terminal==="end")}},{areRecordsEqual:(r,e)=>r.id===e.id,areResultsEqual:(r,e)=>r.start===e.start&&r.end===e.end});function zn(r,e){return LIe.get(r,e.id)}const UIe=d1("arrow info",(r,e)=>{const t=zn(r,e);if(e.props.kind==="elbow"){const n=WY(r,e,t);if(!n?.route)return Tv(r,e,t);const i=n.swapOrder?n.B:n.A,s=n.swapOrder?n.A:n.B;return{type:"elbow",bindings:t,start:{handle:i.target,point:n.route.points[0],arrowhead:e.props.arrowheadStart},end:{handle:s.target,point:n.route.points[n.route.points.length-1],arrowhead:e.props.arrowheadEnd},elbow:n,route:n.route,isValid:!0}}return jIe(e)?Tv(r,e,t):wIe(r,e,t)},{areRecordsEqual:(r,e)=>r.props===e.props,areResultsEqual:Wme});function Ns(r,e){const t=typeof e=="string"?e:e.id;return UIe.get(r,t)}function sf(r,e,t){const n=r.getShapePageTransform(e),i=d_(r,t.start?.toId,t.end?.toId),s=t.start?i3(r,n,t.start,i==="double-bound"||i==="start-contains-end"):T.From(e.props.start),o=t.end?i3(r,n,t.end,i==="double-bound"||i==="end-contains-start"):T.From(e.props.end);return{start:s,end:o}}function Up(r,e,t,n){const i=typeof e=="string"?e:e.id,s=typeof t=="string"?t:t.id,o=r.getBindingsFromShape(i,"arrow").filter(l=>l.props.terminal===n.terminal);o.length>1&&r.deleteBindings(o.slice(1));const a=o[0];a?r.updateBinding({...a,toId:s,props:n}):r.createBinding({type:"arrow",fromId:i,toId:s,props:n})}function fm(r,e,t){const n=r.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===t);r.deleteBindings(n)}const of=10,Ly=10,WIe=10,us={s:2,m:3.5,l:5,xl:10};function d_(r,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const n=r.getShapePageBounds(e),i=r.getShapePageBounds(t);if(n&&i){if(n.contains(i))return"start-contains-end";if(i.contains(n))return"end-contains-start"}return"safe"}function HIe(r){return r.getSelectedShapeIds().map(n=>r.getShape(n)).filter(n=>{if(!n)return!1;if(r.isShapeOfType(n,"arrow")){const i=zn(r,n);if(i.start||i.end)return!1}return!0})}const HY=()=>{const r=z();return F("threeStackableItems",()=>HIe(r).length>2,[r])},Za=()=>{const r=z();return F("isInSelectState",()=>r.isIn("select"),[r])},qY=()=>{const r=z();return F("allow group",()=>{const e=r.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(r.isShapeOfType(t,"arrow")){const n=zn(r,t);if(n.start&&!e.some(i=>i.id===n.start.toId)||n.end&&!e.some(i=>i.id===n.end.toId))return!1}return!0},[r])},KY=()=>{const r=z();return F("allowUngroup",()=>r.getSelectedShapeIds().some(e=>r.getShape(e)?.type==="group"),[r])},qIe=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function JY(r,e){const t=z();return F("selectedShapes",()=>t.getSelectedShapes().length>=r,[t,r,e])}function ji(r,e){const t=z();return F("selectedShapes",()=>{const n=t.getSelectedShapes().filter(i=>!t.isShapeOrAncestorLocked(i)).length;return r===void 0?n:n>=r},[t])}function KIe(){const r=z();return F("showAutoSizeToggle",()=>{const e=r.getSelectedShapes();return e.length===1&&r.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[r])}function VY(){const r=z();return F("hasLinkShapeSelected",()=>{const e=r.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[r])}function JIe(){const r=z();return F("onlyFlippableShape",()=>{const e=r.getOnlySelectedShape();return e&&(r.isShapeOfType(e,"group")||r.isShapeOfType(e,"image")||r.isShapeOfType(e,"arrow")||r.isShapeOfType(e,"line")||r.isShapeOfType(e,"draw"))},[r])}function GY(){const r=z();return F("useCanRedo",()=>r.getCanRedo(),[r])}function YY(){const r=z();return F("useCanUndo",()=>r.getCanUndo(),[r])}function VIe(){return x.jsxs(x.Fragment,{children:[x.jsx(GIe,{}),x.jsx(YIe,{}),x.jsx(XIe,{}),x.jsx(ZIe,{}),x.jsx(QIe,{}),x.jsx(nPe,{}),x.jsx(rPe,{}),x.jsx(iPe,{})]})}function GIe(){const r=ji(2),e=Za(),t=r&&e;return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"align-left",disabled:!t}),x.jsx(K,{actionId:"align-center-horizontal",disabled:!t}),x.jsx(K,{actionId:"align-right",disabled:!t}),x.jsx(K,{actionId:"stretch-horizontal",disabled:!t}),x.jsx(K,{actionId:"align-top",disabled:!t}),x.jsx(K,{actionId:"align-center-vertical",disabled:!t}),x.jsx(K,{actionId:"align-bottom",disabled:!t}),x.jsx(K,{actionId:"stretch-vertical",disabled:!t})]})}function YIe(){const r=ji(3),e=Za(),t=r&&e;return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"distribute-horizontal",disabled:!t}),x.jsx(K,{actionId:"distribute-vertical",disabled:!t})]})}function XIe(){const r=HY(),e=Za(),t=r&&e;return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"stack-horizontal",disabled:!t}),x.jsx(K,{actionId:"stack-vertical",disabled:!t})]})}function ZIe(){const r=ji(1),e=Za(),t=r&&e;return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"send-to-back",disabled:!t}),x.jsx(K,{actionId:"send-backward",disabled:!t}),x.jsx(K,{actionId:"bring-forward",disabled:!t}),x.jsx(K,{actionId:"bring-to-front",disabled:!t})]})}function QIe(){return Jn()<an.TABLET_SM?x.jsx(ePe,{}):x.jsx(tPe,{})}function ePe(){const r=z(),e=F("zoom is 1",()=>r.getZoomLevel()===1,[r]);return x.jsx(K,{actionId:"zoom-to-100",disabled:e})}function tPe(){const r=ji(1),e=Za(),t=r&&e;return x.jsx(K,{actionId:"rotate-ccw",disabled:!t})}function nPe(){const r=ji(1),e=Za(),t=r&&e;return x.jsx(K,{actionId:"rotate-cw",disabled:!t})}function rPe(){const r=VY(),e=Za(),t=r&&e;return x.jsx(K,{actionId:"edit-link",disabled:!t})}function iPe(){const r=qY(),e=KY();return r?x.jsx(s3,{}):e?x.jsx(sPe,{}):x.jsx(s3,{})}function s3(){const r=ji(2),e=Za(),t=r&&e;return x.jsx(K,{actionId:"group",disabled:!t})}function sPe(){return x.jsx(K,{actionId:"ungroup"})}const oPe=k.memo(function({children:e}){const t=ie(),n=Jn(),i=Ss(),{orientation:s}=xS(),o=k.useRef(null);ya(o);const a=z(),l=F("should display quick actions when in readonly",()=>a.isInAny("hand","zoom"),[a]),c=e??x.jsx(VIe,{});if(!(i&&!l))return x.jsxs(yd,{id:"actions-menu",children:[x.jsx(xd,{children:x.jsx(Mt,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:x.jsx(be,{icon:s==="horizontal"?"dots-vertical":"dots-horizontal",small:!0})})}),x.jsx(Sd,{side:s==="horizontal"?n>=an.TABLET?"bottom":"top":"right",sideOffset:6,children:x.jsx(_i,{ref:o,label:t("actions-menu.title"),className:"tlui-actions-menu","data-testid":"actions-menu.content",orientation:"grid",children:x.jsx(Ni,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function aPe(){const r=z(),e=j1(),t=F("isSelectToolActive",()=>r.getCurrentToolId()==="select",[r]),n=F("isSinglePageMode",()=>r.options.maxPages<=1,[r]);return t?x.jsxs(x.Fragment,{children:[e&&x.jsx(kDe,{}),x.jsxs(Xe,{id:"modify",children:[x.jsx(sDe,{}),x.jsx(oDe,{}),x.jsx(cDe,{}),!n&&x.jsx(uDe,{})]}),x.jsx(KQ,{}),x.jsx(JQ,{}),x.jsx(Xe,{id:"select-all",children:x.jsx(VQ,{})})]}):null}const lPe=k.memo(function({children:e,disabled:t=!1}){const n=z(),i=ie(),{Canvas:s}=Tt(),o=k.useCallback(h=>{h.key==="Escape"&&(h.stopPropagation(),n.getContainer().focus())},[n]);k.useEffect(()=>()=>{document.body.removeEventListener("keydown",o,{capture:!0})},[o]);const a=k.useCallback(h=>{if(h){if(document.body.addEventListener("keydown",o,{capture:!0}),n.getInstanceState().isCoarsePointer){const f=n.getSelectedShapes(),{inputs:{currentPagePoint:p}}=n,m=n.getShapesAtPoint(p);if(!n.getSelectedShapes().length||!m.some(g=>f.includes(g))){const g=m.filter(y=>n.isShapeOrAncestorLocked(y));g.length&&n.select(...g.map(y=>y.id))}}}else{const f=n.getOnlySelectedShape();f&&n.isShapeOrAncestorLocked(f)&&n.setSelectedShapes([]),n.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",o,{capture:!0})})}},[n,o]),l=Pn(),[c,u]=Ya("context menu",a),d=e??x.jsx(aPe,{});return x.jsxs(ufe,{dir:"ltr",onOpenChange:u,modal:!1,children:[x.jsx(dfe,{onContextMenu:void 0,dir:"ltr",disabled:t,children:s?x.jsx(s,{}):null}),c&&x.jsx(hfe,{container:l,children:x.jsx(ffe,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":i("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:Oe,children:x.jsx(Ni,{type:"context-menu",sourceId:"context-menu",children:d})})})]})}),cPe=2e3,uPe=5e3,dPe=In(function(){const e=z(),{isChatting:t,chatMessage:n}=e.getInstanceState(),i=k.useRef(-1),[s,o]=k.useState("");return k.useEffect(()=>{if(!t&&n||t){const l=t?uPe:cPe;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},l)}return()=>{clearTimeout(i.current)}},[e,n,t]),t?x.jsx(fPe,{value:s,setValue:o,chatMessage:n}):n.trim()?x.jsx(hPe,{chatMessage:n}):null});function XY(r){const e=z();k.useLayoutEffect(()=>{if(!r.current)return;const{x:n,y:i}=e.inputs.currentScreenPoint;r.current?.style.setProperty("transform",`translate(${n}px, ${i}px)`);function s(o){const{minX:a,minY:l}=e.getViewportScreenBounds();r.current?.style.setProperty("transform",`translate(${o.clientX-a}px, ${o.clientY-l}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[r,e])}const hPe=({chatMessage:r})=>{const e=z(),t=k.useRef(null);return XY(t),x.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:r})},fPe=In(function({chatMessage:e,value:t,setValue:n}){const i=z(),s=ie(),o=k.useRef(null),a=e||s("cursor-chat.type-to-chat");XY(o),k.useLayoutEffect(()=>{const h=o.current;if(!h)return;const f=i.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});h.style.setProperty("width",f.w+"px")},[i,t,a]),k.useLayoutEffect(()=>{const h=i.timers.requestAnimationFrame(()=>{o.current?.focus()});return()=>{cancelAnimationFrame(h)}},[i]);const l=k.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),c=k.useCallback(h=>{const{value:f}=h.target;n(f.slice(0,64)),i.updateInstanceState({chatMessage:f})},[i,n]),u=k.useCallback(h=>{const f=o.current;if(!f)return;const{value:p}=f;switch(h.key){case"Enter":{if(Oe(h),h.stopPropagation(),!p){l();return}n("");break}case"Escape":{Oe(h),h.stopPropagation(),l();break}}},[l,n]),d=k.useCallback(h=>{h.stopPropagation()},[]);return x.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:l,onChange:c,onKeyDown:u,onPaste:d,value:t,placeholder:a,spellCheck:!1})});function gA({checked:r}){const e=ie();return x.jsx(ta,{"data-checked":!!r,label:e(r?"ui.checked":"ui.unchecked"),icon:r?"check":"none",className:"tlui-button__icon",small:!0})}function wS({id:r,kbd:e,label:t,lang:n,readonlyOk:i,onSelect:s,toggle:o=!1,disabled:a=!1,checked:l=!1}){const{type:c,sourceId:u}=B1(),d=Ss(),h=ie();if(d&&!i)return null;const f=Zy(t,c),p=f?h(f):void 0;switch(c){case"menu":return x.jsxs(o7,{dir:"ltr",lang:n,className:"tlui-button tlui-button__menu tlui-button__checkbox",title:p,onSelect:m=>{s?.(u),Oe(m)},disabled:a,checked:l,children:[x.jsx(ta,{small:!0,label:h(l?"ui.checked":"ui.unchecked"),icon:o?l?"toggle-on":"toggle-off":l?"check":"none"}),p&&x.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),e&&x.jsx(Yg,{children:e})]});case"context-menu":return x.jsxs(mfe,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",lang:n,title:p,onSelect:m=>{s(u),Oe(m)},disabled:a,checked:l,children:[x.jsx(ta,{small:!0,label:h(l?"ui.checked":"ui.unchecked"),icon:o?l?"toggle-on":"toggle-off":l?"check":"none"}),p&&x.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),e&&x.jsx(Yg,{children:e})]},r);default:return null}}function _r({id:r,disabled:e=!1,label:t,size:n="small",children:i}){const{type:s,sourceId:o}=B1(),a=Pn(),l=ie(),c=t?typeof t=="string"?t:t[s]??t.default:void 0,u=c?l(c):void 0;switch(s){case"menu":return x.jsxs(PMe,{id:`${o}-sub.${r}`,children:[x.jsx(AMe,{id:`${o}-sub.${r}-button`,disabled:e,label:u,title:u}),x.jsx($Me,{id:`${o}-sub.${r}-content`,size:n,children:i})]});case"context-menu":return e?null:x.jsxs(pPe,{id:`${o}-sub.${r}`,children:[x.jsx(K9,{dir:"ltr",disabled:e,asChild:!0,children:x.jsxs(et,{"data-testid":`${o}-sub.${r}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[x.jsx(Tn,{children:u}),x.jsx(be,{icon:"chevron-right",small:!0})]})}),x.jsx(gO,{container:a,children:x.jsx(J9,{"data-testid":`${o}-sub.${r}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":n,children:i})})]});default:return i}}function pPe({id:r,children:e}){const[t,n]=Ya(r);return x.jsx(q9,{open:t,onOpenChange:n,children:e})}function mPe({customDebugFlags:r,customFeatureFlags:e}){const t=z(),{addToast:n}=Xa(),{addDialog:i}=SS(),[s,o]=Be.useState(!1);return x.jsxs(x.Fragment,{children:[x.jsxs(Xe,{id:"items",children:[x.jsx(it,{id:"hard-reset",onSelect:mq,label:"Hard reset"}),x.jsx(it,{id:"add-toast",onSelect:()=>{n({id:ft(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),n({id:ft(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:ft(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:ft(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),x.jsx(it,{id:"show-dialog",label:"Show dialog",onSelect:()=>{i({component:({onClose:a})=>x.jsx(xPe,{displayDontShowAgain:!0,onCancel:()=>a(),onContinue:()=>a()}),onClose:()=>{}})}}),x.jsx(it,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>SPe(t,100)}),x.jsx(it,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{const a=t.getSelectedShapes(),l=a.length===0?t.getRenderingShapes():a;window.alert(`Shapes ${l.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(s)throw Error("oh no!");return null})(),x.jsx(it,{id:"throw-error",onSelect:()=>o(!0),label:"Throw error"})]}),x.jsxs(Xe,{id:"flags",children:[x.jsx(gPe,{customDebugFlags:r}),x.jsx(yPe,{customFeatureFlags:e})]})]})}function gPe(r){const e=Object.values(r.customDebugFlags??Yt);return e.length?x.jsx(_r,{id:"debug flags",label:"Debug flags",children:x.jsx(Xe,{id:"debug flags",children:e.map(t=>x.jsx(ZY,{flag:t},t.name))})}):null}function yPe(r){const e=Object.values(r.customFeatureFlags??_Se);return e.length?x.jsx(_r,{id:"feature flags",label:"Feature flags",children:x.jsx(Xe,{id:"feature flags",children:e.map(t=>x.jsx(ZY,{flag:t},t.name))})}):null}function xPe({title:r="title",body:e="hello hello hello",cancel:t="Cancel",confirm:n="Continue",displayDontShowAgain:i=!1,maxWidth:s="350",onCancel:o,onContinue:a}){const[l,c]=Be.useState(!1);return x.jsxs(x.Fragment,{children:[x.jsxs(D1,{children:[x.jsx(F1,{children:r}),x.jsx(z1,{})]}),x.jsx(By,{style:{maxWidth:s},children:e}),x.jsxs(i_,{className:"tlui-dialog__footer__actions",children:[i&&x.jsxs(et,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[x.jsx(gA,{checked:l}),x.jsx(Tn,{children:"Dont show again"})]}),x.jsx(et,{type:"normal",onClick:o,children:x.jsx(Tn,{children:t})}),x.jsx(et,{type:"primary",onClick:async()=>a(),children:x.jsx(Tn,{children:n})})]})]})}const ZY=In(function({flag:e,onChange:t}){const n=e.get();return x.jsx(wS,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:n,onSelect:()=>{e.set(!n),t?.(!n)}})});let o3=0;function SPe(r,e){const t=r.options.adjacentShapeMargin,n=Array(e),i=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)o3++,n[s]={id:Ct("box"+o3),type:"geo",x:s%i*(100+t),y:Math.floor(s/i)*(100+t)};r.run(()=>{r.createShapes(n).setSelectedShapes(n.map(s=>s.id))})}function wPe({children:r}){const e=r??x.jsx(mPe,{});return x.jsxs(L1,{id:"debug",children:[x.jsx(U1,{children:x.jsx(et,{type:"icon",title:"Debug menu",children:x.jsx(be,{icon:"dots-horizontal"})})}),x.jsx(W1,{side:"top",align:"end",alignOffset:0,children:x.jsx(Ni,{type:"menu",sourceId:"debug-panel",children:e})})]})}const bPe=k.memo(function(){const{DebugMenu:e}=Sa(),t=k.useRef(null);return ya(t),x.jsxs("footer",{ref:t,className:"tlui-debug-panel",children:[x.jsx(kPe,{}),x.jsx(CPe,{}),e&&x.jsx(e,{})]})});function vPe(r=!0){const[e,t]=k.useState(0),n=z();k.useEffect(()=>{if(!r)return;const i=()=>t(s=>s+1);return n.on("tick",i),()=>{n.off("tick",i)}},[n,r])}const kPe=In(function(){vPe();const e=z(),t=e.getPath(),n=e.getHoveredShape(),i=e.getOnlySelectedShape(),s=t==="select.idle"||!t.includes("select.")?n:i,o=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${T.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${T.ToInt(e.inputs.originPagePoint)}]  [${T.ToInt(e.inputs.currentPagePoint)}] = ${T.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return x.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function CPe(){const r=z(),e=F("show_fps",()=>Yt.showFps.get(),[Yt]),t=k.useRef(null);return k.useEffect(()=>{if(!e)return;const n=250;let i=0,s=-1,o=performance.now(),a=0,l=0,c=!1;function u(){if(l++,a=performance.now()-o,a>n){const d=Math.round(l*(n/a)*(1e3/n));d>i&&(i=d);const h=i*.75;(d<h&&!c||d>=h&&c)&&(c=!c),t.current.innerHTML=`FPS ${d.toString()}`,t.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=n,l=0,o=performance.now()}s=r.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(s)}},[e,r]),e?x.jsx("div",{ref:t}):null}function TPe(){const r=z(),e=F("follow",()=>r.getInstanceState().followingUserId,[r]);return e?x.jsx(EPe,{userId:e}):null}function EPe({userId:r}){const e=$1(r);return e?x.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}const MPe=k.memo(function(){const e=Jn(),t=ie(),n=k.useRef(null);ya(n);const{MainMenu:i,QuickActions:s,ActionsMenu:o,PageMenu:a}=Sa(),l=z(),c=F("isSinglePageMode",()=>l.options.maxPages<=1,[l]),u=l.options.actionShortcutsLocation==="menu"?!0:l.options.actionShortcutsLocation==="toolbar"?!1:e>=an.TABLET;return!i&&!a&&!u?null:x.jsx("nav",{ref:n,className:"tlui-menu-zone",children:x.jsxs(Kd,{children:[i&&x.jsx(i,{}),a&&!c&&x.jsx(a,{}),u?x.jsxs(_i,{orientation:"horizontal",label:t("actions-menu.title"),children:[s&&x.jsx(s,{}),o&&x.jsx(o,{})]}):null]})})}),IPe=({id:r,component:e,preventBackgroundClose:t})=>{const{removeDialog:n}=SS(),i=k.useRef(!1),s=Pn(),o=k.useCallback(a=>{a||n(r)},[r,n]);return x.jsx(jde,{onOpenChange:o,defaultOpen:!0,children:x.jsx(Lde,{container:s,children:x.jsx(Ude,{dir:"ltr",className:"tlui-dialog__overlay",onClick:a=>{i.current||!t&&a.target===a.currentTarget&&o(!1)},children:x.jsx(Wde,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>i.current=!0,onMouseUp:()=>i.current=!1,onInteractOutside:a=>{i.current=!1,t&&a.preventDefault()},children:x.jsx(e,{onClose:()=>{i.current=!1,o(!1)}})})})})})},PPe=k.memo(function(){const{dialogs:e}=SS();return F("dialogs",()=>e.get(),[e]).map(n=>x.jsx(IPe,{...n},n.id))});function APe(){const r=z(),e=wa(),[t,n]=k.useState(!1),i=k.useRef(!1);return cd("toggle showback to content",()=>{const s=i.current,o=r.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===r.getCulledShapes().size),s!==a&&(n(a),i.current=a)},[r]),t?x.jsx(K,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),n(!1)}}):null}function $Pe(){const r=z();return F("is pen mode",()=>r.getInstanceState().isPenMode,[r])?x.jsx(K,{actionId:"exit-pen-mode"}):null}function RPe(){const r=z(),e=wa();return F("is following user",()=>!!r.getInstanceState().followingUserId,[r])?x.jsx(it,{...e["stop-following"]}):null}function OPe(){return x.jsxs(x.Fragment,{children:[x.jsx($Pe,{}),x.jsx(APe,{}),x.jsx(RPe,{})]})}function NPe({children:r}){const e=r??x.jsx(OPe,{});return x.jsx("div",{className:"tlui-helper-buttons",children:x.jsx(Ni,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}const _Pe=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function DPe(){const r=z(),e=ln(),t=F("colorScheme",()=>r.user.getUserPreferences().colorScheme??(r.user.getIsDarkMode()?"dark":"light"),[r]);return x.jsx(_r,{id:"help menu color-scheme",label:"menu.theme",children:x.jsx(Xe,{id:"theme",children:_Pe.map(({colorScheme:n,label:i})=>x.jsx(wS,{id:`color-scheme-${n}`,label:i,checked:n===t,readonlyOk:!0,onSelect:()=>{r.user.updateUserPreferences({colorScheme:n}),e("color-scheme",{source:"menu",value:n})}},n))})})}function QY(){const r=Sn(),e=ln(),t=F("locale",()=>r?.user.getLocale(),[r]);return r?x.jsx(_r,{id:"help menu language",label:"menu.language",children:x.jsx(Xe,{id:"languages",className:"tlui-language-menu",children:$y.map(({locale:n,label:i})=>x.jsx(wS,{id:`language-${n}`,lang:n,title:n,label:i,checked:n===t,readonlyOk:!0,onSelect:()=>{r.user.updateUserPreferences({locale:n}),e("change-language",{source:"menu",locale:n})}},n))})}):null}function FPe(){return x.jsxs(x.Fragment,{children:[x.jsx(QY,{}),x.jsx(eX,{})]})}function eX(){const{KeyboardShortcutsDialog:r}=Sa(),{addDialog:e}=SS(),t=k.useCallback(()=>{r&&e({component:r})},[e,r]);return r?x.jsx(it,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}const zPe=["auto","trackpad","mouse"];function BPe(){const r=z(),e=ln(),t=F("inputMode",()=>r.user.getUserPreferences().inputMode,[r]),n=F("wheelBehavior",()=>r.getCameraOptions().wheelBehavior,[r]),i=o=>o==="auto"?t===null:t===o,s=(o,a)=>o==="auto"?`action.toggle-auto-${a}`:o==="trackpad"?"action.toggle-trackpad":"action.toggle-mouse";return x.jsx(_r,{id:"help menu input-mode",label:"menu.input-mode",children:x.jsx(Xe,{id:"peripheral-mode",children:zPe.map(o=>x.jsx(wS,{id:`peripheral-mode-${o}`,label:s(o,n),checked:i(o),readonlyOk:!0,onSelect:()=>{switch(e("input-mode",{source:"menu",value:o}),o){case"auto":r.user.updateUserPreferences({inputMode:null});break;case"trackpad":r.user.updateUserPreferences({inputMode:"trackpad"});break;case"mouse":r.user.updateUserPreferences({inputMode:"mouse"});break}}},o))})})}function jPe(){return x.jsxs(x.Fragment,{children:[x.jsxs(Xe,{id:"basic",children:[x.jsx(UPe,{}),x.jsx(KPe,{}),x.jsx(LPe,{}),x.jsx(JPe,{})]}),x.jsx(VPe,{})]})}function LPe(){return x.jsxs(_r,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[x.jsxs(Xe,{id:"export-all-as-group",children:[x.jsx(K,{actionId:"export-all-as-svg"}),x.jsx(K,{actionId:"export-all-as-png"})]}),x.jsx(Xe,{id:"export-all-as-bg",children:x.jsx(B_,{})})]})}function UPe(){return x.jsxs(_r,{id:"edit",label:"menu.edit",children:[x.jsx(qPe,{}),x.jsx(KQ,{}),x.jsx(JQ,{}),x.jsx(WPe,{}),x.jsx(HPe,{}),x.jsx(Xe,{id:"select-all",children:x.jsx(VQ,{})})]})}function WPe(){return x.jsxs(Xe,{id:"misc",children:[x.jsx(zQ,{}),x.jsx(BQ,{}),x.jsx(DQ,{}),x.jsx(_Q,{}),x.jsx(jQ,{}),x.jsx(LQ,{}),x.jsx(YQ,{}),x.jsx(GQ,{}),x.jsx(FQ,{})]})}function HPe(){return x.jsxs(Xe,{id:"lock",children:[x.jsx(UQ,{}),x.jsx(Q2e,{})]})}function qPe(){const r=YY(),e=GY();return x.jsxs(Xe,{id:"undo-redo",children:[x.jsx(K,{actionId:"undo",disabled:!r}),x.jsx(K,{actionId:"redo",disabled:!e})]})}function KPe(){return x.jsx(_r,{id:"view",label:"menu.view",children:x.jsxs(Xe,{id:"view-actions",children:[x.jsx(K,{actionId:"zoom-in"}),x.jsx(K,{actionId:"zoom-out"}),x.jsx(WQ,{}),x.jsx(HQ,{}),x.jsx(qQ,{})]})})}function JPe(){return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"insert-embed"}),x.jsx(K,{actionId:"insert-media"})]})}function VPe(){return x.jsxs(Xe,{id:"preferences",children:[x.jsxs(_r,{id:"preferences",label:"menu.preferences",children:[x.jsxs(Xe,{id:"preferences-actions",children:[x.jsx(dDe,{}),x.jsx(hDe,{}),x.jsx(fDe,{}),x.jsx(pDe,{}),x.jsx(mDe,{}),x.jsx(gDe,{}),x.jsx(bDe,{}),x.jsx(vDe,{}),x.jsx(wDe,{})]}),x.jsxs(Xe,{id:"user-interface-submenus",children:[x.jsx(BPe,{}),x.jsx(DPe,{}),x.jsx(CDe,{})]})]}),x.jsx(QY,{}),x.jsx(eX,{})]})}const GPe=k.memo(function({children:e}){const t=Pn(),[n,i]=Ya("main menu"),s=ie(),o=e??x.jsx(jPe,{});return x.jsxs(yO,{dir:"ltr",open:n,onOpenChange:i,modal:!1,children:[x.jsx(xO,{asChild:!0,dir:"ltr",children:x.jsx(et,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:x.jsx(be,{icon:"menu",small:!0})})}),x.jsx(Zk,{container:t,children:x.jsx(SO,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:x.jsx(Ni,{type:"menu",sourceId:"main-menu",children:o})})})]})}),hM={};function Wp(r){if(hM[r])return hM[r];const t=document.createElement("canvas").getContext("2d");t.fillStyle=r,t.fillRect(0,0,1,1);const[n,i,s,o]=t.getImageData(0,0,1,1).data,a=new Float32Array([n/255,i/255,s/255,o/255]);return hM[r]=a,a}const Fb=10,tX=24*Fb+12+48;function xh(r,{center:e,radius:t,numArcSegments:n=20,startAngle:i=0,endAngle:s=At,offset:o=0}){const a=(s-i)/n;let l=o;for(let c=i;c<s;c+=a)r[l++]=e.x,r[l++]=e.y,r[l++]=e.x+Math.cos(c)*t,r[l++]=e.y+Math.sin(c)*t,r[l++]=e.x+Math.cos(c+a)*t,r[l++]=e.y+Math.sin(c+a)*t;return r}function Sh(r,e,t,n,i,s){r[e++]=t,r[e++]=n,r[e++]=t,r[e++]=n+s,r[e++]=t+i,r[e++]=n,r[e++]=t+i,r[e++]=n,r[e++]=t,r[e++]=n+s,r[e++]=t+i,r[e++]=n+s}function YPe(r,e,t){const n=Fb;t=Math.min(t,Math.min(e.w,e.h)/2);const i=V.ExpandBy(e,-t);if(i.w<=0||i.h<=0)return xh(r,{center:e.center,radius:t,numArcSegments:Fb*4}),Fb*4*6;let s=0;return Sh(r,s,i.minX,i.minY,i.w,i.h),s+=12,Sh(r,s,i.minX,e.minY,i.w,t),s+=12,Sh(r,s,i.maxX,i.minY,t,i.h),s+=12,Sh(r,s,i.minX,i.maxY,i.w,t),s+=12,Sh(r,s,e.minX,i.minY,t,i.h),s+=12,xh(r,{numArcSegments:n,offset:s,center:i.point,radius:t,startAngle:pt,endAngle:pt*1.5}),s+=n*6,xh(r,{numArcSegments:n,offset:s,center:T.Add(i.point,new T(i.w,0)),radius:t,startAngle:pt*1.5,endAngle:At}),s+=n*6,xh(r,{numArcSegments:n,offset:s,center:T.Add(i.point,i.size),radius:t,startAngle:0,endAngle:kn}),s+=n*6,xh(r,{numArcSegments:n,offset:s,center:T.Add(i.point,new T(0,i.h)),radius:t,startAngle:kn,endAngle:pt}),tX}function XPe(r){if(!r)throw new Error("Canvas element not found");const e=r.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,n=e.createShader(e.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader");if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,n),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const l=e.getUniformLocation(o,"canvasPageBounds"),c=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:pw(e,1024),unselectedShapes:pw(e,4096),viewport:pw(e,tX),collaborators:pw(e,1024),prepareTriangles(h,f){e.bindBuffer(e.ARRAY_BUFFER,h.buffer),e.bufferData(e.ARRAY_BUFFER,h.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(h){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,h/2),e.disable(e.BLEND)},drawTriangles(h){e.drawArrays(e.TRIANGLES,0,h/2)},setFillColor(h){e.uniform4fv(c,h)},setCanvasPageBounds(h){e.uniform4fv(l,h)}}}function pw(r,e){const t=r.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function a3(r,e,t){let n=r.vertices.length;for(;n<e+t.length;)n*=2;if(n!=r.vertices.length){const i=new Float32Array(n);i.set(r.vertices),r.vertices=i}r.vertices.set(t,e)}var ZPe=Object.create,nX=Object.defineProperty,QPe=Object.getOwnPropertyDescriptor,eAe=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),rX=r=>{throw TypeError(r)},iX=(r,e,t)=>e in r?nX(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tAe=r=>[,,,ZPe(null)],sX=["class","method","getter","setter","accessor","field","value","get","set"],oX=r=>r!==void 0&&typeof r!="function"?rX("Function expected"):r,nAe=(r,e,t,n,i)=>({kind:sX[r],name:e,metadata:n,addInitializer:s=>t._?rX("Already initialized"):i.push(oX(s||null))}),rAe=(r,e)=>iX(e,eAe("metadata"),r[3]),iAe=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},xa=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=sX[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,QPe(i,t)),y=n.length-1;y>=0;y--)l=nAe(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,oX(o)&&(g[p]=o);return g&&nX(i,t,g),i},$a=(r,e,t)=>iX(r,typeof e!="symbol"?e+"":e,t),aX,lX,cX,uX,dX,hX,fX,pX,mX,gX,ws;gX=[Yi],mX=[q],pX=[q],fX=[q],hX=[q],dX=[q],uX=[q],cX=[q],lX=[q],aX=[Yi];class Hs{constructor(e,t,n){this.editor=e,this.elem=t,this.container=n,iAe(ws,5,this),$a(this,"disposables",[]),$a(this,"gl"),$a(this,"shapeGeometryCache"),$a(this,"colors"),$a(this,"id",ft()),$a(this,"canvasBoundingClientRect",Ft("canvasBoundingClientRect",new V)),$a(this,"originPagePoint",new T),$a(this,"originPageCenter",new T),$a(this,"isInViewport",!1),this.gl=XPe(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const s=e.getShapeMaskedPageBounds(i.id);if(!s)return null;const o=new Float32Array(12);return Sh(o,0,s.x,s.y,s.w,s.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Zi("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Wp(e.getPropertyValue("--tl-color-text-3").trim()),selectFill:Wp(e.getPropertyValue("--tl-color-selected").trim()),viewportFill:Wp(e.getPropertyValue("--tl-color-muted-1").trim()),background:Wp(e.getPropertyValue("--tl-color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?V.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new T(e.maxX,e.maxY));return new V(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:n,height:i}=this.elem.getBoundingClientRect();return new V(e,t,n,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new T(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height;let i=t.width,s=i/n;s<t.height&&(s=t.height,i=s*n);const o=new V(0,0,i,s);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:n,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,n,i])}getMinimapPagePoint(e,t){const n=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,o=t-i.y;return s*=n.width/i.width,o*=n.height/i.height,s+=n.minX,o+=n.minY,new T(s,o,1)}minimapScreenPointToPagePoint(e,t,n=!1,i=!1){const{editor:s}=this,o=s.getViewportPageBounds();let{x:a,y:l}=this.getMinimapPagePoint(e,t);if(i){const c=this.editor.getCurrentPageBounds()??new V,u=c.minX-o.width/2,d=c.maxX+o.width/2,h=c.minY-o.height/2,f=c.maxY+o.height/2,p=Math.max(0,u+o.width-a),m=Math.max(0,-(d-o.width-a)),g=Math.max(0,h+o.height-l),y=Math.max(0,-(f-o.height-l));a+=(p-m)/2,l+=(g-y)/2,a=_e(a,u,d),l=_e(l,h,f)}if(n){const{originPagePoint:c}=this,u=Math.abs(a-c.x),d=Math.abs(l-c.y);u>d?l=c.y:a=c.x}return new T(a,l)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const n=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,c=a.length;l<c;l++){const u=a[l],d=this.shapeGeometryCache.get(u);if(!d)continue;const h=d.length,f=this.editor.getShape(u);f&&this.editor.getShapeUtil(f.type).hideInMinimap?.(f)||(n.has(u)?(a3(this.gl.selectedShapes,s,d),s+=h):(a3(this.gl.unselectedShapes,o,d),o+=h))}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=YPe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),ht.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,n=t*6,i=n*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const s=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:l}of e)l&&(xh(s,{center:T.From(l),radius:3*a,offset:o,numArcSegments:t}),o+=n);this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:l}of e)this.gl.setFillColor(Wp(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,n/2),o+=n}}ws=tAe();xa(ws,1,"close",gX,Hs);xa(ws,1,"getDpr",mX,Hs);xa(ws,1,"getContentPageBounds",pX,Hs);xa(ws,1,"getContentScreenBounds",fX,Hs);xa(ws,1,"getCanvasSize",hX,Hs);xa(ws,1,"getCanvasClientPosition",dX,Hs);xa(ws,1,"getCanvasPageBounds",uX,Hs);xa(ws,1,"getZoom",cX,Hs);xa(ws,1,"getCanvasPageBoundsArray",lX,Hs);xa(ws,1,"render",aX,Hs);rAe(ws,Hs);function sAe(){const r=z(),e=Pn(),t=ie(),n=k.useRef(null),i=k.useRef(!1),s=k.useRef();k.useEffect(()=>{try{const d=new Hs(r,n.current,e);return s.current=d,s.current.close}catch(d){r.annotateError(d,{origin:"minimap",willCrashApp:!1}),r.timers.setTimeout(()=>{throw d})}},[r,e]);const o=k.useCallback(d=>{if(!r.getCurrentPageShapeIds().size||!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),f=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.originPagePoint.setTo(f),s.current.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(h,{animation:{duration:r.options.animationMediumMs}})},[r]),a=k.useCallback(d=>{if(!s.current)return;const h=d.currentTarget;if(oS(h,d),!r.getCurrentPageShapeIds().size)return;i.current=!0,s.current.isInViewport=!1;const f=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),p=r.getViewportPageBounds(),m=s.current.getContentPageBounds();if(new V(m.x-p.width/2,m.y-p.height/2,m.width+p.width,m.height+p.height).containsPoint(f)&&!p.containsPoint(f)){s.current.isInViewport=p.containsPoint(f);const S=T.Sub(p.center,p.point),w=T.Add(f,S);s.current.originPagePoint.setTo(w),s.current.originPageCenter.setTo(f),r.centerOnPoint(f,{animation:{duration:r.options.animationMediumMs}})}else{const S=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);s.current.isInViewport=p.containsPoint(S),s.current.originPagePoint.setTo(S),s.current.originPageCenter.setTo(p.center)}function y(S){h&&aS(h,S),i.current=!1,document.body.removeEventListener("pointerup",y)}document.body.addEventListener("pointerup",y)},[r]),l=k.useCallback(d=>{if(!s.current)return;const h=s.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(i.current){if(s.current.isInViewport){const g=s.current.originPagePoint.clone().sub(s.current.originPageCenter);r.centerOnPoint(T.Sub(h,g));return}r.centerOnPoint(h)}const f=s.current.getMinimapPagePoint(d.clientX,d.clientY),p=r.pageToScreen(f),m={type:"pointer",target:"canvas",name:"pointer_move",...nr(r,d),point:p,isPen:r.getInstanceState().isPenMode};r.dispatch(m)},[r]),c=k.useCallback(d=>{const h=cG(d);r.dispatch({type:"wheel",name:"wheel",delta:h,point:new T(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:zt(d)})},[r]),u=P1();return k.useEffect(()=>{r.timers.setTimeout(()=>{s.current?.updateColors(),s.current?.render()})},[u,r]),x.jsx("div",{className:"tlui-minimap",children:x.jsx("canvas",{role:"img","aria-label":t("navigation-zone.minimap"),"data-testid":"minimap.canvas",ref:n,className:"tlui-minimap__canvas",onDoubleClick:o,onPointerMove:l,onPointerDown:a,onWheelCapture:c})})}function oAe(r,e){const[t,n]=Be.useState(e);Be.useLayoutEffect(()=>{const s=zO(r);if(s)try{n(JSON.parse(s))}catch{console.error(`Could not restore value ${r} from local storage.`)}},[r]);const i=Be.useCallback(s=>{n(o=>{const a=typeof s=="function"?s(o):s;return BO(r,JSON.stringify(a)),a})},[r]);return[t,i]}const aAe=k.memo(function(){const e=wa(),t=ie(),n=Jn(),i=k.useRef(null);ya(i);const[s,o]=oAe("minimap",!0),a=k.useCallback(()=>{o(u=>!u)},[o]),{ZoomMenu:l,Minimap:c}=Sa();return n<an.MOBILE?null:x.jsxs("div",{ref:i,className:"tlui-navigation-panel",children:[x.jsx(_i,{orientation:"horizontal",label:t("navigation-zone.title"),children:l&&n<an.TABLET?x.jsx(l,{}):x.jsxs(x.Fragment,{children:[!s&&x.jsx(Mt,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(Zy(e["zoom-out"].label))} ${kv(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:x.jsx(be,{small:!0,icon:"minus"})}),l&&x.jsx(l,{},"zoom-menu"),!s&&x.jsx(Mt,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(Zy(e["zoom-in"].label))} ${kv(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:x.jsx(be,{small:!0,icon:"plus"})}),c&&x.jsx(Mt,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),onClick:a,children:x.jsx(be,{small:!0,icon:s?"chevron-right":"chevron-left"})})]})}),c&&n>=an.TABLET&&!s&&x.jsx(c,{})]})}),lAe=function({name:e,id:t,isCurrentPage:n,onCancel:i,onComplete:s}){const o=z(),a=ln(),l=k.useRef(null),c=k.useRef(null),u=k.useCallback(()=>{c.current=o.markHistoryStoppingPoint("rename page")},[o]),d=k.useCallback(f=>{o.renamePage(t,f||"New Page"),a("rename-page",{source:"page-menu"})},[o,t,a]),h=k.useCallback(()=>{c.current&&o.bailToMark(c.current),i()},[o,i]);return x.jsx(yp,{className:"tlui-page-menu__item__input",ref:f=>l.current=f,defaultValue:e,onValueChange:d,onComplete:s,onCancel:h,onFocus:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:n,autoSelect:!0})},yA=(r,e,t,n,i)=>{let s;const o=r.getPages(),a=t>n?o[n-1]:o[n],l=t>n?o[n]:o[n+1];a&&!l?s=_s(a.index):!a&&l?s=Yme(o[0].index):s=Pf(a.index,l.index),s!==o[t].index&&(r.markHistoryStoppingPoint("moving page"),r.updatePage({id:e,index:s}),i("move-page",{source:"page-menu"}))},l3=In(function({index:e,listSize:t,item:n,onRename:i}){const s=z(),o=ie(),a=s.getPages(),l=ln(),c=k.useCallback(()=>{s.markHistoryStoppingPoint("creating page");const f=Ci.createId();s.duplicatePage(n.id,f),l("duplicate-page",{source:"page-menu"})},[s,n,l]),u=k.useCallback(()=>{yA(s,n.id,e,e-1,l)},[s,n,e,l]),d=k.useCallback(()=>{yA(s,n.id,e,e+1,l)},[s,n,e,l]),h=k.useCallback(()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(n.id),l("delete-page",{source:"page-menu"})},[s,n,l]);return x.jsxs(L1,{id:`page item submenu ${e}`,children:[x.jsx(U1,{children:x.jsx(et,{type:"icon",title:o("page-menu.submenu.title"),children:x.jsx(be,{icon:"dots-vertical",small:!0})})}),x.jsx(W1,{alignOffset:0,side:"right",sideOffset:-4,children:x.jsxs(Ni,{type:"menu",sourceId:"page-menu",children:[x.jsxs(Xe,{id:"modify",children:[i&&x.jsx(it,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),x.jsx(it,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=s.options.maxPages}),e>0&&x.jsx(it,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<t-1&&x.jsx(it,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:d})]}),t>1&&x.jsx(Xe,{id:"delete",children:x.jsx(it,{id:"delete",onSelect:h,label:"page-menu.submenu.delete"})})]})})]})}),cAe=k.memo(function(){const e=z(),t=ln(),n=ie(),i=Jn(),s=k.useCallback(()=>y(!1),[]),[o,a]=Ya("page-menu",s),l=36,c=k.useRef(null),u=F("pages",()=>e.getPages(),[e]),d=F("currentPage",()=>e.getCurrentPage(),[e]),h=F("currentPageId",()=>e.getCurrentPageId(),[e]),f=Ss(),p=F("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),m=F("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[g,y]=k.useState(!1);k.useEffect(function(){function R(){g||document.activeElement===document.body&&e.menus.clearOpenMenus()}return document.addEventListener("keydown",R,{passive:!0}),()=>{document.removeEventListener("keydown",R)}},[e,g]);const S=k.useCallback(()=>{f||y(I=>!I)},[f]),w=k.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,v]=k.useState(Object.fromEntries(u.map((I,R)=>[I.id,{y:R*l,offsetY:0,isSelected:!1}])));k.useLayoutEffect(()=>{v(Object.fromEntries(u.map((I,R)=>[I.id,{y:R*l,offsetY:0,isSelected:!1}])))},[l,u]),k.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const I=document.querySelector(`[data-pageid="${h}"]`);if(I){I.querySelector("button")?.focus();const R=c.current;if(!R)return;const B=I.offsetTop,U=R.scrollTop;B<U&&R.scrollTo({top:B});const H=B+l,L=R.scrollTop+R.offsetHeight;H>L&&R.scrollTo({top:H-R.offsetHeight})}})},[l,h,o,e]);const C=k.useCallback(I=>{const{clientY:R,currentTarget:B}=I,{dataset:{id:U,index:H}}=B;if(!U||!H)return;const L=w.current;oS(I.currentTarget,I),L.status="pointing",L.pointing={id:U,index:+H};const G=b[U].y;L.startY=R,L.startIndex=Math.max(0,Math.min(Math.round(G/l),u.length-1))},[l,u.length,b]),E=k.useCallback(I=>{const R=w.current;if(R.status==="pointing"){const{clientY:B}=I,U=B-R.startY;Math.abs(U)>5&&(R.status="dragging")}if(R.status==="dragging"){const{clientY:B}=I,U=B-R.startY,H=b[R.pointing.id],{startIndex:L,pointing:X}=R,G=H.y+U,ce=Math.max(0,Math.min(Math.round(G/l),u.length-1)),ae={...b};if(ae[X.id]={y:H.y,offsetY:U,isSelected:!0},ce!==R.dragIndex){R.dragIndex=ce;for(let ge=0;ge<u.length;ge++){const De=u[ge];if(De.id===R.pointing.id)continue;let{y:Ne}=ae[De.id];ce===L?Ne=ge*l:ce<L?ce<=ge&&ge<L?Ne=(ge+1)*l:Ne=ge*l:ce>L&&(ce>=ge&&ge>L?Ne=(ge-1)*l:Ne=ge*l),Ne!==ae[De.id].y&&(ae[De.id]={y:Ne,offsetY:0,isSelected:!0})}}v(ae)}},[l,u,b]),M=k.useCallback(I=>{const R=w.current;if(R.status==="dragging"){const{id:B,index:U}=R.pointing;yA(e,B,U,R.dragIndex,t)}aS(I.currentTarget,I),R.status="idle"},[e,t]),P=k.useCallback(I=>{const R=w.current;I.key==="Escape"&&(R.status==="dragging"&&v(Object.fromEntries(u.map((B,U)=>[B.id,{y:U*l,offsetY:0,isSelected:!1}]))),R.status="idle")},[l,u]),$=k.useCallback(()=>{f||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const I=Ci.createId();e.createPage({name:n("page-menu.new-page-initial-name"),id:I}),e.setCurrentPage(I),y(!0),e.timers.requestAnimationFrame(()=>{const R=document.querySelector(`[data-pageid="${I}"]`);R&&R.querySelector("button")?.focus()})}),t("new-page",{source:"page-menu"}))},[e,n,f,t]),A=k.useCallback(I=>{e.setCurrentPage(I),t("change-page",{source:"page-menu"})},[e,t]),O=k.useCallback((I,R)=>{e.renamePage(I,R),t("rename-page",{source:"page-menu"})},[e,t]),_=i<an.TABLET_SM&&m;return x.jsxs(yd,{id:"pages",onOpenChange:a,open:o,children:[x.jsx(xd,{"data-testid":"main.page-menu",children:x.jsxs(et,{type:"menu",title:d.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[x.jsx("div",{className:"tlui-page-menu__name",children:d.name}),x.jsx(be,{icon:"chevron-down",small:!0})]})}),x.jsx(Sd,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:g,children:x.jsxs("div",{className:"tlui-page-menu__wrapper",children:[x.jsxs("div",{className:"tlui-page-menu__header",children:[x.jsx("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!f&&x.jsxs(Kd,{children:[x.jsx(et,{type:"icon","data-testid":"page-menu.edit",title:n(g?"page-menu.edit-done":"page-menu.edit-start"),onClick:S,children:x.jsx(be,{icon:g?"check":"edit"})}),x.jsx(et,{type:"icon","data-testid":"page-menu.create",title:n(p?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:p,onClick:$,children:x.jsx(be,{icon:"plus"})})]})]}),x.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*u.length+4},ref:c,children:u.map((I,R)=>{const B=b[I.id]??{offsetY:0};return g?x.jsxs("div",{"data-testid":"page-menu.item","data-pageid":I.id,className:"tlui-page_menu__item__sortable",style:{zIndex:I.id===d.id?888:R,transform:`translate(0px, ${B.y+B.offsetY}px)`},children:[x.jsx(et,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:C,onPointerUp:M,onPointerMove:E,onKeyDown:P,"data-id":I.id,"data-index":R,children:x.jsx(be,{icon:"drag-handle-dots"})}),_?x.jsxs(et,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const U=window.prompt(n("action.rename"),I.name);U&&U!==I.name&&O(I.id,U)},onDoubleClick:S,children:[x.jsx(gA,{checked:I.id===d.id}),x.jsx(Tn,{children:I.name})]}):x.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:x.jsx(lAe,{id:I.id,name:I.name,isCurrentPage:I.id===d.id,onComplete:()=>{y(!1)},onCancel:()=>{y(!1)}})}),!f&&x.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:x.jsx(l3,{index:R,item:I,listSize:u.length})})]},I.id+"_editing"):x.jsxs("div",{"data-pageid":I.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[x.jsxs(et,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>A(I.id),onDoubleClick:S,title:n("page-menu.go-to-page"),onKeyDown:U=>{U.key==="Enter"&&I.id===d.id&&(S(),e.markEventAsHandled(U))},children:[x.jsx(gA,{checked:I.id===d.id}),x.jsx(Tn,{children:I.name})]}),!f&&x.jsx("div",{className:"tlui-page_menu__item__submenu",children:x.jsx(l3,{index:R,item:I,listSize:u.length,onRename:()=>{if(_){const U=window.prompt(n("action.rename"),I.name);U&&U!==I.name&&O(I.id,U)}else y(!0),h!==I.id&&A(I.id)}})})]},I.id)})})]})})]})});function uAe(){const r=z(),e=Ss(),t=F("should display quick actions",()=>r.isInAny("select","hand","zoom"),[r]);if(!(e&&!t))return x.jsxs(x.Fragment,{children:[x.jsx(hAe,{}),x.jsx(dAe,{})]})}function dAe(){const r=ji(1),e=Za(),t=r&&e;return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"delete",disabled:!t}),x.jsx(K,{actionId:"duplicate",disabled:!t})]})}function hAe(){const r=YY(),e=GY();return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"undo",disabled:!r}),x.jsx(K,{actionId:"redo",disabled:!e})]})}const fAe=k.memo(function({children:e}){const t=e??x.jsx(uAe,{});return x.jsx(Ni,{type:"small-icons",sourceId:"quick-actions",children:t})});function pAe({userId:r}){const e=$1(r);return e?x.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName?.[0]??""},r):null}const mAe=In(function({userId:e}){const t=z(),n=ie(),i=ln(),s=$1(e),o=k.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[t,e,i]),a=s?.followingUserId===t.user.getId(),l=t.getInstanceState().followingUserId===e;return s?x.jsxs(Kd,{className:"tlui-people-menu__item","data-follow":l||a,children:[x.jsxs(et,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[x.jsx(ta,{label:n("people-menu.avatar-color"),icon:"color",color:s.color}),x.jsx("div",{className:"tlui-people-menu__name",children:s.userName?.trim()||n("people-menu.anonymous-user")})]}),x.jsx(et,{type:"icon",className:"tlui-people-menu__item__follow",title:n(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,children:x.jsx(be,{icon:a?"leading":l?"following":"follow"})})]}):null});function gAe({count:r}){return x.jsx("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(r)})}const yAe=In(function(){const e=z(),t=Pn(),n=ie(),i=ln(),s=k.useRef(!1),[o,a]=k.useState(!1),l=k.useCallback(m=>{a(m)},[]),c=e.user.getColor(),u=k.useCallback(m=>{e.user.updateUserPreferences({color:m}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:d,handleButtonPointerDown:h,handleButtonPointerEnter:f,handleButtonPointerUp:p}=Be.useMemo(()=>{const m=()=>{s.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:b=>{const{id:v}=b.currentTarget.dataset;v&&c!==v&&u(v)},handleButtonPointerDown:b=>{const{id:v}=b.currentTarget.dataset;v&&(u(v),s.current=!0,window.addEventListener("pointerup",m))},handleButtonPointerEnter:b=>{if(!s.current)return;const{id:v}=b.currentTarget.dataset;v&&u(v)},handleButtonPointerUp:b=>{const{id:v}=b.currentTarget.dataset;v&&u(v)}}},[c,u]);return x.jsxs(bO,{onOpenChange:l,open:o,children:[x.jsx(vO,{dir:"ltr",asChild:!0,children:x.jsx(et,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:n("people-menu.change-color"),children:x.jsx(be,{icon:"color"})})}),x.jsx(kO,{container:t,children:x.jsx(CO,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:x.jsx(q1,{children:zP.map(m=>x.jsx(et,{type:"icon","data-id":m,"data-testid":m,"aria-label":m,isActive:c===m,title:m,style:{color:m},onPointerEnter:f,onPointerDown:h,onPointerUp:p,onClick:d,children:x.jsx(be,{icon:"color"})},m))})})})]})});function xAe(){const r=z(),e=ln(),t=F("userName",()=>r.user.getName(),[]),n=ie(),i=k.useRef(t),s=k.useRef(t),[o,a]=k.useState(!1),l=k.useCallback(()=>{a(h=>!h)},[]),c=k.useCallback(h=>{s.current=h,r.user.updateUserPreferences({name:h})},[r]),u=k.useCallback(()=>{i.current!==s.current&&(e("change-user-name",{source:"people-menu"}),i.current=s.current)},[e]),d=k.useCallback(()=>{a(!1),r.user.updateUserPreferences({name:i.current}),r.menus.clearOpenMenus()},[r]);return x.jsxs("div",{className:"tlui-people-menu__user",children:[x.jsx(yAe,{}),o?x.jsx(yp,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:c,onComplete:l,onCancel:d,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:t||n("people-menu.anonymous-user")}),t?null:x.jsx("div",{className:"tlui-people-menu__user__label",children:n("people-menu.user")})]}),x.jsx(et,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:n("people-menu.change-name"),onClick:l,children:x.jsx(be,{icon:o?"check":"edit"})})]})}function SAe({children:r}){const e=ie(),t=Pn(),n=z(),i=hG(),s=F("user",()=>n.user.getColor(),[n]),o=F("user",()=>n.user.getName(),[n]),[a,l]=Ya("people menu"),u=Jn()<=an.MOBILE_XS?1:5;return i.length?x.jsxs(bO,{onOpenChange:l,open:a,children:[x.jsx(vO,{dir:"ltr",asChild:!0,children:x.jsx("button",{className:"tlui-people-menu__avatars-button",title:e("people-menu.title"),children:x.jsxs("div",{className:"tlui-people-menu__avatars",children:[i.slice(-u).map(d=>x.jsx(pAe,{userId:d},d)),i.length>0&&x.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:s},children:o?.[0]??""}),i.length>u&&x.jsx(gAe,{count:i.length-u})]})})}),x.jsx(kO,{container:t,children:x.jsx(CO,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:x.jsxs("div",{className:"tlui-people-menu__wrapper",children:[x.jsx("div",{className:"tlui-people-menu__section",children:x.jsx(xAe,{})}),i.length>0&&x.jsx("div",{className:"tlui-people-menu__section",children:i.map(d=>x.jsx(mAe,{userId:d},d+"_presence"))}),r]})})})]}):null}function wAe(){return x.jsx("div",{className:"tlui-share-zone",draggable:!1,children:x.jsx(SAe,{})})}const bAe=Object.freeze([Oi,pd,Dl,Qo]);function yX(r=bAe){const e=z();return F("getRelevantStyles",()=>{const t=new WP(e.getSharedStyles()),n=!!e.root.getCurrent()?.shapeType,i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const s of r)t.applyValue(s,e.getStyleForNextShape(s));return n||i||t.size>0?t:null},[e])}const gs={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowKind:[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},xX=Be.forwardRef(function({onHistoryMark:e,title:t,min:n,steps:i,value:s,label:o,onValueChange:a,["data-testid"]:l,ariaValueModifier:c=1},u){const d=ie(),[h,f]=k.useState(""),[p,m]=k.useState(-1);k.useEffect(()=>{m(0)},[]);const g=k.useCallback(w=>{a(w[0])},[a]),y=k.useCallback(()=>{As.hideAllTooltips(),e?.("click slider")},[e]);k.useEffect(()=>{const w=pv.setTimeout("set title and label",()=>{f(t+"  "+d(o))},0);return()=>clearTimeout(w)},[o,d,t]);const S=k.useCallback(w=>{w.key==="Tab"&&w.stopPropagation()},[]);return x.jsx("div",{className:"tlui-slider__container",children:x.jsx(K1,{content:h,children:x.jsxs(kpe,{"data-testid":l,className:"tlui-slider",dir:"ltr",min:n??0,max:i,step:1,value:s!==null?[s]:void 0,onPointerDown:y,onValueChange:g,onKeyDownCapture:S,onKeyUpCapture:S,children:[x.jsx(Cpe,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&x.jsx(Tpe,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&x.jsx(Epe,{"aria-valuemin":(n??0)*c,"aria-valuenow":s*c,"aria-valuemax":i*c,"aria-label":h,className:"tlui-slider__thumb",dir:"ltr",ref:u,tabIndex:p})]})})})});function qs(){return sc({isDarkMode:P1()})}const SX=k.createContext(null);function vAe({children:r,styles:e}){const t=z(),n=ln(),i=k.useCallback(a=>t.markHistoryStoppingPoint(a),[t]),s=F("enhancedA11yMode",()=>t.user.getEnhancedA11yMode(),[t]),o=k.useCallback(function(a,l){t.run(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(a,l),t.setStyleForNextShapes(a,l),t.updateInstanceState({isChangingStyle:!0})}),n("set-style",{source:"style-panel",id:a.id,value:l})},[t,n]);return x.jsx(SX.Provider,{value:{styles:e,enhancedA11yMode:s,onHistoryMark:i,onValueChange:o},children:r})}function Dr(){const r=k.useContext(SX);if(!r)throw new Error("useStylePanelContext must be used within a StylePanelContextProvider");return r}function J1({children:r}){return x.jsx("h3",{className:"tlui-style-panel__subheading",children:r})}function kAe(r){const{enhancedA11yMode:e}=Dr();return x.jsxs(x.Fragment,{children:[e&&x.jsx(J1,{children:r.title}),x.jsx(_i,{label:r.title,children:x.jsx(h_,{...r})})]})}function CAe(r){const e=Dr(),{uiType:t,items:n,title:i,style:s,value:o,onValueChange:a=e.onValueChange,onHistoryMark:l=e.onHistoryMark}=r,c=qs(),u=z(),d=ie(),h=Jn(),f=k.useRef(!1),p=k.useRef(null),{handleButtonClick:m,handleButtonPointerDown:g,handleButtonPointerEnter:y,handleButtonPointerUp:S}=k.useMemo(()=>{const b=()=>{f.current=!1,window.removeEventListener("pointerup",b);const P=p.current;P&&(["TEXTAREA","INPUT"].includes(P.nodeName)||P.isContentEditable)?P.focus():h>=an.TABLET_SM&&u.getContainer().focus(),p.current=null};return{handleButtonClick:P=>{const{id:$}=P.currentTarget.dataset;o.type==="shared"&&o.value===$||(l?.("point picker item"),a(s,$))},handleButtonPointerDown:P=>{const{id:$}=P.currentTarget.dataset;l?.("point picker item"),a(s,$),f.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",b)},handleButtonPointerEnter:P=>{if(!f.current)return;const{id:$}=P.currentTarget.dataset;a(s,$)},handleButtonPointerUp:P=>{const{id:$}=P.currentTarget.dataset;o.type==="shared"&&o.value===$||a(s,$)}}},[u,h,o,l,a,s]),w=n.length>4?q1:Kd;return x.jsx(BMe,{"data-testid":`style.${t}`,type:"single",value:o.type==="shared"?o.value:null,asChild:!0,children:x.jsx(w,{children:n.map(b=>{const v=o.type==="shared"&&o.value===b.value,C=i+"  "+d(`${t}-style.${b.value}`);return x.jsx(jMe,{type:"icon","data-id":b.value,"data-testid":`style.${t}.${b.value}`,"aria-label":C+(v?` (${d("style-panel.selected")})`:""),tooltip:x.jsxs(x.Fragment,{children:[x.jsx("div",{children:C}),v?x.jsxs("div",{children:["(",d("style-panel.selected"),")"]}):null]}),value:b.value,"data-state":o.type==="shared"&&o.value===b.value?"on":"off","data-isactive":v,title:C,style:s===Oi?{color:ot(c,b.value,"solid")}:void 0,onPointerEnter:y,onPointerDown:g,onPointerUp:S,onClick:m,children:x.jsx(be,{icon:b.icon})},b.value)})})})}const bS=k.memo(kAe),h_=k.memo(CAe);function TAe(r){const e=ie();return x.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[x.jsx("div",{title:e(r.label),className:"tlui-style-panel__double-select-picker-label",children:e(r.label)}),x.jsx(_i,{orientation:"horizontal",label:e(r.label),children:x.jsx(IAe,{...r})})]})}function EAe(r){const e=Dr(),{uiTypeA:t,uiTypeB:n,labelA:i,labelB:s,itemsA:o,itemsB:a,styleA:l,styleB:c,valueA:u,valueB:d,onValueChange:h=e.onValueChange}=r,f=z(),p=ie(),[m,g]=k.useState(!1),[y,S]=k.useState(!1),w=k.useMemo(()=>o.find(E=>u.type==="shared"&&u.value===E.value)?.icon??"mixed",[o,u]),b=k.useMemo(()=>a.find(E=>d.type==="shared"&&d.value===E.value)?.icon??"mixed",[a,d]);if(u===void 0&&d===void 0)return null;const v=`style panel ${t} A`,C=`style panel ${n} B`;return x.jsxs(x.Fragment,{children:[x.jsxs(yd,{id:v,open:m,onOpenChange:g,children:[x.jsx(xd,{children:x.jsx(Mt,{type:"icon","data-testid":`style.${t}`,title:p(i)+"  "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${t}-style.${u.value}`)),children:x.jsx(be,{icon:w,small:!0,invertIcon:!0})})}),x.jsx(Sd,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:x.jsx(_i,{orientation:"grid",label:p(i),children:x.jsx(Ni,{type:"icons",sourceId:"style-panel",children:o.map(E=>x.jsx(Mt,{"data-testid":`style.${t}.${E.value}`,type:"icon",onClick:()=>{h(l,E.value),ui.deleteOpenMenu(v,f.contextId),g(!1)},title:`${p(i)}  ${p(`${t}-style.${E.value}`)}`,children:x.jsx(be,{icon:E.icon,invertIcon:!0})},E.value))})})})]}),x.jsxs(yd,{id:C,open:y,onOpenChange:S,children:[x.jsx(xd,{children:x.jsx(Mt,{type:"icon","data-testid":`style.${n}`,title:p(s)+"  "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${n}-style.${d.value}`)),children:x.jsx(be,{icon:b,small:!0})})}),x.jsx(Sd,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:x.jsx(_i,{orientation:"grid",label:p(s),children:x.jsx(Ni,{type:"icons",sourceId:"style-panel",children:a.map(E=>x.jsx(Mt,{type:"icon",title:`${p(s)}  ${p(`${n}-style.${E.value}`)}`,"data-testid":`style.${n}.${E.value}`,onClick:()=>{h(c,E.value),ui.deleteOpenMenu(C,f.contextId),S(!1)},children:x.jsx(be,{icon:E.icon})},E.value))})})})]})]})}const MAe=k.memo(TAe),IAe=k.memo(EAe);function PAe(r){const e=ie(),t=r.label?e(r.label):e(`style-panel.${r.stylePanelType}`);return x.jsx(_i,{label:t,children:x.jsx(wX,{...r})})}function AAe(r){const e=Dr(),{id:t,label:n,uiType:i,stylePanelType:s,style:o,items:a,type:l,value:c,onValueChange:u=e.onValueChange}=r,d=ie(),h=z(),[f,p]=k.useState(!1),m=k.useMemo(()=>a.find(b=>c.type==="shared"&&b.value===c.value)?.icon,[a,c]),g=d(`style-panel.${s}`),y=c.type==="mixed"?d("style-panel.mixed"):g+"  "+d(`${i}-style.${c.value}`),S=n?d(n):"",w=`style panel ${t}`;return x.jsxs(yd,{id:w,open:f,onOpenChange:p,className:"tlui-style-panel__dropdown-picker",children:[x.jsx(xd,{children:x.jsxs(Mt,{type:l,"data-testid":`style.${i}`,"data-direction":"left",title:y,children:[S&&x.jsx(Tn,{children:S}),x.jsx(be,{icon:m??"mixed"})]})}),x.jsx(Sd,{side:"left",align:"center",children:x.jsx(_i,{orientation:a.length>4?"grid":"horizontal",label:S,children:x.jsx(Ni,{type:"icons",sourceId:"style-panel",children:a.map(b=>x.jsx(Mt,{type:"icon","data-testid":`style.${i}.${b.value}`,title:g+"  "+d(`${i}-style.${b.value}`),isActive:m===b.icon,onClick:()=>{e.onHistoryMark("select style dropdown item"),u(o,b.value),ui.deleteOpenMenu(w,h.contextId),p(!1)},children:x.jsx(be,{icon:b.icon})},b.value))})})})]})}const f_=k.memo(PAe),wX=k.memo(AAe);function $Ae(){return x.jsxs(x.Fragment,{children:[x.jsxs(mw,{children:[x.jsx(RAe,{}),x.jsx(OAe,{})]}),x.jsxs(mw,{children:[x.jsx(NAe,{}),x.jsx(_Ae,{}),x.jsx(DAe,{})]}),x.jsxs(mw,{children:[x.jsx(FAe,{}),x.jsx(zAe,{}),x.jsx(BAe,{})]}),x.jsxs(mw,{children:[x.jsx(jAe,{}),x.jsx(LAe,{}),x.jsx(UAe,{}),x.jsx(WAe,{})]})]})}function mw({children:r}){return x.jsx("div",{className:"tlui-style-panel__section",children:r})}function RAe(){const{styles:r}=Dr(),e=ie(),t=r.get(Oi);return t===void 0?null:x.jsx(bS,{title:e("style-panel.color"),uiType:"color",style:Oi,items:gs.color,value:t})}const Hp=[.1,.25,.5,.75,1];function OAe(){const r=z(),{onHistoryMark:e,enhancedA11yMode:t}=Dr(),n=F("opacity",()=>r.getSharedOpacity(),[r]),i=ln(),s=ie(),o=Be.useCallback(l=>{const c=Hp[l];r.run(()=>{r.isIn("select")&&r.setOpacityForSelectedShapes(c),r.setOpacityForNextShapes(c),r.updateInstanceState({isChangingStyle:!0})}),i("set-style",{source:"style-panel",id:"opacity",value:l})},[r,i]);if(n===void 0)return null;const a=n.type==="mixed"?-1:Hp.indexOf(cW(Hp,l=>Math.abs(l-n.value)));return x.jsxs(x.Fragment,{children:[t&&x.jsx(J1,{children:s("style-panel.opacity")}),x.jsx(xX,{"data-testid":"style.opacity",value:a>=0?a:Hp.length-1,label:n.type==="mixed"?"style-panel.mixed":`opacity-style.${n.value}`,onValueChange:o,steps:Hp.length-1,title:s("style-panel.opacity"),onHistoryMark:e,ariaValueModifier:25})]})}function NAe(){const{styles:r}=Dr(),e=ie(),t=r.get(Dl);return t===void 0?null:x.jsx(bS,{title:e("style-panel.fill"),uiType:"fill",style:Dl,items:gs.fill,value:t})}function _Ae(){const{styles:r}=Dr(),e=ie(),t=r.get(pd);return t===void 0?null:x.jsx(bS,{title:e("style-panel.dash"),uiType:"dash",style:pd,items:gs.dash,value:t})}function DAe(){const r=z(),{styles:e,onValueChange:t}=Dr(),n=ie(),i=e.get(Qo);return i===void 0?null:x.jsx(bS,{title:n("style-panel.size"),uiType:"size",style:Qo,items:gs.size,value:i,onValueChange:(s,o)=>{t(s,o);const a=r.getSelectedShapeIds();a.length>0&&wt(r,a)}})}function FAe(){const{styles:r}=Dr(),e=ie(),t=r.get(Fl);return t===void 0?null:x.jsx(bS,{title:e("style-panel.font"),uiType:"font",style:Fl,items:gs.font,value:t})}function zAe(){const{styles:r,enhancedA11yMode:e}=Dr(),t=ie(),n=r.get(DP);if(n===void 0)return null;const i=t("style-panel.align");return x.jsxs(x.Fragment,{children:[e&&x.jsx(J1,{children:i}),x.jsxs(_i,{orientation:"horizontal",label:i,children:[x.jsx(h_,{title:i,uiType:"align",style:DP,items:gs.textAlign,value:n}),x.jsx(Mt,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:x.jsx(be,{icon:"vertical-align-middle"})})]})]})}function BAe(){const{styles:r,enhancedA11yMode:e}=Dr(),t=ie(),n=r.get(av),i=r.get(lv);if(n===void 0)return null;const s=t("style-panel.label-align");return x.jsxs(x.Fragment,{children:[e&&x.jsx(J1,{children:s}),x.jsxs(_i,{orientation:"horizontal",label:s,children:[x.jsx(h_,{title:s,uiType:"align",style:av,items:gs.horizontalAlign,value:n}),i===void 0?x.jsx(Mt,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:x.jsx(be,{icon:"vertical-align-middle"})}):x.jsx(wX,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:lv,items:gs.verticalAlign,value:i})]})]})}function jAe(){const{styles:r}=Dr(),e=r.get(Vo);return e===void 0?null:x.jsx(f_,{label:"style-panel.geo",type:"menu",id:"geo",uiType:"geo",stylePanelType:"geo",style:Vo,items:gs.geo,value:e})}function LAe(){const{styles:r}=Dr(),e=r.get(sv);return e===void 0?null:x.jsx(f_,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:sv,items:gs.arrowKind,value:e})}function UAe(){const{styles:r}=Dr(),e=r.get(OP),t=r.get(RP);return e===void 0||t===void 0?null:x.jsx(MAe,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:RP,itemsA:gs.arrowheadStart,valueA:t,uiTypeB:"arrowheadEnd",styleB:OP,itemsB:gs.arrowheadEnd,valueB:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function WAe(){const{styles:r}=Dr(),e=r.get(_P);return e===void 0?null:x.jsx(f_,{type:"menu",id:"spline",uiType:"spline",stylePanelType:"spline",label:"style-panel.spline",style:_P,items:gs.spline,value:e})}const HAe=k.memo(function({isMobile:e,styles:t,children:n}){const i=z(),s=F("enhancedA11yMode",()=>i.user.getEnhancedA11yMode(),[i]),o=k.useRef(null);ya(o);const a=k.useCallback(()=>{e||i.updateInstanceState({isChangingStyle:!1})},[i,e]),l=yX();return t===void 0&&(t=l),k.useEffect(()=>{function c(d){d.key==="Escape"&&o.current?.contains(document.activeElement)&&(d.stopPropagation(),i.getContainer().focus())}const u=o.current;return u?.addEventListener("keydown",c,{capture:!0}),()=>{u?.removeEventListener("keydown",c,{capture:!0})}},[i]),t&&x.jsx("div",{ref:o,"data-testid":"style.panel",className:oe("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,"data-enhanced-a11y-mode":s,onPointerLeave:a,children:x.jsx(vAe,{styles:t,children:n??x.jsx($Ae,{})})})}),qAe=4e3,KAe={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function JAe({toast:r}){const{removeToast:e}=Xa(),t=ie(),n=a=>{a||e(r.id)},i=r.actions&&r.actions.length>0,s=r.icon||r.severity&&KAe[r.severity],o=r.iconLabel||(r.severity?t(`toast.${r.severity}`):"");return x.jsxs(Xpe,{onOpenChange:n,className:"tlui-toast__container",duration:r.keepOpen?1/0:qAe,"data-severity":r.severity,children:[s&&x.jsx("div",{className:"tlui-toast__icon",children:x.jsx(ta,{label:o,icon:s})}),x.jsxs("div",{className:"tlui-toast__main","data-title":!!r.title,"data-description":!!r.description,"data-actions":!!r.actions,children:[x.jsxs("div",{className:"tlui-toast__content",children:[r.title&&x.jsx(Zpe,{className:"tlui-toast__title",children:r.title}),r.description&&x.jsx(Qpe,{className:"tlui-toast__description",children:r.description})]}),r.actions&&x.jsxs("div",{className:"tlui-toast__actions",children:[r.actions.map((a,l)=>x.jsx(eme,{altText:a.label,asChild:!0,onClick:a.onClick,children:x.jsx(et,{type:a.type,children:x.jsx(Tn,{children:a.label})})},l)),x.jsx(cF,{asChild:!0,children:x.jsx(et,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:x.jsx(Tn,{children:r.closeLabel??t("toast.close")})})})]})]}),!i&&x.jsx(cF,{asChild:!0,children:x.jsx(et,{type:"normal",className:"tlui-toast__close",children:x.jsx(Tn,{children:r.closeLabel??t("toast.close")})})})]})}const VAe=k.memo(function(){const{toasts:e}=Xa(),t=F("toasts",()=>e.get(),[]);return x.jsxs(x.Fragment,{children:[t.map(n=>x.jsx(JAe,{toast:n},n.id)),x.jsx(D7,{className:"tlui-toast__viewport"})]})}),GAe=150,YAe=16,XAe=16,c3=16**2,ZAe=8,cl=16,p_=({children:r,className:e,isMousingDown:t,getSelectionBounds:n,changeOnlyWhenYChanges:i=!1,label:s})=>{const o=z(),a=k.useRef(null);ya(a),iCe(a);const{isVisible:l,isInteractive:c,hide:u,show:d,position:h,move:f}=t$e(i),p=k.useRef(!1),[m,g]=k.useState(!1),y=rS("content size update counter",0);k.useEffect(()=>{se(a.current);const w=new ResizeObserver(()=>{y.update(b=>b+1)});return w.observe(a.current),()=>w.disconnect()},[y]),k.useEffect(()=>{let w=y.get();return Zi("toolbar position",function(){const v=a.current;if(!v)return;const C=y.get();o.getCamera(),y.get();const E=QAe(o,v,n);if(!E)p.current&&(p.current=!1,g(!1));else{if(o.getCameraState()==="moving")a.current.style.setProperty("transform",`translate(${E.x}px, ${E.y}px)`);else{const P=w!==C;f(E.x,E.y,P)}p.current||(p.current=!0,g(!0))}w=C})},[o,n,y,f]);const S=F("camera state",()=>o.getCameraState(),[o]);return k.useEffect(()=>{if(t||!m){u();return}d()},[m,S,t,d,u]),k.useLayoutEffect(()=>{const w=a.current;w&&(w.dataset.visible=`${l}`)},[l,h]),k.useLayoutEffect(()=>{const w=a.current;w&&w.style.setProperty("transform",`translate(${h.x}px, ${h.y}px)`)},[h]),k.useLayoutEffect(()=>{const w=a.current;w&&(w.dataset.interactive=`${c}`)},[c]),x.jsx("div",{ref:a,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:oe("tlui-contextual-toolbar",e),onPointerDown:o.markEventAsHandled,children:x.jsx(_i,{orientation:"horizontal",className:"tlui-menu",label:s,tooltipSide:"top",children:r})})};function bX(r){return new V(r.x,r.y,r.width,r.height)}function QAe(r,e,t){const n=t()?.clone();if(!n)return;const i=r.getViewportScreenBounds();if(n.x-=i.x,n.y-=i.y,n.midY<cl||n.midY>i.h-cl||n.midX<cl||n.midX>i.w-cl)return;const s=bX(e.getBoundingClientRect());if(!s.width||!s.height)return;const{scrollLeft:o,scrollTop:a}=r.getContainer();let l=n.midX-s.w/2,c=n.y-s.h-ZAe;return l=_e(l,cl,i.w-s.w-cl),c=_e(c,cl,i.h-s.h-cl),l+=o,c+=a,l=Math.round(l),c=Math.round(c),{x:l,y:c}}function e$e(r,e,t){return t?T.Sub(e,r).y**2>=c3:T.Len2(T.Sub(e,r))>=c3}function t$e(r){const e=z(),t=k.useRef({name:"hidden"}),[n,i]=k.useState(!1),[s,o]=k.useState(!1),[a,l]=k.useState({x:-1e3,y:-1e3}),c=k.useRef(new T(-1e3,-1e3)),u=k.useRef(new T(-1e3,-1e3)),d=k.useRef(-1),h=k.useRef(-1),f=k.useCallback((g,y,S=!1)=>{if(u.current.x=g,u.current.y=y,t.current.name==="hidden"||t.current.name==="showing")return;clearTimeout(h.current);const w=()=>{if(t.current.name==="shown"&&e$e(u.current,c.current,r)){const{x:b,y:v}=u.current;c.current=new T(b,v),S?Jk.flushSync(()=>l({x:b,y:v})):l({x:b,y:v})}};S?w():h.current=e.timers.setTimeout(w,GAe)},[e,r]),p=k.useCallback((g=!1)=>{switch(t.current.name){case"showing":{clearTimeout(d.current),t.current={name:"hidden"};break}case"shown":{t.current={name:"hiding"},i(!1),g?(t.current={name:"hidden"},o(!1)):d.current=e.timers.setTimeout(()=>{t.current={name:"hidden"},o(!1)},YAe);break}}},[e]),m=k.useCallback(()=>{switch(t.current.name){case"hidden":{t.current={name:"showing"},d.current=e.timers.setTimeout(()=>{const{x:g,y}=u.current;c.current=new T(g,y),l({x:g,y}),t.current={name:"shown"},o(!0),i(!0)},XAe);break}case"hiding":{clearTimeout(d.current),t.current={name:"shown"},i(!0),f(u.current.x,u.current.y);break}}},[e,f]);return{isVisible:s,isInteractive:n,show:m,hide:p,move:f,position:a}}function vX({shapeId:r,onClose:e,source:t}){const n=z(),[i,s]=k.useState(()=>{const p=n.getShape(r);if(!p)return"";if(!("altText"in p.props))throw Error("Shape does not have altText property");return p.props.altText||""}),o=ie(),a=k.useRef(null),l=ln(),c=n.getIsReadonly(),u=p=>s(p),d=()=>{l("set-alt-text",{source:t});const p=n.getShape(r);p&&(n.updateShapes([{id:p.id,type:p.type,props:{altText:i}}]),e())},h=()=>d(),f=k.useCallback(()=>e(),[e]);return k.useEffect(()=>{a.current?.select();function p(m){m.key==="Escape"&&(m.stopPropagation(),f())}return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0})}},[f]),x.jsxs(x.Fragment,{children:[x.jsx(yp,{ref:a,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:i,placeholder:o("tool.media-alt-text-desc"),"aria-label":o("tool.media-alt-text-desc"),onValueChange:u,onComplete:d,onCancel:f,disabled:c}),!c&&x.jsx(et,{title:o("tool.media-alt-text-confirm"),"data-testid":"tool.media-alt-text-confirm",type:"icon",onPointerDown:Oe,onClick:h,children:x.jsx(be,{small:!0,icon:"check"})})]})}const u3=8;function to(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}const n$e=["original","square","circle","landscape","portrait","wide"],xA={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function lo(r,e){if(!e)return{w:r.w,h:r.h};const t=r.w/(e.bottomRight.x-e.topLeft.x),n=r.h/(e.bottomRight.y-e.topLeft.y);return{w:t,h:n}}function V1(r){return{width:r.bottomRight.x-r.topLeft.x,height:r.bottomRight.y-r.topLeft.y}}function m_(r){const{width:e,height:t}=V1(r);return{x:r.topLeft.x+e/2,y:r.topLeft.y+t/2}}function g_(r,e,t,n,i){const s=Math.max(0,Math.min(1-t,r-t/2)),o=Math.max(0,Math.min(1-n,e-n/2));return{topLeft:{x:s,y:o},bottomRight:{x:s+t,y:o+n},isCircle:i}}function r$e(r,e,t={}){const{handle:n,change:i,crop:s,aspectRatioLocked:o}=e,{w:a,h:l}=e.uncroppedSize,{minWidth:c=u3,minHeight:u=u3}=t;if(a<c||l<u||i.x===0&&i.y===0)return;const d=new V(s.topLeft.x*a,s.topLeft.y*l,(s.bottomRight.x-s.topLeft.x)*a,(s.bottomRight.y-s.topLeft.y)*l),h=d.aspectRatio,f=d.clone();if(n==="top_left"||n==="bottom_left"||n==="left")f.x=_e(f.x+i.x,0,d.maxX-c),f.w=d.maxX-f.x;else if(n==="top_right"||n==="bottom_right"||n==="right"){const g=_e(f.maxX+i.x,d.x+c,a);f.w=g-f.x}if(n==="top_left"||n==="top_right"||n==="top")f.y=_e(f.y+i.y,0,d.maxY-u),f.h=d.maxY-f.y;else if(n==="bottom_left"||n==="bottom_right"||n==="bottom"){const g=_e(f.maxY+i.y,d.y+u,l);f.h=g-f.y}if(o)switch(f.aspectRatio>h?f.h=f.w/h:f.w=f.h*h,n){case"top_left":{f.x=d.maxX-f.w,f.y=d.maxY-f.h,f.x<=0&&(f.x=0,f.w=d.maxX-f.x,f.h=f.w/h,f.y=d.maxY-f.h),f.y<=0&&(f.y=0,f.h=d.maxY-f.y,f.w=f.h*h,f.x=d.maxX-f.w);break}case"top_right":{f.x=d.x,f.y=d.maxY-f.h,f.maxX>=a&&(f.w=a-d.x,f.h=f.w/h,f.y=d.maxY-f.h),f.y<=0&&(f.y=0,f.h=d.maxY-f.y,f.w=f.h*h);break}case"bottom_left":{f.x=d.maxX-f.w,f.y=d.y,f.x<=0&&(f.x=0,f.w=d.maxX-f.x,f.h=f.w/h),f.maxY>=l&&(f.h=l-d.y,f.w=f.h*h,f.x=d.maxX-f.w);break}case"bottom_right":{f.x=d.x,f.y=d.y,f.maxX>=a&&(f.w=a-d.x,f.h=f.w/h),f.maxY>=l&&(f.h=l-d.y,f.w=f.h*h);break}case"top":{if(f.h=d.maxY-f.y,f.w=f.h*h,f.x-=(f.w-d.w)/2,f.x<=0){const y=d.midX;f.w=y*2,f.h=f.w/h,f.x=0}if(f.maxX>=a){const y=a-d.midX;f.w=y*2,f.h=f.w/h,f.x=a-f.w}f.y=d.maxY-f.h;break}case"right":{if(f.w=f.maxX-d.x,f.h=f.w/h,f.y-=(f.h-d.h)/2,f.y<=0){const y=d.midY;f.h=y*2,f.w=f.h*h,f.y=0}if(f.maxY>=l){const y=l-d.midY;f.h=y*2,f.w=f.h*h,f.y=l-f.h}break}case"bottom":{if(f.h=f.maxY-d.y,f.w=f.h*h,f.x-=(f.w-d.w)/2,f.x<=0){const y=d.midX;f.w=y*2,f.h=f.w/h,f.x=0}if(f.maxX>=a){const y=a-d.midX;f.w=y*2,f.h=f.w/h,f.x=a-f.w}break}case"left":{if(f.w=d.maxX-f.x,f.h=f.w/h,f.y-=(f.h-d.h)/2,f.y<=0){const y=d.midY;f.h=y*2,f.w=f.h*h,f.y=0}if(f.maxY>=l){const y=l-d.midY;f.h=y*2,f.w=f.h*h,f.y=l-f.h}f.x=d.maxX-f.w;break}}const p={topLeft:{x:f.x/a,y:f.y/l},bottomRight:{x:f.maxX/a,y:f.maxY/l},isCircle:s.isCircle};if(p.topLeft.x===s.topLeft.x&&p.topLeft.y===s.topLeft.y&&p.bottomRight.x===s.bottomRight.x&&p.bottomRight.y===s.bottomRight.y)return;const m=new T(f.x-s.topLeft.x*a,f.y-s.topLeft.y*l).rot(r.rotation).add(r);return{id:r.id,type:r.type,x:m.x,y:m.y,props:{w:f.w,h:f.h,crop:p}}}function i$e(r,e,t,n=!0,i=!1){const{w:s,h:o}=lo(r.props,r.props.crop??to()),a=r.props.crop||to(),l=r.x+r.props.w/2,c=r.y+r.props.h/2;let u,d;if(n){const{x:m,y:g}=m_(a);u=m,d=g}else u=.5,d=.5;const h=g_(u,d,e,t,i),f=e*s,p=t*o;return{crop:h,w:f,h:p,x:l-f/2,y:c-p/2}}const qi=3;function s$e(r,e,t){const n=e.props.crop||to(),{width:i,height:s}=V1(n),o=i/s,a=t?1/(1-t):qi,l=1+r*(a-1);let c,u;o>1?(c=Math.min(1,1/l),u=c/o):(u=Math.min(1,1/l),c=u*o);const d=i$e(e,c,u,!0,n.isCircle),h=Math.min(qi,i/c);d.w*=h,d.h*=h;const f=e.x+e.props.w/2,p=e.y+e.props.h/2;return d.x=f-d.w/2,d.y=p-d.h/2,d}function o$e(r,e,t){const n=to(),i=r.props.crop||n,s=r.props.w,o=r.props.h,a=e/t;let l=n,c=s,u=o;if(Yl(r.props.crop,n))c=s,u=s*t/e;else{const{w:g,h:y}=lo(r.props,r.props.crop||to()),{width:S,height:w}=V1(i),b=S/w,v=g/y;let C,E;const M=m_(i);C=S;const P=a/v/b;E=C*P;const $=qi/(qi-1);if(P>$){const A=1/qi;if(1/E<1/C){const O=E/A;E=E/O,C=C/O}else{const O=C/A;C=C/O,E=E/O}}C=Math.max(0,Math.min(1,C)),E=Math.max(0,Math.min(1,E)),l=g_(M.x,M.y,C,E,i.isCircle)}const h=r.x+s/2,f=r.y+o/2,p=h-c/2,m=f-u/2;return{crop:l,w:c,h:u,x:p,y:m}}function a$e(r,e){if(r==="original"){const{w:A,h:O}=lo(e.props,e.props.crop??to()),_=e.x+e.props.w/2,I=e.y+e.props.h/2;return{crop:to(),w:A,h:O,x:_-A/2,y:I-O/2}}const t=xA[r],n=r==="circle",{w:i,h:s}=lo(e.props,e.props.crop||to()),o=i/s,a=e.props.crop||to(),{width:l,height:c}=V1(a),u=m_(a),d=Math.min(1/l,1/c);let h,f;if(o===0||!Number.isFinite(o)||t===0)h=1,f=1;else{const A=l*i,O=c*s,_=Math.max(A,O),I=A>=O;let R,B;I?(R=_,B=R/t):(B=_,R=B*t),h=R/i,f=B/s,h>1&&(h=1,f=o/t),f>1&&(f=1,h=t/o),h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f))}const p=Math.min(1/h,1/f);h*=p/d,f*=p/d,h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f));const m=g_(u.x,u.y,h,f,n),g=m.bottomRight.x-m.topLeft.x,y=m.bottomRight.y-m.topLeft.y,S=g*i,w=y*s;let b=1;l>0?b=e.props.w/(l*i):c>0&&(b=e.props.h/(c*s));const v=S*b,C=w*b,E=e.x+e.props.w/2,M=e.y+e.props.h/2,P=E-v/2,$=M-C/2;return{crop:m,w:v,h:C,x:P,y:$}}const l$e=In(function({imageShapeId:e,isManipulating:t,onEditAltTextStart:n,onManipulatingStart:i,onManipulatingEnd:s}){const o=z(),a=ln(),l=ie(),c="image-toolbar",u=k.useRef(null),d=o.getIsReadonly(),h=F("crop",()=>o.getShape(e).props.crop,[o,e]),f=h?Math.min(1-(h.bottomRight.x-h.topLeft.x),1-(h.bottomRight.y-h.topLeft.y)):0,[p,m]=k.useState(h?Math.max(f,1-1/qi):qi),g=wa();k.useEffect(()=>{m(h?Math.max(f,1-1/qi):qi)},[h,f,p]);const y=k.useCallback(A=>o.markHistoryStoppingPoint(A),[o]),S=k.useCallback((A,O)=>{const _=qi/(qi-1);return Math.pow(A/O,_)*O},[]),w=h&&p?oo(S(f,p),[0,p],[0,100],!0):0,b=k.useCallback(A=>{o.setCurrentTool("select.crop.idle");const O=A/100,_=1-1/qi,I=Math.min(_,p??_),R=qi/(qi-1),B=Math.pow(O,1/R)*I,U=B>=1?1:B/(2*(1-B)),H=o.getShape(e);if(!H)return;const L=s$e(U,H,p);o.updateShape({id:H.id,type:H.type,x:L.x,y:L.y,props:{w:L.w,h:L.h,crop:L.crop}}),a("set-style",{source:"image-toolbar",id:"zoom",value:A})},[o,a,e,p]),v=k.useCallback(()=>g["image-replace"].onSelect("image-toolbar"),[g]),C=k.useCallback(()=>g["download-original"].onSelect("image-toolbar"),[g]),E=A=>{const O=o.getShape(e);O&&o.run(()=>{o.setCurrentTool("select.crop.idle");const _=a$e(A,O);o.markHistoryStoppingPoint("aspect ratio"),o.updateShape({id:e,type:"image",x:_.x,y:_.y,props:{crop:_.crop,w:_.w,h:_.h}}),wt(o,[e])})},M=F("altText",()=>o.getShape(e).props.altText,[o,e]),P=F("shapeAspectRatio",()=>{const A=o.getShape(e);return A.props.w/A.props.h},[o,e]),$=!h||Yl(h,to());return k.useEffect(()=>{t&&o.timers.setTimeout(()=>u.current?.focus(),0)},[o,t]),k.useEffect(()=>{function A(_){t&&(_.key==="Escape"?(o.cancel(),s()):_.key==="Enter"&&(o.complete(),s()))}const O=u.current;return O&&O.addEventListener("keydown",A),()=>{O&&O.removeEventListener("keydown",A)}},[o,t,s]),t?x.jsxs(x.Fragment,{children:[x.jsx(xX,{ref:u,value:w,label:"tool.image-zoom",onValueChange:b,onHistoryMark:y,min:0,steps:100,"data-testid":"tool.image-zoom",title:l("tool.image-zoom")}),x.jsxs(L1,{id:"image-toolbar-aspect-ratio",children:[x.jsx(U1,{children:x.jsx(Mt,{title:l("tool.aspect-ratio"),type:"icon","data-testid":"tool.image-aspect-ratio",children:x.jsx(be,{icon:"corners"})})}),x.jsx(W1,{side:"top",align:"center",children:n$e.map(A=>{let O=!1;return $?A==="original"&&(O=!0):A==="circle"?O=!!h.isCircle:A==="square"?O=!h?.isCircle&&Mn(P,xA[A],.1):A==="original"?O=!1:O=!$&&Mn(P,xA[A],.01),x.jsx(NMe,{onSelect:()=>E(A),checked:O,title:l(`tool.aspect-ratio.${A}`),children:x.jsx(Tn,{children:l(`tool.aspect-ratio.${A}`)})},A)})})]}),x.jsx(Mt,{type:"icon",onClick:s,"data-testid":"tool.image-crop-confirm",style:{borderLeft:"1px solid var(--tl-color-divider)",marginLeft:"2px"},title:l("tool.image-crop-confirm"),children:x.jsx(be,{small:!0,icon:"check"})})]}):x.jsxs(x.Fragment,{children:[!d&&x.jsx(Mt,{type:"icon","data-testid":"tool.image-replace",onClick:v,title:l("tool.replace-media"),children:x.jsx(be,{small:!0,icon:"tool-media"})}),!d&&x.jsx(Mt,{type:"icon",title:l("tool.image-crop"),onClick:i,"data-testid":"tool.image-crop",children:x.jsx(be,{small:!0,icon:"crop"})}),x.jsx(Mt,{type:"icon",title:l("action.download-original"),onClick:C,"data-testid":"tool.image-download",children:x.jsx(be,{small:!0,icon:"download"})}),(M||!d)&&x.jsx(Mt,{type:"icon",title:l("tool.media-alt-text"),"data-testid":"tool.image-alt-text",onClick:()=>{a("alt-text-start",{source:c}),n()},children:x.jsx(be,{small:!0,icon:"alt"})})]})});function c$e({children:r}){const e=z(),t=F("imageShape",()=>{const s=e.getOnlySelectedShape();return!s||s.type!=="image"?null:s.id},[e]),n=F("showToolbar",()=>e.isInAny("select.idle","select.pointing_shape","select.crop"),[e]),i=F("locked",()=>t?e.getShape(t)?.isLocked:!1,[e,t]);return!t||!n||i?null:x.jsx(u$e,{imageShapeId:t,children:r},t)}function u$e({children:r,imageShapeId:e}){const t=z(),n=ie(),i=F("editor path",()=>t.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[t]),s=F("camera",()=>t.getCamera(),[t]),o=F("editor path",()=>t.isIn("select.crop."),[t]),a=k.useRef(),l=k.useCallback(()=>{t.setCroppingShape(null),t.setCurrentTool("select.idle")},[t]),[c,u]=k.useState(!1),d=k.useCallback(()=>u(!0),[]),h=k.useCallback(()=>t.setCurrentTool("select.crop.idle"),[t]),f=k.useCallback(()=>u(!1),[]);k.useEffect(()=>{a.current=void 0},[s]);const p=k.useCallback(()=>{if(o&&a.current)return a.current;const m=t.getSelectionScreenBounds();if(!m)return;const g=new V(m.x,m.y,m.width,0);return a.current=g,g},[t,o]);return i?(a.current=void 0,null):x.jsx(p_,{className:"tlui-image__toolbar",getSelectionBounds:p,label:n("tool.image-toolbar-title"),children:r||(c?x.jsx(vX,{shapeId:e,onClose:f,source:"image-toolbar"}):x.jsx(l$e,{imageShapeId:e,isManipulating:o,onEditAltTextStart:d,onManipulatingStart:h,onManipulatingEnd:l}))})}function kX(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=kX(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function CX(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=CX(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let le=class Zr{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Zr(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new Zr(n,i)}cutByIndex(e,t){return e==t?Zr.empty:e==0&&t==this.content.length?this:new Zr(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new Zr(i,s)}addToStart(e){return new Zr([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Zr(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return kX(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return CX(this,e,t,n)}findIndex(e){if(e==0)return gw(0,e);if(e==this.size)return gw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?gw(t+1,s):gw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Zr.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Zr(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Zr.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new Zr(t||e,n)}static from(e){if(!e)return Zr.empty;if(e instanceof Zr)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Zr([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};le.empty=new le([],0);const fM={index:0,offset:0};function gw(r,e){return fM.index=r,fM.offset=e,fM}function Iv(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Iv(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Iv(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let It=class SA{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Iv(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return SA.none;if(e instanceof SA)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};It.none=[];let Pv=class extends Error{},Se=class wh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=EX(this.content,e+this.openStart,t);return n&&new wh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new wh(TX(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return wh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new wh(le.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new wh(e,n,i)}};Se.empty=new Se(le.empty,0,0);function TX(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(TX(s.content,e-i-1,t-i-1)))}function EX(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=EX(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function d$e(r,e,t){if(t.openStart>r.depth)throw new Pv("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Pv("Inconsistent open depths");return MX(r,e,t,0)}function MX(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=MX(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Pu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=h$e(t,r);return Pu(s,PX(r,o,a,e,n))}else return Pu(s,Av(r,e,n))}function IX(r,e){if(!e.type.compatibleContent(r.type))throw new Pv("Cannot join "+e.type.name+" onto "+r.type.name)}function wA(r,e,t){let n=r.node(t);return IX(n,e.node(t)),n}function Iu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function Xg(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Iu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Iu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Iu(e.nodeBefore,n)}function Pu(r,e){return r.type.checkContent(e),r.copy(e)}function PX(r,e,t,n,i){let s=r.depth>i&&wA(r,e,i+1),o=n.depth>i&&wA(t,n,i+1),a=[];return Xg(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(IX(s,o),Iu(Pu(s,PX(r,e,t,n,i+1)),a)):(s&&Iu(Pu(s,Av(r,e,i+1)),a),Xg(e,t,i,a),o&&Iu(Pu(o,Av(t,n,i+1)),a)),Xg(n,null,i,a),new le(a)}function Av(r,e,t){let n=[];if(Xg(null,r,t,n),r.depth>t){let i=wA(r,e,t+1);Iu(Pu(i,Av(r,e,t+1)),n)}return Xg(e,null,t,n),new le(n)}function h$e(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(le.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let d3=class bA{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return It.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new m$e(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new bA(t,n,s)}static resolveCached(e,t){let n=h3.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else h3.set(e,n=new f$e);let i=n.elts[n.i]=bA.resolve(e,t);return n.i=(n.i+1)%p$e,i}},f$e=class{constructor(){this.elts=[],this.i=0}};const p$e=12,h3=new WeakMap;let m$e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const g$e=Object.create(null);let Xo=class vA{constructor(e,t,n,i=It.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||le.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Iv(this.attrs,t||e.defaultAttrs||g$e)&&It.sameSet(this.marks,n||It.none)}copy(e=null){return e==this.content?this:new vA(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new vA(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Se.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Se(c,i.depth-o,s.depth-o)}replace(e,t,n){return d$e(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return d3.resolveCached(this,e)}resolveNoCache(e){return d3.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),AX(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=le.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=It.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!It.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=le.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Xo.prototype.text=void 0;let y$e=class kA extends Xo{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):AX(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new kA(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new kA(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function AX(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let Uy=class $X{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new x$e(e,t);if(n.next==null)return $X.empty;let i=RX(n);n.next&&n.err("Unexpected trailing text");let s=T$e(C$e(i));return E$e(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return le.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};Uy.empty=new Uy(!0);let x$e=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function RX(r){let e=[];do e.push(S$e(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function S$e(r){let e=[];do e.push(w$e(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function w$e(r){let e=k$e(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=b$e(r,e);else break;return e}function f3(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function b$e(r,e){let t=f3(r),n=t;return r.eat(",")&&(r.next!="}"?n=f3(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function v$e(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function k$e(r){if(r.eat("(")){let e=RX(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=v$e(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function C$e(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function OX(r,e){return e-r}function p3(r,e){let t=[];return n(e),t.sort(OX);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function T$e(r){let e=Object.create(null);return t(p3(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);p3(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new Uy(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(OX);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function E$e(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function NX(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function _X(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function DX(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function FX(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new I$e(r,n,e[n]);return t}let m3=class zX{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=FX(e,n.attrs),this.defaultAttrs=NX(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Uy.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:_X(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Xo(this,this.computeAttrs(e),le.from(t),It.setFrom(n))}createChecked(e=null,t,n){return t=le.from(t),this.checkContent(t),new Xo(this,this.computeAttrs(e),t,It.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=le.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(le.empty,!0);return s?new Xo(this,e,t.append(s),It.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){DX(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:It.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new zX(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function M$e(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let I$e=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?M$e(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},BX=class jX{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=FX(e,i.attrs),this.excluded=null;let s=NX(this.attrs);this.instance=s?new It(this,s):null}create(e=null){return!e&&this.instance?this.instance:new It(this,_X(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new jX(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){DX(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},LX=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=m3.compile(this.spec.nodes,this),this.marks=BX.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Uy.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?g3(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:g3(this,o.split(" "))}this.nodeFromJSON=i=>Xo.fromJSON(this,i),this.markFromJSON=i=>It.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof m3){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new y$e(n,n.defaultAttrs,e,It.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function g3(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function P$e(r){return r.tag!=null}function A$e(r){return r.style!=null}let ff=class CA{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(P$e(i))this.tags.push(i);else if(A$e(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new x3(this,t,!1);return n.addAll(e,It.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new x3(this,t,!0);return n.addAll(e,It.none,t.from,t.to),Se.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(O$e(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=S3(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=S3(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new CA(e,CA.schemaRules(e)))}};const UX={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},$$e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},WX={ol:!0,ul:!0},Wy=1,TA=2,Zg=4;function y3(r,e,t){return e!=null?(e?Wy:0)|(e==="full"?TA:0):r&&r.whitespace=="pre"?Wy|TA:t&~Zg}let yw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=It.none,this.match=s||(o&Zg?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(le.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Wy)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=le.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(le.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!UX.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},x3=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=y3(null,t.preserveWhitespace,0)|(n?Zg:0);i?s=new yw(i.type,i.attrs,It.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new yw(null,null,It.none,!0,null,o):s=new yw(e.schema.topNodeType,null,It.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&TA?"full":this.localPreserveWS||(i.options&Wy)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;WX.hasOwnProperty(o)&&this.parser.normalizeLists&&R$e(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:$$e.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(UX.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=It.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):w3(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=y3(e,s,o.options);o.options&Zg&&o.content.length==0&&(a|=Zg);let l=It.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):w3(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new yw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Wy)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function R$e(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&WX.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function O$e(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function S3(r){let e={};for(let t in r)e[t]=r[t];return e}function w3(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}let vS=class HX{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=pM(t).createDocumentFragment());let i=n,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=zb(pM(t),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&zb(pM(n),i(e,t),null,e.attrs)}static renderSpec(e,t,n=null,i){return zb(e,t,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new HX(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=b3(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return b3(e.marks)}};function b3(r){let e={};for(let t in r){let n=r[t].spec.toDOM;n&&(e[t]=n)}return e}function pM(r){return r.document||window.document}const v3=new WeakMap;function N$e(r){let e=v3.get(r);return e===void 0&&v3.set(r,e=_$e(r)),e}function _$e(r){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)t(n[i]);else for(let i in n)t(n[i])}return t(r),e}function zb(r,e,t,n){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(s=N$e(n))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(t=i.slice(0,o),i=i.slice(o+1));let a,l=t?r.createElementNS(t,i):r.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=zb(r,h,t,n);if(l.appendChild(f),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const qX=65535,KX=Math.pow(2,16);function D$e(r,e){return r+e*KX}function k3(r){return r&qX}function F$e(r){return(r-(r&qX))/KX}const JX=1,VX=2,Bb=4,GX=8;let EA=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&GX)>0}get deletedBefore(){return(this.delInfo&(JX|Bb))>0}get deletedAfter(){return(this.delInfo&(VX|Bb))>0}get deletedAcross(){return(this.delInfo&Bb)>0}},wd=class bh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&bh.empty)return bh.empty}recover(e){let t=0,n=k3(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+F$e(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:D$e(a/3,e-l),m=e==l?VX:e==d?JX:Bb;return(t<0?e!=l:e!=d)&&(m|=GX),new EA(f,m,p)}i+=u-c}return n?e+i:new EA(e+i,0,null)}touches(e,t){let n=0,i=k3(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new bh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?bh.empty:new bh(e<0?[0,-e,0]:[0,0,e])}};wd.empty=new wd([]);let z$e=class MA{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new MA(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new MA;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new EA(e,i,null)}};const mM=Object.create(null);let Fr=class{getMap(){return wd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=mM[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in mM)throw new RangeError("Duplicate use of step JSON ID "+e);return mM[e]=t,t.prototype.jsonID=e,t}},mi=class pm{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new pm(e,null)}static fail(e){return new pm(null,e)}static fromReplace(e,t,n,i){try{return pm.ok(e.replace(t,n,i))}catch(s){if(s instanceof Pv)return pm.fail(s.message);throw s}}};function y_(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(y_(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return le.fromArray(n)}let x_=class mm extends Fr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Se(y_(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return mi.fromReplace(e,this.from,this.to,s)}invert(){return new xp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new mm(t.pos,n.pos,this.mark)}merge(e){return e instanceof mm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new mm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new mm(t.from,t.to,e.markFromJSON(t.mark))}};Fr.jsonID("addMark",x_);let xp=class gm extends Fr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Se(y_(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return mi.fromReplace(e,this.from,this.to,n)}invert(){return new x_(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new gm(t.pos,n.pos,this.mark)}merge(e){return e instanceof gm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new gm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new gm(t.from,t.to,e.markFromJSON(t.mark))}};Fr.jsonID("removeMark",xp);let S_=class ym extends Fr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return mi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return mi.fromReplace(e,this.pos,this.pos+1,new Se(le.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new ym(this.pos,t.marks[i]);return new ym(this.pos,this.mark)}}return new $v(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ym(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ym(t.pos,e.markFromJSON(t.mark))}};Fr.jsonID("addNodeMark",S_);let $v=class IA extends Fr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return mi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return mi.fromReplace(e,this.pos,this.pos+1,new Se(le.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new S_(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new IA(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new IA(t.pos,e.markFromJSON(t.mark))}};Fr.jsonID("removeNodeMark",$v);let na=class Zc extends Fr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&PA(e,this.from,this.to)?mi.fail("Structure replace would overwrite content"):mi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new wd([this.from,this.to-this.from,this.slice.size])}invert(e){return new Zc(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Zc(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Zc)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Se.empty:new Se(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Zc(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Se.empty:new Se(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Zc(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Zc(t.from,t.to,Se.fromJSON(e,t.slice),!!t.structure)}};Fr.jsonID("replace",na);let uc=class jb extends Fr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(PA(e,this.from,this.gapFrom)||PA(e,this.gapTo,this.to)))return mi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return mi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?mi.fromReplace(e,this.from,this.to,n):mi.fail("Content does not fit in gap")}getMap(){return new wd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new jb(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new jb(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new jb(t.from,t.to,t.gapFrom,t.gapTo,Se.fromJSON(e,t.slice),t.insert,!!t.structure)}};Fr.jsonID("replaceAround",uc);function PA(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function B$e(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new xp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new x_(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function j$e(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof BX){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new xp(o.from,o.to,o.style)))}function w_(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new na(a,u,Se.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new xp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Se(le.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new na(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(le.empty,!0);r.replace(a,a,new Se(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function L$e(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function U$e(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!L$e(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function W$e(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=le.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=le.from(n.node(p).copy(u)),d++):l--;let h=le.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=le.from(i.node(p).copy(h)),f++):c++;r.step(new uc(l,c,o,a,new Se(u.append(h),d,f),u.size-d,!0))}function H$e(r,e,t){let n=le.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=le.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new uc(i,s,i,s,new Se(n,0,0),t.length,!0))}function q$e(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&K$e(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&XX(r,o,a,s),w_(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new uc(d,h,d+1,h-1,new Se(le.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&YX(r,o,a,s),!1}})}function YX(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function XX(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function K$e(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function J$e(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new uc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Se(le.from(o),0,0),1,!0))}function Lb(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function V$e(r,e,t=1,n){let i=r.doc.resolve(e),s=le.empty,o=le.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=le.from(i.node(a).copy(s));let u=n&&n[c];o=le.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new na(e,e,new Se(s.append(o),t,t),!0))}function ZX(r,e){let t=r.resolve(e),n=t.index();return QX(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function G$e(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function QX(r,e){return!!(r&&e&&!r.isLeaf&&G$e(r,e))}function eZ(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&QX(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function Y$e(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);XX(r,u.node(),u.before(),a)}o.inlineContent&&w_(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new na(c,l.map(e+t,-1),Se.empty,!0)),n===!0){let u=r.doc.resolve(c);YX(r,u.node(),u.before(),r.steps.length)}return r}function X$e(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function Z$e(r,e,t){let n=r.resolve(e);if(!t.content.size)return e;let i=t.content;for(let s=0;s<t.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=n.depth;o>=0;o--){let a=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,l=n.index(o)+(a>0?1:0),c=n.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?n.pos:a<0?n.before(o+1):n.after(o+1)}return null}function Q$e(r,e,t=e,n=Se.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return tZ(i,s,n)?new na(e,t,n):new eRe(i,s,n).fit()}function tZ(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let eRe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=le.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=le.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Se(s,o,a);return e>-1?new uc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new na(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=gM(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(le.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=gM(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Se(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=gM(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Se(xm(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Se(xm(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(nZ(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Sm(this.placed,t,le.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Se.empty:new Se(xm(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Se(xm(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!yM(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=yM(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=yM(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Sm(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Sm(this.placed,this.depth,le.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(le.empty,!0);t.childCount&&(this.placed=Sm(this.placed,this.frontier.length,t))}};function xm(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(xm(r.firstChild.content,e-1,t)))}function Sm(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Sm(r.lastChild.content,e-1,t)))}function gM(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function nZ(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,nZ(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(le.empty,!0)))),r.copy(n)}function yM(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!tRe(t,s.content,o)?a:null}function tRe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function nRe(r){return r.spec.defining||r.spec.definingForContent}function rRe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(tZ(i,s,n))return r.step(new na(e,t,n));let o=iZ(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=nRe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Se(rZ(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function rZ(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(rZ(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(le.empty,!0))}return r}function iRe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=X$e(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Se(le.from(n),0,0))}function sRe(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=iZ(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function iZ(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let sZ=class Ub extends Fr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return mi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return mi.fromReplace(e,this.pos,this.pos+1,new Se(le.from(i),0,t.isLeaf?0:1))}getMap(){return wd.empty}invert(e){return new Ub(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ub(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ub(t.pos,t.attr,t.value)}};Fr.jsonID("attr",sZ);let oZ=class AA extends Fr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return mi.ok(n)}getMap(){return wd.empty}invert(e){return new AA(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new AA(t.attr,t.value)}};Fr.jsonID("docAttr",oZ);let Df=class extends Error{};Df=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Df.prototype=Object.create(Error.prototype);Df.prototype.constructor=Df;Df.prototype.name="TransformError";let aZ=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new z$e}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Df(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Se.empty){let i=Q$e(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Se(le.from(n),0,0))}delete(e,t){return this.replace(e,t,Se.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return rRe(this,e,t,n),this}replaceRangeWith(e,t,n){return iRe(this,e,t,n),this}deleteRange(e,t){return sRe(this,e,t),this}lift(e,t){return W$e(this,e,t),this}join(e,t=1){return Y$e(this,e,t),this}wrap(e,t){return H$e(this,e,t),this}setBlockType(e,t=e,n,i=null){return q$e(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return J$e(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new sZ(e,t,n)),this}setDocAttribute(e,t){return this.step(new oZ(e,t)),this}addNodeMark(e,t){return this.step(new S_(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof It)t.isInSet(n.marks)&&this.step(new $v(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new $v(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return V$e(this,e,t,n),this}addMark(e,t,n){return B$e(this,e,t,n),this}removeMark(e,t,n){return j$e(this,e,t,n),this}clearIncompatible(e,t,n){return w_(this,e,t,n),this}};const xM=Object.create(null);let gt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new oRe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Se.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Se.empty:t),a==0&&E3(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),E3(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new St(e):vh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?vh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):vh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Au(e.node(0))}static atStart(e){return vh(e,e,0,0,1)||new Au(e)}static atEnd(e){return vh(e,e,e.content.size,e.childCount,-1)||new Au(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=xM[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in xM)throw new RangeError("Duplicate use of selection JSON ID "+e);return xM[e]=t,t.prototype.jsonID=e,t}getBookmark(){return St.between(this.$anchor,this.$head).getBookmark()}};gt.prototype.visible=!0;let oRe=class{constructor(e,t){this.$from=e,this.$to=t}},C3=!1;function T3(r){!C3&&!r.parent.inlineContent&&(C3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let St=class wm extends gt{constructor(e,t=e){T3(e),T3(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return gt.near(n);let i=e.resolve(t.map(this.anchor));return new wm(i.parent.inlineContent?i:n,n)}replace(e,t=Se.empty){if(super.replace(e,t),t==Se.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof wm&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new lZ(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new wm(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=gt.findFrom(t,n,!0)||gt.findFrom(t,-n,!0);if(s)t=s.$head;else return gt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(gt.findFrom(e,-n,!0)||gt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new wm(e,t)}};gt.jsonID("text",St);let lZ=class cZ{constructor(e,t){this.anchor=e,this.head=t}map(e){return new cZ(e.map(this.anchor),e.map(this.head))}resolve(e){return St.between(e.resolve(this.anchor),e.resolve(this.head))}},yt=class bm extends gt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?gt.near(s):new bm(s)}content(){return new Se(le.from(this.node),0,0)}eq(e){return e instanceof bm&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new aRe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new bm(e.resolve(t.anchor))}static create(e,t){return new bm(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};yt.prototype.visible=!1;gt.jsonID("node",yt);let aRe=class uZ{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new lZ(n,n):new uZ(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&yt.isSelectable(n)?new yt(t):gt.near(t)}},Au=class Wb extends gt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Se.empty){if(t==Se.empty){e.delete(0,e.doc.content.size);let n=gt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Wb(e)}map(e){return new Wb(e)}eq(e){return e instanceof Wb}getBookmark(){return lRe}};gt.jsonID("all",Au);const lRe={map(){return this},resolve(r){return new Au(r)}};function vh(r,e,t,n,i,s=!1){if(e.inlineContent)return St.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&yt.isSelectable(a))return yt.create(r,t-(i<0?a.nodeSize:0))}else{let l=vh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function E3(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof na||i instanceof uc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(gt.near(r.doc.resolve(o),t))}const M3=1,xw=2,I3=4;class cRe extends aZ{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|M3)&~xw,this.storedMarks=null,this}get selectionSet(){return(this.updated&M3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=xw,this}ensureMarks(e){return It.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&xw)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~xw,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||It.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),!e)return this.deleteRange(t,n);let s=this.storedMarks;if(!s){let o=this.doc.resolve(t);s=n==t?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,i.text(e,s)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(gt.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=I3,this}get scrolledIntoView(){return(this.updated&I3)>0}}function P3(r,e){return!e||!r?r:r.bind(e)}let vm=class{constructor(e,t,n){this.name=e,this.init=P3(t.init,n),this.apply=P3(t.apply,n)}};const uRe=[new vm("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new vm("selection",{init(r,e){return r.selection||gt.atStart(e.doc)},apply(r){return r.selection}}),new vm("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new vm("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];class SM{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=uRe.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new vm(n.key,n.spec.state,n))})}}class af{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,c,n);if(u&&n.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:n,n:t.length}:{state:this,n:0})}t.push(u),n=n.applyInner(u),s=!0}i&&(i[o]={state:n,n:t.length})}}if(!s)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new af(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let s=n[i];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new cRe(this)}static create(e){let t=new SM(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new af(t);for(let i=0;i<t.fields.length;i++)n[t.fields[i].name]=t.fields[i].init(e,n);return n}reconfigure(e){let t=new SM(this.schema,e.plugins),n=t.fields,i=new af(t);for(let s=0;s<n.length;s++){let o=n[s].name;i[o]=this.hasOwnProperty(o)?this[o]:n[s].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],s=i.spec.state;s&&s.toJSON&&(t[n]=s.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new SM(e.schema,e.plugins),s=new af(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=Xo.fromJSON(e.schema,t.doc);else if(o.name=="selection")s.selection=gt.fromJSON(s.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(s.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let a in n){let l=n[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){s[o.name]=c.fromJSON.call(l,e,t[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function dZ(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=dZ(i,e,{})),t[n]=i}return t}let Qa=class{constructor(e){this.spec=e,this.props={},e.props&&dZ(e.props,this,this.props),this.key=e.key?e.key.key:hZ("plugin")}getState(e){return e[this.key]}};const wM=Object.create(null);function hZ(r){return r in wM?r+"$"+ ++wM[r]:(wM[r]=0,r+"$")}let Jd=class{constructor(e="key"){this.key=hZ(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};const Qn=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},Ff=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let $A=null;const _a=function(r,e,t){let n=$A||($A=document.createRange());return n.setEnd(r,t??r.nodeValue.length),n.setStart(r,e||0),n},dRe=function(){$A=null},bd=function(r,e,t,n){return t&&(A3(r,e,t,n,-1)||A3(r,e,t,n,1))},hRe=/^(img|br|input|textarea|hr)$/i;function A3(r,e,t,n,i){for(var s;;){if(r==t&&e==n)return!0;if(e==(i<0?0:Ds(r))){let o=r.parentNode;if(!o||o.nodeType!=1||kS(r)||hRe.test(r.nodeName)||r.contentEditable=="false")return!1;e=Qn(r)+(i<0?0:1),r=o}else if(r.nodeType==1){let o=r.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else r=o,e=i<0?Ds(r):0}else return!1}}function Ds(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function fRe(r,e){for(;;){if(r.nodeType==3&&e)return r;if(r.nodeType==1&&e>0){if(r.contentEditable=="false")return null;r=r.childNodes[e-1],e=Ds(r)}else if(r.parentNode&&!kS(r))e=Qn(r),r=r.parentNode;else return null}}function pRe(r,e){for(;;){if(r.nodeType==3&&e<r.nodeValue.length)return r;if(r.nodeType==1&&e<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[e],e=0}else if(r.parentNode&&!kS(r))e=Qn(r)+1,r=r.parentNode;else return null}}function mRe(r,e,t){for(let n=e==0,i=e==Ds(r);n||i;){if(r==t)return!0;let s=Qn(r);if(r=r.parentNode,!r)return!1;n=n&&s==0,i=i&&s==Ds(r)}}function kS(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const G1=function(r){return r.focusNode&&bd(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function lu(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function gRe(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function yRe(r,e,t){if(r.caretPositionFromPoint)try{let n=r.caretPositionFromPoint(e,t);if(n)return{node:n.offsetNode,offset:Math.min(Ds(n.offsetNode),n.offset)}}catch{}if(r.caretRangeFromPoint){let n=r.caretRangeFromPoint(e,t);if(n)return{node:n.startContainer,offset:Math.min(Ds(n.startContainer),n.startOffset)}}}const ra=typeof navigator<"u"?navigator:null,$3=typeof document<"u"?document:null,dc=ra&&ra.userAgent||"",RA=/Edge\/(\d+)/.exec(dc),fZ=/MSIE \d/.exec(dc),OA=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(dc),es=!!(fZ||OA||RA),$l=fZ?document.documentMode:OA?+OA[1]:RA?+RA[1]:0,js=!es&&/gecko\/(\d+)/i.test(dc);js&&+(/Firefox\/(\d+)/.exec(dc)||[0,0])[1];const NA=!es&&/Chrome\/(\d+)/.exec(dc),jn=!!NA,pZ=NA?+NA[1]:0,Sr=!es&&!!ra&&/Apple Computer/.test(ra.vendor),zf=Sr&&(/Mobile\/\w+/.test(dc)||!!ra&&ra.maxTouchPoints>2),$s=zf||(ra?/Mac/.test(ra.platform):!1),mZ=ra?/Win/.test(ra.platform):!1,Fa=/Android \d/.test(dc),CS=!!$3&&"webkitFontSmoothing"in $3.documentElement.style,xRe=CS?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function SRe(r){let e=r.defaultView&&r.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function Ra(r,e){return typeof r=="number"?r:r[e]}function wRe(r){let e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,n=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*n}}function R3(r,e,t){let n=r.someProp("scrollThreshold")||0,i=r.someProp("scrollMargin")||5,s=r.dom.ownerDocument;for(let o=t||r.dom;o;){if(o.nodeType!=1){o=Ff(o);continue}let a=o,l=a==s.body,c=l?SRe(s):wRe(a),u=0,d=0;if(e.top<c.top+Ra(n,"top")?d=-(c.top-e.top+Ra(i,"top")):e.bottom>c.bottom-Ra(n,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+Ra(i,"top")-c.top:e.bottom-c.bottom+Ra(i,"bottom")),e.left<c.left+Ra(n,"left")?u=-(c.left-e.left+Ra(i,"left")):e.right>c.right-Ra(n,"right")&&(u=e.right-c.right+Ra(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let f=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-f,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:Ff(o)}}function bRe(r){let e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),n,i;for(let s=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=r.root.elementFromPoint(s,o);if(!a||a==r.dom||!r.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){n=a,i=l.top;break}}return{refDOM:n,refTop:i,stack:gZ(r.dom)}}function gZ(r){let e=[],t=r.ownerDocument;for(let n=r;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),r!=t);n=Ff(n));return e}function vRe({refDOM:r,refTop:e,stack:t}){let n=r?r.getBoundingClientRect().top:0;yZ(t,n==0?0:n-e)}function yZ(r,e){for(let t=0;t<r.length;t++){let{dom:n,top:i,left:s}=r[t];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=s&&(n.scrollLeft=s)}}let dh=null;function kRe(r){if(r.setActive)return r.setActive();if(dh)return r.focus(dh);let e=gZ(r);r.focus(dh==null?{get preventScroll(){return dh={preventScroll:!0},!0}}:void 0),dh||(dh=!1,yZ(e,0))}function xZ(r,e){let t,n=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=r.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=_a(u).getClientRects();else continue;for(let f=0;f<h.length;f++){let p=h[f];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<n){t=u,n=m,i=m&&t.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!t&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!t&&l&&(t=l,i=c,n=0),t&&t.nodeType==3?CRe(t,i):!t||n&&t.nodeType==1?{node:r,offset:s}:xZ(t,i)}function CRe(r,e){let t=r.nodeValue.length,n=document.createRange(),i;for(let s=0;s<t;s++){n.setEnd(r,s+1),n.setStart(r,s);let o=ml(n,1);if(o.top!=o.bottom&&b_(e,o)){i={node:r,offset:s+(e.left>=(o.left+o.right)/2?1:0)};break}}return n.detach(),i||{node:r,offset:0}}function b_(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function TRe(r,e){let t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function ERe(r,e,t){let{node:n,offset:i}=xZ(e,t),s=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();s=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return r.docView.posFromDOM(n,i,s)}function MRe(r,e,t,n){let i=-1;for(let s=e,o=!1;s!=r.dom;){let a=r.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>n.left||l.top>n.top?i=a.posBefore:(!o&&l.right<n.left||l.bottom<n.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:r.docView.posFromDOM(e,t,-1)}function SZ(r,e,t){let n=r.childNodes.length;if(n&&t.top<t.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-t.top)/(t.bottom-t.top))-2)),s=i;;){let o=r.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(b_(e,c))return SZ(o,e,c)}}if((s=(s+1)%n)==i)break}return r}function IRe(r,e){let t=r.dom.ownerDocument,n,i=0,s=yRe(t,e.left,e.top);s&&({node:n,offset:i}=s);let o=(r.root.elementFromPoint?r.root:t).elementFromPoint(e.left,e.top),a;if(!o||!r.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=r.dom.getBoundingClientRect();if(!b_(e,c)||(o=SZ(r.dom,e,c),!o))return null}if(Sr)for(let c=o;n&&c;c=Ff(c))c.draggable&&(n=void 0);if(o=TRe(o,e),n){if(js&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let u=n.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;CS&&i&&n.nodeType==1&&(c=n.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,n==r.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?a=r.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(a=MRe(r,n,i,e))}a==null&&(a=ERe(r,o,e));let l=r.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function O3(r){return r.top<r.bottom||r.left<r.right}function ml(r,e){let t=r.getClientRects();if(t.length){let n=t[e<0?0:t.length-1];if(O3(n))return n}return Array.prototype.find.call(t,O3)||r.getBoundingClientRect()}const PRe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function wZ(r,e,t){let{node:n,offset:i,atom:s}=r.docView.domFromPos(e,t<0?-1:1),o=CS||js;if(n.nodeType==3)if(o&&(PRe.test(n.nodeValue)||(t<0?!i:i==n.nodeValue.length))){let l=ml(_a(n,i,i),t);if(js&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let c=ml(_a(n,i-1,i-1),-1);if(c.top==l.top){let u=ml(_a(n,i,i+1),-1);if(u.top!=l.top)return qp(u,u.left<c.left)}}return l}else{let l=i,c=i,u=t<0?1:-1;return t<0&&!i?(c++,u=-1):t>=0&&i==n.nodeValue.length?(l--,u=1):t<0?l--:c++,qp(ml(_a(n,l,c),u),u<0)}if(!r.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(t<0||i==Ds(n))){let l=n.childNodes[i-1];if(l.nodeType==1)return bM(l.getBoundingClientRect(),!1)}if(s==null&&i<Ds(n)){let l=n.childNodes[i];if(l.nodeType==1)return bM(l.getBoundingClientRect(),!0)}return bM(n.getBoundingClientRect(),t>=0)}if(s==null&&i&&(t<0||i==Ds(n))){let l=n.childNodes[i-1],c=l.nodeType==3?_a(l,Ds(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return qp(ml(c,1),!1)}if(s==null&&i<Ds(n)){let l=n.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?_a(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return qp(ml(c,-1),!0)}return qp(ml(n.nodeType==3?_a(n):n,-t),t>=0)}function qp(r,e){if(r.width==0)return r;let t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function bM(r,e){if(r.height==0)return r;let t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function bZ(r,e,t){let n=r.state,i=r.root.activeElement;n!=e&&r.updateState(e),i!=r.dom&&r.focus();try{return t()}finally{n!=e&&r.updateState(n),i!=r.dom&&i&&i.focus()}}function ARe(r,e,t){let n=e.selection,i=t=="up"?n.$from:n.$to;return bZ(r,e,()=>{let{node:s}=r.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let a=r.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=wZ(r,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=_a(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const $Re=/[\u0590-\u08ac]/;function RRe(r,e,t){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,s=!i,o=i==n.parent.content.size,a=r.domSelection();return a?!$Re.test(n.parent.textContent)||!a.modify?t=="left"||t=="backward"?s:o:bZ(r,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=r.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",t,"character");let f=n.depth?r.docView.domAfterPos(n.before()):r.dom,{focusNode:p,focusOffset:m}=r.domSelectionRange(),g=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),g}):n.pos==n.start()||n.pos==n.end()}let N3=null,_3=null,D3=!1;function ORe(r,e,t){return N3==e&&_3==t?D3:(N3=e,_3=t,D3=t=="up"||t=="down"?ARe(r,e,t):RRe(r,e,t))}const Ls=0,F3=1,du=2,ia=3;class TS{constructor(e,t,n,i){this.parent=e,this.children=t,this.dom=n,this.contentDOM=i,this.dirty=Ls,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let i=this.children[t];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let s,o;if(e==this.contentDOM)s=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>Qn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!t||s.node))if(n&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return s}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let i=this.children[t],s=n+i.size;if(n==e&&s!=n){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-n-i.border);n=s}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let s=0;n<this.children.length;n++){let o=this.children[n],a=s+o.size;if(a>e||o instanceof kZ){i=e-s;break}s=a}if(i)return this.children[n].domFromPos(i-this.children[n].border,t);for(let s;n&&!(s=this.children[n-1]).size&&s instanceof vZ&&s.side>=0;n--);if(t<=0){let s,o=!0;for(;s=n?this.children[n-1]:null,!(!s||s.dom.parentNode==this.contentDOM);n--,o=!1);return s&&t&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,t):{node:this.contentDOM,offset:s?Qn(s.dom)+1:0}}else{let s,o=!0;for(;s=n<this.children.length?this.children[n]:null,!(!s||s.dom.parentNode==this.contentDOM);n++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,t):{node:this.contentDOM,offset:s?Qn(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=n,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&t<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=Qn(h.dom)+1;break}e-=h.size}i==-1&&(i=0)}if(i>-1&&(c>t||a==this.children.length-1)){t=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=Qn(d.dom);break}t+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,i=!1){let s=Math.min(e,t),o=Math.max(e,t);for(let f=0,p=0;f<this.children.length;f++){let m=this.children[f],g=p+m.size;if(s>p&&o<g)return m.setSelection(e-p-m.border,t-p-m.border,n,i);p=g}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),c=n.root.getSelection(),u=n.domSelectionRange(),d=!1;if((js||Sr)&&e==t){let{node:f,offset:p}=a;if(f.nodeType==3){if(d=!!(p&&f.nodeValue[p-1]==`
`),d&&p==f.nodeValue.length)for(let m=f,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:Qn(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=f.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(js&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(i=!0)}if(!(i||d&&Sr)&&bd(a.node,a.offset,u.anchorNode,u.anchorOffset)&&bd(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==t)&&!(d&&js)){c.collapse(a.node,a.offset);try{e!=t&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>t){let p=a;a=l,l=p}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,i=0;i<this.children.length;i++){let s=this.children[i],o=n+s.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let a=n+s.border,l=o-s.border;if(e>=a&&t<=l){this.dirty=e==n||t==o?du:F3,e==a&&t==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=ia:s.markDirty(e-a,t-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?du:ia}n=o}this.dirty=du}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?du:F3;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class vZ extends TS{constructor(e,t,n,i){let s,o=t.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,s=this}matchesWidget(e){return this.dirty==Ls&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class NRe extends TS{constructor(e,t,n,i){super(e,[],t,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class vd extends TS{constructor(e,t,n,i,s){super(e,[],n,i),this.mark=t,this.spec=s}static create(e,t,n,i){let s=i.nodeViews[t.type.name],o=s&&s(t,i,n);return(!o||!o.dom)&&(o=vS.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new vd(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ia||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ia&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Ls){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Ls}}slice(e,t,n){let i=vd.create(this.parent,this.mark,!0,n),s=this.children,o=this.size;t<o&&(s=DA(s,t,o,n)),e>0&&(s=DA(s,0,e,n));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Rl extends TS{constructor(e,t,n,i,s,o,a,l,c){super(e,[],s,o),this.node=t,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=a}static create(e,t,n,i,s,o){let a=s.nodeViews[t.type.name],l,c=a&&a(t,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},n,i),u=c&&c.dom,d=c&&c.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=vS.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!d&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let h=u;return u=EZ(u,n,t),c?l=new _Re(e,t,n,i,u,d||null,h,c,s,o+1):t.isText?new Y1(e,t,n,i,u,h,s):new Rl(e,t,n,i,u,d||null,h,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>le.empty)}return e}matchesNode(e,t,n){return this.dirty==Ls&&e.eq(this.node)&&Rv(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,i=t,s=e.composing?this.localCompositionInfo(e,t):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new FRe(this,o&&o.node,e);jRe(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,n,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?It.none:this.node.child(u).marks,n,e),l.placeWidget(c,e,i)},(c,u,d,h)=>{l.syncToMarks(c.marks,n,e);let f;l.findNodeMatch(c,u,d,h)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(f=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,f,e)||l.updateNextNode(c,u,d,e,h,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],n,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==du)&&(o&&this.protectLocalComposition(e,o),CZ(this.contentDOM,this.children,e),zf&&LRe(this.dom))}localCompositionInfo(e,t){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof St)||n<t||i>t+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=URe(this.node.content,o,n-t,i-t);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:i}){if(this.getDesc(t))return;let s=t;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new NRe(this,s,t,i);e.input.compositionNodes.push(o),this.children=DA(this.children,n,n+i.length,e,o)}update(e,t,n,i){return this.dirty==ia||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,i),!0)}updateInner(e,t,n,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Ls}updateOuterDeco(e){if(Rv(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=TZ(this.dom,this.nodeDOM,_A(this.outerDeco,this.node,t),_A(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function z3(r,e,t,n,i){EZ(n,e,r);let s=new Rl(void 0,r,e,t,n,n,n,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class Y1 extends Rl{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,i){return this.dirty==ia||this.dirty!=Ls&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Ls||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Ls,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,n){let i=this.node.cut(e,t),s=document.createTextNode(i.text);return new Y1(this.parent,i,this.outerDeco,this.innerDeco,s,s,n)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=ia)}get domAtom(){return!1}isText(e){return this.node.text==e}}class kZ extends TS{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ls&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class _Re extends Rl{constructor(e,t,n,i,s,o,a,l,c,u){super(e,t,n,i,s,o,a,c,u),this.spec=l}update(e,t,n,i){if(this.dirty==ia)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,t,n);return s&&this.updateInner(e,t,n,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,i){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function CZ(r,e,t){let n=r.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==r){for(;a!=n;)n=B3(n),i=!0;n=n.nextSibling}else i=!0,r.insertBefore(a,n);if(o instanceof vd){let l=n?n.previousSibling:r.lastChild;CZ(o.contentDOM,o.children,t),n=l?l.nextSibling:r.firstChild}}for(;n;)n=B3(n),i=!0;i&&t.trackWrites==r&&(t.trackWrites=null)}const Qg=function(r){r&&(this.nodeName=r)};Qg.prototype=Object.create(null);const hu=[new Qg];function _A(r,e,t){if(r.length==0)return hu;let n=t?hu[0]:new Qg,i=[n];for(let s=0;s<r.length;s++){let o=r[s].type.attrs;if(o){o.nodeName&&i.push(n=new Qg(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&i.length==1&&i.push(n=new Qg(e.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return i}function TZ(r,e,t,n){if(t==hu&&n==hu)return e;let i=e;for(let s=0;s<n.length;s++){let o=n[s],a=t[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=r&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=hu[0]),i=l}DRe(i,a||hu[0],o)}return i}function DRe(r,e,t){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&r.removeAttribute(n);for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&t[n]!=e[n]&&r.setAttribute(n,t[n]);if(e.class!=t.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let s=0;s<n.length;s++)i.indexOf(n[s])==-1&&r.classList.remove(n[s]);for(let s=0;s<i.length;s++)n.indexOf(i[s])==-1&&r.classList.add(i[s]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)r.style.removeProperty(i[1])}t.style&&(r.style.cssText+=t.style)}}function EZ(r,e,t){return TZ(r,r,hu,_A(e,t,r.nodeType!=1))}function Rv(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function B3(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class FRe{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=zRe(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Ls,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=vd.create(this.top,e[s],t,n);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,t,n,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,t,n)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,n,i,s){let o=this.top.children[i];return o.dirty==ia&&o.dom==o.contentDOM&&(o.dirty=du),o.update(e,t,n,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=t}}updateNextNode(e,t,n,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Rl){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ia&&Rv(t,l.outerDeco));if(!h&&l.update(e,t,n,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,e,t,n,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=du,d.updateChildren(i,o+1),d.dirty=Ls),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,i,s,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Rv(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=Rl.create(this.top,t,n,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,n,i,s){let o=Rl.create(this.top,e,t,n,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new vZ(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof vd;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Y1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Sr||jn)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new kZ(this.top,[],n,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function zRe(r,e){let t=e,n=t.children.length,i=r.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(n){let c=t.children[n-1];if(c instanceof vd)t=c,n=c.children.length;else{a=c,n--;break}}else{if(t==e)break e;n=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=r.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function BRe(r,e){return r.type.side-e.type.side}function jRe(r,e,t,n){let i=e.locals(r),s=0;if(i.length==0){for(let c=0;c<r.childCount;c++){let u=r.child(c);n(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let g=i[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(BRe);for(let g=0;g<d.length;g++)t(d[g],c,!!l)}else t(u,c,!!l);let h,f;if(l)f=-1,h=l,l=null;else if(c<r.childCount)f=c,h=r.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=s&&a.splice(g--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+h.nodeSize;if(h.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=h.cut(g-s),h=h.cut(0,g-s),p=g,f=-1)}else for(;o<i.length&&i[o].to<p;)o++;let m=h.isInline&&!h.isLeaf?a.filter(g=>!g.inline):a.slice();n(h,m,e.forChild(s,h),f),s=p}}function LRe(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function URe(r,e,t,n){for(let i=0,s=0;i<r.childCount&&s<=n;){let o=r.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<r.childCount;){let c=r.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=t){if(s>=n&&l.slice(n-e.length-a,n-a)==e)return n-e.length;let c=a<n?l.lastIndexOf(e,n-a-1):-1;if(c>=0&&c+e.length+a>=t)return a+c;if(t==n&&l.length>=n+e.length-a&&l.slice(n-a,n-a+e.length)==e)return n}}return-1}function DA(r,e,t,n,i){let s=[];for(let o=0,a=0;o<r.length;o++){let l=r[o],c=a,u=a+=l.size;c>=t||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,n)),i&&(s.push(i),i=void 0),u>t&&s.push(l.slice(t-c,l.size,n)))}return s}function v_(r,e=null){let t=r.domSelectionRange(),n=r.state.doc;if(!t.focusNode)return null;let i=r.docView.nearestDesc(t.focusNode),s=i&&i.size==0,o=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=n.resolve(o),l,c;if(G1(t)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&yt.isSelectable(d)&&i.parent&&!(d.isInline&&mRe(t.focusNode,t.focusOffset,i.dom))){let h=i.posBefore;c=new yt(o==h?a:n.resolve(h))}}else{if(t instanceof r.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let d=o,h=o;for(let f=0;f<t.rangeCount;f++){let p=t.getRangeAt(f);d=Math.min(d,r.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,r.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=h==r.state.selection.anchor?[h,d]:[d,h],a=n.resolve(o)}else l=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=n.resolve(l);if(!c){let d=e=="pointer"||r.state.selection.head<a.pos&&!s?1:-1;c=k_(r,u,a,d)}return c}function MZ(r){return r.editable?r.hasFocus():PZ(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function ja(r,e=!1){let t=r.state.selection;if(IZ(r,t),!!MZ(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&jn){let n=r.domSelectionRange(),i=r.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&bd(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)HRe(r);else{let{anchor:n,head:i}=t,s,o;j3&&!(t instanceof St)&&(t.$from.parent.inlineContent||(s=L3(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=L3(r,t.to))),r.docView.setSelection(n,i,r,e),j3&&(s&&U3(s),o&&U3(o)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&WRe(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const j3=Sr||jn&&pZ<63;function L3(r,e){let{node:t,offset:n}=r.docView.domFromPos(e,0),i=n<t.childNodes.length?t.childNodes[n]:null,s=n?t.childNodes[n-1]:null;if(Sr&&i&&i.contentEditable=="false")return vM(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return vM(i);if(s)return vM(s)}}function vM(r){return r.contentEditable="true",Sr&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function U3(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function WRe(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),n=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=n||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!MZ(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function HRe(r){let e=r.domSelection();if(!e)return;let t=r.cursorWrapper.dom,n=t.nodeName=="IMG";n?e.collapse(t.parentNode,Qn(t)+1):e.collapse(t,0),!n&&!r.state.selection.visible&&es&&$l<=11&&(t.disabled=!0,t.disabled=!1)}function IZ(r,e){if(e instanceof yt){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(W3(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else W3(r)}function W3(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function k_(r,e,t,n){return r.someProp("createSelectionBetween",i=>i(r,e,t))||St.between(e,t,n)}function H3(r){return r.editable&&!r.hasFocus()?!1:PZ(r)}function PZ(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function qRe(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.domSelectionRange();return bd(e.node,e.offset,t.anchorNode,t.anchorOffset)}function FA(r,e){let{$anchor:t,$head:n}=r.selection,i=e>0?t.max(n):t.min(n),s=i.parent.inlineContent?i.depth?r.doc.resolve(e>0?i.after():i.before()):null:i;return s&&gt.findFrom(s,e)}function Sl(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function q3(r,e,t){let n=r.state.selection;if(n instanceof St)if(t.indexOf("s")>-1){let{$head:i}=n,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=r.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Sl(r,new St(n.$anchor,o))}else if(n.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let i=FA(r.state,e);return i&&i instanceof yt?Sl(r,i):!1}else if(!($s&&t.indexOf("m")>-1)){let i=n.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=r.docView.descAt(a))&&!o.contentDOM?yt.isSelectable(s)?Sl(r,new yt(e<0?r.state.doc.resolve(i.pos-s.nodeSize):i)):CS?Sl(r,new St(r.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(n instanceof yt&&n.node.isInline)return Sl(r,new St(e>0?n.$to:n.$from));{let i=FA(r.state,e);return i?Sl(r,i):!1}}}function Ov(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function ey(r,e){let t=r.pmViewDesc;return t&&t.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function hh(r,e){return e<0?KRe(r):JRe(r)}function KRe(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i,s,o=!1;for(js&&t.nodeType==1&&n<Ov(t)&&ey(t.childNodes[n],-1)&&(o=!0);;)if(n>0){if(t.nodeType!=1)break;{let a=t.childNodes[n-1];if(ey(a,-1))i=t,s=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}}else{if(AZ(t))break;{let a=t.previousSibling;for(;a&&ey(a,-1);)i=t.parentNode,s=Qn(a),a=a.previousSibling;if(a)t=a,n=Ov(t);else{if(t=t.parentNode,t==r.dom)break;n=0}}}o?zA(r,t,n):i&&zA(r,i,s)}function JRe(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i=Ov(t),s,o;for(;;)if(n<i){if(t.nodeType!=1)break;let a=t.childNodes[n];if(ey(a,1))s=t,o=++n;else break}else{if(AZ(t))break;{let a=t.nextSibling;for(;a&&ey(a,1);)s=a.parentNode,o=Qn(a)+1,a=a.nextSibling;if(a)t=a,n=0,i=Ov(t);else{if(t=t.parentNode,t==r.dom)break;n=i=0}}}s&&zA(r,s,o)}function AZ(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function VRe(r,e){for(;r&&e==r.childNodes.length&&!kS(r);)e=Qn(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let t=r.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=0}}function GRe(r,e){for(;r&&!e&&!kS(r);)e=Qn(r),r=r.parentNode;for(;r&&e;){let t=r.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=r.childNodes.length}}function zA(r,e,t){if(e.nodeType!=3){let s,o;(o=VRe(e,t))?(e=o,t=0):(s=GRe(e,t))&&(e=s,t=s.nodeValue.length)}let n=r.domSelection();if(!n)return;if(G1(n)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),n.removeAllRanges(),n.addRange(s)}else n.extend&&n.extend(e,t);r.domObserver.setCurSelection();let{state:i}=r;setTimeout(()=>{r.state==i&&ja(r)},50)}function K3(r,e){let t=r.state.doc.resolve(e);if(!(jn||mZ)&&t.parent.inlineContent){let i=r.coordsAtPos(e);if(e>t.start()){let s=r.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<t.end()){let s=r.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function J3(r,e,t){let n=r.state.selection;if(n instanceof St&&!n.empty||t.indexOf("s")>-1||$s&&t.indexOf("m")>-1)return!1;let{$from:i,$to:s}=n;if(!i.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let o=FA(r.state,e);if(o&&o instanceof yt)return Sl(r,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=n instanceof Au?gt.near(o,e):gt.findFrom(o,e);return a?Sl(r,a):!1}return!1}function V3(r,e){if(!(r.state.selection instanceof St))return!0;let{$head:t,$anchor:n,empty:i}=r.state.selection;if(!t.sameParent(n))return!0;if(!i)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=r.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),r.dispatch(o),!0}return!1}function G3(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function YRe(r){if(!Sr||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;G3(r,n,"true"),setTimeout(()=>G3(r,n,"false"),20)}return!1}function XRe(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function ZRe(r,e){let t=e.keyCode,n=XRe(e);if(t==8||$s&&t==72&&n=="c")return V3(r,-1)||hh(r,-1);if(t==46&&!e.shiftKey||$s&&t==68&&n=="c")return V3(r,1)||hh(r,1);if(t==13||t==27)return!0;if(t==37||$s&&t==66&&n=="c"){let i=t==37?K3(r,r.state.selection.from)=="ltr"?-1:1:-1;return q3(r,i,n)||hh(r,i)}else if(t==39||$s&&t==70&&n=="c"){let i=t==39?K3(r,r.state.selection.from)=="ltr"?1:-1:1;return q3(r,i,n)||hh(r,i)}else{if(t==38||$s&&t==80&&n=="c")return J3(r,-1,n)||hh(r,-1);if(t==40||$s&&t==78&&n=="c")return YRe(r)||J3(r,1,n)||hh(r,1);if(n==($s?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function C_(r,e){r.someProp("transformCopied",f=>{e=f(e,r)});let t=[],{content:n,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,s--;let f=n.firstChild;t.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),n=f.content}let o=r.someProp("clipboardSerializer")||vS.fromSchema(r.state.schema),a=DZ(),l=a.createElement("div");l.appendChild(o.serializeFragment(n,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=_Z[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let h=r.someProp("clipboardTextSerializer",f=>f(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function $Z(r,e,t,n,i){let s=i.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=!!e&&(n||s||!t);if(l){if(r.someProp("transformPastedText",h=>{e=h(e,s||n,r)}),s)return a=new Se(le.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),r.someProp("transformPasted",h=>{a=h(a,r,!0)}),a;let d=r.someProp("clipboardTextParser",h=>h(e,i,n,r));if(d)a=d;else{let h=i.marks(),{schema:f}=r.state,p=vS.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(f.text(m,h)))})}}else r.someProp("transformPastedHTML",d=>{t=d(t,r)}),o=nOe(t),CS&&rOe(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(r.someProp("clipboardParser")||r.someProp("domParser")||ff.fromSchema(r.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!QRe.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=iOe(Y3(a,+u[1],+u[2]),u[4]);else if(a=Se.maxOpen(eOe(a.content,i),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=Y3(a,d,h)}return r.someProp("transformPasted",d=>{a=d(a,r,l)}),a}const QRe=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function eOe(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(r.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&OZ(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=NZ(o[o.length-1],s.length));let u=RZ(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return le.from(o)}return r}function RZ(r,e,t=0){for(let n=e.length-1;n>=t;n--)r=e[n].create(null,le.from(r));return r}function OZ(r,e,t,n,i){if(i<r.length&&i<e.length&&r[i]==e[i]){let s=OZ(r,e,t,n.lastChild,i+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(i==r.length-1?t.type:r[i+1]))return n.copy(n.content.append(le.from(RZ(t,r,i+1))))}}function NZ(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,NZ(r.lastChild,e-1)),n=r.contentMatchAt(r.childCount).fillBefore(le.empty,!0);return r.copy(t.append(n))}function BA(r,e,t,n,i,s){let o=e<0?r.firstChild:r.lastChild,a=o.content;return r.childCount>1&&(s=0),i<n-1&&(a=BA(a,e,t,n,i+1,s)),i>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(le.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,o.copy(a))}function Y3(r,e,t){return e<r.openStart&&(r=new Se(BA(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new Se(BA(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const _Z={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let X3=null;function DZ(){return X3||(X3=document.implementation.createHTMLDocument("title"))}let kM=null;function tOe(r){let e=window.trustedTypes;return e?(kM||(kM=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),kM.createHTML(r)):r}function nOe(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=DZ().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(r),i;if((i=n&&_Z[n[1].toLowerCase()])&&(r=i.map(s=>"<"+s+">").join("")+r+i.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=tOe(r),i)for(let s=0;s<i.length;s++)t=t.querySelector(i[s])||t;return t}function rOe(r){let e=r.querySelectorAll(jn?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let n=e[t];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),n)}}function iOe(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return r}let{content:i,openStart:s,openEnd:o}=r;for(let a=n.length-2;a>=0;a-=2){let l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;i=le.from(l.create(n[a+1],i)),s++,o++}return new Se(i,s,o)}const Di={},Fi={},sOe={touchstart:!0,touchmove:!0};class oOe{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function aOe(r){for(let e in Di){let t=Di[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=n=>{cOe(r,n)&&!T_(r,n)&&(r.editable||!(n.type in Fi))&&t(r,n)},sOe[e]?{passive:!0}:void 0)}Sr&&r.dom.addEventListener("input",()=>null),jA(r)}function Tl(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function lOe(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function jA(r){r.someProp("handleDOMEvents",e=>{for(let t in e)r.input.eventHandlers[t]||r.dom.addEventListener(t,r.input.eventHandlers[t]=n=>T_(r,n))})}function T_(r,e){return r.someProp("handleDOMEvents",t=>{let n=t[e.type];return n?n(r,e)||e.defaultPrevented:!1})}function cOe(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function uOe(r,e){!T_(r,e)&&Di[e.type]&&(r.editable||!(e.type in Fi))&&Di[e.type](r,e)}Fi.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!zZ(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(Fa&&jn&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),zf&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let n=Date.now();r.input.lastIOSEnter=n,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==n&&(r.someProp("handleKeyDown",i=>i(r,lu(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",n=>n(r,t))||ZRe(r,t)?t.preventDefault():Tl(r,"key")};Fi.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};Fi.keypress=(r,e)=>{let t=e;if(zZ(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||$s&&t.metaKey)return;if(r.someProp("handleKeyPress",i=>i(r,t))){t.preventDefault();return}let n=r.state.selection;if(!(n instanceof St)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(t.charCode),s=()=>r.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!r.someProp("handleTextInput",o=>o(r,n.$from.pos,n.$to.pos,i,s))&&r.dispatch(s()),t.preventDefault()}};function X1(r){return{left:r.clientX,top:r.clientY}}function dOe(r,e){let t=e.x-r.clientX,n=e.y-r.clientY;return t*t+n*n<100}function E_(r,e,t,n,i){if(n==-1)return!1;let s=r.state.doc.resolve(n);for(let o=s.depth+1;o>0;o--)if(r.someProp(e,a=>o>s.depth?a(r,t,s.nodeAfter,s.before(o),i,!0):a(r,t,s.node(o),s.before(o),i,!1)))return!0;return!1}function pf(r,e,t){if(r.focused||r.focus(),r.state.selection.eq(e))return;let n=r.state.tr.setSelection(e);n.setMeta("pointer",!0),r.dispatch(n)}function hOe(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&yt.isSelectable(n)?(pf(r,new yt(t)),!0):!1}function fOe(r,e){if(e==-1)return!1;let t=r.state.selection,n,i;t instanceof yt&&(n=t.node);let s=r.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(yt.isSelectable(a)){n&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?i=s.before(t.$from.depth):i=s.before(o);break}}return i!=null?(pf(r,yt.create(r.state.doc,i)),!0):!1}function pOe(r,e,t,n,i){return E_(r,"handleClickOn",e,t,n)||r.someProp("handleClick",s=>s(r,e,n))||(i?fOe(r,t):hOe(r,t))}function mOe(r,e,t,n){return E_(r,"handleDoubleClickOn",e,t,n)||r.someProp("handleDoubleClick",i=>i(r,e,n))}function gOe(r,e,t,n){return E_(r,"handleTripleClickOn",e,t,n)||r.someProp("handleTripleClick",i=>i(r,e,n))||yOe(r,t,n)}function yOe(r,e,t){if(t.button!=0)return!1;let n=r.state.doc;if(e==-1)return n.inlineContent?(pf(r,St.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)pf(r,St.create(n,a+1,a+1+o.content.size));else if(yt.isSelectable(o))pf(r,yt.create(n,a));else continue;return!0}}function M_(r){return Nv(r)}const FZ=$s?"metaKey":"ctrlKey";Di.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let n=M_(r),i=Date.now(),s="singleClick";i-r.input.lastClick.time<500&&dOe(t,r.input.lastClick)&&!t[FZ]&&r.input.lastClick.button==t.button&&(r.input.lastClick.type=="singleClick"?s="doubleClick":r.input.lastClick.type=="doubleClick"&&(s="tripleClick")),r.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:s,button:t.button};let o=r.posAtCoords(X1(t));o&&(s=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new xOe(r,o,t,!!n)):(s=="doubleClick"?mOe:gOe)(r,o.pos,o.inside,t)?t.preventDefault():Tl(r,"pointer"))};let xOe=class{constructor(e,t,n,i){this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[FZ],this.allowDefault=n.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:n.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof yt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&js&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Tl(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ja(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(X1(e))),this.updateAllowDefault(e),this.allowDefault||!t?Tl(this.view,"pointer"):pOe(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Sr&&this.mightDrag&&!this.mightDrag.node.isAtom||jn&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(pf(this.view,gt.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Tl(this.view,"pointer")}move(e){this.updateAllowDefault(e),Tl(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};Di.touchstart=r=>{r.input.lastTouch=Date.now(),M_(r),Tl(r,"pointer")};Di.touchmove=r=>{r.input.lastTouch=Date.now(),Tl(r,"pointer")};Di.contextmenu=r=>M_(r);function zZ(r,e){return r.composing?!0:Sr&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const SOe=Fa?5e3:-1;Fi.compositionstart=Fi.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$to;if(e.selection instanceof St&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||jn&&mZ&&wOe(r)))r.markCursor=r.state.storedMarks||t.marks(),Nv(r,!0),r.markCursor=null;else if(Nv(r,!e.selection.empty),js&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let n=r.domSelectionRange();for(let i=n.focusNode,s=n.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=r.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}r.input.composing=!0}BZ(r,SOe)};function wOe(r){let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(!e||e.nodeType!=1||t>=e.childNodes.length)return!1;let n=e.childNodes[t];return n.nodeType==1&&n.contentEditable=="false"}Fi.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,BZ(r,20))};function BZ(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>Nv(r),e))}function jZ(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=vOe());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function bOe(r){let e=r.domSelectionRange();if(!e.focusNode)return null;let t=fRe(e.focusNode,e.focusOffset),n=pRe(e.focusNode,e.focusOffset);if(t&&n&&t!=n){let i=n.pmViewDesc,s=r.domObserver.lastChangedTextNode;if(t==s||n==s)return s;if(!i||!i.isText(n.nodeValue))return n;if(r.input.compositionNode==n){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return n}}return t||n}function vOe(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function Nv(r,e=!1){if(!(Fa&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),jZ(r),e||r.docView&&r.docView.dirty){let t=v_(r),n=r.state.selection;return t&&!t.eq(n)?r.dispatch(r.state.tr.setSelection(t)):(r.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function kOe(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),r.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const Hy=es&&$l<15||zf&&xRe<604;Di.copy=Fi.cut=(r,e)=>{let t=e,n=r.state.selection,i=t.type=="cut";if(n.empty)return;let s=Hy?null:t.clipboardData,o=n.content(),{dom:a,text:l}=C_(r,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):kOe(r,a),i&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function COe(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function TOe(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,n=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),n.parentNode&&n.parentNode.removeChild(n),t?qy(r,n.value,null,i,e):qy(r,n.textContent,n.innerHTML,i,e)},50)}function qy(r,e,t,n,i){let s=$Z(r,e,t,n,r.state.selection.$from);if(r.someProp("handlePaste",l=>l(r,i,s||Se.empty)))return!0;if(!s)return!1;let o=COe(s),a=o?r.state.tr.replaceSelectionWith(o,n):r.state.tr.replaceSelection(s);return r.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function LZ(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let t=r.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}Fi.paste=(r,e)=>{let t=e;if(r.composing&&!Fa)return;let n=Hy?null:t.clipboardData,i=r.input.shiftKey&&r.input.lastKeyCode!=45;n&&qy(r,LZ(n),n.getData("text/html"),i,t)?t.preventDefault():TOe(r,t)};let UZ=class{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}};const EOe=$s?"altKey":"ctrlKey";function WZ(r,e){let t=r.someProp("dragCopies",n=>!n(e));return t??!e[EOe]}Di.dragstart=(r,e)=>{let t=e,n=r.input.mouseDown;if(n&&n.done(),!t.dataTransfer)return;let i=r.state.selection,s=i.empty?null:r.posAtCoords(X1(t)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof yt?i.to-1:i.to))){if(n&&n.mightDrag)o=yt.create(r.state.doc,n.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=r.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=r.docView&&(o=yt.create(r.state.doc,d.posBefore))}}let a=(o||r.state.selection).content(),{dom:l,text:c,slice:u}=C_(r,a);(!t.dataTransfer.files.length||!jn||pZ>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Hy?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Hy||t.dataTransfer.setData("text/plain",c),r.dragging=new UZ(u,WZ(r,t),o)};Di.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};Fi.dragover=Fi.dragenter=(r,e)=>e.preventDefault();Fi.drop=(r,e)=>{try{MOe(r,e,r.dragging)}finally{r.dragging=null}};function MOe(r,e,t){if(!e.dataTransfer)return;let n=r.posAtCoords(X1(e));if(!n)return;let i=r.state.doc.resolve(n.pos),s=t&&t.slice;s?r.someProp("transformPasted",f=>{s=f(s,r,!1)}):s=$Z(r,LZ(e.dataTransfer),Hy?null:e.dataTransfer.getData("text/html"),!1,i);let o=!!(t&&WZ(r,e));if(r.someProp("handleDrop",f=>f(r,e,s||Se.empty,o))){e.preventDefault();return}if(!s)return;e.preventDefault();let a=s?Z$e(r.state.doc,i.pos,s):i.pos;a==null&&(a=i.pos);let l=r.state.tr;if(o){let{node:f}=t;f?f.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=l.doc;if(u?l.replaceRangeWith(c,c,s.content.firstChild):l.replaceRange(c,c,s),l.doc.eq(d))return;let h=l.doc.resolve(c);if(u&&yt.isSelectable(s.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(s.content.firstChild))l.setSelection(new yt(h));else{let f=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((p,m,g,y)=>f=y),l.setSelection(k_(r,h,l.doc.resolve(f)))}r.focus(),r.dispatch(l.setMeta("uiEvent","drop"))}Di.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&ja(r)},20))};Di.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};Di.beforeinput=(r,e)=>{if(jn&&Fa&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:n}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=n||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",s=>s(r,lu(8,"Backspace")))))return;let{$cursor:i}=r.state.selection;i&&i.pos>0&&r.dispatch(r.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let r in Fi)Di[r]=Fi[r];function Ky(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}let Z3=class HZ{constructor(e,t){this.toDOM=e,this.spec=t||$u,this.side=this.spec.side||0}map(e,t,n,i){let{pos:s,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new Sp(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof HZ&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ky(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},ty=class LA{constructor(e,t){this.attrs=e,this.spec=t||$u}map(e,t,n,i){let s=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return s>=o?null:new Sp(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof LA&&Ky(this.attrs,e.attrs)&&Ky(this.spec,e.spec)}static is(e){return e.type instanceof LA}destroy(){}},IOe=class qZ{constructor(e,t){this.attrs=e,this.spec=t||$u}map(e,t,n,i){let s=e.mapResult(t.from+i,1);if(s.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Sp(s.pos-n,o.pos-n,this)}valid(e,t){let{index:n,offset:i}=e.content.findIndex(t.from),s;return i==t.from&&!(s=e.child(n)).isText&&i+s.nodeSize==t.to}eq(e){return this==e||e instanceof qZ&&Ky(this.attrs,e.attrs)&&Ky(this.spec,e.spec)}destroy(){}},Sp=class km{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new km(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new km(e,e,new Z3(t,n))}static inline(e,t,n,i){return new km(e,t,new ty(n,i))}static node(e,t,n,i){return new km(e,t,new IOe(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof ty}get widget(){return this.type instanceof Z3}};const kh=[],$u={};let Zo=class gl{constructor(e,t){this.local=e.length?e:kh,this.children=t.length?t:kh}static create(e,t){return t.length?_v(t,e,0,$u):fr}find(e,t,n){let i=[];return this.findInner(e??0,t??1e9,i,0,n),i}findInner(e,t,n,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!s||s(a.spec))&&n.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,n,i+a,s)}}map(e,t,n){return this==fr||e.maps.length==0?this:this.mapInner(e,t,0,0,n||$u)}mapInner(e,t,n,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,n,i);l&&l.type.valid(t,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?POe(this.children,o||[],e,t,n,i,s):o?new gl(o.sort(Ru),kh):fr}add(e,t){return t.length?this==fr?gl.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,s=0;e.forEach((a,l)=>{let c=l+n,u;if(u=VZ(t,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,_v(u,a,c+1,$u)),s+=3}});let o=JZ(s?GZ(t):t,-n);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new gl(o.length?this.local.concat(o).sort(Ru):this.local,i||this.children)}remove(e){return e.length==0||this==fr?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let s=0;s<n.length;s+=3){let o,a=n[s]+t,l=n[s+1]+t;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;n==this.children&&(n=this.children.slice());let c=n[s+2].removeInner(o,a+1);c!=fr?n[s+2]=c:(n.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new gl(i,n):fr}forChild(e,t){if(this==fr)return this;if(t.isLeaf)return gl.empty;let n,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(n=this.children[a+2]);break}let s=e+1,o=s+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof ty){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new gl(i.sort(Ru),kh);return n?new KZ([a,n]):a}return n||fr}eq(e){if(this==e)return!0;if(!(e instanceof gl)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return I_(this.localsInner(e))}localsInner(e){if(this==fr)return kh;if(e.inlineContent||!this.local.some(ty.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof ty||t.push(this.local[n]);return t}forEachSet(e){e(this)}};Zo.empty=new Zo([],[]);Zo.removeOverlap=I_;const fr=Zo.empty;let KZ=class Ch{constructor(e){this.members=e}map(e,t){const n=this.members.map(i=>i.map(e,t,$u));return Ch.from(n)}forChild(e,t){if(t.isLeaf)return Zo.empty;let n=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,t);s!=fr&&(s instanceof Ch?n=n.concat(s.members):n.push(s))}return Ch.from(n)}eq(e){if(!(e instanceof Ch)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!t)t=s;else{n&&(t=t.slice(),n=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?I_(n?t:t.sort(Ru)):kh}static from(e){switch(e.length){case 0:return fr;case 1:return e[0];default:return new Ch(e.every(t=>t instanceof Zo)?e:e.reduce((t,n)=>t.concat(n instanceof Zo?n:n.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}};function POe(r,e,t,n,i,s,o){let a=r.slice();for(let c=0,u=s;c<t.maps.length;c++){let d=0;t.maps[c].forEach((h,f,p,m)=>{let g=m-p-(f-h);for(let y=0;y<a.length;y+=3){let S=a[y+1];if(S<0||h>S+u-d)continue;let w=a[y]+u-d;f>=w?a[y+1]=h<=w?-2:-1:h>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(r[c]+s),d=u-i;if(d<0||d>=n.content.size){l=!0;continue}let h=t.map(r[c+1]+s,-1),f=h-i,{index:p,offset:m}=n.content.findIndex(d),g=n.maybeChild(p);if(g&&m==d&&m+g.nodeSize==f){let y=a[c+2].mapInner(t,g,u+1,r[c]+s+1,o);y!=fr?(a[c]=d,a[c+1]=f,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=AOe(a,r,e,t,i,s,o),u=_v(c,n,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new Zo(e.sort(Ru),a)}function JZ(r,e){if(!e||!r.length)return r;let t=[];for(let n=0;n<r.length;n++){let i=r[n];t.push(new Sp(i.from+e,i.to+e,i.type))}return t}function AOe(r,e,t,n,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(n,i,c);d?t.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<r.length;l+=3)r[l+1]==-1&&a(r[l+2],e[l]+s+1);return t}function VZ(r,e,t){if(e.isLeaf)return null;let n=t+e.nodeSize,i=null;for(let s=0,o;s<r.length;s++)(o=r[s])&&o.from>t&&o.to<n&&((i||(i=[])).push(o),r[s]=null);return i}function GZ(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function _v(r,e,t,n){let i=[],s=!1;e.forEach((a,l)=>{let c=VZ(r,a,l+t);if(c){s=!0;let u=_v(c,a,t+l+1,n);u!=fr&&i.push(l,l+a.nodeSize,u)}});let o=JZ(s?GZ(r):r,-t).sort(Ru);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(n.onRemove&&n.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new Zo(o,i):fr}function Ru(r,e){return r.from-e.from||r.to-e.to}function I_(r){let e=r;for(let t=0;t<e.length-1;t++){let n=e[t];if(n.from!=n.to)for(let i=t+1;i<e.length;i++){let s=e[i];if(s.from==n.from){s.to!=n.to&&(e==r&&(e=r.slice()),e[i]=s.copy(s.from,n.to),Q3(e,i+1,s.copy(n.to,s.to)));continue}else{s.from<n.to&&(e==r&&(e=r.slice()),e[t]=n.copy(n.from,s.from),Q3(e,i,n.copy(s.from,n.to)));break}}}return e}function Q3(r,e,t){for(;e<r.length&&Ru(t,r[e])>0;)e++;r.splice(e,0,t)}function CM(r){let e=[];return r.someProp("decorations",t=>{let n=t(r.state);n&&n!=fr&&e.push(n)}),r.cursorWrapper&&e.push(Zo.create(r.state.doc,[r.cursorWrapper.deco])),KZ.from(e)}const $Oe={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ROe=es&&$l<=11;class OOe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class NOe{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new OOe,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);es&&$l<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),ROe&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,$Oe)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(H3(this.view)){if(this.suppressingSelectionUpdates)return ja(this.view);if(es&&$l<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&bd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let s=e.focusNode;s;s=Ff(s))t.add(s);for(let s=e.anchorNode;s;s=Ff(s))if(t.has(s)){n=s;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&H3(e)&&!this.ignoreSelectionChange(n),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let d=this.registerMutation(t[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(js&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let f=h.parentNode;f&&f.nodeName=="LI"&&(!d||FOe(e,d)!=f)&&h.remove()}}}else if((jn||Sr)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let d=u.nextSibling;d&&d.nodeType==1&&d.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&G1(n)&&(c=v_(e))&&c.eq(gt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ja(e),this.currentSelection.set(n),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),_Oe(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||ja(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];t.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,s=e.nextSibling;if(es&&$l<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h)}let o=i&&i.parentNode==e.target?Qn(i)+1:0,a=n.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Qn(s):e.target.childNodes.length,c=n.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let e5=new WeakMap,t5=!1;function _Oe(r){if(!e5.has(r)&&(e5.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=js,t5)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),t5=!0}}function n5(r,e){let t=e.startContainer,n=e.startOffset,i=e.endContainer,s=e.endOffset,o=r.domAtPos(r.state.selection.anchor);return bd(o.node,o.offset,i,s)&&([t,n,i,s]=[i,s,t,n]),{anchorNode:t,anchorOffset:n,focusNode:i,focusOffset:s}}function DOe(r,e){if(e.getComposedRanges){let i=e.getComposedRanges(r.root)[0];if(i)return n5(r,i)}let t;function n(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",n,!0),t?n5(r,t):null}function FOe(r,e){for(let t=e.parentNode;t&&t!=r.dom;t=t.parentNode){let n=r.docView.nearestDesc(t,!0);if(n&&n.node.isBlock)return t}return null}function zOe(r,e,t){let{node:n,fromOffset:i,toOffset:s,from:o,to:a}=r.docView.parseRange(e,t),l=r.domSelectionRange(),c,u=l.anchorNode;if(u&&r.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],G1(l)||c.push({node:l.focusNode,offset:l.focusOffset})),jn&&r.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=n.childNodes[g-1],S=y.pmViewDesc;if(y.nodeName=="BR"&&!S){s=g;break}if(!S||S.size)break}let d=r.state.doc,h=r.someProp("domParser")||ff.fromSchema(r.state.schema),f=d.resolve(o),p=null,m=h.parse(n,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:i,to:s,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:BOe,context:f});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function BOe(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(Sr&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||Sr&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const jOe=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function LOe(r,e,t,n,i){let s=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,e<0){let E=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,M=v_(r,E);if(M&&!r.state.selection.eq(M)){if(jn&&Fa&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",$=>$(r,lu(13,"Enter"))))return;let P=r.state.tr.setSelection(M);E=="pointer"?P.setMeta("pointer",!0):E=="key"&&P.scrollIntoView(),s&&P.setMeta("composition",s),r.dispatch(P)}return}let o=r.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=r.state.doc.resolve(t).after(a+1);let l=r.state.selection,c=zOe(r,e,t),u=r.state.doc,d=u.slice(c.from,c.to),h,f;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(h=r.state.selection.to,f="end"):(h=r.state.selection.from,f="start"),r.input.lastKeyCode=null;let p=HOe(d.content,c.doc.content,c.from,h,f);if(p&&r.input.domChangeCount++,(zf&&r.input.lastIOSEnter>Date.now()-225||Fa)&&i.some(E=>E.nodeType==1&&!jOe.test(E.nodeName))&&(!p||p.endA>=p.endB)&&r.someProp("handleKeyDown",E=>E(r,lu(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!p)if(n&&l instanceof St&&!l.empty&&l.$head.sameParent(l.$anchor)&&!r.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let E=r5(r,r.state.doc,c.sel);if(E&&!E.eq(r.state.selection)){let M=r.state.tr.setSelection(E);s&&M.setMeta("composition",s),r.dispatch(M)}}return}r.state.selection.from<r.state.selection.to&&p.start==p.endB&&r.state.selection instanceof St&&(p.start>r.state.selection.from&&p.start<=r.state.selection.from+2&&r.state.selection.from>=c.from?p.start=r.state.selection.from:p.endA<r.state.selection.to&&p.endA>=r.state.selection.to-2&&r.state.selection.to<=c.to&&(p.endB+=r.state.selection.to-p.endA,p.endA=r.state.selection.to)),es&&$l<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),S=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((zf&&r.input.lastIOSEnter>Date.now()-225&&(!S||i.some(E=>E.nodeName=="DIV"||E.nodeName=="P"))||!S&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&r.someProp("handleKeyDown",E=>E(r,lu(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>p.start&&WOe(u,p.start,p.endA,m,g)&&r.someProp("handleKeyDown",E=>E(r,lu(8,"Backspace")))){Fa&&jn&&r.domObserver.suppressSelectionUpdates();return}jn&&p.endB==p.start&&(r.input.lastChromeDelete=Date.now()),Fa&&!S&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{r.someProp("handleKeyDown",function(E){return E(r,lu(13,"Enter"))})},20));let w=p.start,b=p.endA,v=E=>{let M=E||r.state.tr.replace(w,b,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let P=r5(r,M.doc,c.sel);P&&!(jn&&r.composing&&P.empty&&(p.start!=p.endB||r.input.lastChromeDelete<Date.now()-100)&&(P.head==w||P.head==M.mapping.map(b)-1)||es&&P.empty&&P.head==w)&&M.setSelection(P)}return s&&M.setMeta("composition",s),M.scrollIntoView()},C;if(S)if(m.pos==g.pos){es&&$l<=11&&m.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>ja(r),20));let E=v(r.state.tr.delete(w,b)),M=u.resolve(p.start).marksAcross(u.resolve(p.endA));M&&E.ensureMarks(M),r.dispatch(E)}else if(p.endA==p.endB&&(C=UOe(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let E=v(r.state.tr);C.type=="add"?E.addMark(w,b,C.mark):E.removeMark(w,b,C.mark),r.dispatch(E)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let E=m.parent.textBetween(m.parentOffset,g.parentOffset),M=()=>v(r.state.tr.insertText(E,w,b));r.someProp("handleTextInput",P=>P(r,w,b,E,M))||r.dispatch(M())}else r.dispatch(v());else r.dispatch(v())}function r5(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:k_(r,e.resolve(t.anchor),e.resolve(t.head))}function UOe(r,e){let t=r.firstChild.marks,n=e.firstChild.marks,i=t,s=n,o,a,l;for(let u=0;u<n.length;u++)i=n[u].removeFromSet(i);for(let u=0;u<t.length;u++)s=t[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(le.from(c).eq(r))return{mark:a,type:o}}function WOe(r,e,t,n,i){if(t-e<=i.pos-n.pos||TM(n,!0,!1)<i.pos)return!1;let s=r.resolve(e);if(!n.parent.isTextblock){let a=s.nodeAfter;return a!=null&&t==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=r.resolve(TM(s,!0,!0));return!o.parent.isTextblock||o.pos>t||TM(o,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function TM(r,e,t){let n=r.depth,i=e?r.end():r.pos;for(;n>0&&(e||r.indexAfter(n)==r.node(n).childCount);)n--,i++,e=!1;if(t){let s=r.node(n).maybeChild(r.indexAfter(n));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function HOe(r,e,t,n,i){let s=r.findDiffStart(e,t);if(s==null)return null;let{a:o,b:a}=r.findDiffEnd(e,t+r.size,t+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));n-=o+l-s}if(o<s&&r.size<e.size){let l=n<=s&&n>=o?s-n:0;s-=l,s&&s<e.size&&i5(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=n<=s&&n>=a?s-n:0;s-=l,s&&s<r.size&&i5(r.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function i5(r){if(r.length!=2)return!1;let e=r.charCodeAt(0),t=r.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class YZ{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new oOe,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(c5),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=a5(this),o5(this),this.nodeViews=l5(this),this.docView=z3(this.state.doc,s5(this),CM(this),this.dom,this),this.domObserver=new NOe(this,(n,i,s,o)=>LOe(this,n,i,s,o)),this.domObserver.start(),aOe(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&jA(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(c5),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(jZ(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let f=l5(this);KOe(f,this.nodeViews)&&(this.nodeViews=f,s=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&jA(this),this.editable=a5(this),o5(this);let l=CM(this),c=s5(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&bRe(this);if(o){this.domObserver.stop();let f=d&&(es||jn)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&qOe(i.selection,e.selection);if(d){let p=jn?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=bOe(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=z3(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&qRe(this))?ja(this,f):(IZ(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&vRe(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof yt){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&R3(this,t.getBoundingClientRect(),e)}else R3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let n=this.directPlugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let n=this.state.plugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}updateDraggedNode(e,t){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let s=n.from+(this.state.doc.content.size-t.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==n.node&&(i=s)}this.dragging=new UZ(e.slice,e.move,i<0?void 0:yt.create(this.state.doc,i))}someProp(e,t){let n=this._props&&this._props[e],i;if(n!=null&&(i=t?t(n):n))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=t?t(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=t?t(a):a))return i}}hasFocus(){if(es){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&kRe(this.dom),ja(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return IRe(this,e)}coordsAtPos(e,t=1){return wZ(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let i=this.docView.posFromDOM(e,t,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return ORe(this,t||this.state,e)}pasteHTML(e,t){return qy(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return qy(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return C_(this,e)}destroy(){this.docView&&(lOe(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],CM(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,dRe())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return uOe(this,e)}domSelectionRange(){let e=this.domSelection();return e?Sr&&this.root.nodeType===11&&gRe(this.dom.ownerDocument)==this.dom&&DOe(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}YZ.prototype.dispatch=function(r){let e=this._props.dispatchTransaction;e?e.call(this,r):this.updateState(this.state.apply(r))};function s5(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),r.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(r.state)),t)for(let n in t)n=="class"?e.class+=" "+t[n]:n=="style"?e.style=(e.style?e.style+";":"")+t[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(t[n]))}),e.translate||(e.translate="no"),[Sp.node(0,r.state.doc.content.size,e)]}function o5(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:Sp.widget(r.state.selection.from,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function a5(r){return!r.someProp("editable",e=>e(r.state)===!1)}function qOe(r,e){let t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function l5(r){let e=Object.create(null);function t(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return r.someProp("nodeViews",t),r.someProp("markViews",t),e}function KOe(r,e){let t=0,n=0;for(let i in r){if(r[i]!=e[i])return!0;t++}for(let i in e)n++;return t!=n}function c5(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var JOe=Object.defineProperty,XZ=(r,e)=>{for(var t in e)JOe(r,t,{get:e[t],enumerable:!0})};function Z1(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var Q1=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Z1({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},VOe=class{constructor(){this.callbacks={}}on(r,e){return this.callbacks[r]||(this.callbacks[r]=[]),this.callbacks[r].push(e),this}emit(r,...e){const t=this.callbacks[r];return t&&t.forEach(n=>n.apply(this,e)),this}off(r,e){const t=this.callbacks[r];return t&&(e?this.callbacks[r]=t.filter(n=>n!==e):delete this.callbacks[r]),this}once(r,e){const t=(...n)=>{this.off(r,t),e.apply(this,n)};return this.on(r,t)}removeAllListeners(){this.callbacks={}}};function GOe(r,e){const t=new aZ(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}var ZZ=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&ZZ(n)}return r};function Cm(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return ZZ(t)}function Jy(r,e,t){if(r instanceof Xo||r instanceof le)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return le.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),Jy("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new LX({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?ff.fromSchema(l).parseSlice(Cm(r),t.parseOptions):ff.fromSchema(l).parse(Cm(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=ff.fromSchema(e);return t.slice?s.parseSlice(Cm(r),t.parseOptions).content:s.parse(Cm(r),t.parseOptions)}return Jy("",e,t)}function UA(r,e,t={},n={}){return Jy(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}function YOe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function XOe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function P_(r){return e=>XOe(e.$from,r)}function ye(r,e,t){return r.config[e]===void 0&&r.parent?ye(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?ye(r.parent,e,t):null}):r.config[e]}function A_(r){return r.map(e=>{const t={name:e.name,options:e.options,storage:e.storage},n=ye(e,"addExtensions",t);return n?[e,...A_(n())]:e}).flat(10)}function eC(r,e){const t=vS.fromSchema(e).serializeFragment(r),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(t),i.innerHTML}function QZ(r){return typeof r=="function"}function _t(r,e=void 0,...t){return QZ(r)?e?r.bind(e)(...t):r(...t):r}function ZOe(r={}){return Object.keys(r).length===0&&r.constructor===Object}function Vy(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function eQ(r){const e=[],{nodeExtensions:t,markExtensions:n}=Vy(r),i=[...t,...n],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=ye(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{e.push({type:d,name:h,attribute:{...s,...f}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=ye(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...s,...d};typeof h?.default=="function"&&(h.default=h.default()),h?.isRequired&&h?.default===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function tQ(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function Dv(r,e){return e.filter(t=>t.type===r.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,n)=>tQ(t,n),{})}function QOe(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function u5(r,e){return"style"in r?r:{...r,getAttrs:t=>{const n=r.getAttrs?r.getAttrs(t):r.attrs;if(n===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):QOe(t.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...n,...i}}}}function d5(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&ZOe(t)?!1:t!=null))}function nQ(r,e){var t;const n=eQ(r),{nodeExtensions:i,markExtensions:s}=Vy(r),o=(t=i.find(c=>ye(c,"topNode")))==null?void 0:t.name,a=Object.fromEntries(i.map(c=>{const u=n.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((y,S)=>{const w=ye(S,"extendNodeSchema",d);return{...y,...w?w(c):{}}},{}),f=d5({...h,content:_t(ye(c,"content",d)),marks:_t(ye(c,"marks",d)),group:_t(ye(c,"group",d)),inline:_t(ye(c,"inline",d)),atom:_t(ye(c,"atom",d)),selectable:_t(ye(c,"selectable",d)),draggable:_t(ye(c,"draggable",d)),code:_t(ye(c,"code",d)),whitespace:_t(ye(c,"whitespace",d)),linebreakReplacement:_t(ye(c,"linebreakReplacement",d)),defining:_t(ye(c,"defining",d)),isolating:_t(ye(c,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var S,w;return[y.name,{default:(S=y?.attribute)==null?void 0:S.default,validate:(w=y?.attribute)==null?void 0:w.validate}]}))}),p=_t(ye(c,"parseHTML",d));p&&(f.parseDOM=p.map(y=>u5(y,u)));const m=ye(c,"renderHTML",d);m&&(f.toDOM=y=>m({node:y,HTMLAttributes:Dv(y,u)}));const g=ye(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(s.map(c=>{const u=n.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((g,y)=>{const S=ye(y,"extendMarkSchema",d);return{...g,...S?S(c):{}}},{}),f=d5({...h,inclusive:_t(ye(c,"inclusive",d)),excludes:_t(ye(c,"excludes",d)),group:_t(ye(c,"group",d)),spanning:_t(ye(c,"spanning",d)),code:_t(ye(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y,S;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(S=g?.attribute)==null?void 0:S.validate}]}))}),p=_t(ye(c,"parseHTML",d));p&&(f.parseDOM=p.map(g=>u5(g,u)));const m=ye(c,"renderHTML",d);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:Dv(g,u)})),[c.name,f]}));return new LX({topNode:o,nodes:a,marks:l})}function eNe(r){const e=r.filter((t,n)=>r.indexOf(t)!==n);return Array.from(new Set(e))}function $_(r){return r.sort((t,n)=>{const i=ye(t,"priority")||100,s=ye(n,"priority")||100;return i>s?-1:i<s?1:0})}function R_(r){const e=$_(A_(r)),t=eNe(e.map(n=>n.name));return t.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${t.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function O_(r,e){const t=R_(r);return nQ(t,e)}function tNe(r,e){const t=O_(e),n=Xo.fromJSON(t,r);return eC(n.content,t)}function nNe(r,e){const t=O_(e),n=Cm(r);return ff.fromSchema(t).parse(n).toJSON()}function rQ(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function iQ(r,e){const t={from:0,to:r.content.size};return rQ(r,t,e)}function N_(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function rNe(r,e,t){const{blockSeparator:n=`

`,textSerializers:i={}}=t||{},s=O_(e),o=Xo.fromJSON(s,r);return iQ(o,{blockSeparator:n,textSerializers:{...N_(s),...i}})}function el(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}function sQ(r,e){const t=el(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Un(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function iNe(r,e){const t=Un(e,r.schema),{from:n,to:i}=r.selection,s=[];r.doc.nodesBetween(n,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function tC(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function sNe(r,e){const t=tC(typeof e=="string"?e:e.name,r.schema);return t==="node"?iNe(r,e):t==="mark"?sQ(r,e):{}}function oNe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function aNe(r){const e=oNe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function lNe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),aNe(n)}function __(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Fv(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:__(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function oQ(r,e,t={}){return r.find(n=>n.type===e&&Fv(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function h5(r,e,t={}){return!!oQ(r,e,t)}function nC(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!oQ([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&h5([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&h5([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function aQ(r,e,t){const n=[];return r===e?t.resolve(r).marks().forEach(i=>{const s=t.resolve(r),o=nC(s,i.type);o&&n.push({mark:i,...o})}):t.nodesBetween(r,e,(i,s)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),n}function EM(r,e){return e.nodes[r]||e.marks[r]||null}function Hb(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}var cNe=(r,e=500)=>{let t="";const n=r.parentOffset;return r.parent.nodesBetween(Math.max(0,n-e),n,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)==null?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";t+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,n-s))}),t};function WA(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?el(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Fv(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Fv(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function Gy(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?Un(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Fv(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}function uNe(r,e,t={}){if(!e)return Gy(r,null,t)||WA(r,null,t);const n=tC(e,r.schema);return n==="node"?Gy(r,e,t):n==="mark"?WA(r,e,t):!1}function f5(r,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===r.name):e}function p5(r,e){const{nodeExtensions:t}=Vy(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=_t(ye(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function D_(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(D_(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function lQ(r){return r instanceof St}function fu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function cQ(r,e=null){if(!e)return null;const t=gt.atStart(r),n=gt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?St.create(r,fu(0,i,s),fu(r.content.size,i,s)):St.create(r,fu(e,i,s),fu(e,i,s))}function dNe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof na||i instanceof uc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(gt.near(r.doc.resolve(o),t))}var hNe=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}},fNe=(r,e)=>{if(__(e))return e.exec(r);const t=e(r);if(!t)return null;const n=[t.text];return n.index=t.index,n.input=r,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(t.replaceWith)),n};function Sw(r){var e;const{editor:t,from:n,to:i,text:s,rules:o,plugin:a}=r,{view:l}=t;if(l.composing)return!1;const c=l.state.doc.resolve(n);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const d=cNe(c)+s;return o.forEach(h=>{if(u)return;const f=fNe(d,h.find);if(!f)return;const p=l.state.tr,m=Z1({state:l.state,transaction:p}),g={from:n-(f[0].length-s.length),to:i},{commands:y,chain:S,can:w}=new Q1({editor:t,state:m});h.handler({state:m,range:g,match:f,commands:y,chain:S,can:w})===null||!p.steps.length||(h.undoable&&p.setMeta(a,{transform:p,from:n,to:i,text:s}),l.dispatch(p),u=!0)}),u}function pNe(r){const{editor:e,rules:t}=r,n=new Qa({state:{init(){return null},apply(i,s,o){const a=i.getMeta(n);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=eC(le.from(u),o.schema);const{from:d}=l,h=d+u.length;Sw({editor:e,from:d,to:h,text:u,rules:t,plugin:n})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return Sw({editor:e,from:s,to:o,text:a,rules:t,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&Sw({editor:e,from:s.pos,to:s.pos,text:"",rules:t,plugin:n})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Sw({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:n}):!1}},isInputRules:!0});return n}function mNe(r){return Object.prototype.toString.call(r).slice(8,-1)}function ww(r){return mNe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function uQ(r,e){const t={...r};return ww(r)&&ww(e)&&Object.keys(e).forEach(n=>{ww(e[n])&&ww(r[n])?t[n]=uQ(r[n],e[n]):t[n]=e[n]}),t}var dQ=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{..._t(ye(this,"addOptions",{name:this.name}))||{}}}get storage(){return{..._t(ye(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>uQ(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},hQ=class fQ extends dQ{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new fQ(t)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===t.name))return!1;const l=o.find(c=>c?.type.name===t.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function gNe(r){return typeof r=="number"}var yNe=class{constructor(e){this.find=e.find,this.handler=e.handler}},xNe=(r,e,t)=>{if(__(e))return[...r.matchAll(e)];const n=e(r,t);return n?n.map(i=>{const s=[i.text];return s.index=i.index,s.input=r,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function SNe(r){const{editor:e,state:t,from:n,to:i,rule:s,pasteEvent:o,dropEvent:a}=r,{commands:l,chain:c,can:u}=new Q1({editor:e,state:t}),d=[];return t.doc.nodesBetween(n,i,(f,p)=>{var m,g,y,S,w;if((g=(m=f.type)==null?void 0:m.spec)!=null&&g.code||!(f.isText||f.isTextblock||f.isInline))return;const b=(w=(S=(y=f.content)==null?void 0:y.size)!=null?S:f.nodeSize)!=null?w:0,v=Math.max(n,p),C=Math.min(i,p+b);if(v>=C)return;const E=f.isText?f.text||"":f.textBetween(v-p,C-p,void 0,"");xNe(E,s.find,o).forEach(P=>{if(P.index===void 0)return;const $=v+P.index+1,A=$+P[0].length,O={from:t.tr.mapping.map($),to:t.tr.mapping.map(A)},_=s.handler({state:t,range:O,match:P,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(_)})}),d.every(f=>f!==null)}var bw=null,wNe=r=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)==null||e.setData("text/html",r),t};function bNe(r){const{editor:e,rules:t}=r;let n=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:h,rule:f,pasteEvt:p})=>{const m=u.tr,g=Z1({state:u,transaction:m});if(!(!SNe({editor:e,state:g,from:Math.max(d-1,0),to:h.b-1,rule:f,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return t.map(u=>new Qa({view(d){const h=p=>{var m;n=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,n&&(bw=e)},f=()=>{bw&&(bw=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(s=n===d.dom.parentElement,a=h,!s){const f=bw;f?.isEditable&&setTimeout(()=>{const p=f.state.selection;p&&f.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,h)=>{var f;const p=(f=h.clipboardData)==null?void 0:f.getData("text/html");return o=h,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,h,f)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!s,y=p.getMeta("applyPasteRules"),S=!!y;if(!m&&!g&&!S)return;if(S){let{text:v}=y;typeof v=="string"?v=v:v=eC(le.from(v),f.schema);const{from:C}=y,E=C+v.length,M=wNe(v);return l({rule:u,state:f,from:C,to:{b:E},pasteEvt:M})}const w=h.doc.content.findDiffStart(f.doc.content),b=h.doc.content.findDiffEnd(f.doc.content);if(!(!gNe(w)||!b||w===b.b))return l({rule:u,state:f,from:w,to:b,pasteEvt:o})}}))}var rC=class{constructor(r,e){this.splittableMarks=[],this.editor=e,this.extensions=R_(r),this.schema=nQ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((r,e)=>{const t={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:EM(e.name,this.schema)},n=ye(e,"addCommands",t);return n?{...r,...n()}:r},{})}get plugins(){const{editor:r}=this;return $_([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:r,type:EM(n.name,this.schema)},s=[],o=ye(n,"addKeyboardShortcuts",i);let a={};if(n.type==="mark"&&ye(n,"exitable",i)&&(a.ArrowRight=()=>hQ.handleExit({editor:r,mark:n})),o){const h=Object.fromEntries(Object.entries(o()).map(([f,p])=>[f,()=>p({editor:r})]));a={...a,...h}}const l=Hde(a);s.push(l);const c=ye(n,"addInputRules",i);if(f5(n,r.options.enableInputRules)&&c){const h=c();if(h&&h.length){const f=pNe({editor:r,rules:h}),p=Array.isArray(f)?f:[f];s.push(...p)}}const u=ye(n,"addPasteRules",i);if(f5(n,r.options.enablePasteRules)&&u){const h=u();if(h&&h.length){const f=bNe({editor:r,rules:h});s.push(...f)}}const d=ye(n,"addProseMirrorPlugins",i);if(d){const h=d();s.push(...h)}return s})}get attributes(){return eQ(this.extensions)}get nodeViews(){const{editor:r}=this,{nodeExtensions:e}=Vy(this.extensions);return Object.fromEntries(e.filter(t=>!!ye(t,"addNodeView")).map(t=>{const n=this.attributes.filter(a=>a.type===t.name),i={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:r,type:Un(t.name,this.schema)},s=ye(t,"addNodeView",i);if(!s)return[];const o=(a,l,c,u,d)=>{const h=Dv(a,n);return s()({node:a,view:l,getPos:c,decorations:u,innerDecorations:d,editor:r,extension:t,HTMLAttributes:h})};return[t.name,o]}))}get markViews(){const{editor:r}=this,{markExtensions:e}=Vy(this.extensions);return Object.fromEntries(e.filter(t=>!!ye(t,"addMarkView")).map(t=>{const n=this.attributes.filter(a=>a.type===t.name),i={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:r,type:el(t.name,this.schema)},s=ye(t,"addMarkView",i);if(!s)return[];const o=(a,l,c)=>{const u=Dv(a,n);return s()({mark:a,view:l,inline:c,editor:r,extension:t,HTMLAttributes:u,updateAttributes:d=>{D_e(a,r,d)}})};return[t.name,o]}))}setupExtensions(){const r=this.extensions;this.editor.extensionStorage=Object.fromEntries(r.map(e=>[e.name,e.storage])),r.forEach(e=>{var t;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:EM(e.name,this.schema)};e.type==="mark"&&((t=_t(ye(e,"keepOnSplit",n)))==null||t)&&this.splittableMarks.push(e.name);const i=ye(e,"onBeforeCreate",n),s=ye(e,"onCreate",n),o=ye(e,"onUpdate",n),a=ye(e,"onSelectionUpdate",n),l=ye(e,"onTransaction",n),c=ye(e,"onFocus",n),u=ye(e,"onBlur",n),d=ye(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};rC.resolve=R_;rC.sort=$_;rC.flatten=A_;var vNe={};XZ(vNe,{ClipboardTextSerializer:()=>mQ,Commands:()=>xQ,Delete:()=>SQ,Drop:()=>wQ,Editable:()=>bQ,FocusEvents:()=>kQ,Keymap:()=>CQ,Paste:()=>TQ,Tabindex:()=>EQ,focusEventsPluginKey:()=>vQ});var Ro=class pQ extends dQ{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new pQ(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},mQ=Ro.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Qa({key:new Jd("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=N_(t);return rQ(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),gQ={};XZ(gQ,{blur:()=>kNe,clearContent:()=>CNe,clearNodes:()=>TNe,command:()=>ENe,createParagraphNear:()=>MNe,cut:()=>INe,deleteCurrentNode:()=>PNe,deleteNode:()=>ANe,deleteRange:()=>$Ne,deleteSelection:()=>RNe,enter:()=>ONe,exitCode:()=>NNe,extendMarkRange:()=>_Ne,first:()=>DNe,focus:()=>zNe,forEach:()=>BNe,insertContent:()=>jNe,insertContentAt:()=>UNe,joinBackward:()=>qNe,joinDown:()=>HNe,joinForward:()=>KNe,joinItemBackward:()=>JNe,joinItemForward:()=>VNe,joinTextblockBackward:()=>GNe,joinTextblockForward:()=>YNe,joinUp:()=>WNe,keyboardShortcut:()=>ZNe,lift:()=>QNe,liftEmptyBlock:()=>e_e,liftListItem:()=>t_e,newlineInCode:()=>n_e,resetAttributes:()=>r_e,scrollIntoView:()=>i_e,selectAll:()=>s_e,selectNodeBackward:()=>o_e,selectNodeForward:()=>a_e,selectParentNode:()=>l_e,selectTextblockEnd:()=>c_e,selectTextblockStart:()=>u_e,setContent:()=>d_e,setMark:()=>f_e,setMeta:()=>p_e,setNode:()=>m_e,setNodeSelection:()=>g_e,setTextSelection:()=>y_e,sinkListItem:()=>x_e,splitBlock:()=>S_e,splitListItem:()=>w_e,toggleList:()=>b_e,toggleMark:()=>v_e,toggleNode:()=>k_e,toggleWrap:()=>C_e,undoInputRule:()=>T_e,unsetAllMarks:()=>E_e,unsetMark:()=>M_e,updateAttributes:()=>I_e,wrapIn:()=>P_e,wrapInList:()=>A_e});var kNe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),CNe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),TNe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=U$e(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},ENe=r=>e=>r(e),MNe=()=>({state:r,dispatch:e})=>uo(r,e),INe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new St(n.doc.resolve(Math.max(o-1,0)))),!0},PNe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1},ANe=r=>({tr:e,state:t,dispatch:n})=>{const i=Un(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},$Ne=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},RNe=()=>({state:r,dispatch:e})=>ho(r,e),ONe=()=>({commands:r})=>r.keyboardShortcut("Enter"),NNe=()=>({state:r,dispatch:e})=>fo(r,e),_Ne=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=el(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=nC(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=St.create(o,d.from,d.to);t.setSelection(h)}}return!0},DNe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function FNe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function F_(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var zNe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(F_()||FNe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!lQ(t.state.selection))return o(),!0;const a=cQ(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},BNe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),jNe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),LNe=r=>!("type"in r),UNe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{Jy(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=Jy(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((LNe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof le){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&dNe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},WNe=()=>({state:r,dispatch:e})=>po(r,e),HNe=()=>({state:r,dispatch:e})=>mo(r,e),qNe=()=>({state:r,dispatch:e})=>go(r,e),KNe=()=>({state:r,dispatch:e})=>yo(r,e),JNe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=eZ(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},VNe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=eZ(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},GNe=()=>({state:r,dispatch:e})=>xo(r,e),YNe=()=>({state:r,dispatch:e})=>So(r,e);function yQ(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function XNe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))F_()||yQ()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var ZNe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=XNe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0},QNe=(r,e={})=>({state:t,dispatch:n})=>{const i=Un(r,t.schema);return Gy(t,i,e)?wo(t,n):!1},e_e=()=>({state:r,dispatch:e})=>bo(r,e),t_e=r=>({state:e,dispatch:t})=>{const n=Un(r,e.schema);return vo(n)(e,t)},n_e=()=>({state:r,dispatch:e})=>ko(r,e);function m5(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var r_e=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=tC(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(s=Un(r,n.schema)),a==="mark"&&(o=el(r,n.schema)),i&&t.selection.ranges.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&t.setNodeMarkup(u,void 0,m5(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&t.addMark(u,u+c.nodeSize,o.create(m5(d.attrs,e)))})})}),!0):!1},i_e=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),s_e=()=>({tr:r,dispatch:e})=>{if(e){const t=new Au(r.doc);r.setSelection(t)}return!0},o_e=()=>({state:r,dispatch:e})=>Co(r,e),a_e=()=>({state:r,dispatch:e})=>To(r,e),l_e=()=>({state:r,dispatch:e})=>Eo(r,e),c_e=()=>({state:r,dispatch:e})=>Mo(r,e),u_e=()=>({state:r,dispatch:e})=>Io(r,e),d_e=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=UA(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function h_e(r,e,t){var n;const{selection:i}=e;let s=null;if(lQ(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var f_e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=el(r,n.schema);if(i)if(o){const c=sQ(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return h_e(n,t,l)},p_e=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),m_e=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=Un(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},g_e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=fu(r,0,n.content.size),s=yt.create(n,i);e.setSelection(s)}return!0},y_e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=St.atStart(n).from,a=St.atEnd(n).to,l=fu(i,o,a),c=fu(s,o,a),u=St.create(n,l,c);e.setSelection(u)}return!0},x_e=r=>({state:e,dispatch:t})=>{const n=Un(r,e.schema);return Po(n)(e,t)};function g5(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var S_e=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Hb(c,a.node().type.name,a.node().attrs);if(s instanceof yt&&s.node.isBlock)return!a.parentOffset||!Lb(o,a.pos)?!1:(n&&(r&&g5(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:YOe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=Lb(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Lb(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof St&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&g5(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},w_e=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=Un(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=le.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=le.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...Hb(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(le.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Se(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(St.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Hb(h,d.type.name,d.attrs),...e},m={...Hb(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!Lb(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},MM=(r,e)=>{const t=P_(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&ZX(r.doc,t.pos)&&r.join(t.pos),!0},IM=(r,e)=>{const t=P_(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&ZX(r.doc,n)&&r.join(n),!0},b_e=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=Un(r,o.schema),p=Un(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=P_(C=>p5(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(p5(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>MM(s,f)).command(()=>IM(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>MM(s,f)).command(()=>IM(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>MM(s,f)).command(()=>IM(s,f)).run()},v_e=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=el(r,n.schema);return WA(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},k_e=(r,e,t={})=>({state:n,commands:i})=>{const s=Un(r,n.schema),o=Un(e,n.schema),a=Gy(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},C_e=(r,e={})=>({state:t,commands:n})=>{const i=Un(r,t.schema);return Gy(t,i,e)?n.lift(i):n.wrapIn(i,e)},T_e=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},E_e=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},M_e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=el(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=nC(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},I_e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=tC(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(s=Un(r,n.schema)),a==="mark"&&(o=el(r,n.schema)),i&&t.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,h,f,p;t.selection.empty?n.doc.nodesBetween(c,u,(m,g)=>{s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m)}):n.doc.nodesBetween(c,u,(m,g)=>{g<c&&s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m),g>=c&&g<=u&&(s&&s===m.type&&t.setNodeMarkup(g,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const S=Math.max(g,c),w=Math.min(g+m.nodeSize,u);t.addMark(S,w,o.create({...y.attrs,...e}))}}))}),h&&(d!==void 0&&t.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(m=>{o===m.type&&t.addMark(f,p,o.create({...m.attrs,...e}))}))}),!0):!1},P_e=(r,e={})=>({state:t,dispatch:n})=>{const i=Un(r,t.schema);return Ao(i,e)(t,n)},A_e=(r,e={})=>({state:t,dispatch:n})=>{const i=Un(r,t.schema);return $o(i,e)(t,n)},xQ=Ro.create({name:"commands",addCommands(){return{...gQ}}}),SQ=Ro.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=GOe(r.before,[r,...e]);lNe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof xp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),wQ=Ro.create({name:"drop",addProseMirrorPlugins(){return[new Qa({key:new Jd("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),bQ=Ro.create({name:"editable",addProseMirrorPlugins(){return[new Qa({key:new Jd("editable"),props:{editable:()=>this.editor.options.editable}})]}}),vQ=new Jd("focusEvents"),kQ=Ro.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Qa({key:vQ,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),CQ=Ro.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:gt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return F_()||yQ()?s:i},addProseMirrorPlugins(){return[new Qa({key:new Jd("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=gt.atStart(e.doc).from,c=gt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!D_(t.doc))return;const h=t.tr,f=Z1({state:t,transaction:h}),{commands:p}=new Q1({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),TQ=Ro.create({name:"paste",addProseMirrorPlugins(){return[new Qa({key:new Jd("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),EQ=Ro.create({name:"tabindex",addProseMirrorPlugins(){return[new Qa({key:new Jd("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),$_e=class Th{constructor(e,t,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Th(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Th(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Th(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,n)=>{const i=t.isBlock&&!t.isTextblock,s=t.isAtom&&!t.isText,o=this.pos+n+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new Th(a,this.editor,i,i?t:null);i&&(l.actualDepth=this.depth+1),e.push(new Th(a,this.editor,i,i?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(t).length>0){const s=i.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==t[l])break}}else n=i;i=i.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(t);return this.children.forEach(o=>{n&&i.length>0||(o.node.type.name===e&&s.every(l=>t[l]===o.node.attrs[l])&&i.push(o),!(n&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,t,n))))}),i}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}},R_e=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function O_e(r,e,t){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),i}var N_e=class extends VOe{constructor(r={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(r),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:s})=>this.options.onDrop(n,i,s)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),t=cQ(e,this.options.autofocus);this.editorState=af.create({doc:e,schema:this.schema,selection:t||void 0}),this.options.element&&this.mount(this.options.element)}mount(r){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(r),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const r=this.editorView.dom;r?.editor&&delete r.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(r){console.warn("Failed to remove CSS element:",r)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=O_e(R_e,this.options.injectNonce))}setOptions(r={}){this.options={...this.options,...r},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(r,e=!0){this.setOptions({editable:r}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:r=>{this.editorState=r},dispatch:r=>{this.dispatchTransaction(r)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(r,e)=>{if(e==="state")return this.editorState;if(e in r)return Reflect.get(r,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(r,e){const t=QZ(e)?e(r,[...this.state.plugins]):[...this.state.plugins,r],n=this.state.reconfigure({plugins:t});return this.view.updateState(n),n}unregisterPlugin(r){if(this.isDestroyed)return;const e=this.state.plugins;let t=e;if([].concat(r).forEach(i=>{const s=typeof i=="string"?`${i}$`:i.key;t=t.filter(o=>!o.key.startsWith(s))}),e.length===t.length)return;const n=this.state.reconfigure({plugins:t});return this.view.updateState(n),n}createExtensionManager(){var r,e;const n=[...this.options.enableCoreExtensions?[bQ,mQ.configure({blockSeparator:(e=(r=this.options.coreExtensionOptions)==null?void 0:r.clipboardTextSerializer)==null?void 0:e.blockSeparator}),xQ,kQ,CQ,EQ,wQ,TQ,SQ].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new rC(n,this)}createCommandManager(){this.commandManager=new Q1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let r;try{r=UA(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(t=>t.name!=="collaboration"),this.createExtensionManager()}}),r=UA(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return r}createView(r){var e;this.editorView=new YZ(r,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const t=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(t),this.prependClass(),this.injectCSS();const n=this.view.dom;n.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(r){this.isCapturingTransaction=!0,r(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(r){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=r;return}r.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:t}=this.state.applyTransaction(r),n=!this.state.selection.eq(e.selection),i=t.includes(r),s=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:r,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:r,appendedTransactions:t.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:r});const o=t.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=o?.getMeta("focus"),l=o?.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),!(r.getMeta("preventUpdate")||!t.some(c=>c.docChanged)||s.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:r,appendedTransactions:t.slice(1)})}getAttributes(r){return sNe(this.state,r)}isActive(r,e){const t=typeof r=="string"?r:null,n=typeof r=="string"?e:r;return uNe(this.state,t,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return eC(this.state.doc.content,this.schema)}getText(r){const{blockSeparator:e=`

`,textSerializers:t={}}=r||{};return iQ(this.state.doc,{blockSeparator:e,textSerializers:{...N_(this.schema),...t}})}get isEmpty(){return D_(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var r,e;return(e=(r=this.editorView)==null?void 0:r.isDestroyed)!=null?e:!0}$node(r,e){var t;return((t=this.$doc)==null?void 0:t.querySelector(r,e))||null}$nodes(r,e){var t;return((t=this.$doc)==null?void 0:t.querySelectorAll(r,e))||null}$pos(r){const e=this.state.doc.resolve(r);return new $_e(e,this)}get $doc(){return this.$pos(0)}};function __e(r){return new hNe({find:r.find,handler:({state:e,range:t,match:n})=>{const i=_t(r.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:s}=e,o=n[n.length-1],a=n[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(aQ(t.from,t.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===r.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<t.to&&s.delete(u,t.to),c>t.from&&s.delete(t.from+l,c);const h=t.from+l+o.length;s.addMark(t.from+l,h,r.type.create(i||{})),s.removeStoredMark(r.type)}},undoable:r.undoable})}function D_e(r,e,t={}){const{state:n}=e,{doc:i,tr:s}=n,o=r;i.descendants((a,l)=>{const c=s.mapping.map(l),u=s.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(f=>{if(f!==o)return!1;d=f}),!d)return;let h=!1;if(Object.keys(t).forEach(f=>{t[f]!==d.attrs[f]&&(h=!0)}),h){const f=r.type.create({...r.attrs,...t});s.removeMark(c,u,r.type),s.addMark(c,u,f)}}),s.docChanged&&e.view.dispatch(s)}function F_e(r){return new yNe({find:r.find,handler:({state:e,range:t,match:n,pasteEvent:i})=>{const s=_t(r.getAttributes,void 0,n,i);if(s===!1||s===null)return null;const{tr:o}=e,a=n[n.length-1],l=n[0];let c=t.to;if(a){const u=l.search(/\S/),d=t.from+l.indexOf(a),h=d+a.length;if(aQ(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<t.to&&o.delete(h,t.to),d>t.from&&o.delete(t.from+u,d),c=t.from+u+a.length,o.addMark(t.from+u,c,r.type.create(s||{})),o.removeStoredMark(r.type)}}})}function z_e({textEditor:r,onEditLinkStart:e}){const t=ln(),n=ie(),i="rich-text-menu",[s,o]=k.useState(0);return k.useEffect(function(){function c(){o(u=>u+1)}r.on("update",c),r.on("selectionUpdate",c)},[r]),k.useEffect(()=>{function l(c){e&&zt(c)&&c.shiftKey&&c.key==="k"&&(c.preventDefault(),e())}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[e]),k.useMemo(()=>{function l(c,u){r.view&&(t("rich-text",{operation:c,source:i}),r.chain().focus()[u]().run())}return[{name:"bold",onSelect(){l("bold","toggleBold")}},{name:"italic",onSelect(){l("bold","toggleItalic")}},{name:"code",onSelect(){l("bold","toggleCode")}},e?{name:"link",onSelect(){e()}}:void 0,{name:"bulletList",onSelect(){l("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){l("bulletList","toggleHighlight")}}].filter(Boolean)},[r,t,e]).map(({name:l,attrs:c,onSelect:u})=>{const d=r.view?r.isActive(l,c):!1;return x.jsx(Mt,{title:n(`tool.rich-text-${l}`),"data-testid":`rich-text.${l}`,type:"icon",isActive:d,onPointerDown:Oe,onClick:u,role:"option","aria-pressed":d,children:x.jsx(be,{small:!0,icon:l})},l)})}function B_e({textEditor:r,value:e,onClose:t}){const n=z(),[i,s]=k.useState(e),o=ie(),a=k.useRef(null),l=ln(),c="rich-text-menu",u=i.startsWith("http")?i:`https://${i}`,d=g=>s(g),h=g=>{l("rich-text",{operation:"link-edit",source:c}),!g.startsWith("http://")&&!g.startsWith("https://")&&(g=`https://${g}`),r.chain().setLink({href:g}).run(),n.getInstanceState().isCoarsePointer?r.commands.blur():r.commands.focus(),t()},f=()=>{l("rich-text",{operation:"link-visit",source:c}),e_(u,"_blank"),t()},p=()=>{l("rich-text",{operation:"link-remove",source:c}),r.chain().unsetLink().focus().run(),t()},m=()=>t();return k.useEffect(()=>{a.current?.focus()},[i]),k.useEffect(()=>{s(e)},[e]),x.jsxs(x.Fragment,{children:[x.jsx(yp,{ref:a,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:i,onValueChange:d,onComplete:h,onCancel:m,placeholder:"example.com","aria-label":"example.com"}),x.jsx(et,{className:"tlui-rich-text__toolbar-link-visit",title:o("tool.rich-text-link-visit"),type:"icon",onPointerDown:Oe,onClick:f,disabled:!i,children:x.jsx(be,{small:!0,icon:"external-link"})}),x.jsx(et,{className:"tlui-rich-text__toolbar-link-remove",title:o("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:Oe,onClick:p,children:x.jsx(be,{small:!0,icon:"trash"})})]})}const j_e=In(function({children:e}){const t=z(),n=F("textEditor",()=>t.getRichTextEditor(),[t]);return t.getInstanceState().isCoarsePointer||!n?null:x.jsx(L_e,{textEditor:n,children:e})});function L_e({textEditor:r,children:e}){const{isEditingLink:t,onEditLinkStart:n,onEditLinkClose:i}=U_e(r),[s,o]=k.useState(null),a=k.useRef(),l=W_e(r),c=ie(),u=k.useCallback(()=>{if(t)return a.current;const d=window.getSelection();if(!s||!d||d.rangeCount===0||d.isCollapsed)return;const h=[];for(let p=0;p<d.rangeCount;p++){const m=d.getRangeAt(p);h.push(bX(m.getBoundingClientRect()))}const f=V.Common(h);return a.current=f,f},[s,t]);return k.useEffect(()=>{const d=({editor:h})=>o(h.state.selection);return r.on("selectionUpdate",d),d({editor:r}),()=>{r.off("selectionUpdate",d)}},[r]),x.jsx(p_,{className:"tlui-rich-text__toolbar",getSelectionBounds:u,isMousingDown:l,changeOnlyWhenYChanges:!0,label:c("tool.rich-text-toolbar-title"),children:e||(t?x.jsx(B_e,{textEditor:r,value:r.isActive("link")?r.getAttributes("link").href:"",onClose:i}):x.jsx(z_e,{textEditor:r,onEditLinkStart:n}))})}function U_e(r){const[e,t]=k.useState(!1);k.useEffect(()=>{if(!r){t(!1);return}const o=()=>{const a=r.isActive("link");t(a)};return r.view.dom.addEventListener("click",o),()=>{r.isInitialized&&r.view.dom.removeEventListener("click",o)}},[r,e]),k.useEffect(()=>{if(r&&r.isActive("link"))try{const{from:o,to:a}=nC(r.state.doc.resolve(r.state.selection.from),r.schema.marks.link);r.state.selection.empty&&r.commands.setTextSelection({from:o,to:a})}catch{}},[r,e]);const n=k.useCallback(()=>{t(!0)},[]),i=k.useCallback(()=>{t(!1)},[]),s=k.useCallback(()=>{if(t(!1),!r)return;const o=r.state.selection.from;r.commands.setTextSelection({from:o,to:o})},[r]);return{isEditingLink:e,onEditLinkStart:n,onEditLinkClose:s,onEditLinkCancel:i}}function W_e(r){const[e,t]=k.useState(!1);return k.useEffect(()=>{if(!r)return;const n=n1(({isPointing:l})=>{t(l)},16),i=()=>n({isPointing:!0}),s=()=>n({isPointing:!1}),o=["touchstart","pointerdown","mousedown"],a=["touchend","pointerup","mouseup"];return o.forEach(l=>{r.view.dom.addEventListener(l,i)}),a.forEach(l=>{document.body.addEventListener(l,s)}),()=>{o.forEach(l=>{r.isInitialized&&r.view.dom.removeEventListener(l,i)}),a.forEach(l=>{document.body.removeEventListener(l,s)})}},[r]),e}function H_e(){const r=z(),e=ie(),{orientation:t}=xS(),i=yX()?.get(Oi),s=sc({isDarkMode:r.user.getIsDarkMode()}),o=i?.type==="shared"?ot(s,i.value,"solid"):ot(s,"black","solid"),a=F("disable style panel",()=>r.isInAny("hand","zoom","eraser","laser"),[r]),l=k.useCallback(u=>{u||r.updateInstanceState({isChangingStyle:!1})},[r]),{StylePanel:c}=Sa();return c?x.jsxs(yd,{id:"mobile style menu",onOpenChange:l,children:[x.jsx(xd,{children:x.jsx(et,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--tl-color-muted-1)":o},title:e("style-panel.title"),disabled:a,children:x.jsx(be,{icon:a?"blob":i?.type==="mixed"?"mixed":"blob"})})}),x.jsx(Sd,{side:t==="horizontal"?"top":"right",align:"end",children:c&&x.jsx(c,{isMobile:!0})})]}):null}function q_e(){return x.jsxs(x.Fragment,{children:[x.jsx(J_e,{}),x.jsx(V_e,{}),x.jsx(G_e,{}),x.jsx(Y_e,{}),x.jsx(X_e,{}),x.jsx(Z_e,{}),x.jsx(Q_e,{}),x.jsx(e2e,{}),x.jsx(t2e,{}),x.jsx(n2e,{}),x.jsx(i2e,{}),x.jsx(r2e,{}),x.jsx(a2e,{}),x.jsx(u2e,{}),x.jsx(s2e,{}),x.jsx(c2e,{}),x.jsx(l2e,{}),x.jsx(o2e,{}),x.jsx(d2e,{}),x.jsx(h2e,{}),x.jsx(f2e,{}),x.jsx(p2e,{}),x.jsx(m2e,{}),x.jsx(g2e,{}),x.jsx(y2e,{}),x.jsx(x2e,{}),x.jsx(w2e,{}),x.jsx(S2e,{})]})}function K_e(r){const e=z(),t=r?.meta?.geo;return F("is tool selected",()=>{if(!r)return!1;const n=e.getCurrentToolId();return n==="geo"?t===e.getSharedStyles().getAsKnownValue(Vo):n===r.id},[e,r?.id,t])}function $t({tool:r}){const e=u_(),t=K_e(e[r]);return x.jsx(Hi,{toolId:r,isSelected:t})}function J_e(){return x.jsx($t,{tool:"select"})}function V_e(){return x.jsx($t,{tool:"hand"})}function G_e(){return x.jsx($t,{tool:"draw"})}function Y_e(){return x.jsx($t,{tool:"eraser"})}function X_e(){return x.jsx($t,{tool:"arrow"})}function Z_e(){return x.jsx($t,{tool:"text"})}function Q_e(){return x.jsx($t,{tool:"note"})}function e2e(){return x.jsx(Hi,{toolId:"asset"})}function t2e(){return x.jsx($t,{tool:"rectangle"})}function n2e(){return x.jsx($t,{tool:"ellipse"})}function r2e(){return x.jsx($t,{tool:"diamond"})}function i2e(){return x.jsx($t,{tool:"triangle"})}function s2e(){return x.jsx($t,{tool:"rhombus"})}function o2e(){return x.jsx($t,{tool:"heart"})}function a2e(){return x.jsx($t,{tool:"hexagon"})}function l2e(){return x.jsx($t,{tool:"cloud"})}function c2e(){return x.jsx($t,{tool:"star"})}function u2e(){return x.jsx($t,{tool:"oval"})}function d2e(){return x.jsx($t,{tool:"x-box"})}function h2e(){return x.jsx($t,{tool:"check-box"})}function f2e(){return x.jsx($t,{tool:"arrow-left"})}function p2e(){return x.jsx($t,{tool:"arrow-up"})}function m2e(){return x.jsx($t,{tool:"arrow-down"})}function g2e(){return x.jsx($t,{tool:"arrow-right"})}function y2e(){return x.jsx($t,{tool:"line"})}function x2e(){return x.jsx($t,{tool:"highlight"})}function S2e(){return x.jsx($t,{tool:"frame"})}function w2e(){return x.jsx($t,{tool:"laser"})}const PM=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function AM(r,e,t,n){r.addEventListener?r.addEventListener(e,t,n):r.attachEvent&&r.attachEvent("on".concat(e),t)}function Kp(r,e,t,n){r.removeEventListener?r.removeEventListener(e,t,n):r.detachEvent&&r.detachEvent("on".concat(e),t)}function MQ(r,e){const t=e.slice(0,e.length-1);for(let n=0;n<t.length;n++)t[n]=r[t[n].toLowerCase()];return t}function IQ(r){typeof r!="string"&&(r=""),r=r.replace(/\s/g,"");const e=r.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function b2e(r,e){const t=r.length>=e.length?r:e,n=r.length>=e.length?e:r;let i=!0;for(let s=0;s<t.length;s++)n.indexOf(t[s])===-1&&(i=!1);return i}const Yy={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":PM?173:189,"=":PM?61:187,";":PM?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},io={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},Tm={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Yn={16:!1,18:!1,17:!1,91:!1},dn={};for(let r=1;r<20;r++)Yy["f".concat(r)]=111+r;let Lt=[],ny=null,PQ="all";const Da=new Map,wp=r=>Yy[r.toLowerCase()]||io[r.toLowerCase()]||r.toUpperCase().charCodeAt(0),v2e=r=>Object.keys(Yy).find(e=>Yy[e]===r),k2e=r=>Object.keys(io).find(e=>io[e]===r);function AQ(r){PQ=r||"all"}function Xy(){return PQ||"all"}function C2e(){return Lt.slice(0)}function T2e(){return Lt.map(r=>v2e(r)||k2e(r)||String.fromCharCode(r))}function E2e(){const r=[];return Object.keys(dn).forEach(e=>{dn[e].forEach(t=>{let{key:n,scope:i,mods:s,shortcut:o}=t;r.push({scope:i,shortcut:o,mods:s,keys:n.split("+").map(a=>wp(a))})})}),r}function M2e(r){const e=r.target||r.srcElement,{tagName:t}=e;let n=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(n=!1),n}function I2e(r){return typeof r=="string"&&(r=wp(r)),Lt.indexOf(r)!==-1}function P2e(r,e){let t,n;r||(r=Xy());for(const i in dn)if(Object.prototype.hasOwnProperty.call(dn,i))for(t=dn[i],n=0;n<t.length;)t[n].scope===r?t.splice(n,1).forEach(o=>{let{element:a}=o;return z_(a)}):n++;Xy()===r&&AQ(e||"all")}function A2e(r){let e=r.keyCode||r.which||r.charCode;r.key&&r.key.toLowerCase()==="capslock"&&(e=wp(r.key));const t=Lt.indexOf(e);if(t>=0&&Lt.splice(t,1),r.key&&r.key.toLowerCase()==="meta"&&Lt.splice(0,Lt.length),(e===93||e===224)&&(e=91),e in Yn){Yn[e]=!1;for(const n in io)io[n]===e&&(Fs[n]=!1)}}function $Q(r){if(typeof r>"u")Object.keys(dn).forEach(i=>{Array.isArray(dn[i])&&dn[i].forEach(s=>vw(s)),delete dn[i]}),z_(null);else if(Array.isArray(r))r.forEach(i=>{i.key&&vw(i)});else if(typeof r=="object")r.key&&vw(r);else if(typeof r=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];let[i,s]=t;typeof i=="function"&&(s=i,i=""),vw({key:r,scope:i,method:s,splitKey:"+"})}}const vw=r=>{let{key:e,scope:t,method:n,splitKey:i="+"}=r;IQ(e).forEach(o=>{const a=o.split(i),l=a.length,c=a[l-1],u=c==="*"?"*":wp(c);if(!dn[u])return;t||(t=Xy());const d=l>1?MQ(io,a):[],h=[];dn[u]=dn[u].filter(f=>{const m=(n?f.method===n:!0)&&f.scope===t&&b2e(f.mods,d);return m&&h.push(f.element),!m}),h.forEach(f=>z_(f))})};function y5(r,e,t,n){if(e.element!==n)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const s in Yn)Object.prototype.hasOwnProperty.call(Yn,s)&&(!Yn[s]&&e.mods.indexOf(+s)>-1||Yn[s]&&e.mods.indexOf(+s)===-1)&&(i=!1);(e.mods.length===0&&!Yn[16]&&!Yn[18]&&!Yn[17]&&!Yn[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Lt),e.method(r,e)===!1&&(r.preventDefault?r.preventDefault():r.returnValue=!1,r.stopPropagation&&r.stopPropagation(),r.cancelBubble&&(r.cancelBubble=!0)))}}function x5(r,e){const t=dn["*"];let n=r.keyCode||r.which||r.charCode;if(r.key&&r.key.toLowerCase()==="capslock"||!Fs.filter.call(this,r))return;if((n===93||n===224)&&(n=91),Lt.indexOf(n)===-1&&n!==229&&Lt.push(n),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const l=Tm[a];r[a]&&Lt.indexOf(l)===-1?Lt.push(l):!r[a]&&Lt.indexOf(l)>-1?Lt.splice(Lt.indexOf(l),1):a==="metaKey"&&r[a]&&(Lt=Lt.filter(c=>c in Tm||c===n))}),n in Yn){Yn[n]=!0;for(const a in io)if(Object.prototype.hasOwnProperty.call(io,a)){const l=Tm[io[a]];Fs[a]=r[l]}if(!t)return}for(const a in Yn)Object.prototype.hasOwnProperty.call(Yn,a)&&(Yn[a]=r[Tm[a]]);r.getModifierState&&!(r.altKey&&!r.ctrlKey)&&r.getModifierState("AltGraph")&&(Lt.indexOf(17)===-1&&Lt.push(17),Lt.indexOf(18)===-1&&Lt.push(18),Yn[17]=!0,Yn[18]=!0);const i=Xy();if(t)for(let a=0;a<t.length;a++)t[a].scope===i&&(r.type==="keydown"&&t[a].keydown||r.type==="keyup"&&t[a].keyup)&&y5(r,t[a],i,e);if(!(n in dn))return;const s=dn[n],o=s.length;for(let a=0;a<o;a++)if((r.type==="keydown"&&s[a].keydown||r.type==="keyup"&&s[a].keyup)&&s[a].key){const l=s[a],{splitKey:c}=l,u=l.key.split(c),d=[];for(let h=0;h<u.length;h++)d.push(wp(u[h]));d.sort().join("")===Lt.sort().join("")&&y5(r,l,i,e)}}function Fs(r,e,t){Lt=[];const n=IQ(r);let i=[],s="all",o=document,a=0,l=!1,c=!0,u="+",d=!1,h=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(h=!0)),typeof e=="string"&&(s=e),h&&$Q(r,s);a<n.length;a++)r=n[a].split(u),i=[],r.length>1&&(i=MQ(io,r)),r=r[r.length-1],r=r==="*"?"*":wp(r),r in dn||(dn[r]=[]),dn[r].push({keyup:l,keydown:c,scope:s,mods:i,shortcut:n[a],method:t,key:n[a],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Da.has(o)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return x5(m,o)},p=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;x5(m,o),A2e(m)};Da.set(o,{keydownListener:f,keyupListenr:p,capture:d}),AM(o,"keydown",f,d),AM(o,"keyup",p,d)}if(!ny){const f=()=>{Lt=[]};ny={listener:f,capture:d},AM(window,"focus",f,d)}}}function $2e(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(dn).forEach(t=>{dn[t].filter(i=>i.scope===e&&i.shortcut===r).forEach(i=>{i&&i.method&&i.method()})})}function z_(r){const e=Object.values(dn).flat();if(e.findIndex(n=>{let{element:i}=n;return i===r})<0){const{keydownListener:n,keyupListenr:i,capture:s}=Da.get(r)||{};n&&i&&(Kp(r,"keyup",i,s),Kp(r,"keydown",n,s),Da.delete(r))}if((e.length<=0||Da.size<=0)&&(Object.keys(Da).forEach(i=>{const{keydownListener:s,keyupListenr:o,capture:a}=Da.get(i)||{};s&&o&&(Kp(i,"keyup",o,a),Kp(i,"keydown",s,a),Da.delete(i))}),Da.clear(),Object.keys(dn).forEach(i=>delete dn[i]),ny)){const{listener:i,capture:s}=ny;Kp(window,"focus",i,s),ny=null}}const $M={getPressedKeyString:T2e,setScope:AQ,getScope:Xy,deleteScope:P2e,getPressedKeyCodes:C2e,getAllKeyCodes:E2e,isPressed:I2e,filter:M2e,trigger:$2e,unbind:$Q,keyMap:Yy,modifier:io,modifierMap:Tm};for(const r in $M)Object.prototype.hasOwnProperty.call($M,r)&&(Fs[r]=$M[r]);if(typeof window<"u"){const r=window.hotkeys;Fs.noConflict=e=>(e&&window.hotkeys===Fs&&(window.hotkeys=r),Fs),window.hotkeys=Fs}const S5=["copy","cut","paste","asset"];function R2e(){const r=z(),e=Ss(),t=wa(),n=u_(),i=F("is focused",()=>r.getInstanceState().isFocused,[r]);k.useEffect(()=>{if(!i)return;const s=new Array,o=r.getContainer(),a=(c,u)=>{Fs(c,{element:o.ownerDocument.body},u),s.push(()=>{Fs.unbind(c,u)})},l=(c,u)=>{Fs(c,{element:o.ownerDocument.body,keyup:!0,keydown:!1},u),s.push(()=>{Fs.unbind(c,u)})};for(const c of Object.values(t))c.kbd&&(e&&!c.readonlyOk||S5.includes(c.id)||a(w5(c.kbd),u=>{Em(r)&&!c.isRequiredA11yAction||(Oe(u),c.onSelect("kbd"))}));for(const c of Object.values(n))!c.kbd||!c.readonlyOk&&r.getIsReadonly()||S5.includes(c.id)||a(w5(c.kbd),u=>{Em(r)||(Oe(u),c.onSelect("kbd"))});return a(",",c=>{if(Em(r)||r.inputs.keys.has("Comma"))return;Oe(c),r.focus(),r.inputs.keys.add("Comma");const{x:u,y:d,z:h}=r.inputs.currentPagePoint,f=r.pageToScreen({x:u,y:d}),p={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:zt(c),pointerId:0,button:0,isPen:r.getInstanceState().isPenMode,target:"canvas"};r.dispatch(p)}),l(",",c=>{if(Em(r)||!r.inputs.keys.has("Comma"))return;r.inputs.keys.delete("Comma");const{x:u,y:d,z:h}=r.inputs.currentScreenPoint,f={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:zt(c),pointerId:0,button:0,isPen:r.getInstanceState().isPenMode,target:"canvas"};r.dispatch(f)}),()=>{s.forEach(c=>c())}},[t,n,e,r,i])}function Em(r){return r.menus.hasAnyOpenMenus()||r.getEditingShapeId()!==null||r.getCrashingError()||!r.user.getAreKeyboardShortcutsEnabled()}function w5(r){return O2e(r).map(e=>{let t="";const n=e.includes("!"),i=e.includes("?"),s=e.includes("$"),o=e.replace(/[!?$]/g,"");return n&&i&&s?t=`cmd+shift+alt+${o},ctrl+shift+alt+${o}`:n&&s?t=`cmd+shift+${o},ctrl+shift+${o}`:i&&s?t=`cmd+alt+${o},ctrl+alt+${o}`:i&&n?t=`shift+alt+${o}`:n?t=`shift+${o}`:i?t=`alt+${o}`:s?t=`cmd+${o},ctrl+${o}`:t=o,t}).join(",")}function O2e(r){typeof r!="string"&&(r=""),r=r.replace(/\s/g,"");const e=r.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}const N2e=k.createContext(!1),_2e={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function D2e({children:r,orientation:e,sizingParentClassName:t,minItems:n,minSizePx:i,maxItems:s,maxSizePx:o}){const a=z(),l=Ud(),c=Jn(),u=ie(),d=k.useRef([]),[h,f]=k.useState(!1),p=k.useRef(null),[m,g]=k.useState(null),[y,S]=k.useState(null),[w,b]=k.useState(!1),v=qo(()=>{if(!p.current)return;const M=e==="horizontal"?"offsetWidth":"offsetHeight",P=A(p.current.children),$=m?A(m.children):null;function A(G){const ce=[];for(const ae of G)ae.classList.contains("tlui-main-toolbar__group")?ce.push({type:"group",items:A(ae.children),element:ae}):ae.hasAttribute("data-radix-popper-content-wrapper")||ce.push({type:"item",element:ae});return ce}const _=b5(p.current,t)[M],I=Math.floor(oo(_,[i,o],[n,s],!0));let R=0,B=null,U=!1;const H=[];function L(G,ce){ce&&se(G.length===ce.length);let ae=!1,ge=!1;for(let De=0;De<G.length;De++){const Ne=G[De],ne=ce?.[De];if(Ne.type==="item"){const ue=Ne.element.getAttribute("data-value")===y;let ze;y?ze=R<I||ue:ze=R<=I;const xe=R>=I;ae||=ze,ge||=xe,kw(Ne.element,"data-toolbar-visible",ze?"true":"false"),ne&&(se(ne.type==="item"),kw(ne.element,"data-toolbar-visible",xe?"true":"false")),xe&&Ne.element.getAttribute("aria-pressed")==="true"&&(B=Ne.element.getAttribute("data-value")),ze&&Ne.element.tagName==="BUTTON"&&H.push(Ne.element),!xe&&ue&&(U=!0),R++}else{let ue,ze;ne?(se(ne.type==="group"),ze=ne,ue=L(Ne.items,ze.items)):ue=L(Ne.items,null),ae||=ue.didShowAnyInMain,ge||=ue.didShowAnyInOverflow,kw(Ne.element,"data-toolbar-visible",ue.didShowAnyInMain?"true":"false"),ze&&kw(ze.element,"data-toolbar-visible",ue.didShowAnyInOverflow?"true":"false")}}return{didShowAnyInMain:ae,didShowAnyInOverflow:ge}}const{didShowAnyInOverflow:X}=L(P,$);b(X),B?S(B):U&&S(null),d.current=H});k.useLayoutEffect(()=>{v()}),k.useLayoutEffect(()=>{if(!p.current)return;const M=new MutationObserver(v);M.observe(p.current,{childList:!0,subtree:!0,attributes:!0,characterData:!0});const P=b5(p.current,t),$=new ResizeObserver(v);return $.observe(P),()=>{M.disconnect(),$.disconnect()}},[v,t]),k.useEffect(()=>{if(!a.options.enableToolbarKeyboardShortcuts)return;function M(P){if(Em(a)||dq(!0)||P.ctrlKey||P.metaKey||P.altKey||P.shiftKey)return;const $=_2e[P.key];typeof $=="number"&&(Oe(P),d.current[$]?.click())}return document.addEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)}},[a]);const C="toolbar overflow",E=e==="horizontal"?Kd:a_;return x.jsx(x.Fragment,{children:x.jsxs(_i,{orientation:e,className:oe("tlui-main-toolbar__tools",{"tlui-main-toolbar__tools__mobile":c<an.TABLET_SM}),label:u("tool-panel.title"),children:[x.jsx(E,{id:`${l}_main`,ref:p,children:x.jsx(Ni,{type:"toolbar",sourceId:"toolbar",children:r})}),w&&x.jsx(N2e.Provider,{value:!0,children:x.jsxs(yd,{id:C,open:h,onOpenChange:f,children:[x.jsx(xd,{children:x.jsx(Mt,{title:u("tool-panel.more"),type:"tool",className:"tlui-main-toolbar__overflow","data-testid":"tools.more-button",children:x.jsx(be,{icon:e==="horizontal"?"chevron-up":"chevron-right"})})}),x.jsx(Sd,{side:e==="horizontal"?"top":"right",align:e==="horizontal"?"center":"end",children:x.jsx(_i,{orientation:"grid",className:"tlui-main-toolbar__overflow-content",ref:g,"data-testid":"tools.more-content",label:u("tool-panel.more"),id:`${l}_more`,onClick:()=>{ui.deleteOpenMenu(C,a.contextId),f(!1)},children:x.jsx(Ni,{type:"toolbar-overflow",sourceId:"toolbar",children:r})})})]})})]})})}function b5(r,e){let t=r;for(;t;){if(t.classList.contains(e))return t;t=t.parentElement}throw new Error("Could not find parent with class name "+e)}function kw(r,e,t){r.getAttribute(e)!==t&&r.setAttribute(e,t)}function F2e({activeToolId:r}){const e=z(),t=Jn(),n=ie(),i=wa(),s=F("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),o=F("current tool",()=>e.getCurrentTool(),[e]);if(!r||!o.isLockable)return null;const a=i["toggle-tool-lock"],l=a?.kbd?`${n("action.toggle-tool-lock")} ${kv(a.kbd)}`:n("action.toggle-tool-lock");return x.jsx(K1,{content:l,children:x.jsx(et,{type:"normal","data-testid":"tool-lock",className:oe("tlui-main-toolbar__lock-button",{"tlui-main-toolbar__lock-button__mobile":t<an.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!s}),children:x.jsx(be,{icon:s?"lock":"unlock",small:!0})})})}const z2e=k.memo(function({children:e,orientation:t="horizontal",minItems:n=4,minSizePx:i=310,maxItems:s=8,maxSizePx:o=470}){const a=z(),l=ie(),c=Jn(),u=Ss(),d=F("current tool id",()=>a.getCurrentToolId(),[a]),h=k.useRef(null);ya(h);const{ActionsMenu:f,QuickActions:p}=Sa(),m=a.options.actionShortcutsLocation==="menu"?!1:a.options.actionShortcutsLocation==="toolbar"?!0:c<an.TABLET;return x.jsx(H1,{orientation:t,tooltipSide:t==="horizontal"?"top":"right",children:x.jsx("div",{ref:h,className:oe("tlui-main-toolbar",`tlui-main-toolbar--${t}`),children:x.jsxs("div",{className:"tlui-main-toolbar__inner",children:[x.jsxs("div",{className:"tlui-main-toolbar__left",children:[!u&&x.jsxs("div",{className:"tlui-main-toolbar__extras",children:[m&&x.jsxs(_i,{orientation:t,className:"tlui-main-toolbar__extras__controls",label:l("actions-menu.title"),children:[p&&x.jsx(p,{}),f&&x.jsx(f,{})]}),x.jsx(F2e,{activeToolId:d})]}),x.jsx(D2e,{orientation:t,sizingParentClassName:"tlui-main-toolbar",minItems:n,maxItems:s,minSizePx:i,maxSizePx:o,children:e??x.jsx(q_e,{})})]}),c<an.TABLET_SM&&!u&&x.jsx("div",{className:"tlui-main-toolbar__tools tlui-main-toolbar__mobile-style-panel",children:x.jsx(H_e,{})})]})})})}),B2e=In(function({videoShapeId:e,onEditAltTextStart:t}){const n=z(),i=ln(),s=ie(),o="video-toolbar",a=n.getIsReadonly(),l=wa(),c=k.useCallback(()=>l["video-replace"].onSelect("video-toolbar"),[l]),u=k.useCallback(()=>l["download-original"].onSelect("video-toolbar"),[l]),d=F("altText",()=>n.getShape(e).props.altText,[n,e]);return x.jsxs(x.Fragment,{children:[!a&&x.jsx(et,{type:"icon",title:s("tool.replace-media"),onClick:c,"data-testid":"tool.video-replace",children:x.jsx(be,{small:!0,icon:"tool-media"})}),x.jsx(et,{type:"icon",title:s("action.download-original"),onClick:u,"data-testid":"tool.video-download",children:x.jsx(be,{small:!0,icon:"download"})}),(d||!a)&&x.jsx(Mt,{type:"icon",isActive:!!d,title:s("tool.media-alt-text"),"data-testid":"tool.video-alt-text",onClick:()=>{i("alt-text-start",{source:o}),t()},children:x.jsx(be,{small:!0,icon:"alt"})})]})}),j2e=In(function({children:e}){const t=z(),n=F("videoShape",()=>{const o=t.getOnlySelectedShape();return!o||o.type!=="video"?null:o.id},[t]),i=t.isInAny("select.idle","select.pointing_shape"),s=F("locked",()=>n?t.getShape(n)?.isLocked:!1,[t,n]);return!n||!i||s?null:x.jsx(L2e,{videoShapeId:n,children:e},n)});function L2e({children:r,videoShapeId:e}){const t=z(),n=ie(),[i,s]=k.useState(!1),o=k.useCallback(()=>s(!0),[]),a=k.useCallback(()=>s(!1),[]),l=k.useCallback(()=>{const c=t.getSelectionScreenBounds();if(c)return new V(c.x,c.y,c.width,0)},[t]);return x.jsx(p_,{className:"tlui-video__toolbar",getSelectionBounds:l,label:n("tool.video-toolbar-title"),children:r||(i?x.jsx(vX,{shapeId:e,onClose:a,source:"video-toolbar"}):x.jsx(B2e,{videoShapeId:e,onEditAltTextStart:o}))})}function U2e(){const r=ie();return x.jsxs("div",{className:oe("tlui-offline-indicator"),children:[r("status.offline"),x.jsx(ta,{label:r("status.offline"),icon:"status-offline",small:!0})]})}function W2e({maxWidth:r=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:n=12,squeezeAmount:i=52,children:s}){const o=k.useRef(null),a=Jn(),l=k.useCallback(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),f=u.offsetWidth,p=d.offsetWidth,m=h.offsetWidth,g=c.offsetWidth-e;let y=(f-g)/2;f%2!==0&&(y-=.5);const S=p+n,w=c.offsetLeft,b=Math.min(f-m-p-2*n,r),v=Math.max(y,S)-w;h.offsetWidth>t&&a<=6?c.style.setProperty("max-width",b-i+"px"):c.style.setProperty("max-width",b+"px"),c.style.setProperty("transform",`translate(${v}px, 0px)`)},[a,e,n,r,i,t]);return k.useLayoutEffect(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(l);return f.observe(d),f.observe(h),f.observe(u),f.observe(c),l(),()=>{f.disconnect()}},[l]),k.useLayoutEffect(()=>{l()}),x.jsx("div",{ref:o,className:"tlui-top-panel__container",children:s})}function H2e(){const r=EMe()==="offline";return x.jsx(W2e,{children:r&&x.jsx(U2e,{})})}function q2e(){return x.jsxs(x.Fragment,{children:[x.jsx(K,{actionId:"zoom-in",noClose:!0}),x.jsx(K,{actionId:"zoom-out",noClose:!0}),x.jsx(WQ,{}),x.jsx(HQ,{}),x.jsx(qQ,{})]})}const K2e=k.memo(function({children:e}){const t=Pn(),[n,i]=Ya("zoom menu"),s=e??x.jsx(q2e,{});return x.jsxs(yO,{dir:"ltr",open:n,onOpenChange:i,modal:!1,children:[x.jsx(J2e,{}),x.jsx(Zk,{container:t,children:x.jsx(SO,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:x.jsx(Ni,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),J2e=()=>{const r=z(),e=Jn(),t=F("zoom",()=>r.getZoomLevel(),[r]),n=ie(),i=k.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]),s=`${Math.floor(t*100)}%`;return x.jsx(Mt,{asChild:!0,type:"icon","aria-label":`${n("navigation-zone.zoom")}  ${s}`,title:`${n("navigation-zone.zoom")}  ${s}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:i,children:x.jsx(xO,{dir:"ltr",children:e<an.MOBILE?null:x.jsx("span",{style:{flexGrow:0,textAlign:"center"},children:s})})})},RQ=k.createContext(null);function V2e({overrides:r={},children:e}){const t=hp(r),n=j1();return x.jsx(RQ.Provider,{value:k.useMemo(()=>({ContextMenu:lPe,ActionsMenu:oPe,HelpMenu:null,ZoomMenu:K2e,MainMenu:GPe,Minimap:sAe,StylePanel:HAe,PageMenu:cAe,NavigationPanel:aAe,Toolbar:z2e,RichTextToolbar:j_e,ImageToolbar:c$e,VideoToolbar:j2e,KeyboardShortcutsDialog:UY,QuickActions:fAe,HelperButtons:NPe,DebugPanel:bPe,DebugMenu:wPe,MenuPanel:MPe,SharePanel:n?wAe:null,CursorChatBubble:n?dPe:null,TopPanel:n?H2e:null,Dialogs:PPe,Toasts:VAe,A11y:lMe,FollowingIndicator:TPe,...t}),[t,n]),children:e})}function Sa(){const r=k.useContext(RQ);if(!r)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return r}const OQ=k.createContext(null);function NQ(r,e){return(e.isShapeOfType(r,"image")||e.isShapeOfType(r,"video"))&&!!r.props.assetId}function G2e(r){return Object.fromEntries(r.map(e=>[e.id,e]))}function Cw(r,e){if(r.getSelectedShapes().length===0)return r.getDocumentSettings().name||e}function Y2e({overrides:r,children:e}){const t=Sn(),n=j1(),i=c_(),s=Sa(),o=ln(),a=_1(),l=ie(),c=i.msg("document.default-name"),u=k.useMemo(()=>{const d=t;if(!d)return{};function h(){return d.isIn("select")||(d.complete(),d.setCurrentTool("select")),!1}function f(){return d.isIn("select")&&d.getSelectedShapeIds().length>0}function p(y){if(!f()||h())return;d.markHistoryStoppingPoint("resize shapes");const S=d.getSelectedShapeIds();S.length!==0&&d.run(()=>{S.map(b=>d.getShape(b)).filter(Boolean).forEach(b=>{d.resizeShape(b.id,new T(y,y),{scaleOrigin:d.getSelectionPageBounds()?.center})})})}const m=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(y){f()&&(h()||(o("edit-link",{source:y}),d.markHistoryStoppingPoint("edit-link"),i.addDialog({component:yMe})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(y){o("insert-embed",{source:y}),i.addDialog({component:MY})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(y){o("open-kbd-shortcuts",{source:y}),i.addDialog({component:s.KeyboardShortcutsDialog??UY})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(y){o("insert-media",{source:y}),i.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(y){o("undo",{source:y}),d.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(y){o("redo",{source:y}),d.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(y){let S=d.getSelectedShapeIds();S.length===0&&(S=Array.from(d.getCurrentPageShapeIds().values())),S.length!==0&&(o("export-as",{format:"svg",source:y}),i.exportAs(S,{format:"svg",name:Cw(d,c)}))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(y){let S=d.getSelectedShapeIds();S.length===0&&(S=Array.from(d.getCurrentPageShapeIds().values())),S.length!==0&&(o("export-as",{format:"png",source:y}),i.exportAs(S,{format:"png",name:Cw(d,c)}))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(y){let S=d.getSelectedShapeIds();S.length===0&&(S=Array.from(d.getCurrentPageShapeIds().values())),S.length!==0&&(o("export-all-as",{format:"svg",source:y}),i.exportAs(Array.from(d.getCurrentPageShapeIds()),{format:"svg",name:Cw(d,c)}))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(y){const S=Array.from(d.getCurrentPageShapeIds().values());S.length!==0&&(o("export-all-as",{format:"png",source:y}),i.exportAs(S,{format:"png",name:Cw(d,c)}))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(y){let S=d.getSelectedShapeIds();S.length===0&&(S=Array.from(d.getCurrentPageShapeIds().values())),S.length!==0&&(o("copy-as",{format:"svg",source:y}),i.copyAs(S,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(y){let S=d.getSelectedShapeIds();S.length===0&&(S=Array.from(d.getCurrentPageShapeIds().values())),S.length!==0&&(o("copy-as",{format:"png",source:y}),i.copyAs(S,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(y){f()&&(h()||(o("toggle-auto-size",{source:y}),d.markHistoryStoppingPoint("toggling auto size"),d.run(()=>{const S=d.getSelectedShapes().filter(w=>d.isShapeOfType(w,"text")&&w.props.autoSize===!1);d.updateShapes(S.map(w=>({id:w.id,type:w.type,props:{...w.props,w:8,autoSize:!0}}))),wt(d,S.map(w=>w.id))})))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(y){o("open-embed-link",{source:y});const S=d.getSelectedShapeIds(),w="No embed shapes selected";if(S.length!==1){console.error(w);return}const b=d.getShape(S[0]);if(!b||!d.isShapeOfType(b,"embed")){console.error(w);return}e_(b.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(y){if(d.root.getCurrent()?.id!=="zoom"&&(o("zoom-tool",{source:y}),!(d.inputs.shiftKey||d.inputs.ctrlKey))){const S=d.root.getCurrent();S&&S.getCurrent()?.id==="idle"&&d.setCurrentTool("zoom",{onInteractionEnd:S.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",async onSelect(y){if(!f()||h())return;o("convert-to-bookmark",{source:y});const S=d.getSelectedShapes(),w=d.markHistoryStoppingPoint("convert shapes to bookmark"),b=[];for(const v of S){if(!v||!d.isShapeOfType(v,"embed")||!v.props.url)continue;const C=d.getShapePageBounds(v)?.center;C&&(d.deleteShapes([v.id]),b.push(kY(d,{url:v.props.url,center:C}).then(E=>{if(!E.ok)throw new Error(E.error);return E})))}await Promise.all(b).catch(v=>{d.bailToMark(w),console.error(v)})}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(y){f()&&(h()||(o("convert-to-embed",{source:y}),d.run(()=>{const S=d.getSelectedShapeIds(),w=Re(S.map(C=>d.getShape(C))),b=[],v=[];for(const C of w){if(!d.isShapeOfType(C,"bookmark"))continue;const{url:E}=C.props,M=i.getEmbedDefinition(E);if(!M||!M.definition)continue;const{width:P,height:$}=M.definition,A=new T(C.x,C.y);A.rot(-C.rotation),A.add(new T(C.props.w/2-P/2,C.props.h/2-$/2)),A.rot(C.rotation);const O={id:Ct(),type:"embed",x:A.x,y:A.y,rotation:C.rotation,props:{url:E,w:P,h:$}};b.push(O),v.push(C.id)}d.markHistoryStoppingPoint("convert shapes to embed"),d.deleteShapes(v),d.createShapes(b)})))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(y){if(!f()||h())return;o("duplicate-shapes",{source:y});const S=d.getInstanceState();let w,b;if(S.duplicateProps)w=S.duplicateProps.shapeIds,b=S.duplicateProps.offset;else{w=d.getSelectedShapeIds();const v=V.Common(Re(w.map(C=>d.getShapePageBounds(C))));b=d.getCameraOptions().isLocked?{x:d.options.adjacentShapeMargin,y:d.options.adjacentShapeMargin}:{x:v.width+d.options.adjacentShapeMargin,y:0}}d.markHistoryStoppingPoint("duplicate shapes"),d.duplicateShapes(w,b),S.duplicateProps&&d.updateInstanceState({duplicateProps:{...S.duplicateProps,shapeIds:d.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(y){f()&&(h()||(o("ungroup-shapes",{source:y}),d.markHistoryStoppingPoint("ungroup"),d.ungroupShapes(d.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(y){if(!f()||h())return;o("group-shapes",{source:y});const S=d.getOnlySelectedShape();S&&d.isShapeOfType(S,"group")?(d.markHistoryStoppingPoint("ungroup"),d.ungroupShapes(d.getSelectedShapeIds())):(d.markHistoryStoppingPoint("group"),d.groupShapes(d.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(y){if(!f())return;o("remove-frame",{source:y});const S=d.getSelectedShapes();S.length>0&&S.every(w=>d.isShapeOfType(w,"frame"))&&(d.markHistoryStoppingPoint("remove-frame"),mMe(d,S.map(w=>w.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(y){if(!f())return;o("fit-frame-to-content",{source:y});const S=d.getOnlySelectedShape();S&&d.isShapeOfType(S,"frame")&&(d.markHistoryStoppingPoint("fit-frame-to-content"),TY(d,S.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"left",source:y}),d.markHistoryStoppingPoint("align left"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"left"),wt(d,S)})))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"center-horizontal",source:y}),d.markHistoryStoppingPoint("align center horizontal"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"center-horizontal"),wt(d,S)})))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"right",source:y}),d.markHistoryStoppingPoint("align right"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"right"),wt(d,S)})))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"center-vertical",source:y}),d.markHistoryStoppingPoint("align center vertical"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"center-vertical"),wt(d,S)})))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"top",source:y}),d.markHistoryStoppingPoint("align top"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"top"),wt(d,S)})))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(y){f()&&(h()||(o("align-shapes",{operation:"bottom",source:y}),d.markHistoryStoppingPoint("align bottom"),d.run(()=>{const S=d.getSelectedShapeIds();d.alignShapes(S,"bottom"),wt(d,S)})))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(y){f()&&(h()||(o("distribute-shapes",{operation:"horizontal",source:y}),d.markHistoryStoppingPoint("distribute horizontal"),d.run(()=>{const S=d.getSelectedShapeIds();d.distributeShapes(S,"horizontal"),wt(d,S)})))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(y){f()&&(h()||(o("distribute-shapes",{operation:"vertical",source:y}),d.markHistoryStoppingPoint("distribute vertical"),d.run(()=>{const S=d.getSelectedShapeIds();d.distributeShapes(S,"vertical"),wt(d,S)})))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(y){f()&&(h()||(o("stretch-shapes",{operation:"horizontal",source:y}),d.markHistoryStoppingPoint("stretch horizontal"),d.run(()=>{const S=d.getSelectedShapeIds();d.stretchShapes(S,"horizontal"),wt(d,S)})))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(y){f()&&(h()||(o("stretch-shapes",{operation:"vertical",source:y}),d.markHistoryStoppingPoint("stretch vertical"),d.run(()=>{const S=d.getSelectedShapeIds();d.stretchShapes(S,"vertical"),wt(d,S)})))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(y){f()&&(h()||(o("flip-shapes",{operation:"horizontal",source:y}),d.markHistoryStoppingPoint("flip horizontal"),d.run(()=>{const S=d.getSelectedShapeIds();d.flipShapes(S,"horizontal"),wt(d,S)})))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(y){f()&&(h()||(o("flip-shapes",{operation:"vertical",source:y}),d.markHistoryStoppingPoint("flip vertical"),d.run(()=>{const S=d.getSelectedShapeIds();d.flipShapes(S,"vertical"),wt(d,S)})))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(y){f()&&(h()||(o("pack-shapes",{source:y}),d.markHistoryStoppingPoint("pack"),d.run(()=>{const S=d.getSelectedShapeIds();d.packShapes(S,d.options.adjacentShapeMargin),wt(d,S)})))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(y){f()&&(h()||(o("stack-shapes",{operation:"vertical",source:y}),d.markHistoryStoppingPoint("stack-vertical"),d.run(()=>{const S=d.getSelectedShapeIds();d.stackShapes(S,"vertical",d.options.adjacentShapeMargin),wt(d,S)})))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(y){f()&&(h()||(o("stack-shapes",{operation:"horizontal",source:y}),d.markHistoryStoppingPoint("stack-horizontal"),d.run(()=>{const S=d.getSelectedShapeIds();d.stackShapes(S,"horizontal",d.options.adjacentShapeMargin),wt(d,S)})))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(y){f()&&(h()||(o("reorder-shapes",{operation:"toFront",source:y}),d.markHistoryStoppingPoint("bring to front"),d.bringToFront(d.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(y){f()&&(h()||(o("reorder-shapes",{operation:"forward",source:y}),d.markHistoryStoppingPoint("bring forward"),d.bringForward(d.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(y){f()&&(h()||(o("reorder-shapes",{operation:"backward",source:y}),d.markHistoryStoppingPoint("send backward"),d.sendBackward(d.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(y){f()&&(h()||(o("reorder-shapes",{operation:"toBack",source:y}),d.markHistoryStoppingPoint("send to back"),d.sendToBack(d.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(y){f()&&(h()||(d.markHistoryStoppingPoint("cut"),i.cut(y)))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(y){f()&&(h()||i.copy(y))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(y){navigator.clipboard?.read().then(S=>{i.paste(S,y,y==="context-menu"?d.inputs.currentPagePoint:void 0)}).catch(()=>{i.addToast({title:i.msg("action.paste-error-title"),description:i.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(y){d.run(()=>{h()||(o("select-all-shapes",{source:y}),d.markHistoryStoppingPoint("select all kbd"),d.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(y){f()&&(h()||(o("select-none-shapes",{source:y}),d.markHistoryStoppingPoint("select none"),d.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del",icon:"trash",onSelect(y){f()&&(h()||(o("delete-shapes",{source:y}),d.markHistoryStoppingPoint("delete"),d.deleteShapes(d.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",kbd:"shift+.,shift+alt+.",onSelect(y){if(!f()||h())return;const S=d.inputs.altKey;o("rotate-cw",{source:y,fine:S}),d.markHistoryStoppingPoint("rotate-cw"),d.run(()=>{const w=kn/(S?96:6),b=d.getSelectionRotation()%w,v=Mn(b,0)||Mn(b,w),C=d.getSelectedShapeIds();d.rotateShapesBy(C,w-(v?0:b)),wt(d,C)})}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",kbd:"shift+,,shift+alt+,",onSelect(y){if(!f()||h())return;const S=d.inputs.altKey;o("rotate-ccw",{source:y,fine:S}),d.markHistoryStoppingPoint("rotate-ccw"),d.run(()=>{const w=kn/(S?96:6),b=d.getSelectionRotation()%w,v=Mn(b,0),C=d.getSelectedShapeIds();d.rotateShapesBy(C,v?-w:-b),wt(d,C)})}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(y){o("zoom-in",{source:y,towardsCursor:!1}),d.zoomIn(void 0,{animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(y){o("zoom-in",{source:y,towardsCursor:!0}),d.zoomIn(d.inputs.currentScreenPoint,{animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(y){o("zoom-out",{source:y,towardsCursor:!1}),d.zoomOut(void 0,{animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(y){o("zoom-out",{source:y,towardsCursor:!0}),d.zoomOut(d.inputs.currentScreenPoint,{animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(y){o("reset-zoom",{source:y}),d.resetZoom(void 0,{animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(y){o("zoom-to-fit",{source:y}),d.zoomToFit({animation:{duration:d.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(y){f()&&(h()||(o("zoom-to-selection",{source:y}),d.zoomToSelection({animation:{duration:d.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(y){o("toggle-snap-mode",{source:y}),d.user.updateUserPreferences({isSnapMode:!d.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(y){const S=d.user.getIsDarkMode()?"light":"dark";o("color-scheme",{source:y,value:S}),d.user.updateUserPreferences({colorScheme:S})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(y){o("toggle-wrap-mode",{source:y}),d.user.updateUserPreferences({isWrapMode:!d.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(y){o("toggle-dynamic-size-mode",{source:y}),d.user.updateUserPreferences({isDynamicSizeMode:!d.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(y){o("toggle-paste-at-cursor",{source:y}),d.user.updateUserPreferences({isPasteAtCursorMode:!d.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(y){o("toggle-reduce-motion",{source:y}),d.user.updateUserPreferences({animationSpeed:d.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(y){o("toggle-keyboard-shortcuts",{source:y}),d.user.updateUserPreferences({areKeyboardShortcutsEnabled:!d.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"enhanced-a11y-mode",label:{default:"action.enhanced-a11y-mode",menu:"action.enhanced-a11y-mode.menu"},readonlyOk:!0,onSelect(y){o("enhanced-a11y-mode",{source:y}),d.user.updateUserPreferences({enhancedA11yMode:!d.user.getEnhancedA11yMode()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(y){o("toggle-edge-scrolling",{source:y}),d.user.updateUserPreferences({edgeScrollSpeed:d.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(y){o("toggle-transparent",{source:y}),d.updateInstanceState({exportBackground:!d.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(y){o("toggle-tool-lock",{source:y}),d.updateInstanceState({isToolLocked:!d.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(y){o("unlock-all",{source:y});const S=[];for(const w of d.getCurrentPageShapes())w.isLocked&&S.push({id:w.id,type:w.type,isLocked:!1});S.length>0&&d.updateShapes(S)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(y){d.timers.requestAnimationFrame(()=>{d.run(()=>{o("toggle-focus-mode",{source:y}),i.clearDialogs(),i.clearToasts(),d.updateInstanceState({isFocusMode:!d.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(y){o("toggle-grid-mode",{source:y}),d.updateInstanceState({isGridMode:!d.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(y){o("toggle-debug-mode",{source:y}),d.updateInstanceState({isDebugMode:!d.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(y){o("print",{source:y}),i.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(y){o("exit-pen-mode",{source:y}),d.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(y){o("stop-following",{source:y}),d.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(y){o("zoom-to-content",{source:y});const S=d.getSelectionPageBounds()??d.getCurrentPageBounds();S&&d.zoomToBounds(S,{targetZoom:Math.min(1,d.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(y){d.markHistoryStoppingPoint("locking"),o("toggle-lock",{source:y}),d.toggleLock(d.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(y){const S=Ci.createId(),w=d.getSelectedShapeIds();d.run(()=>{d.markHistoryStoppingPoint("move_shapes_to_page"),d.createPage({name:i.msg("page-menu.new-page-initial-name"),id:S}),d.moveShapesToPage(w,S)}),o("move-to-new-page",{source:y})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(y){const S=Oi;d.run(()=>{d.markHistoryStoppingPoint("change-color"),d.isIn("select")&&d.setStyleForSelectedShapes(S,"white"),d.setStyleForNextShapes(S,"white")}),o("set-style",{source:y,id:S.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(y){const S=Dl;d.run(()=>{d.markHistoryStoppingPoint("change-fill"),d.isIn("select")&&d.setStyleForSelectedShapes(S,"fill"),d.setStyleForNextShapes(S,"fill")}),o("set-style",{source:y,id:S.id,value:"fill"})}},{id:"select-fill-lined-fill",label:"fill-style.lined-fill",kbd:"alt+shift+f",onSelect(y){const S=Dl;d.run(()=>{d.markHistoryStoppingPoint("change-fill"),d.isIn("select")&&d.setStyleForSelectedShapes(S,"lined-fill"),d.setStyleForNextShapes(S,"lined-fill")}),o("set-style",{source:y,id:S.id,value:"lined-fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async y=>{const S=d.getSelectedShapeIds();if(S.length===0)return;d.markHistoryStoppingPoint("flattening to image"),o("flatten-to-image",{source:y});const w=await SIe(d,S,d.options.flattenImageBoundsExpand);w?.length&&d.setSelectedShapes(w)}},{id:"select-geo-tool",kbd:"g",onSelect:async y=>{o("select-tool",{source:y,id:"geo-previous"}),d.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async y=>{const S=d.getPages(),w=S.findIndex(b=>b.id===d.getCurrentPageId());w<1||(o("change-page",{source:y,direction:"prev"}),d.setCurrentPage(S[w-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async y=>{const S=d.getPages(),w=S.findIndex(b=>b.id===d.getCurrentPageId());if(w===-1||w>=S.length-1){if(d.getCurrentPageShapes().length<=0||d.getIsReadonly())return;o("new-page",{source:y}),d.run(()=>{d.markHistoryStoppingPoint("creating page");const b=Ci.createId();d.createPage({name:i.msg("page-menu.new-page-initial-name"),id:b}),d.setCurrentPage(b)});return}d.setCurrentPage(S[w+1].id),o("change-page",{source:y,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async y=>{if(!f())return;const S=d.getOnlySelectedShape();if(S&&(d.isShapeOfType(S,"image")||d.isShapeOfType(S,"video"))){d.getContainer().querySelector(".tlui-contextual-toolbar button:first-child")?.focus();return}d.getContainer().querySelector(".tlui-style-panel button")?.focus(),o("adjust-shape-styles",{source:y})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async y=>{if(!f())return;const S=d.getSelectionPageBounds();if(!S)return;const w=S.x+S.width/2,b=S.y+S.height/2,v=d.pageToScreen(new T(w,b));d.getContainer().querySelector(".tl-canvas")?.dispatchEvent(new PointerEvent("contextmenu",{clientX:v.x,clientY:v.y,bubbles:!0})),o("open-context-menu",{source:y})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async y=>{p(1.1),o("enlarge-shapes",{source:y})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async y=>{p(1/1.1),o("shrink-shapes",{source:y})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async y=>{const S=d.getSelectedShapeIds();if(!S.length)return;const w=bY({editor:d,selectedShapeIds:S,msg:l});w&&(a.announce({msg:""}),d.timers.requestAnimationFrame(()=>{a.announce({msg:w})}),o("a11y-repeat-shape-announce",{source:y}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async y=>{o("image-replace",{source:y}),i.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async y=>{o("video-replace",{source:y}),i.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async y=>{const S=d.getSelectedShapes();if(S.length===0)return;const w=S.filter(b=>NQ(b,d));if(w.length!==0){for(const b of w){const v=d.getAsset(b.props.assetId);if(!v||!v.props.src)continue;const C=await d.resolveAssetUrl(v.id,{shouldResolveToOriginal:!0});if(!C)return;const E=document.createElement("a");E.href=C,(v.type==="video"||v.type==="image")&&!v.props.src.startsWith("asset:")?E.download=v.props.name:E.download="download",document.body.appendChild(E),E.click(),document.body.removeChild(E)}o("download-original",{source:y})}}}];n&&m.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(y){o("open-cursor-chat",{source:y}),!d.getInstanceState().isCoarsePointer&&d.timers.requestAnimationFrame(()=>{d.updateInstanceState({isChatting:!0})})}});const g=G2e(m);return r?r(d,g,i):g},[i,t,o,r,c,n,l,a,s]);return x.jsx(OQ.Provider,{value:u,children:e})}function wa(){const r=k.useContext(OQ);if(!r)throw new Error("useTools must be used within a ToolProvider");return r}function Zy(r,e){return r?typeof r=="string"?r:e?r[e]??r.default:void 0:void 0}function bs({actionId:r="",...e}){const n=wa()[r];return n?x.jsx(wS,{...n,...e}):null}function _Q(){return KIe()?x.jsx(K,{actionId:"toggle-auto-size"}):null}function DQ(){return VY()?x.jsx(K,{actionId:"edit-link"}):null}function X2e(){return ji(1)?x.jsx(K,{actionId:"duplicate"}):null}function FQ(){const r=z();return F("should display flatten option",()=>{if(r.getSelectedShapeIds().length===0)return!1;const n=r.getOnlySelectedShape();return!(n&&r.isShapeOfType(n,"image"))},[r])?x.jsx(K,{actionId:"flatten-to-image"}):null}function Z2e(){const r=z();return F("should display download original option",()=>{const t=r.getSelectedShapes();return t.length===0?!1:t.some(n=>NQ(n,r))},[r])?x.jsx(K,{actionId:"download-original"}):null}function zQ(){return qY()?x.jsx(K,{actionId:"group"}):null}function BQ(){return KY()?x.jsx(K,{actionId:"ungroup"}):null}function jQ(){const r=z();return F("allow unframe",()=>{const t=r.getSelectedShapes();return t.length===0?!1:t.every(n=>r.isShapeOfType(n,"frame"))},[r])?x.jsx(K,{actionId:"remove-frame"}):null}function LQ(){const r=z();return F("allow fit frame to content",()=>{const t=r.getOnlySelectedShape();return t?r.isShapeOfType(t,"frame")&&r.getSortedChildIdsForParent(t).length>0:!1},[r])?x.jsx(K,{actionId:"fit-frame-to-content"}):null}function UQ(){const r=z();return F("selected shapes",()=>r.getSelectedShapes().length>0,[r])?x.jsx(K,{actionId:"toggle-lock"}):null}function B_(){const r=z(),e=F("isTransparentBg",()=>!r.getInstanceState().exportBackground,[r]);return x.jsx(bs,{actionId:"toggle-transparent",checked:e,toggle:!0})}function Q2e(){const r=z(),e=F("any shapes",()=>r.getCurrentPageShapeIds().size>0,[r]);return x.jsx(K,{actionId:"unlock-all",disabled:!e})}function WQ(){const r=z(),e=F("zoomed to 100",()=>r.getZoomLevel()===1,[r]);return x.jsx(K,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function HQ(){const r=z(),e=F("has shapes",()=>r.getCurrentPageShapeIds().size>0,[r]);return x.jsx(K,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function qQ(){const r=z(),e=F("has shapes",()=>r.getSelectedShapeIds().length>0,[r]);return x.jsx(K,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function KQ(){return x.jsxs(Xe,{id:"clipboard",children:[x.jsx(tDe,{}),x.jsx(nDe,{}),x.jsx(rDe,{}),x.jsx(X2e,{}),x.jsx(iDe,{})]})}function eDe(){const r=z(),e=F("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r]);return x.jsxs(_r,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[x.jsxs(Xe,{id:"copy-as-group",children:[x.jsx(K,{actionId:"copy-as-svg"}),!!window.navigator.clipboard?.write&&x.jsx(K,{actionId:"copy-as-png"})]}),x.jsx(Xe,{id:"copy-as-bg",children:x.jsx(B_,{})})]})}function tDe(){const r=ji(1);return x.jsx(K,{actionId:"cut",disabled:!r})}function nDe(){const r=JY(1);return x.jsx(K,{actionId:"copy",disabled:!r})}function rDe(){const r=qIe;return x.jsx(K,{actionId:"paste",disabled:!r})}function JQ(){const r=z();return F("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r])?x.jsxs(Xe,{id:"conversions",children:[x.jsx(eDe,{}),x.jsxs(_r,{id:"export-as",label:"context-menu.export-as",size:"small",children:[x.jsxs(Xe,{id:"export-as-group",children:[x.jsx(K,{actionId:"export-as-svg"}),x.jsx(K,{actionId:"export-as-png"})]}),x.jsx(Xe,{id:"export-as-bg",children:x.jsx(B_,{})})]}),x.jsx(Z2e,{})]}):null}function VQ(){const r=z(),e=F("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r]);return x.jsx(K,{actionId:"select-all",disabled:!e})}function iDe(){const r=ji(1);return x.jsx(K,{actionId:"delete",disabled:!r})}function sDe(){const r=Ss();return!JY(1)||r?null:x.jsxs(_r,{id:"edit",label:"context-menu.edit",size:"small",children:[x.jsx(zQ,{}),x.jsx(BQ,{}),x.jsx(FQ,{}),x.jsx(DQ,{}),x.jsx(LQ,{}),x.jsx(jQ,{}),x.jsx(YQ,{}),x.jsx(GQ,{}),x.jsx(_Q,{}),x.jsx(UQ,{})]})}function oDe(){const r=ji(2),e=JIe();return Ss()||!(r||e)?null:x.jsxs(_r,{id:"arrange",label:"context-menu.arrange",size:"small",children:[r&&x.jsxs(Xe,{id:"align",children:[x.jsx(K,{actionId:"align-left"}),x.jsx(K,{actionId:"align-center-horizontal"}),x.jsx(K,{actionId:"align-right"}),x.jsx(K,{actionId:"align-top"}),x.jsx(K,{actionId:"align-center-vertical"}),x.jsx(K,{actionId:"align-bottom"})]}),x.jsx(aDe,{}),r&&x.jsxs(Xe,{id:"stretch",children:[x.jsx(K,{actionId:"stretch-horizontal"}),x.jsx(K,{actionId:"stretch-vertical"})]}),(r||e)&&x.jsxs(Xe,{id:"flip",children:[x.jsx(K,{actionId:"flip-horizontal"}),x.jsx(K,{actionId:"flip-vertical"})]}),x.jsx(lDe,{})]})}function aDe(){return ji(3)?x.jsxs(Xe,{id:"distribute",children:[x.jsx(K,{actionId:"distribute-horizontal"}),x.jsx(K,{actionId:"distribute-vertical"})]}):null}function lDe(){const r=ji(2),e=HY();return r?x.jsxs(Xe,{id:"order",children:[x.jsx(K,{actionId:"pack"}),e&&x.jsx(K,{actionId:"stack-horizontal"}),e&&x.jsx(K,{actionId:"stack-vertical"})]}):null}function cDe(){const r=Ss(),e=ji(1);return r||!e?null:x.jsx(_r,{id:"reorder",label:"context-menu.reorder",size:"small",children:x.jsxs(Xe,{id:"reorder",children:[x.jsx(K,{actionId:"bring-to-front"}),x.jsx(K,{actionId:"bring-forward"}),x.jsx(K,{actionId:"send-backward"}),x.jsx(K,{actionId:"send-to-back"})]})})}function uDe(){const r=z(),e=F("pages",()=>r.getPages(),[r]),t=F("current page id",()=>r.getCurrentPageId(),[r]),{addToast:n}=Xa(),i=ln(),s=Ss();return!ji(1)||s?null:x.jsxs(_r,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[x.jsx(Xe,{id:"pages",children:e.map(a=>x.jsx(it,{id:a.id,disabled:t===a.id,label:a.name.length>30?`${a.name.slice(0,30)}`:a.name,onSelect:()=>{r.markHistoryStoppingPoint("move_shapes_to_page"),r.moveShapesToPage(r.getSelectedShapeIds(),a.id);const l=r.getPage(a.id);l&&n({title:"Changed page",description:`Moved to ${l.name}.`,actions:[{label:"Go back",type:"primary",onClick:()=>{r.markHistoryStoppingPoint("change-page"),r.setCurrentPage(t)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),x.jsx(Xe,{id:"new-page",children:x.jsx(K,{actionId:"move-to-new-page"})})]})}function GQ(){const r=z();return F("oneEmbedSelected",()=>{const t=r.getOnlySelectedShape();return t?!!(r.isShapeOfType(t,"embed")&&t.props.url&&!r.isShapeOrAncestorLocked(t)):!1},[r])?x.jsx(K,{actionId:"convert-to-bookmark"}):null}function YQ(){const r=z(),e=o_();return F("oneEmbeddableBookmarkSelected",()=>{const n=r.getOnlySelectedShape();return n?!!(r.isShapeOfType(n,"bookmark")&&n.props.url&&e(n.props.url)&&!r.isShapeOrAncestorLocked(n)):!1},[r])?x.jsx(K,{actionId:"convert-to-embed"}):null}function dDe(){const r=z(),e=F("isSnapMode",()=>r.user.getIsSnapMode(),[r]);return x.jsx(bs,{actionId:"toggle-snap-mode",checked:e})}function hDe(){const r=z(),e=F("isToolLock",()=>r.getInstanceState().isToolLocked,[r]);return x.jsx(bs,{actionId:"toggle-tool-lock",checked:e})}function fDe(){const r=z(),e=F("isGridMode",()=>r.getInstanceState().isGridMode,[r]);return x.jsx(bs,{actionId:"toggle-grid",checked:e})}function pDe(){const r=z(),e=F("isWrapMode",()=>r.user.getIsWrapMode(),[r]);return x.jsx(bs,{actionId:"toggle-wrap-mode",checked:e})}function mDe(){const r=z(),e=F("isFocusMode",()=>r.getInstanceState().isFocusMode,[r]);return x.jsx(bs,{actionId:"toggle-focus-mode",checked:e})}function gDe(){const r=z(),e=F("edgeScrollSpeed",()=>r.user.getEdgeScrollSpeed(),[r]);return x.jsx(bs,{actionId:"toggle-edge-scrolling",checked:e===1})}function yDe(){const r=z(),e=F("animationSpeed",()=>r.user.getAnimationSpeed(),[r]);return x.jsx(bs,{actionId:"toggle-reduce-motion",checked:e===0})}function xDe(){const r=z(),e=F("keyboardShortcuts",()=>r.user.getAreKeyboardShortcutsEnabled(),[r]);return x.jsx(bs,{actionId:"toggle-keyboard-shortcuts",checked:e})}function SDe(){const r=z(),e=F("enhancedA11yMode",()=>r.user.getEnhancedA11yMode(),[r]);return x.jsx(bs,{actionId:"enhanced-a11y-mode",checked:e})}function wDe(){const r=z(),e=F("isDebugMode",()=>r.getInstanceState().isDebugMode,[r]);return x.jsx(bs,{actionId:"toggle-debug-mode",checked:e})}function bDe(){const r=z(),e=F("dynamic resize",()=>r.user.getIsDynamicResizeMode(),[r]);return x.jsx(bs,{actionId:"toggle-dynamic-size-mode",checked:e})}function vDe(){const r=z(),e=F("paste at cursor",()=>r.user.getIsPasteAtCursorMode(),[r]);return x.jsx(bs,{actionId:"toggle-paste-at-cursor",checked:e})}function kDe(){const r=z();return F("show cursor chat",()=>r.getCurrentToolId()==="select"&&!r.getInstanceState().isCoarsePointer,[r])?x.jsx(K,{actionId:"open-cursor-chat"}):null}function CDe(){return x.jsx(_r,{id:"help menu accessibility",label:"menu.accessibility",children:x.jsxs(Xe,{id:"accessibility",children:[x.jsx(yDe,{}),x.jsx(xDe,{}),x.jsx(SDe,{})]})})}class TDe extends Q1e{static type="arrow";static props=RH;static migrations=OH;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&RM(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&RM(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){RM(this.editor,e)}onAfterChangeToShape({binding:e,shapeBefore:t,shapeAfter:n,reason:i}){i!=="ancestry"&&t.parentId===n.parentId&&t.index===n.index||XQ(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&zv({editor:this.editor,arrow:t,terminal:e.props.terminal})}}function XQ(r,e){const t=r.getShape(e);if(!t)return;const n=zn(r,t),{start:i,end:s}=n,o=i?r.getShape(i.toId):void 0,a=s?r.getShape(s.toId):void 0,l=r.getAncestorPageId(t);if(!l)return;let c;if(o&&a)c=r.findCommonAncestor([o,a])??l;else if(o||a){const g=(o||a)?.parentId;g&&g===t.parentId?c=t.parentId:c=l}else return;c&&c!==t.parentId&&r.reparentShapes([e],c);const u=r.getShape(e);if(!u)throw Error("no reparented arrow");const d=r.getShapeNearestSibling(u,o),h=r.getShapeNearestSibling(u,a);let f;if(d&&h)f=d.index>h.index?d:h;else if(d&&!h)f=d;else if(h&&!d)f=h;else return;let p;const m=r.getSortedChildIdsForParent(f.parentId).map(g=>r.getShape(g)).filter(g=>g.index>f.index);if(m.length){const g=m.find(y=>y.type!=="arrow");if(u.index>f.index&&(!g||u.index<g.index))return;p=Pf(f.index,m[0].index)}else p=_s(f.index);p!==u.index&&r.updateShapes([{id:e,type:"arrow",index:p}])}function RM(r,e){const t=zn(r,e);for(const n of["start","end"]){const i=t[n];if(!i)continue;const s=r.getShape(i.toId),o=r.getAncestorPageId(e)===r.getAncestorPageId(s);(!s||!o)&&zv({editor:r,arrow:e,terminal:n,unbind:!0})}XQ(r,e.id)}function zv({editor:r,arrow:e,terminal:t,unbind:n=!1,useHandle:i=!1}){const s=Ns(r,e);if(!s)throw new Error("expected arrow info");const o=i?s.start.handle:s.start.point,a=i?s.end.handle:s.end.point,l=t==="start"?o:a,c={id:e.id,type:"arrow",props:{[t]:{x:l.x,y:l.y},bend:e.props.bend}};if(s.type==="arc"){const u=t==="start"?o:s.start.handle,d=t==="end"?a:s.end.handle,h=T.Med(u,d),f=T.Sub(u,d).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),p=cS(s.handleArc.center,T.Add(h,f),s.handleArc.center,s.handleArc.radius);se(p?.length===1);const m=T.Dist(h,p[0])*Math.sign(e.props.bend);Mn(m,c.props.bend)||(c.props.bend=m)}r.updateShape(c),n&&fm(r,e,t)}function EDe({size:r,width:e,height:t,hideAlternateHandles:n}){const i=D(r/3),s=i/2,o=ie();return x.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[x.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${D(0-s)},${D(r)} 
						${D(0-s)},${D(0-s)} 
						${D(r)},${D(0-s)}`,strokeWidth:i,"data-testid":"selection.crop.top_left",role:"button","aria-label":o("handle.crop.top-left")}),x.jsx("line",{className:oe("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:D(e/2-r),y1:D(0-s),x2:D(e/2+r),y2:D(0-s),strokeWidth:i,"data-testid":"selection.crop.top",role:"button","aria-label":o("handle.crop.top")}),x.jsx("polyline",{className:oe("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${D(e-r)},${D(0-s)} 
						${D(e+s)},${D(0-s)} 
						${D(e+s)},${D(r)}`,strokeWidth:i,"data-testid":"selection.crop.top_right",role:"button","aria-label":o("handle.crop.top-right")}),x.jsx("line",{className:oe("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:D(e+s),y1:D(t/2-r),x2:D(e+s),y2:D(t/2+r),strokeWidth:i,"data-testid":"selection.crop.right",role:"button","aria-label":o("handle.crop.right")}),x.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${D(e+s)},${D(t-r)} 
						${D(e+s)},${D(t+s)}
						${D(e-r)},${D(t+s)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":o("handle.crop.bottom-right")}),x.jsx("line",{className:oe("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:D(e/2-r),y1:D(t+s),x2:D(e/2+r),y2:D(t+s),strokeWidth:i,"data-testid":"selection.crop.bottom",role:"button","aria-label":o("handle.crop.bottom")}),x.jsx("polyline",{className:oe("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${D(0+r)},${D(t+s)} 
						${D(0-s)},${D(t+s)}
						${D(0-s)},${D(t-r)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":o("handle.crop.bottom-left")}),x.jsx("line",{className:oe("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:D(0-s),y1:D(t/2-r),x2:D(0-s),y2:D(t/2+r),strokeWidth:i,"data-testid":"selection.crop.left",role:"button","aria-label":o("handle.crop.left")})]})}function MDe({children:r}){const e=z();return F("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const n=e.getOnlySelectedShape();return n&&e.isShapeOfType(n,"note")}return!1},[e])?x.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:r}):null}const IDe=new Ar;function ry(r){return IDe.get(r,()=>Ft("arrowTarget",null))}function PDe(r){return ry(r).get()}function j_(r){ry(r).set(null)}function iC({editor:r,pointInPageSpace:e,arrow:t,isPrecise:n,currentBinding:i,oppositeBinding:s}){const o=r.getShapeUtil("arrow");if(o.options.shouldIgnoreTargets(r))return ry(r).set(null),null;const a=t?t.props.kind:r.getStyleForNextShape(sv),l=r.getShapeAtPoint(e,{hitInside:!0,hitFrameInside:!0,margin:a==="elbow"?8:[8,0],filter:R=>!R.isLocked&&r.canBindShapes({fromShape:t??ADe,toShape:R,binding:"arrow"})});if(!l)return ry(r).set(null),null;const c=r.getShapeGeometry(l),u=V.ZeroFix(c.bounds),d=c.center,h=r.getShapePageTransform(l),f=r.getPointInShapeSpace(l,e),p=Math.max(c.bounds.width,c.bounds.height),m=tc(vIe,(R,B)=>{const U=jy[kIe[R]],H=T.Mul(B,p).add(d);let L=!1,X=U.v(u[R],u[U.crossMid]),G=0;const ce=c.intersectLineSegment(d,H,Yo.EXCLUDE_NON_STANDARD);for(const ge of ce){const De=T.Dist2(ge,d);De>G&&(G=De,X=ge,L=c.isClosed)}return{point:h.applyToPoint(X),isEnabled:L,far:h.applyToPoint(H)}}),g=r.getZoomLevel(),y=o.options.minElbowHandleDistance/g,S=h.applyToPoint(d);for(const R of Wg(m)){const B=m[R];T.DistMin(B.point,S,y)&&(B.isEnabled=!1)}let w=n;w||(!i||i&&l.id!==i.toId)&&(w=r.inputs.pointerVelocity.len()<.5),n||(c.isClosed||(w=!0),s&&l.id===s.toId&&s.props.isPrecise&&(w=!0));const b=o.options.shouldBeExact(r,w);b&&(w=!0);const v=!b&&w&&c.isClosed,C=!b&&(w&&a==="elbow"||!c.isClosed),E=!b&&w&&a==="elbow"&&c.isClosed,M=w&&(c.isClosed||b),P=!b&&w&&a==="elbow"&&c.isClosed;let $="none",A=e;if(M||($="center",A=S),C){const R=M?Tw(r,u,o.options.elbowArrowEdgeSnapDistance):1/0,B=c.nearestPoint(f,{includeLabels:!1,includeInternal:!1}),U=h.applyToPoint(B);T.Dist(U,e)<R&&($="edge",A=U)}if(P){const R=Tw(r,u,o.options.elbowArrowAxisSnapDistance),B=T.DistanceToLineSegment(m.left.far,m.right.far,e),U=T.DistanceToLineSegment(m.top.far,m.bottom.far,e),H=B<U&&B<R?"x":U<R?"y":null;if(H){const L=jy[H],X=T.Dist2(m[L.loEdge].far,e),G=T.Dist2(m[L.hiEdge].far,e),ce=X<G?L.loEdge:L.hiEdge;m[ce].isEnabled&&($="edge-point",A=m[ce].point)}}if(E){const R=Tw(r,u,o.options.elbowArrowPointSnapDistance);let B=null,U=1/0;for(const[H,L]of fi(m)){if(!L.isEnabled)continue;const X=T.Dist(L.point,e);X<R&&X<U&&(U=X,B=H)}B&&($="edge-point",A=m[B].point)}if(v){const R=Tw(r,u,a==="elbow"?o.options.elbowArrowCenterSnapDistance:o.options.arcArrowCenterSnapDistance);T.Dist(f,u.center)<R&&($="center",A=S)}const O=r.getPointInShapeSpace(l,A),_={x:Iy(u.minX,u.maxX,O.x),y:Iy(u.minY,u.maxY,O.y)},I={target:l,arrowKind:a,handlesInPageSpace:m,centerInPageSpace:S,anchorInPageSpace:A,isExact:b,isPrecise:w,snap:$,normalizedAnchor:_};return ry(r).set(I),I}const ADe={type:"arrow"};function Tw(r,e,t){return _e(Math.min(e.width,e.height)*.15,4,t)/r.getZoomLevel()}function $De(){const r=z();return F("should show arrow hints",()=>{if(r.isInAny("arrow.idle","arrow.pointing"))return!0;if(r.isIn("select.pointing_handle")){const t=r.getStateDescendant("select.pointing_handle");if(t.info.shape.type==="arrow"&&(t.info.handle.id==="start"||t.info.handle.id==="end"))return!0}if(r.isIn("select.dragging_handle")){const t=r.getStateDescendant("select.dragging_handle");if(t.info.shape.type==="arrow"&&(t.info.handle.id==="start"||t.info.handle.id==="end"))return!0}return!1},[r])?x.jsx(RDe,{}):null}function RDe(){const r=z(),{ShapeIndicator:e}=Tt(),t=F("arrow target info",()=>PDe(r),[r]);if(!t)return null;const{handlesInPageSpace:n,snap:i,anchorInPageSpace:s,arrowKind:o,isExact:a,isPrecise:l}=t,c=!a&&o==="elbow";return x.jsxs(x.Fragment,{children:[e&&x.jsx(e,{shapeId:t.target.id}),c&&x.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[x.jsx("circle",{cx:s.x,cy:s.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${l?i??"none":"none"}`}),Object.entries(n).map(([u,d])=>d.isEnabled?x.jsx("circle",{cx:d.point.x,cy:d.point.y,className:"tl-arrow-hint-handle"},u):null)]})]})}const{PI:ODe}=Math,mf=ODe+1e-4;function ZQ(r,e={}){const{size:t=16,smoothing:n=.5}=e;if(r.length===0||t<=0)return{left:[],right:[]};const i=r[0],s=r[r.length-1],o=s.runningLength,a=Math.pow(t*n,2),l=[],c=[];let u=r[0].vector,d=r[0].point,h=d,f=d,p=h,m=!1,g;for(let y=0;y<r.length;y++){g=r[y];const{point:S,vector:w}=r[y],b=g.vector.dpr(u),v=(y<r.length-1?r[y+1]:r[y]).vector,C=y<r.length-1?v.dpr(g.vector):1,E=b<0&&!m,M=C!==null&&C<.2;if(E||M){if(C>-.62&&o-g.runningLength>g.radius){const $=u.clone().mul(g.radius);u.clone().cpr(v)<0?(f=T.Add(S,$),p=T.Sub(S,$)):(f=T.Sub(S,$),p=T.Add(S,$)),l.push(f),c.push(p)}else{const $=u.clone().mul(g.radius).per(),A=T.Sub(g.input,$);for(let O=1/13,_=0;_<1;_+=O)f=T.RotWith(A,g.input,mf*_),l.push(f),p=T.RotWith(A,g.input,mf+mf*-_),c.push(p)}d=f,h=p,M&&(m=!0);continue}if(m=!1,g===i||g===s){const $=T.Per(w).mul(g.radius);l.push(T.Sub(S,$)),c.push(T.Add(S,$));continue}const P=T.Lrp(v,w,C).per().mul(g.radius);f=T.Sub(S,P),(y<=1||T.Dist2(d,f)>a)&&(l.push(f),d=f),p=T.Add(S,P),(y<=1||T.Dist2(h,p)>a)&&(c.push(p),h=p),u=w}return{left:l,right:c}}function QQ(r,e={}){const{size:t=16,start:n={},end:i={},last:s=!1}=e,{cap:o=!0}=n,{cap:a=!0}=i;if(r.length===0||t<=0)return[];const l=r[0],c=r[r.length-1],u=c.runningLength,d=n.taper===!1?0:n.taper===!0?Math.max(t,u):n.taper,h=i.taper===!1?0:i.taper===!0?Math.max(t,u):i.taper,{left:f,right:p}=ZQ(r,e),m=l.point,g=r.length>1?r[r.length-1].point:T.AddXY(l.point,1,1);if(r.length===1&&(!(d||h)||s)){const b=T.Add(m,T.Sub(m,g).uni().per().mul(-l.radius)),v=[];for(let C=1/13,E=C;E<=1;E+=C)v.push(T.RotWith(b,m,mf*2*E));return v}const y=[];if(!(d||h&&r.length===1))if(o)for(let b=1/8,v=b;v<=1;v+=b){const C=T.RotWith(p[0],m,mf*v);y.push(C)}else{const b=T.Sub(f[0],p[0]),v=T.Mul(b,.5),C=T.Mul(b,.51);y.push(T.Sub(m,v),T.Sub(m,C),T.Add(m,C),T.Add(m,v))}const S=[],w=c.vector.clone().per().neg();if(h||d&&r.length===1)S.push(g);else if(a){const b=T.Add(g,T.Mul(w,c.radius));for(let v=1/29,C=v;C<1;C+=v)S.push(T.RotWith(b,g,mf*3*C))}else S.push(T.Add(g,T.Mul(w,c.radius)),T.Add(g,T.Mul(w,c.radius*.99)),T.Sub(g,T.Mul(w,c.radius*.99)),T.Sub(g,T.Mul(w,c.radius)));return f.concat(S,p.reverse(),y)}const NDe=.025,_De=.01;function jl(r,e={}){const{streamline:t=.5,size:n=16,simulatePressure:i=!1}=e;if(r.length===0)return[];const s=.15+(1-t)*.85;let o=r.map(T.From),a=0;if(!i){let g=o[0];for(;g&&!(g.z>=NDe);)o.shift(),g=o[0]}if(!i){let g=o[o.length-1];for(;g&&!(g.z>=_De);)o.pop(),g=o[o.length-1]}if(o.length===0)return[{point:T.From(r[0]),input:T.From(r[0]),pressure:i?.5:.15,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let l=o[1];for(;l&&!(T.Dist2(l,o[0])>(n/3)**2);)o[0].z=Math.max(o[0].z,l.z),o.splice(1,1),l=o[1];const c=o.pop();for(l=o[o.length-1];l&&!(T.Dist2(l,c)>(n/3)**2);)o.pop(),l=o[o.length-1],a++;o.push(c);const u=e.last||!e.simulatePressure||o.length>1&&T.Dist2(o[o.length-1],o[o.length-2])<n**2||a>0;if(o.length===2&&e.simulatePressure){const g=o[1];o=o.slice(0,-1);for(let y=1;y<5;y++){const S=T.Lrp(o[0],g,y/4);S.z=(o[0].z+(g.z-o[0].z))*y/4,o.push(S)}}const d=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let h=0,f=d[0],p,m;u&&t>0&&o.push(o[o.length-1].clone());for(let g=1,y=o.length;g<y;g++)p=!s||e.last&&g===y-1?o[g].clone():o[g].clone().lrp(f.point,1-s),!f.point.equals(p)&&(m=T.Dist(p,f.point),h+=m,!(g<4&&h<n)&&(f={input:o[g],point:p,pressure:i?.5:o[g].z,vector:T.Sub(f.point,p).uni(),distance:m,runningLength:h,radius:1},d.push(f)));if(d[1]?.vector&&(d[0].vector=d[1].vector.clone()),h<1){const g=Math.max(.5,...d.map(y=>y.pressure));d.forEach(y=>y.pressure=g)}return d}const{min:ul}=Math,OM=.275;function L_(r,e){const{size:t=16,thinning:n=.5,simulatePressure:i=!0,easing:s=g=>g,start:o={},end:a={}}=e,{easing:l=gr.easeOutQuad}=o,{easing:c=gr.easeOutCubic}=a,u=r[r.length-1].runningLength;let d,h=r[0].pressure,f;if(!i&&u<t){const g=r.reduce((y,S)=>Math.max(y,S.pressure),.5);return r.forEach(y=>{y.pressure=g,y.radius=t*s(.5-n*(.5-y.pressure))}),r}else{let g;for(let y=0,S=r.length;y<S&&(f=r[y],!(f.runningLength>t*5));y++){const w=ul(1,f.distance/t);if(i){const b=ul(1,1-w);g=ul(1,h+(b-h)*(w*OM))}else g=ul(1,h+(f.pressure-h)*.5);h=h+(g-h)*.5}for(let y=0;y<r.length;y++){if(f=r[y],n){let{pressure:S}=f;const w=ul(1,f.distance/t);if(i){const b=ul(1,1-w);S=ul(1,h+(b-h)*(w*OM))}else S=ul(1,h+(S-h)*(w*OM));f.radius=t*s(.5-n*(.5-S)),h=S}else f.radius=t/2;d===void 0&&(d=f.radius)}}const p=o.taper===!1?0:o.taper===!0?Math.max(t,u):o.taper,m=a.taper===!1?0:a.taper===!0?Math.max(t,u):a.taper;if(p||m)for(let g=0;g<r.length;g++){f=r[g];const{runningLength:y}=f,S=y<p?l(y/p):1,w=u-y<m?c((u-y)/m):1;f.radius=Math.max(.01,f.radius*Math.min(S,w))}return r}function DDe(r,e={}){return QQ(L_(jl(r,e),e),e)}function v5({scribble:r,zoom:e,color:t,opacity:n,className:i}){if(!r.points.length)return null;const s=DDe(r.points,{size:r.size/e,start:{taper:r.taper,easing:gr.linear},last:r.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(s.length<4){const a=r.size/e/2,{x:l,y:c}=r.points[r.points.length-1];o=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=XV(s);return x.jsx("svg",{className:i&&oe("tl-overlays__item",i),children:x.jsx("path",{className:"tl-scribble",d:o,fill:t??`var(--tl-color-${r.color})`,opacity:n??r.opacity})})}const FDe=In(function({bounds:e,rotation:t}){const n=z(),i=ie(),s=k.useRef(null),o=Ss(),a=Ho("top"),l=Ho("right"),c=Ho("bottom"),u=Ho("left"),d=Ho("top_left"),h=Ho("top_right"),f=Ho("bottom_right"),p=Ho("bottom_left"),m=n.getInstanceState().cursor.type==="default",g=n.getInstanceState().isCoarsePointer,y=n.getOnlySelectedShape(),S=y&&n.isShapeOrAncestorLocked(y),w=y?n.getShapeUtil(y).expandSelectionOutlinePx(y):0,b=w instanceof V?e.clone().expand(w).zeroFix():e.clone().expandBy(w).zeroFix();if(sS(s,e?.x,e?.y,1,n.getSelectionRotation(),{x:b.x-e.x,y:b.y-e.y}),y&&n.isShapeHidden(y))return null;const v=n.getZoomLevel(),C=n.getInstanceState().isChangingStyle,E=b.width,M=b.height,P=8/v,$=E<P*2,A=M<P*2,O=E<P*4,_=M<P*4,I=E<P*5,R=M<P*5,B=g?1.75:1,U=6/v*B,H=(O?U/2:U)*(B*.75),L=(_?U/2:U)*(B*.75),X=(y?!n.getShapeUtil(y).hideSelectionBoundsFg(y):!0)&&!C;let G=X&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||X&&n.isIn("select.resizing")&&y&&n.isShapeOfType(y,"text");y&&G&&ht.isFirefox&&n.isShapeOfType(y,"embed")&&(G=!1);const ce=n.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!C&&!o,ae=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!C&&!o,ge=!g&&!($||A)&&(ae||ce)&&(y?!n.getShapeUtil(y).hideRotateHandle(y):!0)&&!S,De=g&&(!O||!_)&&(ae||ce)&&(y?!n.getShapeUtil(y).hideRotateHandle(y):!0)&&!S,Ne=ae&&(y?n.getShapeUtil(y).canResize(y)&&!n.getShapeUtil(y).hideResizeHandles(y):!0)&&!ce&&!S,ne=$||A,ue=$&&A,ze=I||R,xe=Ne||ce,hn=!ge,An=!ae||!De,Bt=!ae||!xe,Rt=!ae||!xe||ne,Ot=!ae||!xe||ne,Jr=!ae||!xe||ue&&!ce;let Vr=!0,rs=!0;if(ce)Vr=ze,rs=ze;else if(Ne){Vr=ne||ue||g;const zo=g&&y&&y.type==="text";rs=Vr&&!zo}const Js=Math.min(24/v,M-L*3),Fo=ae&&g&&y&&n.isShapeOfType(y,"text")&&Js*v>=4;return x.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:x.jsxs("g",{ref:s,children:[G&&x.jsx("rect",{className:"tl-selection__fg__outline",width:D(E),height:D(M)}),x.jsx(Ew,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:U,corner:"top_left_rotate",cursor:m?as("nwse-rotate",t):void 0,isHidden:hn}),x.jsx(Ew,{"data-testid":"selection.rotate.top-right",cx:E+U*3,cy:0,targetSize:U,corner:"top_right_rotate",cursor:m?as("nesw-rotate",t):void 0,isHidden:hn}),x.jsx(Ew,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:M+U*3,targetSize:U,corner:"bottom_left_rotate",cursor:m?as("swne-rotate",t):void 0,isHidden:hn}),x.jsx(Ew,{"data-testid":"selection.rotate.bottom-right",cx:E+U*3,cy:M+U*3,targetSize:U,corner:"bottom_right_rotate",cursor:m?as("senw-rotate",t):void 0,isHidden:hn}),x.jsx(BDe,{"data-testid":"selection.rotate.mobile",cx:O?-U*1.5:E/2,cy:O?M/2:-U*1.5,size:P,isHidden:An}),x.jsx(dl,{hide:Vr,dataTestId:"selection.resize.top",ariaLabel:i("handle.resize-top"),x:0,y:D(0-(_?L*2:L)),width:D(E),height:D(Math.max(1,L*2)),cursor:m?as("ns-resize",t):void 0,events:a}),x.jsx(dl,{hide:rs,dataTestId:"selection.resize.right",ariaLabel:i("handle.resize-right"),x:D(E-(O?0:H)),y:0,height:D(M),width:D(Math.max(1,H*2)),cursor:m?as("ew-resize",t):void 0,events:l}),x.jsx(dl,{hide:Vr,dataTestId:"selection.resize.bottom",ariaLabel:i("handle.resize-bottom"),x:0,y:D(M-(_?0:L)),width:D(E),height:D(Math.max(1,L*2)),cursor:m?as("ns-resize",t):void 0,events:c}),x.jsx(dl,{hide:rs,dataTestId:"selection.resize.left",ariaLabel:i("handle.resize-left"),x:D(0-(O?H*2:H)),y:0,height:D(M),width:D(Math.max(1,H*2)),cursor:m?as("ew-resize",t):void 0,events:u}),x.jsx(dl,{hide:Bt,dataTestId:"selection.target.top-left",ariaLabel:i("handle.resize-top-left"),x:D(0-(O?H*2:H*1.5)),y:D(0-(_?L*2:L*1.5)),width:D(H*3),height:D(L*3),cursor:m?as("nwse-resize",t):void 0,events:d}),x.jsx(dl,{hide:Rt,dataTestId:"selection.target.top-right",ariaLabel:i("handle.resize-top-right"),x:D(E-(O?0:H*1.5)),y:D(0-(_?L*2:L*1.5)),width:D(H*3),height:D(L*3),cursor:m?as("nesw-resize",t):void 0,events:h}),x.jsx(dl,{hide:Jr,dataTestId:"selection.target.bottom-right",ariaLabel:i("handle.resize-bottom-right"),x:D(E-(O?H:H*1.5)),y:D(M-(_?L:L*1.5)),width:D(H*3),height:D(L*3),cursor:m?as("nwse-resize",t):void 0,events:f}),x.jsx(dl,{hide:Ot,dataTestId:"selection.target.bottom-left",ariaLabel:i("handle.resize-bottom-left"),x:D(0-(O?H*3:H*1.5)),y:D(M-(_?0:L*1.5)),width:D(H*3),height:D(L*3),cursor:m?as("nesw-resize",t):void 0,events:p}),Ne&&x.jsxs(x.Fragment,{children:[x.jsx("rect",{"data-testid":"selection.resize.top-left",className:oe("tl-corner-handle",{"tl-hidden":Bt}),x:D(0-P/2),y:D(0-P/2),width:D(P),height:D(P)}),x.jsx("rect",{"data-testid":"selection.resize.top-right",className:oe("tl-corner-handle",{"tl-hidden":Rt}),x:D(E-P/2),y:D(0-P/2),width:D(P),height:D(P)}),x.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:oe("tl-corner-handle",{"tl-hidden":Jr}),x:D(E-P/2),y:D(M-P/2),width:D(P),height:D(P)}),x.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:oe("tl-corner-handle",{"tl-hidden":Ot}),x:D(0-P/2),y:D(M-P/2),width:D(P),height:D(P)})]}),Fo&&x.jsxs(x.Fragment,{children:[x.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:D(0-P/4),y:D(M/2-Js/2),rx:P/4,width:D(P/2),height:D(Js)}),x.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:P/4,x:D(E-P/4),y:D(M/2-Js/2),width:D(P/2),height:D(Js)})]}),ce&&x.jsx(EDe,{size:P,width:E,height:M,hideAlternateHandles:ze})]})})}),dl=function({hide:e,dataTestId:t,ariaLabel:n,x:i,y:s,width:o,height:a,cursor:l,events:c}){return x.jsx("rect",{className:oe("tl-resize-handle","tl-transparent",{"tl-hidden":e}),"data-testid":t,role:"button","aria-label":n,pointerEvents:"all",x:i,y:s,width:o,height:a,cursor:l,...c})},Ew=function({cx:e,cy:t,targetSize:n,corner:i,cursor:s,isHidden:o,"data-testid":a}){const l=Ho(i),u=ie()(`handle.rotate.${i}`);return x.jsx("rect",{className:oe("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,role:"button","aria-label":u,pointerEvents:"all",x:D(e-n*3),y:D(t-n*3),width:D(Math.max(1,n*3)),height:D(Math.max(1,n*3)),cursor:s,...l})},zDe=Math.sqrt(Math.PI),BDe=function({cx:e,cy:t,size:n,isHidden:i,"data-testid":s}){const o=Ho("mobile_rotate"),a=z(),l=F("zoom level",()=>a.getZoomLevel(),[a]),c=Math.max(14*(1/l),20/Math.max(1,l)),u=ie();return x.jsxs("g",{role:"button","aria-label":u("handle.rotate.mobile_rotate"),children:[x.jsx("circle",{"data-testid":s,pointerEvents:"all",className:oe("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:c,...o}),x.jsx("circle",{className:oe("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:n/zDe})]})};function jDe(){const r=z(),e=F("is in a valid select state",()=>r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[r]);return x.jsx(ZV,{hideAll:!e})}const eee=[TDe],Ei={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},_n={s:2,m:3.5,l:5,xl:10},Bf={s:18,m:24,l:36,xl:44},Ol={s:18,m:22,l:26,xl:32},LDe={s:18,m:20,l:24,xl:28},Ll={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},UDe=20,HA=4.25,di=16;function WDe(r,e){const t=r.w/e.w,n=r.h/e.h;return t<=1&&n<=1?r:t>n?{w:r.w/t,h:r.h/t}:{w:r.w/n,h:r.h/n}}async function HDe(r,e,t){const{elements:n,files:i}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:r.store.schema.serialize()},o=new Map,a=new Map,l=r.getCurrentPageId(),c=new Map,u=[],d=new Set;n.forEach(y=>{if(c.set(y.id,Ct()),y.boundElements!==null)for(const S of y.boundElements)S.type==="text"&&d.add(S.id)});let h=FO;for(const y of n){if(d.has(y.id))continue;const S=c.get(y.id),w={id:S,typeName:"shape",parentId:l,index:h,x:y.x,y:y.y,rotation:0,isLocked:y.locked,opacity:qDe(y.opacity),meta:{}};switch(y.angle!==0&&a.set(S,y.angle),y.groupIds&&y.groupIds.length>0?o.has(y.groupIds[0])?o.get(y.groupIds[0])?.push(S):o.set(y.groupIds[0],[S]):u.push(S),y.type){case"rectangle":case"ellipse":case"diamond":{let b="",v="middle";if(y.boundElements!==null){for(const E of y.boundElements)if(E.type==="text"){const M=n.find(P=>P.id===E.id);M&&(b=M.text,v=ZDe[M.textAlign])}}const C=y.backgroundColor==="transparent"?y.strokeColor:y.backgroundColor;s.shapes.push({...w,type:"geo",props:{geo:y.type,url:y.link??"",w:y.width,h:y.height,size:Mw[y.strokeWidth]??"draw",color:Jp[C]??"black",richText:ir(b),align:v,dash:Iw(y),fill:tFe(y)}});break}case"freedraw":{s.shapes.push({...w,type:"draw",props:{dash:Iw(y),size:Mw[y.strokeWidth],color:Jp[y.strokeColor]??"black",segments:[{type:"free",points:y.points.map(([b,v,C=.5])=>({x:b,y:v,z:C}))}]}});break}case"line":{if(y.points.slice().length<2)break;const v=Py(y.points.length);s.shapes.push({...w,type:"line",props:{dash:Iw(y),size:Mw[y.strokeWidth],color:Jp[y.strokeColor]??"black",spline:y.roundness?"cubic":"line",points:{...Object.fromEntries(y.points.map(([C,E],M)=>{const P=v[M];return[P,{id:P,index:P,x:C,y:E}]}))}}});break}case"arrow":{let b="";if(y.boundElements!==null){for(const P of y.boundElements)if(P.type==="text"){const $=n.find(A=>A.id===P.id);$&&(b=$.text)}}const v=y.points[0],C=y.points[y.points.length-1],E=c.get(y.startBinding?.elementId),M=c.get(y.endBinding?.elementId);s.shapes.push({...w,type:"arrow",props:{richText:ir(b),kind:y.elbowed?"elbow":"arc",bend:eFe(y,v,C),dash:Iw(y),size:Mw[y.strokeWidth]??"m",color:Jp[y.strokeColor]??"black",start:{x:v[0],y:v[1]},end:{x:C[0],y:C[1]},arrowheadEnd:k5[y.endArrowhead]??"none",arrowheadStart:k5[y.startArrowhead]??"none"}}),E&&s.bindings.push({id:Tu(),typeName:"binding",type:"arrow",fromId:S,toId:E,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),M&&s.bindings.push({id:Tu(),typeName:"binding",type:"arrow",fromId:S,toId:M,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:b,scale:v}=JDe(y.fontSize);s.shapes.push({...w,type:"text",props:{size:b,scale:v,font:VDe[y.fontFamily]??"draw",color:Jp[y.strokeColor]??"black",richText:ir(y.text),textAlign:QDe[y.textAlign]}});break}case"image":{const b=i[y.fileId];if(!b)break;const v=Ld.createId();s.assets.push({id:v,typeName:"asset",type:"image",props:{w:y.width,h:y.height,fileSize:b.size,name:y.id??"Untitled",isAnimated:!1,mimeType:b.mimeType,src:b.dataURL},meta:{}}),s.shapes.push({...w,type:"image",props:{w:y.width,h:y.height,assetId:v}})}}h=_s(h)}const f=t??(r.inputs.shiftKey?r.inputs.currentPagePoint:void 0);r.putContentOntoCurrentPage(s,{point:f,select:!1,preserveIds:!0});for(const y of o.values())if(y.length>1){r.groupShapes(y);const S=r.getShape(y[0]);S?.parentId&&li(S.parentId)&&u.push(S.parentId)}for(const[y,S]of a)r.select(y),r.rotateShapesBy([y],S);const p=Re(u.map(y=>r.getShape(y))),m=V.Common(p.map(y=>r.getShapePageBounds(y))),g=r.getViewportPageBounds().center;r.updateShapes(p.map(y=>{const S={x:(y.x??0)-(m.x+m.w/2),y:(y.y??0)-(m.y+m.h/2)};return{id:y.id,type:y.type,x:g.x+S.x,y:g.y+S.y}})),r.setSelectedShapes(u)}const qDe=r=>{const e=r/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Mw={1:"s",2:"m",3:"l",4:"xl"},KDe={16:"s",20:"m",28:"l",36:"xl"};function JDe(r){const e=KDe[r];return e?{size:e,scale:1}:r<16?{size:"s",scale:r/16}:r>36?{size:"xl",scale:r/36}:{size:"m",scale:1}}const VDe={1:"draw",2:"sans",3:"mono"},GDe={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function Uo(r,e,t){const n=[0,1,2,3,4].map(i=>GDe[r][i]);return Object.fromEntries(n.map((i,s)=>[i,s<3?e:t]))}const Jp={...Uo("gray","grey","black"),...Uo("red","light-red","red"),...Uo("pink","light-red","red"),...Uo("grape","light-violet","violet"),...Uo("blue","light-blue","blue"),...Uo("cyan","light-blue","blue"),...Uo("teal","light-green","green"),...Uo("green","light-green","green"),...Uo("yellow","yellow","orange"),...Uo("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},YDe={solid:"draw",dashed:"dashed",dotted:"dotted"},XDe={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},ZDe={left:"start",center:"middle",right:"end"},QDe={left:"start",center:"middle",right:"end"},k5={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function eFe(r,e,t){let n=0;if(r.points.length>2){const i=new T(e[0],e[1]),s=new T(t[0],t[1]),o=new T(r.points[1][0],r.points[1][1]),a=T.Sub(s,i),l=T.Per(a),c=T.Med(s,i),u=T.Sub(c,l),d=T.Add(c,l),h=T.NearestPointOnLineSegment(u,d,o,!1);n=T.Dist(h,c),T.Clockwise(h,s,c)&&(n*=-1)}return n}const Iw=r=>{let e=YDe[r.strokeStyle]??"draw";return e==="draw"&&r.roughness===0&&(e="solid"),e},tFe=r=>r.backgroundColor==="transparent"?"none":XDe[r.fillStyle]??"solid";var nFe=/(^|[^`])`([^`]+)`(?!`)$/,rFe=/(^|[^`])`([^`]+)`(?!`)/g,iFe=hQ.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",tQ(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[__e({find:nFe,type:this.type})]},addPasteRules(){return[F_e({find:rFe,type:this.type})]}});function tee(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=tee(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function nee(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=nee(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let ve=class Qr{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Qr(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new Qr(n,i)}cutByIndex(e,t){return e==t?Qr.empty:e==0&&t==this.content.length?this:new Qr(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new Qr(i,s)}addToStart(e){return new Qr([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Qr(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return tee(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return nee(this,e,t,n)}findIndex(e){if(e==0)return Pw(0,e);if(e==this.size)return Pw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?Pw(t+1,s):Pw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Qr.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Qr(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Qr.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new Qr(t||e,n)}static from(e){if(!e)return Qr.empty;if(e instanceof Qr)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Qr([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};ve.empty=new ve([],0);const NM={index:0,offset:0};function Pw(r,e){return NM.index=r,NM.offset=e,NM}function Bv(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Bv(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Bv(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let Zt=class qA{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Bv(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return qA.none;if(e instanceof qA)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};Zt.none=[];let jv=class extends Error{},Ue=class Eh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=iee(this.content,e+this.openStart,t);return n&&new Eh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Eh(ree(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Eh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Eh(ve.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Eh(e,n,i)}};Ue.empty=new Ue(ve.empty,0,0);function ree(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(ree(s.content,e-i-1,t-i-1)))}function iee(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=iee(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function sFe(r,e,t){if(t.openStart>r.depth)throw new jv("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new jv("Inconsistent open depths");return see(r,e,t,0)}function see(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=see(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Nu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=oFe(t,r);return Nu(s,aee(r,o,a,e,n))}else return Nu(s,Lv(r,e,n))}function oee(r,e){if(!e.type.compatibleContent(r.type))throw new jv("Cannot join "+e.type.name+" onto "+r.type.name)}function KA(r,e,t){let n=r.node(t);return oee(n,e.node(t)),n}function Ou(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function iy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Ou(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Ou(i.child(a),n);e&&e.depth==t&&e.textOffset&&Ou(e.nodeBefore,n)}function Nu(r,e){return r.type.checkContent(e),r.copy(e)}function aee(r,e,t,n,i){let s=r.depth>i&&KA(r,e,i+1),o=n.depth>i&&KA(t,n,i+1),a=[];return iy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(oee(s,o),Ou(Nu(s,aee(r,e,t,n,i+1)),a)):(s&&Ou(Nu(s,Lv(r,e,i+1)),a),iy(e,t,i,a),o&&Ou(Nu(o,Lv(t,n,i+1)),a)),iy(n,null,i,a),new ve(a)}function Lv(r,e,t){let n=[];if(iy(null,r,t,n),r.depth>t){let i=KA(r,e,t+1);Ou(Nu(i,Lv(r,e,t+1)),n)}return iy(e,null,t,n),new ve(n)}function oFe(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(ve.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let C5=class JA{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Zt.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new cFe(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new JA(t,n,s)}static resolveCached(e,t){let n=T5.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else T5.set(e,n=new aFe);let i=n.elts[n.i]=JA.resolve(e,t);return n.i=(n.i+1)%lFe,i}},aFe=class{constructor(){this.elts=[],this.i=0}};const lFe=12,T5=new WeakMap;let cFe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const uFe=Object.create(null);let _u=class VA{constructor(e,t,n,i=Zt.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||ve.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Bv(this.attrs,t||e.defaultAttrs||uFe)&&Zt.sameSet(this.marks,n||Zt.none)}copy(e=null){return e==this.content?this:new VA(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new VA(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ue.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Ue(c,i.depth-o,s.depth-o)}replace(e,t,n){return sFe(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return C5.resolveCached(this,e)}resolveNoCache(e){return C5.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),lee(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=ve.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Zt.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Zt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=ve.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};_u.prototype.text=void 0;let dFe=class GA extends _u{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):lee(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new GA(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new GA(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function lee(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let Qy=class cee{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new hFe(e,t);if(n.next==null)return cee.empty;let i=uee(n);n.next&&n.err("Unexpected trailing text");let s=SFe(xFe(i));return wFe(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return ve.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};Qy.empty=new Qy(!0);let hFe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function uee(r){let e=[];do e.push(fFe(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function fFe(r){let e=[];do e.push(pFe(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function pFe(r){let e=yFe(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=mFe(r,e);else break;return e}function E5(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function mFe(r,e){let t=E5(r),n=t;return r.eat(",")&&(r.next!="}"?n=E5(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function gFe(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function yFe(r){if(r.eat("(")){let e=uee(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=gFe(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function xFe(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function dee(r,e){return e-r}function M5(r,e){let t=[];return n(e),t.sort(dee);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function SFe(r){let e=Object.create(null);return t(M5(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);M5(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new Qy(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(dee);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function wFe(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function hee(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function fee(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function pee(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function mee(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new vFe(r,n,e[n]);return t}let I5=class gee{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=mee(e,n.attrs),this.defaultAttrs=hee(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Qy.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:fee(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new _u(this,this.computeAttrs(e),ve.from(t),Zt.setFrom(n))}createChecked(e=null,t,n){return t=ve.from(t),this.checkContent(t),new _u(this,this.computeAttrs(e),t,Zt.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=ve.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(ve.empty,!0);return s?new _u(this,e,t.append(s),Zt.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){pee(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Zt.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new gee(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function bFe(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let vFe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?bFe(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},yee=class xee{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=mee(e,i.attrs),this.excluded=null;let s=hee(this.attrs);this.instance=s?new Zt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Zt(this,fee(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new xee(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){pee(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},kFe=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=I5.compile(this.spec.nodes,this),this.marks=yee.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Qy.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?P5(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:P5(this,o.split(" "))}this.nodeFromJSON=i=>_u.fromJSON(this,i),this.markFromJSON=i=>Zt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof I5){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new dFe(n,n.defaultAttrs,e,Zt.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function P5(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function CFe(r){return r.tag!=null}function TFe(r){return r.style!=null}let _M=class YA{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(CFe(i))this.tags.push(i);else if(TFe(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new $5(this,t,!1);return n.addAll(e,Zt.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new $5(this,t,!0);return n.addAll(e,Zt.none,t.from,t.to),Ue.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(IFe(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=R5(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=R5(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new YA(e,YA.schemaRules(e)))}};const See={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},EFe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},wee={ol:!0,ul:!0},ex=1,XA=2,sy=4;function A5(r,e,t){return e!=null?(e?ex:0)|(e==="full"?XA:0):r&&r.whitespace=="pre"?ex|XA:t&~sy}let Aw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=Zt.none,this.match=s||(o&sy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(ve.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&ex)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=ve.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(ve.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!See.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},$5=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=A5(null,t.preserveWhitespace,0)|(n?sy:0);i?s=new Aw(i.type,i.attrs,Zt.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new Aw(null,null,Zt.none,!0,null,o):s=new Aw(e.schema.topNodeType,null,Zt.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&XA?"full":this.localPreserveWS||(i.options&ex)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;wee.hasOwnProperty(o)&&this.parser.normalizeLists&&MFe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:EFe.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(See.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Zt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):O5(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=A5(e,s,o.options);o.options&sy&&o.content.length==0&&(a|=sy);let l=Zt.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):O5(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Aw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=ex)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function MFe(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&wee.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function IFe(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function R5(r){let e={};for(let t in r)e[t]=r[t];return e}function O5(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const bee=65535,vee=Math.pow(2,16);function PFe(r,e){return r+e*vee}function N5(r){return r&bee}function AFe(r){return(r-(r&bee))/vee}const kee=1,Cee=2,qb=4,Tee=8;let ZA=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Tee)>0}get deletedBefore(){return(this.delInfo&(kee|qb))>0}get deletedAfter(){return(this.delInfo&(Cee|qb))>0}get deletedAcross(){return(this.delInfo&qb)>0}},kd=class Mh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Mh.empty)return Mh.empty}recover(e){let t=0,n=N5(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+AFe(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:PFe(a/3,e-l),m=e==l?Cee:e==d?kee:qb;return(t<0?e!=l:e!=d)&&(m|=Tee),new ZA(f,m,p)}i+=u-c}return n?e+i:new ZA(e+i,0,null)}touches(e,t){let n=0,i=N5(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Mh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Mh.empty:new Mh(e<0?[0,-e,0]:[0,0,e])}};kd.empty=new kd([]);let $Fe=class QA{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new QA(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new QA;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new ZA(e,i,null)}};const DM=Object.create(null);let zr=class{getMap(){return kd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=DM[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in DM)throw new RangeError("Duplicate use of step JSON ID "+e);return DM[e]=t,t.prototype.jsonID=e,t}},gi=class Mm{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Mm(e,null)}static fail(e){return new Mm(null,e)}static fromReplace(e,t,n,i){try{return Mm.ok(e.replace(t,n,i))}catch(s){if(s instanceof jv)return Mm.fail(s.message);throw s}}};function U_(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(U_(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return ve.fromArray(n)}let W_=class Im extends zr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Ue(U_(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return gi.fromReplace(e,this.from,this.to,s)}invert(){return new bp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Im(t.pos,n.pos,this.mark)}merge(e){return e instanceof Im&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Im(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Im(t.from,t.to,e.markFromJSON(t.mark))}};zr.jsonID("addMark",W_);let bp=class Pm extends zr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ue(U_(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return gi.fromReplace(e,this.from,this.to,n)}invert(){return new W_(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Pm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Pm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Pm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Pm(t.from,t.to,e.markFromJSON(t.mark))}};zr.jsonID("removeMark",bp);let H_=class Am extends zr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return gi.fromReplace(e,this.pos,this.pos+1,new Ue(ve.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new Am(this.pos,t.marks[i]);return new Am(this.pos,this.mark)}}return new Uv(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Am(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Am(t.pos,e.markFromJSON(t.mark))}};zr.jsonID("addNodeMark",H_);let Uv=class e$ extends zr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return gi.fromReplace(e,this.pos,this.pos+1,new Ue(ve.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new H_(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new e$(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e$(t.pos,e.markFromJSON(t.mark))}};zr.jsonID("removeNodeMark",Uv);let sa=class Qc extends zr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&t$(e,this.from,this.to)?gi.fail("Structure replace would overwrite content"):gi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new kd([this.from,this.to-this.from,this.slice.size])}invert(e){return new Qc(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Qc(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Qc)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ue.empty:new Ue(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Qc(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ue.empty:new Ue(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Qc(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Qc(t.from,t.to,Ue.fromJSON(e,t.slice),!!t.structure)}};zr.jsonID("replace",sa);let hc=class Kb extends zr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(t$(e,this.from,this.gapFrom)||t$(e,this.gapTo,this.to)))return gi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return gi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?gi.fromReplace(e,this.from,this.to,n):gi.fail("Content does not fit in gap")}getMap(){return new kd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Kb(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new Kb(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Kb(t.from,t.to,t.gapFrom,t.gapTo,Ue.fromJSON(e,t.slice),t.insert,!!t.structure)}};zr.jsonID("replaceAround",hc);function t$(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function RFe(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new bp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new W_(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function OFe(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof yee){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new bp(o.from,o.to,o.style)))}function q_(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new sa(a,u,Ue.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new bp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Ue(ve.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new sa(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(ve.empty,!0);r.replace(a,a,new Ue(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function NFe(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function _Fe(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!NFe(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function DFe(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=ve.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=ve.from(n.node(p).copy(u)),d++):l--;let h=ve.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=ve.from(i.node(p).copy(h)),f++):c++;r.step(new hc(l,c,o,a,new Ue(u.append(h),d,f),u.size-d,!0))}function FFe(r,e,t){let n=ve.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=ve.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new hc(i,s,i,s,new Ue(n,0,0),t.length,!0))}function zFe(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&BFe(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Mee(r,o,a,s),q_(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new hc(d,h,d+1,h-1,new Ue(ve.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Eee(r,o,a,s),!1}})}function Eee(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Mee(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function BFe(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function jFe(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new hc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ue(ve.from(o),0,0),1,!0))}function Jb(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function LFe(r,e,t=1,n){let i=r.doc.resolve(e),s=ve.empty,o=ve.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=ve.from(i.node(a).copy(s));let u=n&&n[c];o=ve.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new sa(e,e,new Ue(s.append(o),t,t),!0))}function Iee(r,e){let t=r.resolve(e),n=t.index();return Pee(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function UFe(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Pee(r,e){return!!(r&&e&&!r.isLeaf&&UFe(r,e))}function Aee(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Pee(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function WFe(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Mee(r,u.node(),u.before(),a)}o.inlineContent&&q_(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new sa(c,l.map(e+t,-1),Ue.empty,!0)),n===!0){let u=r.doc.resolve(c);Eee(r,u.node(),u.before(),r.steps.length)}return r}function HFe(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function qFe(r,e,t=e,n=Ue.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return $ee(i,s,n)?new sa(e,t,n):new KFe(i,s,n).fit()}function $ee(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let KFe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=ve.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=ve.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ue(s,o,a);return e>-1?new hc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new sa(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=FM(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(ve.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=FM(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ue(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=FM(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Ue($m(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Ue($m(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Ree(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Rm(this.placed,t,ve.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Ue.empty:new Ue($m(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Ue($m(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!zM(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=zM(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=zM(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Rm(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Rm(this.placed,this.depth,ve.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(ve.empty,!0);t.childCount&&(this.placed=Rm(this.placed,this.frontier.length,t))}};function $m(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy($m(r.firstChild.content,e-1,t)))}function Rm(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Rm(r.lastChild.content,e-1,t)))}function FM(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Ree(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Ree(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(ve.empty,!0)))),r.copy(n)}function zM(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!JFe(t,s.content,o)?a:null}function JFe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function VFe(r){return r.spec.defining||r.spec.definingForContent}function GFe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if($ee(i,s,n))return r.step(new sa(e,t,n));let o=Nee(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=VFe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Ue(Oee(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Oee(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Oee(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(ve.empty,!0))}return r}function YFe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=HFe(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Ue(ve.from(n),0,0))}function XFe(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Nee(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Nee(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let _ee=class Vb extends zr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return gi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return gi.fromReplace(e,this.pos,this.pos+1,new Ue(ve.from(i),0,t.isLeaf?0:1))}getMap(){return kd.empty}invert(e){return new Vb(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Vb(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Vb(t.pos,t.attr,t.value)}};zr.jsonID("attr",_ee);let Dee=class n$ extends zr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return gi.ok(n)}getMap(){return kd.empty}invert(e){return new n$(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new n$(t.attr,t.value)}};zr.jsonID("docAttr",Dee);let jf=class extends Error{};jf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};jf.prototype=Object.create(Error.prototype);jf.prototype.constructor=jf;jf.prototype.name="TransformError";let ZFe=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new $Fe}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new jf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ue.empty){let i=qFe(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Ue(ve.from(n),0,0))}delete(e,t){return this.replace(e,t,Ue.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return GFe(this,e,t,n),this}replaceRangeWith(e,t,n){return YFe(this,e,t,n),this}deleteRange(e,t){return XFe(this,e,t),this}lift(e,t){return DFe(this,e,t),this}join(e,t=1){return WFe(this,e,t),this}wrap(e,t){return FFe(this,e,t),this}setBlockType(e,t=e,n,i=null){return zFe(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return jFe(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new _ee(e,t,n)),this}setDocAttribute(e,t){return this.step(new Dee(e,t)),this}addNodeMark(e,t){return this.step(new H_(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof Zt)t.isInSet(n.marks)&&this.step(new Uv(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new Uv(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return LFe(this,e,t,n),this}addMark(e,t,n){return RFe(this,e,t,n),this}removeMark(e,t,n){return OFe(this,e,t,n),this}clearIncompatible(e,t,n){return q_(this,e,t,n),this}};const BM=Object.create(null);let Wt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new QFe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ue.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Ue.empty:t),a==0&&F5(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),F5(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Mi(e):Ih(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Ih(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Ih(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new gf(e.node(0))}static atStart(e){return Ih(e,e,0,0,1)||new gf(e)}static atEnd(e){return Ih(e,e,e.content.size,e.childCount,-1)||new gf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=BM[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in BM)throw new RangeError("Duplicate use of selection JSON ID "+e);return BM[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Mi.between(this.$anchor,this.$head).getBookmark()}};Wt.prototype.visible=!0;let QFe=class{constructor(e,t){this.$from=e,this.$to=t}},_5=!1;function D5(r){!_5&&!r.parent.inlineContent&&(_5=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Mi=class Om extends Wt{constructor(e,t=e){D5(e),D5(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Wt.near(n);let i=e.resolve(t.map(this.anchor));return new Om(i.parent.inlineContent?i:n,n)}replace(e,t=Ue.empty){if(super.replace(e,t),t==Ue.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Om&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Fee(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Om(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Wt.findFrom(t,n,!0)||Wt.findFrom(t,-n,!0);if(s)t=s.$head;else return Wt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Wt.findFrom(e,-n,!0)||Wt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new Om(e,t)}};Wt.jsonID("text",Mi);let Fee=class zee{constructor(e,t){this.anchor=e,this.head=t}map(e){return new zee(e.map(this.anchor),e.map(this.head))}resolve(e){return Mi.between(e.resolve(this.anchor),e.resolve(this.head))}},Ul=class Nm extends Wt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Wt.near(s):new Nm(s)}content(){return new Ue(ve.from(this.node),0,0)}eq(e){return e instanceof Nm&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new eze(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Nm(e.resolve(t.anchor))}static create(e,t){return new Nm(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Ul.prototype.visible=!1;Wt.jsonID("node",Ul);let eze=class Bee{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Fee(n,n):new Bee(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Ul.isSelectable(n)?new Ul(t):Wt.near(t)}},gf=class Gb extends Wt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ue.empty){if(t==Ue.empty){e.delete(0,e.doc.content.size);let n=Wt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Gb(e)}map(e){return new Gb(e)}eq(e){return e instanceof Gb}getBookmark(){return tze}};Wt.jsonID("all",gf);const tze={map(){return this},resolve(r){return new gf(r)}};function Ih(r,e,t,n,i,s=!1){if(e.inlineContent)return Mi.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Ul.isSelectable(a))return Ul.create(r,t-(i<0?a.nodeSize:0))}else{let l=Ih(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function F5(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof sa||i instanceof hc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Wt.near(r.doc.resolve(o),t))}function z5(r,e){return!e||!r?r:r.bind(e)}let $w=class{constructor(e,t,n){this.name=e,this.init=z5(t.init,n),this.apply=z5(t.apply,n)}};new $w("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new $w("selection",{init(r,e){return r.selection||Wt.atStart(e.doc)},apply(r){return r.selection}}),new $w("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new $w("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function jee(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=jee(i,e,{})),t[n]=i}return t}let fc=class{constructor(e){this.spec=e,this.props={},e.props&&jee(e.props,this,this.props),this.key=e.key?e.key.key:Lee("plugin")}getState(e){return e[this.key]}};const jM=Object.create(null);function Lee(r){return r in jM?r+"$"+ ++jM[r]:(jM[r]=0,r+"$")}let pc=class{constructor(e="key"){this.key=Lee(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var nze=Object.defineProperty,K_=(r,e)=>{for(var t in e)nze(r,t,{get:e[t],enumerable:!0})};function Uee(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var rze=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Uee({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},Wee={};K_(Wee,{blur:()=>ize,clearContent:()=>sze,clearNodes:()=>oze,command:()=>aze,createParagraphNear:()=>lze,cut:()=>cze,deleteCurrentNode:()=>uze,deleteNode:()=>dze,deleteRange:()=>hze,deleteSelection:()=>fze,enter:()=>pze,exitCode:()=>mze,extendMarkRange:()=>yze,first:()=>xze,focus:()=>bze,forEach:()=>vze,insertContent:()=>kze,insertContentAt:()=>Eze,joinBackward:()=>Pze,joinDown:()=>Ize,joinForward:()=>Aze,joinItemBackward:()=>$ze,joinItemForward:()=>Rze,joinTextblockBackward:()=>Oze,joinTextblockForward:()=>Nze,joinUp:()=>Mze,keyboardShortcut:()=>Dze,lift:()=>Fze,liftEmptyBlock:()=>zze,liftListItem:()=>Bze,newlineInCode:()=>jze,resetAttributes:()=>Lze,scrollIntoView:()=>Uze,selectAll:()=>Wze,selectNodeBackward:()=>Hze,selectNodeForward:()=>qze,selectParentNode:()=>Kze,selectTextblockEnd:()=>Jze,selectTextblockStart:()=>Vze,setContent:()=>Yze,setMark:()=>uBe,setMeta:()=>dBe,setNode:()=>hBe,setNodeSelection:()=>fBe,setTextDirection:()=>pBe,setTextSelection:()=>mBe,sinkListItem:()=>gBe,splitBlock:()=>yBe,splitListItem:()=>xBe,toggleList:()=>SBe,toggleMark:()=>wBe,toggleNode:()=>bBe,toggleWrap:()=>vBe,undoInputRule:()=>kBe,unsetAllMarks:()=>CBe,unsetMark:()=>TBe,unsetTextDirection:()=>EBe,updateAttributes:()=>MBe,wrapIn:()=>IBe,wrapInList:()=>PBe});var ize=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),sze=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),oze=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=_Fe(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},aze=r=>e=>r(e),lze=()=>({state:r,dispatch:e})=>uo(r,e),cze=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Mi(n.doc.resolve(Math.max(o-1,0)))),!0},uze=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function wr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var dze=r=>({tr:e,state:t,dispatch:n})=>{const i=wr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},hze=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},fze=()=>({state:r,dispatch:e})=>ho(r,e),pze=()=>({commands:r})=>r.keyboardShortcut("Enter"),mze=()=>({state:r,dispatch:e})=>fo(r,e);function gze(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Wv(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:gze(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function Hee(r,e,t={}){return r.find(n=>n.type===e&&Wv(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function B5(r,e,t={}){return!!Hee(r,e,t)}function J_(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!Hee([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&B5([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&B5([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function mc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var yze=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=mc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=J_(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Mi.create(o,d.from,d.to);t.setSelection(h)}}return!0},xze=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function qee(r){return r instanceof Mi}function pu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function Sze(r,e=null){if(!e)return null;const t=Wt.atStart(r),n=Wt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Mi.create(r,pu(0,i,s),pu(r.content.size,i,s)):Mi.create(r,pu(e,i,s),pu(e,i,s))}function wze(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function V_(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var bze=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(V_()||wze())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!qee(t.state.selection))return o(),!0;const a=Sze(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},vze=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),kze=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Kee=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&Kee(n)}return r};function Rw(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Kee(t)}function tx(r,e,t){if(r instanceof _u||r instanceof ve)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return ve.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),tx("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new kFe({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?_M.fromSchema(l).parseSlice(Rw(r),t.parseOptions):_M.fromSchema(l).parse(Rw(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=_M.fromSchema(e);return t.slice?s.parseSlice(Rw(r),t.parseOptions).content:s.parse(Rw(r),t.parseOptions)}return tx("",e,t)}function Cze(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof sa||i instanceof hc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Wt.near(r.doc.resolve(o),t))}var Tze=r=>!("type"in r),Eze=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{tx(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=tx(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((Tze(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof ve){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&Cze(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},Mze=()=>({state:r,dispatch:e})=>po(r,e),Ize=()=>({state:r,dispatch:e})=>mo(r,e),Pze=()=>({state:r,dispatch:e})=>go(r,e),Aze=()=>({state:r,dispatch:e})=>yo(r,e),$ze=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Aee(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},Rze=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Aee(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},Oze=()=>({state:r,dispatch:e})=>xo(r,e),Nze=()=>({state:r,dispatch:e})=>So(r,e);function Jee(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function _ze(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))V_()||Jee()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var Dze=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=_ze(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function G_(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?wr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Wv(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var Fze=(r,e={})=>({state:t,dispatch:n})=>{const i=wr(r,t.schema);return G_(t,i,e)?wo(t,n):!1},zze=()=>({state:r,dispatch:e})=>bo(r,e),Bze=r=>({state:e,dispatch:t})=>{const n=wr(r,e.schema);return vo(n)(e,t)},jze=()=>({state:r,dispatch:e})=>ko(r,e);function Vee(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function j5(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var Lze=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=Vee(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=wr(r,n.schema)),a==="mark"&&(o=mc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,j5(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(j5(h.attrs,e))))})})}),l},Uze=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),Wze=()=>({tr:r,dispatch:e})=>{if(e){const t=new gf(r.doc);r.setSelection(t)}return!0},Hze=()=>({state:r,dispatch:e})=>Co(r,e),qze=()=>({state:r,dispatch:e})=>To(r,e),Kze=()=>({state:r,dispatch:e})=>Eo(r,e),Jze=()=>({state:r,dispatch:e})=>Mo(r,e),Vze=()=>({state:r,dispatch:e})=>Io(r,e);function Gze(r,e,t={},n={}){return tx(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var Yze=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=Gze(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function Xze(r,e){const t=mc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Zze(r,e){const t=new ZFe(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function Qze(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function eBe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function Y_(r){return e=>eBe(e.$from,r)}function nx(r,e,t){return r.config[e]===void 0&&r.parent?nx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?nx(r.parent,e,t):null}):r.config[e]}function tBe(r){return typeof r=="function"}function rx(r,e=void 0,...t){return tBe(r)?e?r.bind(e)(...t):r(...t):r}function Gee(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function nBe(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function rBe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function iBe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function sBe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function oBe(r){const e=sBe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function aBe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),oBe(n)}function Yee(r,e,t){const n=[];return r===e?t.resolve(r).marks().forEach(i=>{const s=t.resolve(r),o=J_(s,i.type);o&&n.push({mark:i,...o})}):t.nodesBetween(r,e,(i,s)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),n}function Yb(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function lBe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?mc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Wv(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Wv(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function L5(r,e){const{nodeExtensions:t}=Gee(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=rx(nx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function Xee(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(Xee(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function cBe(r,e,t){var n;const{selection:i}=e;let s=null;if(qee(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var uBe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=mc(r,n.schema);if(i)if(o){const c=Xze(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return cBe(n,t,l)},dBe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),hBe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=wr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},fBe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=pu(r,0,n.content.size),s=Ul.create(n,i);e.setSelection(s)}return!0},pBe=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},mBe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Mi.atStart(n).from,a=Mi.atEnd(n).to,l=pu(i,o,a),c=pu(s,o,a),u=Mi.create(n,l,c);e.setSelection(u)}return!0},gBe=r=>({state:e,dispatch:t})=>{const n=wr(r,e.schema);return Po(n)(e,t)};function U5(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var yBe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Yb(c,a.node().type.name,a.node().attrs);if(s instanceof Ul&&s.node.isBlock)return!a.parentOffset||!Jb(o,a.pos)?!1:(n&&(r&&U5(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Qze(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=Jb(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Jb(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Mi&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&U5(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},xBe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=wr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=ve.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=ve.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...Yb(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(ve.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Ue(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Mi.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Yb(h,d.type.name,d.attrs),...e},m={...Yb(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!Jb(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},LM=(r,e)=>{const t=Y_(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Iee(r.doc,t.pos)&&r.join(t.pos),!0},UM=(r,e)=>{const t=Y_(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Iee(r.doc,n)&&r.join(n),!0},SBe=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=wr(r,o.schema),p=wr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=Y_(C=>L5(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(L5(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>LM(s,f)).command(()=>UM(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>LM(s,f)).command(()=>UM(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>LM(s,f)).command(()=>UM(s,f)).run()},wBe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=mc(r,n.schema);return lBe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},bBe=(r,e,t={})=>({state:n,commands:i})=>{const s=wr(r,n.schema),o=wr(e,n.schema),a=G_(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},vBe=(r,e={})=>({state:t,commands:n})=>{const i=wr(r,t.schema);return G_(t,i,e)?n.lift(i):n.wrapIn(i,e)},kBe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},CBe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},TBe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=mc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=J_(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},EBe=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},MBe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=Vee(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=wr(r,n.schema)),a==="mark"&&(o=mc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},IBe=(r,e={})=>({state:t,dispatch:n})=>{const i=wr(r,t.schema);return Ao(i,e)(t,n)},PBe=(r,e={})=>({state:t,dispatch:n})=>{const i=wr(r,t.schema);return $o(i,e)(t,n)},ABe=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function $Be(r){return Object.prototype.toString.call(r).slice(8,-1)}function Ow(r){return $Be(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function Zee(r,e){const t={...r};return Ow(r)&&Ow(e)&&Object.keys(e).forEach(n=>{Ow(e[n])&&Ow(r[n])?t[n]=Zee(r[n],e[n]):t[n]=e[n]}),t}var Qee=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...rx(nx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...rx(nx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Zee(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},RBe=class ete extends Qee{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new ete(t)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===t.name))return!1;const l=o.find(c=>c?.type.name===t.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},OBe=class{constructor(e){this.find=e.find,this.handler=e.handler}},NBe={};K_(NBe,{ClipboardTextSerializer:()=>_Be,Commands:()=>DBe,Delete:()=>FBe,Drop:()=>zBe,Editable:()=>BBe,FocusEvents:()=>jBe,Keymap:()=>LBe,Paste:()=>UBe,Tabindex:()=>WBe,TextDirection:()=>HBe,focusEventsPluginKey:()=>nte});var ba=class tte extends Qee{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new tte(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},_Be=ba.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new fc({key:new pc("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=iBe(t);return rBe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),DBe=ba.create({name:"commands",addCommands(){return{...Wee}}}),FBe=ba.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=Zze(r.before,[r,...e]);aBe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof bp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),zBe=ba.create({name:"drop",addProseMirrorPlugins(){return[new fc({key:new pc("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),BBe=ba.create({name:"editable",addProseMirrorPlugins(){return[new fc({key:new pc("editable"),props:{editable:()=>this.editor.options.editable}})]}}),nte=new pc("focusEvents"),jBe=ba.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new fc({key:nte,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),LBe=ba.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Wt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return V_()||Jee()?s:i},addProseMirrorPlugins(){return[new fc({key:new pc("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Wt.atStart(e.doc).from,c=Wt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!Xee(t.doc))return;const h=t.tr,f=Uee({state:t,transaction:h}),{commands:p}=new rze({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),UBe=ba.create({name:"paste",addProseMirrorPlugins(){return[new fc({key:new pc("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),WBe=ba.create({name:"tabindex",addProseMirrorPlugins(){return[new fc({key:new pc("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),HBe=ba.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=Gee(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new fc({key:new pc("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function qBe(r){return new ABe({find:r.find,handler:({state:e,range:t,match:n})=>{const i=rx(r.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:s}=e,o=n[n.length-1],a=n[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(Yee(t.from,t.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===r.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<t.to&&s.delete(u,t.to),c>t.from&&s.delete(t.from+l,c);const h=t.from+l+o.length;s.addMark(t.from+l,h,r.type.create(i||{})),s.removeStoredMark(r.type)}},undoable:r.undoable})}var KBe={};K_(KBe,{createAtomBlockMarkdownSpec:()=>JBe,createBlockMarkdownSpec:()=>VBe,createInlineMarkdownSpec:()=>XBe,parseAttributes:()=>X_,parseIndentedBlocks:()=>ZBe,renderNestedMarkdownContent:()=>QBe,serializeAttributes:()=>Z_});function X_(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function Z_(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function JBe(r){const{nodeName:e,name:t,parseAttributes:n=X_,serializeAttributes:i=Z_,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function VBe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=X_,serializeAttributes:s=Z_,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function GBe(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function YBe(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function XBe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=GBe,serializeAttributes:s=YBe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function ZBe(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function QBe(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}function eje(r){return new OBe({find:r.find,handler:({state:e,range:t,match:n,pasteEvent:i})=>{const s=rx(r.getAttributes,void 0,n,i);if(s===!1||s===null)return null;const{tr:o}=e,a=n[n.length-1],l=n[0];let c=t.to;if(a){const u=l.search(/\S/),d=t.from+l.indexOf(a),h=d+a.length;if(Yee(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<t.to&&o.delete(h,t.to),d>t.from&&o.delete(t.from+u,d),c=t.from+u+a.length,o.addMark(t.from+u,c,r.type.create(s||{})),o.removeStoredMark(r.type)}}})}var tje=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,nje=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,rte=RBe.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:r=>r.getAttribute("data-color")||r.style.backgroundColor,renderHTML:r=>r.color?{"data-color":r.color,style:`background-color: ${r.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:r}){return["mark",nBe(this.options.HTMLAttributes,r),0]},addCommands(){return{setHighlight:r=>({commands:e})=>e.setMark(this.name,r),toggleHighlight:r=>({commands:e})=>e.toggleMark(this.name,r),unsetHighlight:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[qBe({find:tje,type:this.type})]},addPasteRules(){return[eje({find:nje,type:this.type})]}});function ite(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=ite(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function ste(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=ste(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let ke=class ei{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new ei(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new ei(n,i)}cutByIndex(e,t){return e==t?ei.empty:e==0&&t==this.content.length?this:new ei(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ei(i,s)}addToStart(e){return new ei([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ei(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return ite(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ste(this,e,t,n)}findIndex(e){if(e==0)return Nw(0,e);if(e==this.size)return Nw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?Nw(t+1,s):Nw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ei.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ei(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ei.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new ei(t||e,n)}static from(e){if(!e)return ei.empty;if(e instanceof ei)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ei([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};ke.empty=new ke([],0);const WM={index:0,offset:0};function Nw(r,e){return WM.index=r,WM.offset=e,WM}function Hv(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Hv(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Hv(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let Qt=class r${constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Hv(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return r$.none;if(e instanceof r$)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};Qt.none=[];let qv=class extends Error{},We=class Ph{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=ate(this.content,e+this.openStart,t);return n&&new Ph(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Ph(ote(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Ph.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ph(ke.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Ph(e,n,i)}};We.empty=new We(ke.empty,0,0);function ote(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(ote(s.content,e-i-1,t-i-1)))}function ate(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=ate(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function rje(r,e,t){if(t.openStart>r.depth)throw new qv("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new qv("Inconsistent open depths");return lte(r,e,t,0)}function lte(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=lte(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Fu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=ije(t,r);return Fu(s,ute(r,o,a,e,n))}else return Fu(s,Kv(r,e,n))}function cte(r,e){if(!e.type.compatibleContent(r.type))throw new qv("Cannot join "+e.type.name+" onto "+r.type.name)}function i$(r,e,t){let n=r.node(t);return cte(n,e.node(t)),n}function Du(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function oy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Du(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Du(i.child(a),n);e&&e.depth==t&&e.textOffset&&Du(e.nodeBefore,n)}function Fu(r,e){return r.type.checkContent(e),r.copy(e)}function ute(r,e,t,n,i){let s=r.depth>i&&i$(r,e,i+1),o=n.depth>i&&i$(t,n,i+1),a=[];return oy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(cte(s,o),Du(Fu(s,ute(r,e,t,n,i+1)),a)):(s&&Du(Fu(s,Kv(r,e,i+1)),a),oy(e,t,i,a),o&&Du(Fu(o,Kv(t,n,i+1)),a)),oy(n,null,i,a),new ke(a)}function Kv(r,e,t){let n=[];if(oy(null,r,t,n),r.depth>t){let i=i$(r,e,t+1);Du(Fu(i,Kv(r,e,t+1)),n)}return oy(e,null,t,n),new ke(n)}function ije(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(ke.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let W5=class s${constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Qt.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new aje(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new s$(t,n,s)}static resolveCached(e,t){let n=H5.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else H5.set(e,n=new sje);let i=n.elts[n.i]=s$.resolve(e,t);return n.i=(n.i+1)%oje,i}},sje=class{constructor(){this.elts=[],this.i=0}};const oje=12,H5=new WeakMap;let aje=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const lje=Object.create(null);let zu=class o${constructor(e,t,n,i=Qt.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||ke.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Hv(this.attrs,t||e.defaultAttrs||lje)&&Qt.sameSet(this.marks,n||Qt.none)}copy(e=null){return e==this.content?this:new o$(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new o$(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return We.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new We(c,i.depth-o,s.depth-o)}replace(e,t,n){return rje(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return W5.resolveCached(this,e)}resolveNoCache(e){return W5.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),dte(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=ke.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Qt.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Qt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=ke.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};zu.prototype.text=void 0;let cje=class a$ extends zu{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):dte(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new a$(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new a$(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function dte(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let ix=class hte{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new uje(e,t);if(n.next==null)return hte.empty;let i=fte(n);n.next&&n.err("Unexpected trailing text");let s=yje(gje(i));return xje(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return ke.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};ix.empty=new ix(!0);let uje=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function fte(r){let e=[];do e.push(dje(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function dje(r){let e=[];do e.push(hje(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function hje(r){let e=mje(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=fje(r,e);else break;return e}function q5(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function fje(r,e){let t=q5(r),n=t;return r.eat(",")&&(r.next!="}"?n=q5(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function pje(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function mje(r){if(r.eat("(")){let e=fte(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=pje(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function gje(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function pte(r,e){return e-r}function K5(r,e){let t=[];return n(e),t.sort(pte);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function yje(r){let e=Object.create(null);return t(K5(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);K5(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new ix(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(pte);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function xje(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function mte(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function gte(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function yte(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function xte(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new wje(r,n,e[n]);return t}let J5=class Ste{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=xte(e,n.attrs),this.defaultAttrs=mte(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ix.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:gte(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new zu(this,this.computeAttrs(e),ke.from(t),Qt.setFrom(n))}createChecked(e=null,t,n){return t=ke.from(t),this.checkContent(t),new zu(this,this.computeAttrs(e),t,Qt.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=ke.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(ke.empty,!0);return s?new zu(this,e,t.append(s),Qt.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){yte(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Qt.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Ste(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function Sje(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let wje=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?Sje(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},wte=class bte{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=xte(e,i.attrs),this.excluded=null;let s=mte(this.attrs);this.instance=s?new Qt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Qt(this,gte(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new bte(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){yte(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},bje=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=J5.compile(this.spec.nodes,this),this.marks=wte.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=ix.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?V5(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:V5(this,o.split(" "))}this.nodeFromJSON=i=>zu.fromJSON(this,i),this.markFromJSON=i=>Qt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof J5){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new cje(n,n.defaultAttrs,e,Qt.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function V5(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function vje(r){return r.tag!=null}function kje(r){return r.style!=null}let HM=class l${constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(vje(i))this.tags.push(i);else if(kje(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new Y5(this,t,!1);return n.addAll(e,Qt.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Y5(this,t,!0);return n.addAll(e,Qt.none,t.from,t.to),We.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Eje(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=X5(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=X5(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new l$(e,l$.schemaRules(e)))}};const vte={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Cje={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},kte={ol:!0,ul:!0},sx=1,c$=2,ay=4;function G5(r,e,t){return e!=null?(e?sx:0)|(e==="full"?c$:0):r&&r.whitespace=="pre"?sx|c$:t&~ay}let _w=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=Qt.none,this.match=s||(o&ay?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(ke.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&sx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=ke.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(ke.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!vte.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},Y5=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=G5(null,t.preserveWhitespace,0)|(n?ay:0);i?s=new _w(i.type,i.attrs,Qt.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new _w(null,null,Qt.none,!0,null,o):s=new _w(e.schema.topNodeType,null,Qt.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&c$?"full":this.localPreserveWS||(i.options&sx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;kte.hasOwnProperty(o)&&this.parser.normalizeLists&&Tje(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:Cje.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(vte.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Qt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):Z5(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=G5(e,s,o.options);o.options&ay&&o.content.length==0&&(a|=ay);let l=Qt.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):Z5(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new _w(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=sx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function Tje(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&kte.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function Eje(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function X5(r){let e={};for(let t in r)e[t]=r[t];return e}function Z5(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const Cte=65535,Tte=Math.pow(2,16);function Mje(r,e){return r+e*Tte}function Q5(r){return r&Cte}function Ije(r){return(r-(r&Cte))/Tte}const Ete=1,Mte=2,Xb=4,Ite=8;let u$=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Ite)>0}get deletedBefore(){return(this.delInfo&(Ete|Xb))>0}get deletedAfter(){return(this.delInfo&(Mte|Xb))>0}get deletedAcross(){return(this.delInfo&Xb)>0}},Cd=class Ah{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Ah.empty)return Ah.empty}recover(e){let t=0,n=Q5(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+Ije(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:Mje(a/3,e-l),m=e==l?Mte:e==d?Ete:Xb;return(t<0?e!=l:e!=d)&&(m|=Ite),new u$(f,m,p)}i+=u-c}return n?e+i:new u$(e+i,0,null)}touches(e,t){let n=0,i=Q5(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Ah(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Ah.empty:new Ah(e<0?[0,-e,0]:[0,0,e])}};Cd.empty=new Cd([]);let Pje=class d${constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new d$(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new d$;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new u$(e,i,null)}};const qM=Object.create(null);let Br=class{getMap(){return Cd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=qM[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in qM)throw new RangeError("Duplicate use of step JSON ID "+e);return qM[e]=t,t.prototype.jsonID=e,t}},yi=class _m{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new _m(e,null)}static fail(e){return new _m(null,e)}static fromReplace(e,t,n,i){try{return _m.ok(e.replace(t,n,i))}catch(s){if(s instanceof qv)return _m.fail(s.message);throw s}}};function Q_(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(Q_(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return ke.fromArray(n)}let e2=class Dm extends Br{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new We(Q_(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return yi.fromReplace(e,this.from,this.to,s)}invert(){return new vp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Dm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Dm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Dm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Dm(t.from,t.to,e.markFromJSON(t.mark))}};Br.jsonID("addMark",e2);let vp=class Fm extends Br{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new We(Q_(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return yi.fromReplace(e,this.from,this.to,n)}invert(){return new e2(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Fm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Fm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Fm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Fm(t.from,t.to,e.markFromJSON(t.mark))}};Br.jsonID("removeMark",vp);let t2=class zm extends Br{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return yi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return yi.fromReplace(e,this.pos,this.pos+1,new We(ke.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new zm(this.pos,t.marks[i]);return new zm(this.pos,this.mark)}}return new Jv(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new zm(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new zm(t.pos,e.markFromJSON(t.mark))}};Br.jsonID("addNodeMark",t2);let Jv=class h$ extends Br{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return yi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return yi.fromReplace(e,this.pos,this.pos+1,new We(ke.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new t2(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new h$(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new h$(t.pos,e.markFromJSON(t.mark))}};Br.jsonID("removeNodeMark",Jv);let oa=class eu extends Br{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&f$(e,this.from,this.to)?yi.fail("Structure replace would overwrite content"):yi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Cd([this.from,this.to-this.from,this.slice.size])}invert(e){return new eu(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new eu(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof eu)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?We.empty:new We(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new eu(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?We.empty:new We(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new eu(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new eu(t.from,t.to,We.fromJSON(e,t.slice),!!t.structure)}};Br.jsonID("replace",oa);let gc=class Zb extends Br{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(f$(e,this.from,this.gapFrom)||f$(e,this.gapTo,this.to)))return yi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return yi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?yi.fromReplace(e,this.from,this.to,n):yi.fail("Content does not fit in gap")}getMap(){return new Cd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Zb(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new Zb(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Zb(t.from,t.to,t.gapFrom,t.gapTo,We.fromJSON(e,t.slice),t.insert,!!t.structure)}};Br.jsonID("replaceAround",gc);function f$(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function Aje(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new vp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new e2(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function $je(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof wte){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new vp(o.from,o.to,o.style)))}function n2(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new oa(a,u,We.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new vp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new We(ke.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new oa(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(ke.empty,!0);r.replace(a,a,new We(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function Rje(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function Oje(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!Rje(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function Nje(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=ke.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=ke.from(n.node(p).copy(u)),d++):l--;let h=ke.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=ke.from(i.node(p).copy(h)),f++):c++;r.step(new gc(l,c,o,a,new We(u.append(h),d,f),u.size-d,!0))}function _je(r,e,t){let n=ke.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=ke.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new gc(i,s,i,s,new We(n,0,0),t.length,!0))}function Dje(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&Fje(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Ate(r,o,a,s),n2(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new gc(d,h,d+1,h-1,new We(ke.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Pte(r,o,a,s),!1}})}function Pte(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Ate(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Fje(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function zje(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new gc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new We(ke.from(o),0,0),1,!0))}function Qb(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Bje(r,e,t=1,n){let i=r.doc.resolve(e),s=ke.empty,o=ke.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=ke.from(i.node(a).copy(s));let u=n&&n[c];o=ke.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new oa(e,e,new We(s.append(o),t,t),!0))}function $te(r,e){let t=r.resolve(e),n=t.index();return Rte(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function jje(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Rte(r,e){return!!(r&&e&&!r.isLeaf&&jje(r,e))}function Ote(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Rte(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function Lje(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Ate(r,u.node(),u.before(),a)}o.inlineContent&&n2(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new oa(c,l.map(e+t,-1),We.empty,!0)),n===!0){let u=r.doc.resolve(c);Pte(r,u.node(),u.before(),r.steps.length)}return r}function Uje(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function Wje(r,e,t=e,n=We.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Nte(i,s,n)?new oa(e,t,n):new Hje(i,s,n).fit()}function Nte(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let Hje=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=ke.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=ke.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new We(s,o,a);return e>-1?new gc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new oa(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=KM(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(ke.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=KM(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new We(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=KM(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new We(Bm(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new We(Bm(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(_te(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=jm(this.placed,t,ke.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?We.empty:new We(Bm(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new We(Bm(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!JM(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=JM(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=JM(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=jm(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=jm(this.placed,this.depth,ke.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(ke.empty,!0);t.childCount&&(this.placed=jm(this.placed,this.frontier.length,t))}};function Bm(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Bm(r.firstChild.content,e-1,t)))}function jm(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(jm(r.lastChild.content,e-1,t)))}function KM(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function _te(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,_te(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(ke.empty,!0)))),r.copy(n)}function JM(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!qje(t,s.content,o)?a:null}function qje(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function Kje(r){return r.spec.defining||r.spec.definingForContent}function Jje(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Nte(i,s,n))return r.step(new oa(e,t,n));let o=Fte(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=Kje(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new We(Dte(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Dte(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Dte(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(ke.empty,!0))}return r}function Vje(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=Uje(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new We(ke.from(n),0,0))}function Gje(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Fte(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Fte(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let zte=class e0 extends Br{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return yi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return yi.fromReplace(e,this.pos,this.pos+1,new We(ke.from(i),0,t.isLeaf?0:1))}getMap(){return Cd.empty}invert(e){return new e0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new e0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new e0(t.pos,t.attr,t.value)}};Br.jsonID("attr",zte);let Bte=class p$ extends Br{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return yi.ok(n)}getMap(){return Cd.empty}invert(e){return new p$(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new p$(t.attr,t.value)}};Br.jsonID("docAttr",Bte);let Lf=class extends Error{};Lf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Lf.prototype=Object.create(Error.prototype);Lf.prototype.constructor=Lf;Lf.prototype.name="TransformError";let Yje=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Pje}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Lf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=We.empty){let i=Wje(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new We(ke.from(n),0,0))}delete(e,t){return this.replace(e,t,We.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Jje(this,e,t,n),this}replaceRangeWith(e,t,n){return Vje(this,e,t,n),this}deleteRange(e,t){return Gje(this,e,t),this}lift(e,t){return Nje(this,e,t),this}join(e,t=1){return Lje(this,e,t),this}wrap(e,t){return _je(this,e,t),this}setBlockType(e,t=e,n,i=null){return Dje(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return zje(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new zte(e,t,n)),this}setDocAttribute(e,t){return this.step(new Bte(e,t)),this}addNodeMark(e,t){return this.step(new t2(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof Qt)t.isInSet(n.marks)&&this.step(new Jv(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new Jv(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return Bje(this,e,t,n),this}addMark(e,t,n){return Aje(this,e,t,n),this}removeMark(e,t,n){return $je(this,e,t,n),this}clearIncompatible(e,t,n){return n2(this,e,t,n),this}};const VM=Object.create(null);let Ht=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Xje(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=We.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?We.empty:t),a==0&&n4(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),n4(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Ln(e):$h(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?$h(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):$h(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new yf(e.node(0))}static atStart(e){return $h(e,e,0,0,1)||new yf(e)}static atEnd(e){return $h(e,e,e.content.size,e.childCount,-1)||new yf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=VM[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in VM)throw new RangeError("Duplicate use of selection JSON ID "+e);return VM[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ln.between(this.$anchor,this.$head).getBookmark()}};Ht.prototype.visible=!0;let Xje=class{constructor(e,t){this.$from=e,this.$to=t}},e4=!1;function t4(r){!e4&&!r.parent.inlineContent&&(e4=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Ln=class Lm extends Ht{constructor(e,t=e){t4(e),t4(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Ht.near(n);let i=e.resolve(t.map(this.anchor));return new Lm(i.parent.inlineContent?i:n,n)}replace(e,t=We.empty){if(super.replace(e,t),t==We.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Lm&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new jte(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Lm(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Ht.findFrom(t,n,!0)||Ht.findFrom(t,-n,!0);if(s)t=s.$head;else return Ht.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Ht.findFrom(e,-n,!0)||Ht.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new Lm(e,t)}};Ht.jsonID("text",Ln);let jte=class Lte{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Lte(e.map(this.anchor),e.map(this.head))}resolve(e){return Ln.between(e.resolve(this.anchor),e.resolve(this.head))}},co=class Um extends Ht{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Ht.near(s):new Um(s)}content(){return new We(ke.from(this.node),0,0)}eq(e){return e instanceof Um&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Zje(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Um(e.resolve(t.anchor))}static create(e,t){return new Um(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};co.prototype.visible=!1;Ht.jsonID("node",co);let Zje=class Ute{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new jte(n,n):new Ute(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&co.isSelectable(n)?new co(t):Ht.near(t)}},yf=class t0 extends Ht{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=We.empty){if(t==We.empty){e.delete(0,e.doc.content.size);let n=Ht.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new t0(e)}map(e){return new t0(e)}eq(e){return e instanceof t0}getBookmark(){return Qje}};Ht.jsonID("all",yf);const Qje={map(){return this},resolve(r){return new yf(r)}};function $h(r,e,t,n,i,s=!1){if(e.inlineContent)return Ln.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&co.isSelectable(a))return co.create(r,t-(i<0?a.nodeSize:0))}else{let l=$h(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function n4(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof oa||i instanceof gc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Ht.near(r.doc.resolve(o),t))}function r4(r,e){return!e||!r?r:r.bind(e)}let Dw=class{constructor(e,t,n){this.name=e,this.init=r4(t.init,n),this.apply=r4(t.apply,n)}};new Dw("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Dw("selection",{init(r,e){return r.selection||Ht.atStart(e.doc)},apply(r){return r.selection}}),new Dw("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Dw("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function Wte(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=Wte(i,e,{})),t[n]=i}return t}let Oo=class{constructor(e){this.spec=e,this.props={},e.props&&Wte(e.props,this,this.props),this.key=e.key?e.key.key:Hte("plugin")}getState(e){return e[this.key]}};const GM=Object.create(null);function Hte(r){return r in GM?r+"$"+ ++GM[r]:(GM[r]=0,r+"$")}let No=class{constructor(e="key"){this.key=Hte(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var eLe=Object.defineProperty,r2=(r,e)=>{for(var t in e)eLe(r,t,{get:e[t],enumerable:!0})};function qte(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var tLe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:qte({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},Kte={};r2(Kte,{blur:()=>nLe,clearContent:()=>rLe,clearNodes:()=>iLe,command:()=>sLe,createParagraphNear:()=>oLe,cut:()=>aLe,deleteCurrentNode:()=>lLe,deleteNode:()=>cLe,deleteRange:()=>uLe,deleteSelection:()=>dLe,enter:()=>hLe,exitCode:()=>fLe,extendMarkRange:()=>mLe,first:()=>gLe,focus:()=>SLe,forEach:()=>wLe,insertContent:()=>bLe,insertContentAt:()=>CLe,joinBackward:()=>MLe,joinDown:()=>ELe,joinForward:()=>ILe,joinItemBackward:()=>PLe,joinItemForward:()=>ALe,joinTextblockBackward:()=>$Le,joinTextblockForward:()=>RLe,joinUp:()=>TLe,keyboardShortcut:()=>NLe,lift:()=>_Le,liftEmptyBlock:()=>DLe,liftListItem:()=>FLe,newlineInCode:()=>zLe,resetAttributes:()=>BLe,scrollIntoView:()=>jLe,selectAll:()=>LLe,selectNodeBackward:()=>ULe,selectNodeForward:()=>WLe,selectParentNode:()=>HLe,selectTextblockEnd:()=>qLe,selectTextblockStart:()=>KLe,setContent:()=>VLe,setMark:()=>l3e,setMeta:()=>c3e,setNode:()=>u3e,setNodeSelection:()=>d3e,setTextDirection:()=>h3e,setTextSelection:()=>f3e,sinkListItem:()=>p3e,splitBlock:()=>m3e,splitListItem:()=>g3e,toggleList:()=>y3e,toggleMark:()=>x3e,toggleNode:()=>S3e,toggleWrap:()=>w3e,undoInputRule:()=>b3e,unsetAllMarks:()=>v3e,unsetMark:()=>k3e,unsetTextDirection:()=>C3e,updateAttributes:()=>T3e,wrapIn:()=>E3e,wrapInList:()=>M3e});var nLe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),rLe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),iLe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=Oje(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},sLe=r=>e=>r(e),oLe=()=>({state:r,dispatch:e})=>uo(r,e),aLe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Ln(n.doc.resolve(Math.max(o-1,0)))),!0},lLe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function or(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var cLe=r=>({tr:e,state:t,dispatch:n})=>{const i=or(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},uLe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},dLe=()=>({state:r,dispatch:e})=>ho(r,e),hLe=()=>({commands:r})=>r.keyboardShortcut("Enter"),fLe=()=>({state:r,dispatch:e})=>fo(r,e);function pLe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Vv(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:pLe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function Jte(r,e,t={}){return r.find(n=>n.type===e&&Vv(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function i4(r,e,t={}){return!!Jte(r,e,t)}function i2(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!Jte([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&i4([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&i4([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function yc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var mLe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=yc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=i2(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ln.create(o,d.from,d.to);t.setSelection(h)}}return!0},gLe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function Vte(r){return r instanceof Ln}function mu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function yLe(r,e=null){if(!e)return null;const t=Ht.atStart(r),n=Ht.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Ln.create(r,mu(0,i,s),mu(r.content.size,i,s)):Ln.create(r,mu(e,i,s),mu(e,i,s))}function xLe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function s2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var SLe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(s2()||xLe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!Vte(t.state.selection))return o(),!0;const a=yLe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},wLe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),bLe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Gte=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&Gte(n)}return r};function Fw(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Gte(t)}function ox(r,e,t){if(r instanceof zu||r instanceof ke)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return ke.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),ox("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new bje({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?HM.fromSchema(l).parseSlice(Fw(r),t.parseOptions):HM.fromSchema(l).parse(Fw(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=HM.fromSchema(e);return t.slice?s.parseSlice(Fw(r),t.parseOptions).content:s.parse(Fw(r),t.parseOptions)}return ox("",e,t)}function vLe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof oa||i instanceof gc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Ht.near(r.doc.resolve(o),t))}var kLe=r=>!("type"in r),CLe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{ox(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=ox(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((kLe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof ke){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&vLe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},TLe=()=>({state:r,dispatch:e})=>po(r,e),ELe=()=>({state:r,dispatch:e})=>mo(r,e),MLe=()=>({state:r,dispatch:e})=>go(r,e),ILe=()=>({state:r,dispatch:e})=>yo(r,e),PLe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Ote(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},ALe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Ote(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},$Le=()=>({state:r,dispatch:e})=>xo(r,e),RLe=()=>({state:r,dispatch:e})=>So(r,e);function Yte(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function OLe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))s2()||Yte()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var NLe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=OLe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function o2(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?or(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Vv(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var _Le=(r,e={})=>({state:t,dispatch:n})=>{const i=or(r,t.schema);return o2(t,i,e)?wo(t,n):!1},DLe=()=>({state:r,dispatch:e})=>bo(r,e),FLe=r=>({state:e,dispatch:t})=>{const n=or(r,e.schema);return vo(n)(e,t)},zLe=()=>({state:r,dispatch:e})=>ko(r,e);function a2(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function s4(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var BLe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=a2(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=or(r,n.schema)),a==="mark"&&(o=yc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,s4(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(s4(h.attrs,e))))})})}),l},jLe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),LLe=()=>({tr:r,dispatch:e})=>{if(e){const t=new yf(r.doc);r.setSelection(t)}return!0},ULe=()=>({state:r,dispatch:e})=>Co(r,e),WLe=()=>({state:r,dispatch:e})=>To(r,e),HLe=()=>({state:r,dispatch:e})=>Eo(r,e),qLe=()=>({state:r,dispatch:e})=>Mo(r,e),KLe=()=>({state:r,dispatch:e})=>Io(r,e);function JLe(r,e,t={},n={}){return ox(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var VLe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=JLe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function Xte(r,e){const t=yc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Zte(r,e){const t=new Yje(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function GLe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function YLe(r,e,t){const n=[];return r.nodesBetween(e.from,e.to,(i,s)=>{t(i)&&n.push({node:i,pos:s})}),n}function XLe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function l2(r){return e=>XLe(e.$from,r)}function ax(r,e,t){return r.config[e]===void 0&&r.parent?ax(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?ax(r.parent,e,t):null}):r.config[e]}function ZLe(r){return typeof r=="function"}function Uf(r,e=void 0,...t){return ZLe(r)?e?r.bind(e)(...t):r(...t):r}function Qte(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function Ha(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function QLe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function e3e(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function t3e(r,e){const t=or(e,r.schema),{from:n,to:i}=r.selection,s=[];r.doc.nodesBetween(n,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function n3e(r,e){const t=a2(typeof e=="string"?e:e.name,r.schema);return t==="node"?t3e(r,e):t==="mark"?Xte(r,e):{}}function r3e(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function i3e(r){const e=r3e(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function ene(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),i3e(n)}function c2(r,e,t){const n=[];return r===e?t.resolve(r).marks().forEach(i=>{const s=t.resolve(r),o=i2(s,i.type);o&&n.push({mark:i,...o})}):t.nodesBetween(r,e,(i,s)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),n}function n0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function s3e(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?yc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Vv(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Vv(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function o4(r,e){const{nodeExtensions:t}=Qte(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=Uf(ax(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function tne(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(tne(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function o3e(r){return r instanceof co}function a3e(r,e,t){var n;const{selection:i}=e;let s=null;if(Vte(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var l3e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=yc(r,n.schema);if(i)if(o){const c=Xte(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return a3e(n,t,l)},c3e=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),u3e=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=or(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},d3e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=mu(r,0,n.content.size),s=co.create(n,i);e.setSelection(s)}return!0},h3e=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},f3e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Ln.atStart(n).from,a=Ln.atEnd(n).to,l=mu(i,o,a),c=mu(s,o,a),u=Ln.create(n,l,c);e.setSelection(u)}return!0},p3e=r=>({state:e,dispatch:t})=>{const n=or(r,e.schema);return Po(n)(e,t)};function a4(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var m3e=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=n0(c,a.node().type.name,a.node().attrs);if(s instanceof co&&s.node.isBlock)return!a.parentOffset||!Qb(o,a.pos)?!1:(n&&(r&&a4(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:GLe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=Qb(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Qb(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Ln&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&a4(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},g3e=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=or(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=ke.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=ke.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...n0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(ke.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new We(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Ln.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...n0(h,d.type.name,d.attrs),...e},m={...n0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!Qb(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},YM=(r,e)=>{const t=l2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&$te(r.doc,t.pos)&&r.join(t.pos),!0},XM=(r,e)=>{const t=l2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&$te(r.doc,n)&&r.join(n),!0},y3e=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=or(r,o.schema),p=or(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=l2(C=>o4(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(o4(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>YM(s,f)).command(()=>XM(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>YM(s,f)).command(()=>XM(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>YM(s,f)).command(()=>XM(s,f)).run()},x3e=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=yc(r,n.schema);return s3e(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},S3e=(r,e,t={})=>({state:n,commands:i})=>{const s=or(r,n.schema),o=or(e,n.schema),a=o2(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},w3e=(r,e={})=>({state:t,commands:n})=>{const i=or(r,t.schema);return o2(t,i,e)?n.lift(i):n.wrapIn(i,e)},b3e=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},v3e=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},k3e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=yc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=i2(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},C3e=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},T3e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=a2(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=or(r,n.schema)),a==="mark"&&(o=yc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},E3e=(r,e={})=>({state:t,dispatch:n})=>{const i=or(r,t.schema);return Ao(i,e)(t,n)},M3e=(r,e={})=>({state:t,dispatch:n})=>{const i=or(r,t.schema);return $o(i,e)(t,n)},nne=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function I3e(r){return Object.prototype.toString.call(r).slice(8,-1)}function zw(r){return I3e(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function rne(r,e){const t={...r};return zw(r)&&zw(e)&&Object.keys(e).forEach(n=>{zw(e[n])&&zw(r[n])?t[n]=rne(r[n],e[n]):t[n]=e[n]}),t}var u2=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...Uf(ax(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Uf(ax(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>rne(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},kp=class ine extends u2{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new ine(t)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===t.name))return!1;const l=o.find(c=>c?.type.name===t.name);return l&&n.removeStoredMark(l),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},P3e=class{constructor(r){this.find=r.find,this.handler=r.handler}},A3e={};r2(A3e,{ClipboardTextSerializer:()=>$3e,Commands:()=>R3e,Delete:()=>O3e,Drop:()=>N3e,Editable:()=>_3e,FocusEvents:()=>D3e,Keymap:()=>F3e,Paste:()=>z3e,Tabindex:()=>B3e,TextDirection:()=>j3e,focusEventsPluginKey:()=>one});var _o=class sne extends u2{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new sne(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},$3e=_o.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Oo({key:new No("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=e3e(t);return QLe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),R3e=_o.create({name:"commands",addCommands(){return{...Kte}}}),O3e=_o.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=Zte(r.before,[r,...e]);ene(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof vp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),N3e=_o.create({name:"drop",addProseMirrorPlugins(){return[new Oo({key:new No("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),_3e=_o.create({name:"editable",addProseMirrorPlugins(){return[new Oo({key:new No("editable"),props:{editable:()=>this.editor.options.editable}})]}}),one=new No("focusEvents"),D3e=_o.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Oo({key:one,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),F3e=_o.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Ht.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return s2()||Yte()?s:i},addProseMirrorPlugins(){return[new Oo({key:new No("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Ht.atStart(e.doc).from,c=Ht.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!tne(t.doc))return;const h=t.tr,f=qte({state:t,transaction:h}),{commands:p}=new tLe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),z3e=_o.create({name:"paste",addProseMirrorPlugins(){return[new Oo({key:new No("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),B3e=_o.create({name:"tabindex",addProseMirrorPlugins(){return[new Oo({key:new No("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),j3e=_o.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=Qte(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Oo({key:new No("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function Wf(r){return new nne({find:r.find,handler:({state:e,range:t,match:n})=>{const i=Uf(r.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:s}=e,o=n[n.length-1],a=n[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(c2(t.from,t.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===r.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<t.to&&s.delete(u,t.to),c>t.from&&s.delete(t.from+l,c);const h=t.from+l+o.length;s.addMark(t.from+l,h,r.type.create(i||{})),s.removeStoredMark(r.type)}},undoable:r.undoable})}function L3e(r){return new nne({find:r.find,handler:({state:e,range:t,match:n})=>{const i=Uf(r.getAttributes,void 0,n)||{},{tr:s}=e,o=t.from;let a=t.to;const l=r.type.create(i);if(n[1]){const c=n[0].lastIndexOf(n[1]);let u=o+c;u>a?u=a:a=u+n[1].length;const d=n[0][n[0].length-1];s.insertText(d,o+n[0].length-1),s.replaceWith(u,a,l)}else if(n[0]){const c=r.type.isInline?o:o-1;s.insert(c,r.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()},undoable:r.undoable})}function U3e(r,e){const{selection:t}=r,{$from:n}=t;if(t instanceof co){const s=n.index();return n.parent.canReplaceWith(s,s+1,e)}let i=n.depth;for(;i>=0;){const s=n.index(i);if(n.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}var W3e={};r2(W3e,{createAtomBlockMarkdownSpec:()=>H3e,createBlockMarkdownSpec:()=>q3e,createInlineMarkdownSpec:()=>V3e,parseAttributes:()=>d2,parseIndentedBlocks:()=>G3e,renderNestedMarkdownContent:()=>Y3e,serializeAttributes:()=>h2});function d2(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function h2(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function H3e(r){const{nodeName:e,name:t,parseAttributes:n=d2,serializeAttributes:i=h2,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function q3e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=d2,serializeAttributes:s=h2,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function K3e(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function J3e(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function V3e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=K3e,serializeAttributes:s=J3e,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function G3e(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function Y3e(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var f2=class ane extends u2{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new ane(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function Td(r){return new P3e({find:r.find,handler:({state:e,range:t,match:n,pasteEvent:i})=>{const s=Uf(r.getAttributes,void 0,n,i);if(s===!1||s===null)return null;const{tr:o}=e,a=n[n.length-1],l=n[0];let c=t.to;if(a){const u=l.search(/\S/),d=t.from+l.indexOf(a),h=d+a.length;if(c2(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<t.to&&o.delete(h,t.to),d>t.from&&o.delete(t.from+u,d),c=t.from+u+a.length,o.addMark(t.from+u,c,r.type.create(s||{})),o.removeStoredMark(r.type)}}})}function lne(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=lne(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function cne(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=cne(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Ce=class ti{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new ti(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new ti(n,i)}cutByIndex(e,t){return e==t?ti.empty:e==0&&t==this.content.length?this:new ti(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ti(i,s)}addToStart(e){return new ti([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ti(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return lne(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return cne(this,e,t,n)}findIndex(e){if(e==0)return Bw(0,e);if(e==this.size)return Bw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?Bw(t+1,s):Bw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ti.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ti(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ti.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new ti(t||e,n)}static from(e){if(!e)return ti.empty;if(e instanceof ti)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ti([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Ce.empty=new Ce([],0);const ZM={index:0,offset:0};function Bw(r,e){return ZM.index=r,ZM.offset=e,ZM}function Gv(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Gv(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Gv(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let en=class m${constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Gv(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return m$.none;if(e instanceof m$)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};en.none=[];let Yv=class extends Error{},He=class Rh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=dne(this.content,e+this.openStart,t);return n&&new Rh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Rh(une(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Rh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Rh(Ce.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Rh(e,n,i)}};He.empty=new He(Ce.empty,0,0);function une(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(une(s.content,e-i-1,t-i-1)))}function dne(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=dne(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function X3e(r,e,t){if(t.openStart>r.depth)throw new Yv("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Yv("Inconsistent open depths");return hne(r,e,t,0)}function hne(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=hne(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return ju(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=Z3e(t,r);return ju(s,pne(r,o,a,e,n))}else return ju(s,Xv(r,e,n))}function fne(r,e){if(!e.type.compatibleContent(r.type))throw new Yv("Cannot join "+e.type.name+" onto "+r.type.name)}function g$(r,e,t){let n=r.node(t);return fne(n,e.node(t)),n}function Bu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function ly(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Bu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Bu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Bu(e.nodeBefore,n)}function ju(r,e){return r.type.checkContent(e),r.copy(e)}function pne(r,e,t,n,i){let s=r.depth>i&&g$(r,e,i+1),o=n.depth>i&&g$(t,n,i+1),a=[];return ly(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(fne(s,o),Bu(ju(s,pne(r,e,t,n,i+1)),a)):(s&&Bu(ju(s,Xv(r,e,i+1)),a),ly(e,t,i,a),o&&Bu(ju(o,Xv(t,n,i+1)),a)),ly(n,null,i,a),new Ce(a)}function Xv(r,e,t){let n=[];if(ly(null,r,t,n),r.depth>t){let i=g$(r,e,t+1);Bu(ju(i,Xv(r,e,t+1)),n)}return ly(e,null,t,n),new Ce(n)}function Z3e(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Ce.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let l4=class y${constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return en.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new t5e(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new y$(t,n,s)}static resolveCached(e,t){let n=c4.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else c4.set(e,n=new Q3e);let i=n.elts[n.i]=y$.resolve(e,t);return n.i=(n.i+1)%e5e,i}},Q3e=class{constructor(){this.elts=[],this.i=0}};const e5e=12,c4=new WeakMap;let t5e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const n5e=Object.create(null);let Lu=class x${constructor(e,t,n,i=en.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Ce.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Gv(this.attrs,t||e.defaultAttrs||n5e)&&en.sameSet(this.marks,n||en.none)}copy(e=null){return e==this.content?this:new x$(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new x$(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return He.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new He(c,i.depth-o,s.depth-o)}replace(e,t,n){return X3e(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return l4.resolveCached(this,e)}resolveNoCache(e){return l4.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),mne(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Ce.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=en.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!en.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Ce.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Lu.prototype.text=void 0;let r5e=class S$ extends Lu{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):mne(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new S$(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new S$(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function mne(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let lx=class gne{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new i5e(e,t);if(n.next==null)return gne.empty;let i=yne(n);n.next&&n.err("Unexpected trailing text");let s=d5e(u5e(i));return h5e(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Ce.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};lx.empty=new lx(!0);let i5e=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function yne(r){let e=[];do e.push(s5e(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function s5e(r){let e=[];do e.push(o5e(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function o5e(r){let e=c5e(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=a5e(r,e);else break;return e}function u4(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function a5e(r,e){let t=u4(r),n=t;return r.eat(",")&&(r.next!="}"?n=u4(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function l5e(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function c5e(r){if(r.eat("(")){let e=yne(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=l5e(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function u5e(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function xne(r,e){return e-r}function d4(r,e){let t=[];return n(e),t.sort(xne);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function d5e(r){let e=Object.create(null);return t(d4(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);d4(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new lx(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(xne);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function h5e(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Sne(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function wne(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function bne(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function vne(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new p5e(r,n,e[n]);return t}let h4=class kne{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=vne(e,n.attrs),this.defaultAttrs=Sne(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==lx.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:wne(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Lu(this,this.computeAttrs(e),Ce.from(t),en.setFrom(n))}createChecked(e=null,t,n){return t=Ce.from(t),this.checkContent(t),new Lu(this,this.computeAttrs(e),t,en.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Ce.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Ce.empty,!0);return s?new Lu(this,e,t.append(s),en.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){bne(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:en.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new kne(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function f5e(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let p5e=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?f5e(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Cne=class Tne{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=vne(e,i.attrs),this.excluded=null;let s=Sne(this.attrs);this.instance=s?new en(this,s):null}create(e=null){return!e&&this.instance?this.instance:new en(this,wne(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Tne(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){bne(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},m5e=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=h4.compile(this.spec.nodes,this),this.marks=Cne.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=lx.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?f4(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:f4(this,o.split(" "))}this.nodeFromJSON=i=>Lu.fromJSON(this,i),this.markFromJSON=i=>en.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof h4){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new r5e(n,n.defaultAttrs,e,en.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function f4(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function g5e(r){return r.tag!=null}function y5e(r){return r.style!=null}let QM=class w${constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(g5e(i))this.tags.push(i);else if(y5e(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new m4(this,t,!1);return n.addAll(e,en.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new m4(this,t,!0);return n.addAll(e,en.none,t.from,t.to),He.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(w5e(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=g4(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=g4(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new w$(e,w$.schemaRules(e)))}};const Ene={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},x5e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Mne={ol:!0,ul:!0},cx=1,b$=2,cy=4;function p4(r,e,t){return e!=null?(e?cx:0)|(e==="full"?b$:0):r&&r.whitespace=="pre"?cx|b$:t&~cy}let jw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=en.none,this.match=s||(o&cy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ce.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&cx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Ce.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ce.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ene.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},m4=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=p4(null,t.preserveWhitespace,0)|(n?cy:0);i?s=new jw(i.type,i.attrs,en.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new jw(null,null,en.none,!0,null,o):s=new jw(e.schema.topNodeType,null,en.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&b$?"full":this.localPreserveWS||(i.options&cx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Mne.hasOwnProperty(o)&&this.parser.normalizeLists&&S5e(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:x5e.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Ene.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=en.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):y4(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=p4(e,s,o.options);o.options&cy&&o.content.length==0&&(a|=cy);let l=en.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):y4(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new jw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=cx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function S5e(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Mne.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function w5e(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function g4(r){let e={};for(let t in r)e[t]=r[t];return e}function y4(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const Ine=65535,Pne=Math.pow(2,16);function b5e(r,e){return r+e*Pne}function x4(r){return r&Ine}function v5e(r){return(r-(r&Ine))/Pne}const Ane=1,$ne=2,r0=4,Rne=8;let v$=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Rne)>0}get deletedBefore(){return(this.delInfo&(Ane|r0))>0}get deletedAfter(){return(this.delInfo&($ne|r0))>0}get deletedAcross(){return(this.delInfo&r0)>0}},Ed=class Oh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Oh.empty)return Oh.empty}recover(e){let t=0,n=x4(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+v5e(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:b5e(a/3,e-l),m=e==l?$ne:e==d?Ane:r0;return(t<0?e!=l:e!=d)&&(m|=Rne),new v$(f,m,p)}i+=u-c}return n?e+i:new v$(e+i,0,null)}touches(e,t){let n=0,i=x4(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Oh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Oh.empty:new Oh(e<0?[0,-e,0]:[0,0,e])}};Ed.empty=new Ed([]);let k5e=class k${constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new k$(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new k$;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new v$(e,i,null)}};const eI=Object.create(null);let jr=class{getMap(){return Ed.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=eI[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in eI)throw new RangeError("Duplicate use of step JSON ID "+e);return eI[e]=t,t.prototype.jsonID=e,t}},xi=class Wm{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Wm(e,null)}static fail(e){return new Wm(null,e)}static fromReplace(e,t,n,i){try{return Wm.ok(e.replace(t,n,i))}catch(s){if(s instanceof Yv)return Wm.fail(s.message);throw s}}};function p2(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(p2(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Ce.fromArray(n)}let m2=class Hm extends jr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new He(p2(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return xi.fromReplace(e,this.from,this.to,s)}invert(){return new Cp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Hm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Hm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Hm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Hm(t.from,t.to,e.markFromJSON(t.mark))}};jr.jsonID("addMark",m2);let Cp=class qm extends jr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new He(p2(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return xi.fromReplace(e,this.from,this.to,n)}invert(){return new m2(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new qm(t.pos,n.pos,this.mark)}merge(e){return e instanceof qm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new qm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new qm(t.from,t.to,e.markFromJSON(t.mark))}};jr.jsonID("removeMark",Cp);let g2=class Km extends jr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return xi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return xi.fromReplace(e,this.pos,this.pos+1,new He(Ce.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new Km(this.pos,t.marks[i]);return new Km(this.pos,this.mark)}}return new Zv(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Km(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Km(t.pos,e.markFromJSON(t.mark))}};jr.jsonID("addNodeMark",g2);let Zv=class C$ extends jr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return xi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return xi.fromReplace(e,this.pos,this.pos+1,new He(Ce.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new g2(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new C$(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new C$(t.pos,e.markFromJSON(t.mark))}};jr.jsonID("removeNodeMark",Zv);let aa=class tu extends jr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&T$(e,this.from,this.to)?xi.fail("Structure replace would overwrite content"):xi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Ed([this.from,this.to-this.from,this.slice.size])}invert(e){return new tu(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new tu(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof tu)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?He.empty:new He(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new tu(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?He.empty:new He(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new tu(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new tu(t.from,t.to,He.fromJSON(e,t.slice),!!t.structure)}};jr.jsonID("replace",aa);let xc=class i0 extends jr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(T$(e,this.from,this.gapFrom)||T$(e,this.gapTo,this.to)))return xi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return xi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?xi.fromReplace(e,this.from,this.to,n):xi.fail("Content does not fit in gap")}getMap(){return new Ed([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new i0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new i0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new i0(t.from,t.to,t.gapFrom,t.gapTo,He.fromJSON(e,t.slice),t.insert,!!t.structure)}};jr.jsonID("replaceAround",xc);function T$(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function C5e(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Cp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new m2(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function T5e(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof Cne){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Cp(o.from,o.to,o.style)))}function y2(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new aa(a,u,He.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Cp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new He(Ce.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new aa(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Ce.empty,!0);r.replace(a,a,new He(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function E5e(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function M5e(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!E5e(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function I5e(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Ce.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Ce.from(n.node(p).copy(u)),d++):l--;let h=Ce.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Ce.from(i.node(p).copy(h)),f++):c++;r.step(new xc(l,c,o,a,new He(u.append(h),d,f),u.size-d,!0))}function P5e(r,e,t=null,n=r){let i=A5e(r,e),s=i&&$5e(n,e);return s?i.map(S4).concat({type:e,attrs:t}).concat(s.map(S4)):null}function S4(r){return{type:r,attrs:null}}function A5e(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return t.canReplaceWith(n,i,o)?s:null}function $5e(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=n;l&&c<i;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function R5e(r,e,t){let n=Ce.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Ce.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new xc(i,s,i,s,new He(n,0,0),t.length,!0))}function O5e(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&N5e(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Nne(r,o,a,s),y2(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new xc(d,h,d+1,h-1,new He(Ce.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&One(r,o,a,s),!1}})}function One(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Nne(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function N5e(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function _5e(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new xc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new He(Ce.from(o),0,0),1,!0))}function s0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function D5e(r,e,t=1,n){let i=r.doc.resolve(e),s=Ce.empty,o=Ce.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Ce.from(i.node(a).copy(s));let u=n&&n[c];o=Ce.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new aa(e,e,new He(s.append(o),t,t),!0))}function x2(r,e){let t=r.resolve(e),n=t.index();return _ne(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function F5e(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function _ne(r,e){return!!(r&&e&&!r.isLeaf&&F5e(r,e))}function Dne(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&_ne(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function z5e(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Nne(r,u.node(),u.before(),a)}o.inlineContent&&y2(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new aa(c,l.map(e+t,-1),He.empty,!0)),n===!0){let u=r.doc.resolve(c);One(r,u.node(),u.before(),r.steps.length)}return r}function B5e(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function j5e(r,e,t=e,n=He.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Fne(i,s,n)?new aa(e,t,n):new L5e(i,s,n).fit()}function Fne(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let L5e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Ce.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ce.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new He(s,o,a);return e>-1?new xc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new aa(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=tI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Ce.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=tI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new He(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=tI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new He(Jm(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new He(Jm(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(zne(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Vm(this.placed,t,Ce.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?He.empty:new He(Jm(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new He(Jm(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!nI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=nI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=nI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Vm(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Vm(this.placed,this.depth,Ce.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Ce.empty,!0);t.childCount&&(this.placed=Vm(this.placed,this.frontier.length,t))}};function Jm(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Jm(r.firstChild.content,e-1,t)))}function Vm(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Vm(r.lastChild.content,e-1,t)))}function tI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function zne(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,zne(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Ce.empty,!0)))),r.copy(n)}function nI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!U5e(t,s.content,o)?a:null}function U5e(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function W5e(r){return r.spec.defining||r.spec.definingForContent}function H5e(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Fne(i,s,n))return r.step(new aa(e,t,n));let o=jne(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=W5e(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new He(Bne(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Bne(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Bne(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Ce.empty,!0))}return r}function q5e(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=B5e(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new He(Ce.from(n),0,0))}function K5e(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=jne(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function jne(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let Lne=class o0 extends jr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return xi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return xi.fromReplace(e,this.pos,this.pos+1,new He(Ce.from(i),0,t.isLeaf?0:1))}getMap(){return Ed.empty}invert(e){return new o0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new o0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new o0(t.pos,t.attr,t.value)}};jr.jsonID("attr",Lne);let Une=class E$ extends jr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return xi.ok(n)}getMap(){return Ed.empty}invert(e){return new E$(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new E$(t.attr,t.value)}};jr.jsonID("docAttr",Une);let Hf=class extends Error{};Hf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Hf.prototype=Object.create(Error.prototype);Hf.prototype.constructor=Hf;Hf.prototype.name="TransformError";let J5e=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new k5e}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Hf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=He.empty){let i=j5e(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new He(Ce.from(n),0,0))}delete(e,t){return this.replace(e,t,He.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return H5e(this,e,t,n),this}replaceRangeWith(e,t,n){return q5e(this,e,t,n),this}deleteRange(e,t){return K5e(this,e,t),this}lift(e,t){return I5e(this,e,t),this}join(e,t=1){return z5e(this,e,t),this}wrap(e,t){return R5e(this,e,t),this}setBlockType(e,t=e,n,i=null){return O5e(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return _5e(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Lne(e,t,n)),this}setDocAttribute(e,t){return this.step(new Une(e,t)),this}addNodeMark(e,t){return this.step(new g2(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof en)t.isInSet(n.marks)&&this.step(new Zv(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new Zv(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return D5e(this,e,t,n),this}addMark(e,t,n){return C5e(this,e,t,n),this}removeMark(e,t,n){return T5e(this,e,t,n),this}clearIncompatible(e,t,n){return y2(this,e,t,n),this}};const rI=Object.create(null);let qt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new V5e(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=He.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?He.empty:t),a==0&&v4(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),v4(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Ii(e):Nh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Nh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Nh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new xf(e.node(0))}static atStart(e){return Nh(e,e,0,0,1)||new xf(e)}static atEnd(e){return Nh(e,e,e.content.size,e.childCount,-1)||new xf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=rI[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in rI)throw new RangeError("Duplicate use of selection JSON ID "+e);return rI[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ii.between(this.$anchor,this.$head).getBookmark()}};qt.prototype.visible=!0;let V5e=class{constructor(e,t){this.$from=e,this.$to=t}},w4=!1;function b4(r){!w4&&!r.parent.inlineContent&&(w4=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Ii=class Gm extends qt{constructor(e,t=e){b4(e),b4(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return qt.near(n);let i=e.resolve(t.map(this.anchor));return new Gm(i.parent.inlineContent?i:n,n)}replace(e,t=He.empty){if(super.replace(e,t),t==He.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Gm&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Wne(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Gm(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=qt.findFrom(t,n,!0)||qt.findFrom(t,-n,!0);if(s)t=s.$head;else return qt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(qt.findFrom(e,-n,!0)||qt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new Gm(e,t)}};qt.jsonID("text",Ii);let Wne=class Hne{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Hne(e.map(this.anchor),e.map(this.head))}resolve(e){return Ii.between(e.resolve(this.anchor),e.resolve(this.head))}},Wl=class Ym extends qt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?qt.near(s):new Ym(s)}content(){return new He(Ce.from(this.node),0,0)}eq(e){return e instanceof Ym&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new G5e(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Ym(e.resolve(t.anchor))}static create(e,t){return new Ym(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Wl.prototype.visible=!1;qt.jsonID("node",Wl);let G5e=class qne{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Wne(n,n):new qne(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Wl.isSelectable(n)?new Wl(t):qt.near(t)}},xf=class a0 extends qt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=He.empty){if(t==He.empty){e.delete(0,e.doc.content.size);let n=qt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new a0(e)}map(e){return new a0(e)}eq(e){return e instanceof a0}getBookmark(){return Y5e}};qt.jsonID("all",xf);const Y5e={map(){return this},resolve(r){return new xf(r)}};function Nh(r,e,t,n,i,s=!1){if(e.inlineContent)return Ii.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Wl.isSelectable(a))return Wl.create(r,t-(i<0?a.nodeSize:0))}else{let l=Nh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function v4(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof aa||i instanceof xc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(qt.near(r.doc.resolve(o),t))}function k4(r,e){return!e||!r?r:r.bind(e)}let Lw=class{constructor(e,t,n){this.name=e,this.init=k4(t.init,n),this.apply=k4(t.apply,n)}};new Lw("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Lw("selection",{init(r,e){return r.selection||qt.atStart(e.doc)},apply(r){return r.selection}}),new Lw("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Lw("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function Kne(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=Kne(i,e,{})),t[n]=i}return t}let Sc=class{constructor(e){this.spec=e,this.props={},e.props&&Kne(e.props,this,this.props),this.key=e.key?e.key.key:Jne("plugin")}getState(e){return e[this.key]}};const iI=Object.create(null);function Jne(r){return r in iI?r+"$"+ ++iI[r]:(iI[r]=0,r+"$")}let wc=class{constructor(e="key"){this.key=Jne(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var X5e=Object.defineProperty,S2=(r,e)=>{for(var t in e)X5e(r,t,{get:e[t],enumerable:!0})};function Vne(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var Z5e=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Vne({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},Gne={};S2(Gne,{blur:()=>Q5e,clearContent:()=>e4e,clearNodes:()=>t4e,command:()=>n4e,createParagraphNear:()=>r4e,cut:()=>i4e,deleteCurrentNode:()=>s4e,deleteNode:()=>o4e,deleteRange:()=>a4e,deleteSelection:()=>l4e,enter:()=>c4e,exitCode:()=>u4e,extendMarkRange:()=>h4e,first:()=>f4e,focus:()=>g4e,forEach:()=>y4e,insertContent:()=>x4e,insertContentAt:()=>b4e,joinBackward:()=>C4e,joinDown:()=>k4e,joinForward:()=>T4e,joinItemBackward:()=>E4e,joinItemForward:()=>M4e,joinTextblockBackward:()=>I4e,joinTextblockForward:()=>P4e,joinUp:()=>v4e,keyboardShortcut:()=>$4e,lift:()=>R4e,liftEmptyBlock:()=>O4e,liftListItem:()=>N4e,newlineInCode:()=>_4e,resetAttributes:()=>D4e,scrollIntoView:()=>F4e,selectAll:()=>z4e,selectNodeBackward:()=>B4e,selectNodeForward:()=>j4e,selectParentNode:()=>L4e,selectTextblockEnd:()=>U4e,selectTextblockStart:()=>W4e,setContent:()=>q4e,setMark:()=>s6e,setMeta:()=>o6e,setNode:()=>a6e,setNodeSelection:()=>l6e,setTextDirection:()=>c6e,setTextSelection:()=>u6e,sinkListItem:()=>d6e,splitBlock:()=>h6e,splitListItem:()=>f6e,toggleList:()=>p6e,toggleMark:()=>m6e,toggleNode:()=>g6e,toggleWrap:()=>y6e,undoInputRule:()=>x6e,unsetAllMarks:()=>S6e,unsetMark:()=>w6e,unsetTextDirection:()=>b6e,updateAttributes:()=>v6e,wrapIn:()=>k6e,wrapInList:()=>C6e});var Q5e=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),e4e=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),t4e=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=M5e(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},n4e=r=>e=>r(e),r4e=()=>({state:r,dispatch:e})=>uo(r,e),i4e=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Ii(n.doc.resolve(Math.max(o-1,0)))),!0},s4e=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function br(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var o4e=r=>({tr:e,state:t,dispatch:n})=>{const i=br(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},a4e=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},l4e=()=>({state:r,dispatch:e})=>ho(r,e),c4e=()=>({commands:r})=>r.keyboardShortcut("Enter"),u4e=()=>({state:r,dispatch:e})=>fo(r,e);function d4e(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Qv(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:d4e(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function Yne(r,e,t={}){return r.find(n=>n.type===e&&Qv(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function C4(r,e,t={}){return!!Yne(r,e,t)}function Xne(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!Yne([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&C4([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&C4([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function bc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var h4e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=bc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=Xne(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ii.create(o,d.from,d.to);t.setSelection(h)}}return!0},f4e=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function Zne(r){return r instanceof Ii}function gu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function p4e(r,e=null){if(!e)return null;const t=qt.atStart(r),n=qt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Ii.create(r,gu(0,i,s),gu(r.content.size,i,s)):Ii.create(r,gu(e,i,s),gu(e,i,s))}function m4e(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function w2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var g4e=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(w2()||m4e())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!Zne(t.state.selection))return o(),!0;const a=p4e(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},y4e=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),x4e=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Qne=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&Qne(n)}return r};function Uw(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Qne(t)}function ux(r,e,t){if(r instanceof Lu||r instanceof Ce)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Ce.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),ux("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new m5e({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?QM.fromSchema(l).parseSlice(Uw(r),t.parseOptions):QM.fromSchema(l).parse(Uw(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=QM.fromSchema(e);return t.slice?s.parseSlice(Uw(r),t.parseOptions).content:s.parse(Uw(r),t.parseOptions)}return ux("",e,t)}function S4e(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof aa||i instanceof xc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(qt.near(r.doc.resolve(o),t))}var w4e=r=>!("type"in r),b4e=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{ux(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=ux(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((w4e(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Ce){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&S4e(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},v4e=()=>({state:r,dispatch:e})=>po(r,e),k4e=()=>({state:r,dispatch:e})=>mo(r,e),C4e=()=>({state:r,dispatch:e})=>go(r,e),T4e=()=>({state:r,dispatch:e})=>yo(r,e),E4e=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Dne(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},M4e=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Dne(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},I4e=()=>({state:r,dispatch:e})=>xo(r,e),P4e=()=>({state:r,dispatch:e})=>So(r,e);function ere(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function A4e(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))w2()||ere()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var $4e=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=A4e(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function b2(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?br(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Qv(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var R4e=(r,e={})=>({state:t,dispatch:n})=>{const i=br(r,t.schema);return b2(t,i,e)?wo(t,n):!1},O4e=()=>({state:r,dispatch:e})=>bo(r,e),N4e=r=>({state:e,dispatch:t})=>{const n=br(r,e.schema);return vo(n)(e,t)},_4e=()=>({state:r,dispatch:e})=>ko(r,e);function tre(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function T4(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var D4e=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=tre(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=br(r,n.schema)),a==="mark"&&(o=bc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,T4(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(T4(h.attrs,e))))})})}),l},F4e=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),z4e=()=>({tr:r,dispatch:e})=>{if(e){const t=new xf(r.doc);r.setSelection(t)}return!0},B4e=()=>({state:r,dispatch:e})=>Co(r,e),j4e=()=>({state:r,dispatch:e})=>To(r,e),L4e=()=>({state:r,dispatch:e})=>Eo(r,e),U4e=()=>({state:r,dispatch:e})=>Mo(r,e),W4e=()=>({state:r,dispatch:e})=>Io(r,e);function H4e(r,e,t={},n={}){return ux(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var q4e=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=H4e(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function K4e(r,e){const t=bc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function J4e(r,e){const t=new J5e(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function V4e(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function G4e(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function v2(r){return e=>G4e(e.$from,r)}function dx(r,e,t){return r.config[e]===void 0&&r.parent?dx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?dx(r.parent,e,t):null}):r.config[e]}function Y4e(r){return typeof r=="function"}function ek(r,e=void 0,...t){return Y4e(r)?e?r.bind(e)(...t):r(...t):r}function nre(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function X4e(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function Z4e(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function Q4e(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function e6e(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function t6e(r){const e=e6e(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function n6e(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),t6e(n)}function l0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function r6e(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?bc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Qv(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Qv(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function E4(r,e){const{nodeExtensions:t}=nre(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=ek(dx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function rre(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(rre(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function i6e(r,e,t){var n;const{selection:i}=e;let s=null;if(Zne(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var s6e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=bc(r,n.schema);if(i)if(o){const c=K4e(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return i6e(n,t,l)},o6e=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),a6e=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=br(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},l6e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=gu(r,0,n.content.size),s=Wl.create(n,i);e.setSelection(s)}return!0},c6e=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},u6e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Ii.atStart(n).from,a=Ii.atEnd(n).to,l=gu(i,o,a),c=gu(s,o,a),u=Ii.create(n,l,c);e.setSelection(u)}return!0},d6e=r=>({state:e,dispatch:t})=>{const n=br(r,e.schema);return Po(n)(e,t)};function M4(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var h6e=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=l0(c,a.node().type.name,a.node().attrs);if(s instanceof Wl&&s.node.isBlock)return!a.parentOffset||!s0(o,a.pos)?!1:(n&&(r&&M4(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:V4e(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=s0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&s0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Ii&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&M4(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},f6e=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=br(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Ce.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Ce.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...l0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Ce.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new He(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Ii.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...l0(h,d.type.name,d.attrs),...e},m={...l0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!s0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},sI=(r,e)=>{const t=v2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&x2(r.doc,t.pos)&&r.join(t.pos),!0},oI=(r,e)=>{const t=v2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&x2(r.doc,n)&&r.join(n),!0},p6e=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=br(r,o.schema),p=br(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=v2(C=>E4(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(E4(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>sI(s,f)).command(()=>oI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>sI(s,f)).command(()=>oI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>sI(s,f)).command(()=>oI(s,f)).run()},m6e=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=bc(r,n.schema);return r6e(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},g6e=(r,e,t={})=>({state:n,commands:i})=>{const s=br(r,n.schema),o=br(e,n.schema),a=b2(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},y6e=(r,e={})=>({state:t,commands:n})=>{const i=br(r,t.schema);return b2(t,i,e)?n.lift(i):n.wrapIn(i,e)},x6e=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},S6e=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},w6e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=bc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=Xne(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},b6e=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},v6e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=tre(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=br(r,n.schema)),a==="mark"&&(o=bc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},k6e=(r,e={})=>({state:t,dispatch:n})=>{const i=br(r,t.schema);return Ao(i,e)(t,n)},C6e=(r,e={})=>({state:t,dispatch:n})=>{const i=br(r,t.schema);return $o(i,e)(t,n)},T6e=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function E6e(r){return Object.prototype.toString.call(r).slice(8,-1)}function Ww(r){return E6e(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function ire(r,e){const t={...r};return Ww(r)&&Ww(e)&&Object.keys(e).forEach(n=>{Ww(e[n])&&Ww(r[n])?t[n]=ire(r[n],e[n]):t[n]=e[n]}),t}var sre=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...ek(dx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...ek(dx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>ire(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},M6e={};S2(M6e,{ClipboardTextSerializer:()=>I6e,Commands:()=>P6e,Delete:()=>A6e,Drop:()=>$6e,Editable:()=>R6e,FocusEvents:()=>O6e,Keymap:()=>N6e,Paste:()=>_6e,Tabindex:()=>D6e,TextDirection:()=>F6e,focusEventsPluginKey:()=>are});var va=class ore extends sre{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new ore(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},I6e=va.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Sc({key:new wc("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=Q4e(t);return Z4e(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),P6e=va.create({name:"commands",addCommands(){return{...Gne}}}),A6e=va.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=J4e(r.before,[r,...e]);n6e(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Cp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),$6e=va.create({name:"drop",addProseMirrorPlugins(){return[new Sc({key:new wc("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),R6e=va.create({name:"editable",addProseMirrorPlugins(){return[new Sc({key:new wc("editable"),props:{editable:()=>this.editor.options.editable}})]}}),are=new wc("focusEvents"),O6e=va.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Sc({key:are,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),N6e=va.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:qt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return w2()||ere()?s:i},addProseMirrorPlugins(){return[new Sc({key:new wc("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=qt.atStart(e.doc).from,c=qt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!rre(t.doc))return;const h=t.tr,f=Vne({state:t,transaction:h}),{commands:p}=new Z5e({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),_6e=va.create({name:"paste",addProseMirrorPlugins(){return[new Sc({key:new wc("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),D6e=va.create({name:"tabindex",addProseMirrorPlugins(){return[new Sc({key:new wc("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),F6e=va.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=nre(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Sc({key:new wc("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function z6e(r){return new T6e({find:r.find,handler:({state:e,range:t,match:n,chain:i})=>{const s=ek(r.getAttributes,void 0,n)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&P5e(l,r.type,s);if(!c)return null;if(o.wrap(l,c),r.keepMarks&&r.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:f}=r.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>f.includes(g.type.name));o.ensureMarks(m)}}if(r.keepAttributes){const d=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&x2(o.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(n,u))&&o.join(t.from-1)},undoable:r.undoable})}var B6e={};S2(B6e,{createAtomBlockMarkdownSpec:()=>j6e,createBlockMarkdownSpec:()=>L6e,createInlineMarkdownSpec:()=>H6e,parseAttributes:()=>k2,parseIndentedBlocks:()=>q6e,renderNestedMarkdownContent:()=>K6e,serializeAttributes:()=>C2});function k2(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function C2(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function j6e(r){const{nodeName:e,name:t,parseAttributes:n=k2,serializeAttributes:i=C2,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function L6e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=k2,serializeAttributes:s=C2,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function U6e(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function W6e(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function H6e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=U6e,serializeAttributes:s=W6e,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function q6e(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function K6e(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var J6e=class lre extends sre{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new lre(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},I4=(r,e)=>{if(r==="slot")return 0;if(r instanceof Function)return r(e);const{children:t,...n}=e??{};if(r==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[r,n,t]},V6e=/^\s*>\s$/,G6e=J6e.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return I4("blockquote",{...X4e(this.options.HTMLAttributes,r),children:I4("slot",{})})},parseMarkdown:(r,e)=>e.createNode("blockquote",void 0,e.parseChildren(r.tokens||[])),renderMarkdown:(r,e)=>{if(!r.content)return"";const t=">",n=[];return r.content.forEach(i=>{const a=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?t:`${t} ${l}`);n.push(a.join(`
`))}),n.join(`
${t}
`)},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[z6e({find:V6e,type:this.type})]}}),P4=(r,e)=>{if(r==="slot")return 0;if(r instanceof Function)return r(e);const{children:t,...n}=e??{};if(r==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[r,n,t]},Y6e=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,X6e=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Z6e=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Q6e=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,e8e=kp.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return P4("strong",{...Ha(this.options.HTMLAttributes,r),children:P4("slot",{})})},markdownTokenName:"strong",parseMarkdown:(r,e)=>e.applyMark("bold",e.parseInline(r.tokens||[])),renderMarkdown:(r,e)=>`**${e.renderChildren(r)}**`,addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Wf({find:Y6e,type:this.type}),Wf({find:Z6e,type:this.type})]},addPasteRules(){return[Td({find:X6e,type:this.type}),Td({find:Q6e,type:this.type})]}}),t8e=/(^|[^`])`([^`]+)`(?!`)$/,n8e=/(^|[^`])`([^`]+)`(?!`)/g,r8e=kp.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",Ha(this.options.HTMLAttributes,r),0]},markdownTokenName:"codespan",parseMarkdown:(r,e)=>e.applyMark("code",[{type:"text",text:r.text||""}]),renderMarkdown:(r,e)=>r.content?`\`${e.renderChildren(r.content)}\``:"",addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Wf({find:t8e,type:this.type})]},addPasteRules(){return[Td({find:n8e,type:this.type})]}});function cre(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=cre(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function ure(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=ure(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Te=class ni{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new ni(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new ni(n,i)}cutByIndex(e,t){return e==t?ni.empty:e==0&&t==this.content.length?this:new ni(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ni(i,s)}addToStart(e){return new ni([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ni(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return cre(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ure(this,e,t,n)}findIndex(e){if(e==0)return Hw(0,e);if(e==this.size)return Hw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?Hw(t+1,s):Hw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ni.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ni(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ni.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new ni(t||e,n)}static from(e){if(!e)return ni.empty;if(e instanceof ni)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ni([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Te.empty=new Te([],0);const aI={index:0,offset:0};function Hw(r,e){return aI.index=r,aI.offset=e,aI}function tk(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!tk(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!tk(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let tn=class M${constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&tk(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return M$.none;if(e instanceof M$)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};tn.none=[];let nk=class extends Error{},qe=class _h{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=hre(this.content,e+this.openStart,t);return n&&new _h(n,this.openStart,this.openEnd)}removeBetween(e,t){return new _h(dre(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return _h.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new _h(Te.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new _h(e,n,i)}};qe.empty=new qe(Te.empty,0,0);function dre(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(dre(s.content,e-i-1,t-i-1)))}function hre(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=hre(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function i8e(r,e,t){if(t.openStart>r.depth)throw new nk("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new nk("Inconsistent open depths");return fre(r,e,t,0)}function fre(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=fre(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Wu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=s8e(t,r);return Wu(s,mre(r,o,a,e,n))}else return Wu(s,rk(r,e,n))}function pre(r,e){if(!e.type.compatibleContent(r.type))throw new nk("Cannot join "+e.type.name+" onto "+r.type.name)}function I$(r,e,t){let n=r.node(t);return pre(n,e.node(t)),n}function Uu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function uy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Uu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Uu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Uu(e.nodeBefore,n)}function Wu(r,e){return r.type.checkContent(e),r.copy(e)}function mre(r,e,t,n,i){let s=r.depth>i&&I$(r,e,i+1),o=n.depth>i&&I$(t,n,i+1),a=[];return uy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(pre(s,o),Uu(Wu(s,mre(r,e,t,n,i+1)),a)):(s&&Uu(Wu(s,rk(r,e,i+1)),a),uy(e,t,i,a),o&&Uu(Wu(o,rk(t,n,i+1)),a)),uy(n,null,i,a),new Te(a)}function rk(r,e,t){let n=[];if(uy(null,r,t,n),r.depth>t){let i=I$(r,e,t+1);Uu(Wu(i,rk(r,e,t+1)),n)}return uy(e,null,t,n),new Te(n)}function s8e(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Te.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let A4=class P${constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return tn.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new l8e(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new P$(t,n,s)}static resolveCached(e,t){let n=$4.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else $4.set(e,n=new o8e);let i=n.elts[n.i]=P$.resolve(e,t);return n.i=(n.i+1)%a8e,i}},o8e=class{constructor(){this.elts=[],this.i=0}};const a8e=12,$4=new WeakMap;let l8e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const c8e=Object.create(null);let Hu=class A${constructor(e,t,n,i=tn.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Te.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&tk(this.attrs,t||e.defaultAttrs||c8e)&&tn.sameSet(this.marks,n||tn.none)}copy(e=null){return e==this.content?this:new A$(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new A$(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return qe.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new qe(c,i.depth-o,s.depth-o)}replace(e,t,n){return i8e(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return A4.resolveCached(this,e)}resolveNoCache(e){return A4.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),gre(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Te.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=tn.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!tn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Te.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Hu.prototype.text=void 0;let u8e=class $$ extends Hu{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):gre(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new $$(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new $$(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function gre(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let hx=class yre{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new d8e(e,t);if(n.next==null)return yre.empty;let i=xre(n);n.next&&n.err("Unexpected trailing text");let s=x8e(y8e(i));return S8e(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Te.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};hx.empty=new hx(!0);let d8e=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function xre(r){let e=[];do e.push(h8e(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function h8e(r){let e=[];do e.push(f8e(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function f8e(r){let e=g8e(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=p8e(r,e);else break;return e}function R4(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function p8e(r,e){let t=R4(r),n=t;return r.eat(",")&&(r.next!="}"?n=R4(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function m8e(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function g8e(r){if(r.eat("(")){let e=xre(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=m8e(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function y8e(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Sre(r,e){return e-r}function O4(r,e){let t=[];return n(e),t.sort(Sre);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function x8e(r){let e=Object.create(null);return t(O4(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);O4(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new hx(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Sre);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function S8e(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function wre(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function bre(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function vre(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function kre(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new b8e(r,n,e[n]);return t}let N4=class Cre{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=kre(e,n.attrs),this.defaultAttrs=wre(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==hx.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:bre(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Hu(this,this.computeAttrs(e),Te.from(t),tn.setFrom(n))}createChecked(e=null,t,n){return t=Te.from(t),this.checkContent(t),new Hu(this,this.computeAttrs(e),t,tn.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Te.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Te.empty,!0);return s?new Hu(this,e,t.append(s),tn.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){vre(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:tn.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Cre(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function w8e(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let b8e=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?w8e(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Tre=class Ere{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=kre(e,i.attrs),this.excluded=null;let s=wre(this.attrs);this.instance=s?new tn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new tn(this,bre(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Ere(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){vre(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},v8e=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=N4.compile(this.spec.nodes,this),this.marks=Tre.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=hx.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?_4(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:_4(this,o.split(" "))}this.nodeFromJSON=i=>Hu.fromJSON(this,i),this.markFromJSON=i=>tn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof N4){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new u8e(n,n.defaultAttrs,e,tn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function _4(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function k8e(r){return r.tag!=null}function C8e(r){return r.style!=null}let lI=class R${constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(k8e(i))this.tags.push(i);else if(C8e(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new F4(this,t,!1);return n.addAll(e,tn.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new F4(this,t,!0);return n.addAll(e,tn.none,t.from,t.to),qe.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(M8e(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=z4(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=z4(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new R$(e,R$.schemaRules(e)))}};const Mre={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},T8e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ire={ol:!0,ul:!0},fx=1,O$=2,dy=4;function D4(r,e,t){return e!=null?(e?fx:0)|(e==="full"?O$:0):r&&r.whitespace=="pre"?fx|O$:t&~dy}let qw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=tn.none,this.match=s||(o&dy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Te.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&fx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Te.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Te.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Mre.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},F4=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=D4(null,t.preserveWhitespace,0)|(n?dy:0);i?s=new qw(i.type,i.attrs,tn.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new qw(null,null,tn.none,!0,null,o):s=new qw(e.schema.topNodeType,null,tn.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&O$?"full":this.localPreserveWS||(i.options&fx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Ire.hasOwnProperty(o)&&this.parser.normalizeLists&&E8e(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:T8e.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Mre.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=tn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):B4(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=D4(e,s,o.options);o.options&dy&&o.content.length==0&&(a|=dy);let l=tn.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):B4(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new qw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=fx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function E8e(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Ire.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function M8e(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function z4(r){let e={};for(let t in r)e[t]=r[t];return e}function B4(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const Pre=65535,Are=Math.pow(2,16);function I8e(r,e){return r+e*Are}function j4(r){return r&Pre}function P8e(r){return(r-(r&Pre))/Are}const $re=1,Rre=2,c0=4,Ore=8;let N$=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Ore)>0}get deletedBefore(){return(this.delInfo&($re|c0))>0}get deletedAfter(){return(this.delInfo&(Rre|c0))>0}get deletedAcross(){return(this.delInfo&c0)>0}},Md=class Dh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Dh.empty)return Dh.empty}recover(e){let t=0,n=j4(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+P8e(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:I8e(a/3,e-l),m=e==l?Rre:e==d?$re:c0;return(t<0?e!=l:e!=d)&&(m|=Ore),new N$(f,m,p)}i+=u-c}return n?e+i:new N$(e+i,0,null)}touches(e,t){let n=0,i=j4(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Dh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Dh.empty:new Dh(e<0?[0,-e,0]:[0,0,e])}};Md.empty=new Md([]);let A8e=class _${constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new _$(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new _$;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new N$(e,i,null)}};const cI=Object.create(null);let Lr=class{getMap(){return Md.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=cI[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in cI)throw new RangeError("Duplicate use of step JSON ID "+e);return cI[e]=t,t.prototype.jsonID=e,t}},Si=class Xm{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Xm(e,null)}static fail(e){return new Xm(null,e)}static fromReplace(e,t,n,i){try{return Xm.ok(e.replace(t,n,i))}catch(s){if(s instanceof nk)return Xm.fail(s.message);throw s}}};function T2(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(T2(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Te.fromArray(n)}let E2=class Zm extends Lr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new qe(T2(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return Si.fromReplace(e,this.from,this.to,s)}invert(){return new Tp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Zm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Zm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Zm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Zm(t.from,t.to,e.markFromJSON(t.mark))}};Lr.jsonID("addMark",E2);let Tp=class Qm extends Lr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new qe(T2(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return Si.fromReplace(e,this.from,this.to,n)}invert(){return new E2(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Qm(t.pos,n.pos,this.mark)}merge(e){return e instanceof Qm&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Qm(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Qm(t.from,t.to,e.markFromJSON(t.mark))}};Lr.jsonID("removeMark",Tp);let M2=class eg extends Lr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Si.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Si.fromReplace(e,this.pos,this.pos+1,new qe(Te.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new eg(this.pos,t.marks[i]);return new eg(this.pos,this.mark)}}return new ik(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new eg(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new eg(t.pos,e.markFromJSON(t.mark))}};Lr.jsonID("addNodeMark",M2);let ik=class D$ extends Lr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Si.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Si.fromReplace(e,this.pos,this.pos+1,new qe(Te.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new M2(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new D$(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new D$(t.pos,e.markFromJSON(t.mark))}};Lr.jsonID("removeNodeMark",ik);let la=class nu extends Lr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&F$(e,this.from,this.to)?Si.fail("Structure replace would overwrite content"):Si.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Md([this.from,this.to-this.from,this.slice.size])}invert(e){return new nu(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new nu(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof nu)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?qe.empty:new qe(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new nu(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?qe.empty:new qe(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new nu(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new nu(t.from,t.to,qe.fromJSON(e,t.slice),!!t.structure)}};Lr.jsonID("replace",la);let vc=class u0 extends Lr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(F$(e,this.from,this.gapFrom)||F$(e,this.gapTo,this.to)))return Si.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Si.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Si.fromReplace(e,this.from,this.to,n):Si.fail("Content does not fit in gap")}getMap(){return new Md([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new u0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new u0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new u0(t.from,t.to,t.gapFrom,t.gapTo,qe.fromJSON(e,t.slice),t.insert,!!t.structure)}};Lr.jsonID("replaceAround",vc);function F$(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function $8e(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Tp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new E2(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function R8e(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof Tre){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Tp(o.from,o.to,o.style)))}function I2(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new la(a,u,qe.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Tp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new qe(Te.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new la(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Te.empty,!0);r.replace(a,a,new qe(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function O8e(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function N8e(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!O8e(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function _8e(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Te.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Te.from(n.node(p).copy(u)),d++):l--;let h=Te.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Te.from(i.node(p).copy(h)),f++):c++;r.step(new vc(l,c,o,a,new qe(u.append(h),d,f),u.size-d,!0))}function D8e(r,e,t){let n=Te.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Te.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new vc(i,s,i,s,new qe(n,0,0),t.length,!0))}function F8e(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&z8e(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&_re(r,o,a,s),I2(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new vc(d,h,d+1,h-1,new qe(Te.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Nre(r,o,a,s),!1}})}function Nre(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function _re(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function z8e(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function B8e(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new vc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new qe(Te.from(o),0,0),1,!0))}function d0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function j8e(r,e,t=1,n){let i=r.doc.resolve(e),s=Te.empty,o=Te.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Te.from(i.node(a).copy(s));let u=n&&n[c];o=Te.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new la(e,e,new qe(s.append(o),t,t),!0))}function Dre(r,e){let t=r.resolve(e),n=t.index();return Fre(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function L8e(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Fre(r,e){return!!(r&&e&&!r.isLeaf&&L8e(r,e))}function zre(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Fre(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function U8e(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);_re(r,u.node(),u.before(),a)}o.inlineContent&&I2(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new la(c,l.map(e+t,-1),qe.empty,!0)),n===!0){let u=r.doc.resolve(c);Nre(r,u.node(),u.before(),r.steps.length)}return r}function W8e(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function H8e(r,e,t=e,n=qe.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Bre(i,s,n)?new la(e,t,n):new q8e(i,s,n).fit()}function Bre(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let q8e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Te.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Te.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new qe(s,o,a);return e>-1?new vc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new la(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=uI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Te.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=uI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new qe(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=uI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new qe(tg(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new qe(tg(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(jre(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=ng(this.placed,t,Te.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?qe.empty:new qe(tg(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new qe(tg(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!dI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=dI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=dI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=ng(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=ng(this.placed,this.depth,Te.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Te.empty,!0);t.childCount&&(this.placed=ng(this.placed,this.frontier.length,t))}};function tg(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(tg(r.firstChild.content,e-1,t)))}function ng(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(ng(r.lastChild.content,e-1,t)))}function uI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function jre(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,jre(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Te.empty,!0)))),r.copy(n)}function dI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!K8e(t,s.content,o)?a:null}function K8e(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function J8e(r){return r.spec.defining||r.spec.definingForContent}function V8e(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Bre(i,s,n))return r.step(new la(e,t,n));let o=Ure(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=J8e(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new qe(Lre(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Lre(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Lre(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Te.empty,!0))}return r}function G8e(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=W8e(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new qe(Te.from(n),0,0))}function Y8e(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Ure(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Ure(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let Wre=class h0 extends Lr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Si.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return Si.fromReplace(e,this.pos,this.pos+1,new qe(Te.from(i),0,t.isLeaf?0:1))}getMap(){return Md.empty}invert(e){return new h0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new h0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new h0(t.pos,t.attr,t.value)}};Lr.jsonID("attr",Wre);let Hre=class z$ extends Lr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return Si.ok(n)}getMap(){return Md.empty}invert(e){return new z$(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new z$(t.attr,t.value)}};Lr.jsonID("docAttr",Hre);let qf=class extends Error{};qf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};qf.prototype=Object.create(Error.prototype);qf.prototype.constructor=qf;qf.prototype.name="TransformError";let X8e=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new A8e}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new qf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=qe.empty){let i=H8e(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new qe(Te.from(n),0,0))}delete(e,t){return this.replace(e,t,qe.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return V8e(this,e,t,n),this}replaceRangeWith(e,t,n){return G8e(this,e,t,n),this}deleteRange(e,t){return Y8e(this,e,t),this}lift(e,t){return _8e(this,e,t),this}join(e,t=1){return U8e(this,e,t),this}wrap(e,t){return D8e(this,e,t),this}setBlockType(e,t=e,n,i=null){return F8e(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return B8e(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Wre(e,t,n)),this}setDocAttribute(e,t){return this.step(new Hre(e,t)),this}addNodeMark(e,t){return this.step(new M2(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof tn)t.isInSet(n.marks)&&this.step(new ik(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new ik(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return j8e(this,e,t,n),this}addMark(e,t,n){return $8e(this,e,t,n),this}removeMark(e,t,n){return R8e(this,e,t,n),this}clearIncompatible(e,t,n){return I2(this,e,t,n),this}};const hI=Object.create(null);let Dt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Z8e(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=qe.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?qe.empty:t),a==0&&W4(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),W4(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new sr(e):Fh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Fh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Fh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Sf(e.node(0))}static atStart(e){return Fh(e,e,0,0,1)||new Sf(e)}static atEnd(e){return Fh(e,e,e.content.size,e.childCount,-1)||new Sf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=hI[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in hI)throw new RangeError("Duplicate use of selection JSON ID "+e);return hI[e]=t,t.prototype.jsonID=e,t}getBookmark(){return sr.between(this.$anchor,this.$head).getBookmark()}};Dt.prototype.visible=!0;let Z8e=class{constructor(e,t){this.$from=e,this.$to=t}},L4=!1;function U4(r){!L4&&!r.parent.inlineContent&&(L4=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let sr=class rg extends Dt{constructor(e,t=e){U4(e),U4(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Dt.near(n);let i=e.resolve(t.map(this.anchor));return new rg(i.parent.inlineContent?i:n,n)}replace(e,t=qe.empty){if(super.replace(e,t),t==qe.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof rg&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new qre(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new rg(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Dt.findFrom(t,n,!0)||Dt.findFrom(t,-n,!0);if(s)t=s.$head;else return Dt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Dt.findFrom(e,-n,!0)||Dt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new rg(e,t)}};Dt.jsonID("text",sr);let qre=class Kre{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Kre(e.map(this.anchor),e.map(this.head))}resolve(e){return sr.between(e.resolve(this.anchor),e.resolve(this.head))}},Hl=class ig extends Dt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Dt.near(s):new ig(s)}content(){return new qe(Te.from(this.node),0,0)}eq(e){return e instanceof ig&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Q8e(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ig(e.resolve(t.anchor))}static create(e,t){return new ig(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Hl.prototype.visible=!1;Dt.jsonID("node",Hl);let Q8e=class Jre{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new qre(n,n):new Jre(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Hl.isSelectable(n)?new Hl(t):Dt.near(t)}},Sf=class f0 extends Dt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=qe.empty){if(t==qe.empty){e.delete(0,e.doc.content.size);let n=Dt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new f0(e)}map(e){return new f0(e)}eq(e){return e instanceof f0}getBookmark(){return eUe}};Dt.jsonID("all",Sf);const eUe={map(){return this},resolve(r){return new Sf(r)}};function Fh(r,e,t,n,i,s=!1){if(e.inlineContent)return sr.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Hl.isSelectable(a))return Hl.create(r,t-(i<0?a.nodeSize:0))}else{let l=Fh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function W4(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof la||i instanceof vc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Dt.near(r.doc.resolve(o),t))}function H4(r,e){return!e||!r?r:r.bind(e)}let Kw=class{constructor(e,t,n){this.name=e,this.init=H4(t.init,n),this.apply=H4(t.apply,n)}};new Kw("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Kw("selection",{init(r,e){return r.selection||Dt.atStart(e.doc)},apply(r){return r.selection}}),new Kw("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Kw("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function Vre(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=Vre(i,e,{})),t[n]=i}return t}let tl=class{constructor(e){this.spec=e,this.props={},e.props&&Vre(e.props,this,this.props),this.key=e.key?e.key.key:Gre("plugin")}getState(e){return e[this.key]}};const fI=Object.create(null);function Gre(r){return r in fI?r+"$"+ ++fI[r]:(fI[r]=0,r+"$")}let nl=class{constructor(e="key"){this.key=Gre(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var tUe=Object.defineProperty,P2=(r,e)=>{for(var t in e)tUe(r,t,{get:e[t],enumerable:!0})};function Yre(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var nUe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Yre({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},Xre={};P2(Xre,{blur:()=>rUe,clearContent:()=>iUe,clearNodes:()=>sUe,command:()=>oUe,createParagraphNear:()=>aUe,cut:()=>lUe,deleteCurrentNode:()=>cUe,deleteNode:()=>uUe,deleteRange:()=>dUe,deleteSelection:()=>hUe,enter:()=>fUe,exitCode:()=>pUe,extendMarkRange:()=>gUe,first:()=>yUe,focus:()=>wUe,forEach:()=>bUe,insertContent:()=>vUe,insertContentAt:()=>TUe,joinBackward:()=>IUe,joinDown:()=>MUe,joinForward:()=>PUe,joinItemBackward:()=>AUe,joinItemForward:()=>$Ue,joinTextblockBackward:()=>RUe,joinTextblockForward:()=>OUe,joinUp:()=>EUe,keyboardShortcut:()=>_Ue,lift:()=>DUe,liftEmptyBlock:()=>FUe,liftListItem:()=>zUe,newlineInCode:()=>BUe,resetAttributes:()=>jUe,scrollIntoView:()=>LUe,selectAll:()=>UUe,selectNodeBackward:()=>WUe,selectNodeForward:()=>HUe,selectParentNode:()=>qUe,selectTextblockEnd:()=>KUe,selectTextblockStart:()=>JUe,setContent:()=>GUe,setMark:()=>c9e,setMeta:()=>u9e,setNode:()=>d9e,setNodeSelection:()=>h9e,setTextDirection:()=>f9e,setTextSelection:()=>p9e,sinkListItem:()=>m9e,splitBlock:()=>g9e,splitListItem:()=>y9e,toggleList:()=>x9e,toggleMark:()=>S9e,toggleNode:()=>w9e,toggleWrap:()=>b9e,undoInputRule:()=>v9e,unsetAllMarks:()=>k9e,unsetMark:()=>C9e,unsetTextDirection:()=>T9e,updateAttributes:()=>E9e,wrapIn:()=>M9e,wrapInList:()=>I9e});var rUe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),iUe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),sUe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=N8e(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},oUe=r=>e=>r(e),aUe=()=>({state:r,dispatch:e})=>uo(r,e),lUe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new sr(n.doc.resolve(Math.max(o-1,0)))),!0},cUe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function vr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var uUe=r=>({tr:e,state:t,dispatch:n})=>{const i=vr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},dUe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},hUe=()=>({state:r,dispatch:e})=>ho(r,e),fUe=()=>({commands:r})=>r.keyboardShortcut("Enter"),pUe=()=>({state:r,dispatch:e})=>fo(r,e);function mUe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function sk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:mUe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function Zre(r,e,t={}){return r.find(n=>n.type===e&&sk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function q4(r,e,t={}){return!!Zre(r,e,t)}function Qre(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!Zre([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&q4([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&q4([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function kc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var gUe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=kc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=Qre(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=sr.create(o,d.from,d.to);t.setSelection(h)}}return!0},yUe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function eie(r){return r instanceof sr}function yu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function xUe(r,e=null){if(!e)return null;const t=Dt.atStart(r),n=Dt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?sr.create(r,yu(0,i,s),yu(r.content.size,i,s)):sr.create(r,yu(e,i,s),yu(e,i,s))}function SUe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function A2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var wUe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(A2()||SUe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!eie(t.state.selection))return o(),!0;const a=xUe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},bUe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),vUe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),tie=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&tie(n)}return r};function Jw(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return tie(t)}function px(r,e,t){if(r instanceof Hu||r instanceof Te)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Te.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),px("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new v8e({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?lI.fromSchema(l).parseSlice(Jw(r),t.parseOptions):lI.fromSchema(l).parse(Jw(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=lI.fromSchema(e);return t.slice?s.parseSlice(Jw(r),t.parseOptions).content:s.parse(Jw(r),t.parseOptions)}return px("",e,t)}function kUe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof la||i instanceof vc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Dt.near(r.doc.resolve(o),t))}var CUe=r=>!("type"in r),TUe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{px(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=px(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((CUe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Te){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&kUe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},EUe=()=>({state:r,dispatch:e})=>po(r,e),MUe=()=>({state:r,dispatch:e})=>mo(r,e),IUe=()=>({state:r,dispatch:e})=>go(r,e),PUe=()=>({state:r,dispatch:e})=>yo(r,e),AUe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=zre(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},$Ue=()=>({state:r,dispatch:e,tr:t})=>{try{const n=zre(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},RUe=()=>({state:r,dispatch:e})=>xo(r,e),OUe=()=>({state:r,dispatch:e})=>So(r,e);function nie(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function NUe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))A2()||nie()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var _Ue=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=NUe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function $2(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?vr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>sk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var DUe=(r,e={})=>({state:t,dispatch:n})=>{const i=vr(r,t.schema);return $2(t,i,e)?wo(t,n):!1},FUe=()=>({state:r,dispatch:e})=>bo(r,e),zUe=r=>({state:e,dispatch:t})=>{const n=vr(r,e.schema);return vo(n)(e,t)},BUe=()=>({state:r,dispatch:e})=>ko(r,e);function rie(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function K4(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var jUe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=rie(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=vr(r,n.schema)),a==="mark"&&(o=kc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,K4(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(K4(h.attrs,e))))})})}),l},LUe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),UUe=()=>({tr:r,dispatch:e})=>{if(e){const t=new Sf(r.doc);r.setSelection(t)}return!0},WUe=()=>({state:r,dispatch:e})=>Co(r,e),HUe=()=>({state:r,dispatch:e})=>To(r,e),qUe=()=>({state:r,dispatch:e})=>Eo(r,e),KUe=()=>({state:r,dispatch:e})=>Mo(r,e),JUe=()=>({state:r,dispatch:e})=>Io(r,e);function VUe(r,e,t={},n={}){return px(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var GUe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=VUe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function YUe(r,e){const t=kc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function XUe(r,e){const t=new X8e(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function ZUe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function QUe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function R2(r){return e=>QUe(e.$from,r)}function mx(r,e,t){return r.config[e]===void 0&&r.parent?mx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?mx(r.parent,e,t):null}):r.config[e]}function e9e(r){return typeof r=="function"}function ok(r,e=void 0,...t){return e9e(r)?e?r.bind(e)(...t):r(...t):r}function iie(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function t9e(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function n9e(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function r9e(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function i9e(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function s9e(r){const e=i9e(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function o9e(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),s9e(n)}function p0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function a9e(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?kc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>sk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>sk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function J4(r,e){const{nodeExtensions:t}=iie(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=ok(mx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function sie(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(sie(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function l9e(r,e,t){var n;const{selection:i}=e;let s=null;if(eie(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var c9e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=kc(r,n.schema);if(i)if(o){const c=YUe(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return l9e(n,t,l)},u9e=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),d9e=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=vr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},h9e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=yu(r,0,n.content.size),s=Hl.create(n,i);e.setSelection(s)}return!0},f9e=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},p9e=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=sr.atStart(n).from,a=sr.atEnd(n).to,l=yu(i,o,a),c=yu(s,o,a),u=sr.create(n,l,c);e.setSelection(u)}return!0},m9e=r=>({state:e,dispatch:t})=>{const n=vr(r,e.schema);return Po(n)(e,t)};function V4(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var g9e=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=p0(c,a.node().type.name,a.node().attrs);if(s instanceof Hl&&s.node.isBlock)return!a.parentOffset||!d0(o,a.pos)?!1:(n&&(r&&V4(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:ZUe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=d0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&d0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof sr&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&V4(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},y9e=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=vr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Te.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Te.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...p0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Te.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new qe(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(sr.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...p0(h,d.type.name,d.attrs),...e},m={...p0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!d0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},pI=(r,e)=>{const t=R2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Dre(r.doc,t.pos)&&r.join(t.pos),!0},mI=(r,e)=>{const t=R2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Dre(r.doc,n)&&r.join(n),!0},x9e=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=vr(r,o.schema),p=vr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=R2(C=>J4(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(J4(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>pI(s,f)).command(()=>mI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>pI(s,f)).command(()=>mI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>pI(s,f)).command(()=>mI(s,f)).run()},S9e=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=kc(r,n.schema);return a9e(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},w9e=(r,e,t={})=>({state:n,commands:i})=>{const s=vr(r,n.schema),o=vr(e,n.schema),a=$2(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},b9e=(r,e={})=>({state:t,commands:n})=>{const i=vr(r,t.schema);return $2(t,i,e)?n.lift(i):n.wrapIn(i,e)},v9e=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},k9e=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},C9e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=kc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=Qre(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},T9e=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},E9e=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=rie(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=vr(r,n.schema)),a==="mark"&&(o=kc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},M9e=(r,e={})=>({state:t,dispatch:n})=>{const i=vr(r,t.schema);return Ao(i,e)(t,n)},I9e=(r,e={})=>({state:t,dispatch:n})=>{const i=vr(r,t.schema);return $o(i,e)(t,n)},P9e=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function A9e(r){return Object.prototype.toString.call(r).slice(8,-1)}function Vw(r){return A9e(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function oie(r,e){const t={...r};return Vw(r)&&Vw(e)&&Object.keys(e).forEach(n=>{Vw(e[n])&&Vw(r[n])?t[n]=oie(r[n],e[n]):t[n]=e[n]}),t}var aie=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...ok(mx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...ok(mx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>oie(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},$9e={};P2($9e,{ClipboardTextSerializer:()=>R9e,Commands:()=>O9e,Delete:()=>N9e,Drop:()=>_9e,Editable:()=>D9e,FocusEvents:()=>F9e,Keymap:()=>z9e,Paste:()=>B9e,Tabindex:()=>j9e,TextDirection:()=>L9e,focusEventsPluginKey:()=>cie});var ka=class lie extends aie{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new lie(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},R9e=ka.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new tl({key:new nl("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=r9e(t);return n9e(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),O9e=ka.create({name:"commands",addCommands(){return{...Xre}}}),N9e=ka.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=XUe(r.before,[r,...e]);o9e(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Tp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),_9e=ka.create({name:"drop",addProseMirrorPlugins(){return[new tl({key:new nl("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),D9e=ka.create({name:"editable",addProseMirrorPlugins(){return[new tl({key:new nl("editable"),props:{editable:()=>this.editor.options.editable}})]}}),cie=new nl("focusEvents"),F9e=ka.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new tl({key:cie,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),z9e=ka.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Dt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return A2()||nie()?s:i},addProseMirrorPlugins(){return[new tl({key:new nl("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Dt.atStart(e.doc).from,c=Dt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!sie(t.doc))return;const h=t.tr,f=Yre({state:t,transaction:h}),{commands:p}=new nUe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),B9e=ka.create({name:"paste",addProseMirrorPlugins(){return[new tl({key:new nl("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),j9e=ka.create({name:"tabindex",addProseMirrorPlugins(){return[new tl({key:new nl("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),L9e=ka.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=iie(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new tl({key:new nl("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function G4(r){return new P9e({find:r.find,handler:({state:e,range:t,match:n})=>{const i=e.doc.resolve(t.from),s=ok(r.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,s)},undoable:r.undoable})}var U9e={};P2(U9e,{createAtomBlockMarkdownSpec:()=>W9e,createBlockMarkdownSpec:()=>H9e,createInlineMarkdownSpec:()=>J9e,parseAttributes:()=>O2,parseIndentedBlocks:()=>V9e,renderNestedMarkdownContent:()=>G9e,serializeAttributes:()=>N2});function O2(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function N2(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function W9e(r){const{nodeName:e,name:t,parseAttributes:n=O2,serializeAttributes:i=N2,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function H9e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=O2,serializeAttributes:s=N2,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function q9e(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function K9e(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function J9e(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=q9e,serializeAttributes:s=K9e,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function V9e(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function G9e(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var Y9e=class uie extends aie{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new uie(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},gI=4,X9e=/^```([a-z]+)?[\s\n]$/,Z9e=/^~~~([a-z]+)?[\s\n]$/,Q9e=Y9e.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:gI,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var e;const{languageClassPrefix:t}=this.options;if(!t)return null;const s=[...((e=r.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:e}){return["pre",t9e(this.options.HTMLAttributes,e),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(r,e)=>{var t;return((t=r.raw)==null?void 0:t.startsWith("```"))===!1&&r.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:r.lang||null},r.text?[e.createTextNode(r.text)]:[])},renderMarkdown:(r,e)=>{var t;let n="";const i=((t=r.attrs)==null?void 0:t.language)||"";return r.content?n=[`\`\`\`${i}`,e.renderChildren(r.content),"```"].join(`
`):n=`\`\`\`${i}

\`\`\``,n},addCommands(){return{setCodeBlock:r=>({commands:e})=>e.setNode(this.name,r),toggleCodeBlock:r=>({commands:e})=>e.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!r||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:r})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:gI,{state:n}=r,{selection:i}=n,{$from:s,empty:o}=i;if(s.parent.type!==this.type)return!1;const a=" ".repeat(t);return o?r.commands.insertContent(a):r.commands.command(({tr:l})=>{const{from:c,to:u}=i,f=n.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,n.schema.text(f)),!0})},"Shift-Tab":({editor:r})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:gI,{state:n}=r,{selection:i}=n,{$from:s,empty:o}=i;return s.parent.type!==this.type?!1:o?r.commands.command(({tr:a})=>{var l;const{pos:c}=s,u=s.start(),d=s.end(),f=n.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let C=0;C<f.length;C+=1){if(m+f[C].length>=g){p=C;break}m+=f[C].length+1}const S=((l=f[p].match(/^ */))==null?void 0:l[0])||"",w=Math.min(S.length,t);if(w===0)return!0;let b=u;for(let C=0;C<p;C+=1)b+=f[C].length+1;return a.delete(b,b+w),c-b<=w&&a.setSelection(sr.create(a.doc,b)),!0}):r.commands.command(({tr:a})=>{const{from:l,to:c}=i,h=n.doc.textBetween(l,c,`
`,`
`).split(`
`).map(f=>{var p;const m=((p=f.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,t);return f.slice(g)}).join(`
`);return a.replaceWith(l,c,n.schema.text(h)),!0})},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=r,{selection:t}=e,{$from:n,empty:i}=t;if(!i||n.parent.type!==this.type)return!1;const s=n.parentOffset===n.parent.nodeSize-2,o=n.parent.textContent.endsWith(`

`);return!s||!o?!1:r.chain().command(({tr:a})=>(a.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=r,{selection:t,doc:n}=e,{$from:i,empty:s}=t;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:n.nodeAt(a)?r.commands.command(({tr:c})=>(c.setSelection(Dt.near(n.resolve(a))),!0)):r.commands.exitCode()}}},addInputRules(){return[G4({find:X9e,type:this.type,getAttributes:r=>({language:r[1]})}),G4({find:Z9e,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new tl({key:new nl("codeBlockVSCodeHandler"),props:{handlePaste:(r,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,s=i?.mode;if(!t||!s)return!1;const{tr:o,schema:a}=r.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(sr.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),r.dispatch(o),!0}}})]}});function die(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=die(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function hie(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=hie(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Ee=class ri{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new ri(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new ri(n,i)}cutByIndex(e,t){return e==t?ri.empty:e==0&&t==this.content.length?this:new ri(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ri(i,s)}addToStart(e){return new ri([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ri(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return die(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return hie(this,e,t,n)}findIndex(e){if(e==0)return Gw(0,e);if(e==this.size)return Gw(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?Gw(t+1,s):Gw(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ri.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ri(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ri.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new ri(t||e,n)}static from(e){if(!e)return ri.empty;if(e instanceof ri)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ri([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Ee.empty=new Ee([],0);const yI={index:0,offset:0};function Gw(r,e){return yI.index=r,yI.offset=e,yI}function ak(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!ak(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!ak(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let nn=class B${constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ak(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return B$.none;if(e instanceof B$)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};nn.none=[];let lk=class extends Error{},Ke=class zh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=pie(this.content,e+this.openStart,t);return n&&new zh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new zh(fie(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return zh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new zh(Ee.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new zh(e,n,i)}};Ke.empty=new Ke(Ee.empty,0,0);function fie(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(fie(s.content,e-i-1,t-i-1)))}function pie(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=pie(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function e7e(r,e,t){if(t.openStart>r.depth)throw new lk("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new lk("Inconsistent open depths");return mie(r,e,t,0)}function mie(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=mie(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Ku(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=t7e(t,r);return Ku(s,yie(r,o,a,e,n))}else return Ku(s,ck(r,e,n))}function gie(r,e){if(!e.type.compatibleContent(r.type))throw new lk("Cannot join "+e.type.name+" onto "+r.type.name)}function j$(r,e,t){let n=r.node(t);return gie(n,e.node(t)),n}function qu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function hy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(qu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)qu(i.child(a),n);e&&e.depth==t&&e.textOffset&&qu(e.nodeBefore,n)}function Ku(r,e){return r.type.checkContent(e),r.copy(e)}function yie(r,e,t,n,i){let s=r.depth>i&&j$(r,e,i+1),o=n.depth>i&&j$(t,n,i+1),a=[];return hy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(gie(s,o),qu(Ku(s,yie(r,e,t,n,i+1)),a)):(s&&qu(Ku(s,ck(r,e,i+1)),a),hy(e,t,i,a),o&&qu(Ku(o,ck(t,n,i+1)),a)),hy(n,null,i,a),new Ee(a)}function ck(r,e,t){let n=[];if(hy(null,r,t,n),r.depth>t){let i=j$(r,e,t+1);qu(Ku(i,ck(r,e,t+1)),n)}return hy(e,null,t,n),new Ee(n)}function t7e(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Ee.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let Y4=class L${constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return nn.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new i7e(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new L$(t,n,s)}static resolveCached(e,t){let n=X4.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else X4.set(e,n=new n7e);let i=n.elts[n.i]=L$.resolve(e,t);return n.i=(n.i+1)%r7e,i}},n7e=class{constructor(){this.elts=[],this.i=0}};const r7e=12,X4=new WeakMap;let i7e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const s7e=Object.create(null);let Ju=class U${constructor(e,t,n,i=nn.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Ee.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&ak(this.attrs,t||e.defaultAttrs||s7e)&&nn.sameSet(this.marks,n||nn.none)}copy(e=null){return e==this.content?this:new U$(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new U$(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ke.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Ke(c,i.depth-o,s.depth-o)}replace(e,t,n){return e7e(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return Y4.resolveCached(this,e)}resolveNoCache(e){return Y4.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),xie(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Ee.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=nn.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!nn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Ee.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Ju.prototype.text=void 0;let o7e=class W$ extends Ju{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):xie(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new W$(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new W$(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function xie(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let gx=class Sie{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new a7e(e,t);if(n.next==null)return Sie.empty;let i=wie(n);n.next&&n.err("Unexpected trailing text");let s=p7e(f7e(i));return m7e(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Ee.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};gx.empty=new gx(!0);let a7e=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function wie(r){let e=[];do e.push(l7e(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function l7e(r){let e=[];do e.push(c7e(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function c7e(r){let e=h7e(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=u7e(r,e);else break;return e}function Z4(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function u7e(r,e){let t=Z4(r),n=t;return r.eat(",")&&(r.next!="}"?n=Z4(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function d7e(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function h7e(r){if(r.eat("(")){let e=wie(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=d7e(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function f7e(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function bie(r,e){return e-r}function Q4(r,e){let t=[];return n(e),t.sort(bie);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function p7e(r){let e=Object.create(null);return t(Q4(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);Q4(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new gx(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(bie);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function m7e(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function vie(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function kie(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Cie(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function Tie(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new y7e(r,n,e[n]);return t}let e6=class Eie{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Tie(e,n.attrs),this.defaultAttrs=vie(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==gx.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:kie(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ju(this,this.computeAttrs(e),Ee.from(t),nn.setFrom(n))}createChecked(e=null,t,n){return t=Ee.from(t),this.checkContent(t),new Ju(this,this.computeAttrs(e),t,nn.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Ee.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Ee.empty,!0);return s?new Ju(this,e,t.append(s),nn.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Cie(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:nn.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Eie(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function g7e(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let y7e=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?g7e(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Mie=class Iie{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Tie(e,i.attrs),this.excluded=null;let s=vie(this.attrs);this.instance=s?new nn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new nn(this,kie(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Iie(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Cie(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},x7e=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=e6.compile(this.spec.nodes,this),this.marks=Mie.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=gx.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?t6(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:t6(this,o.split(" "))}this.nodeFromJSON=i=>Ju.fromJSON(this,i),this.markFromJSON=i=>nn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof e6){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new o7e(n,n.defaultAttrs,e,nn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function t6(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function S7e(r){return r.tag!=null}function w7e(r){return r.style!=null}let xI=class H${constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(S7e(i))this.tags.push(i);else if(w7e(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new r6(this,t,!1);return n.addAll(e,nn.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new r6(this,t,!0);return n.addAll(e,nn.none,t.from,t.to),Ke.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(k7e(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=i6(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=i6(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new H$(e,H$.schemaRules(e)))}};const Pie={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},b7e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Aie={ol:!0,ul:!0},yx=1,q$=2,fy=4;function n6(r,e,t){return e!=null?(e?yx:0)|(e==="full"?q$:0):r&&r.whitespace=="pre"?yx|q$:t&~fy}let Yw=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=nn.none,this.match=s||(o&fy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ee.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&yx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Ee.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ee.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Pie.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},r6=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=n6(null,t.preserveWhitespace,0)|(n?fy:0);i?s=new Yw(i.type,i.attrs,nn.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new Yw(null,null,nn.none,!0,null,o):s=new Yw(e.schema.topNodeType,null,nn.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&q$?"full":this.localPreserveWS||(i.options&yx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Aie.hasOwnProperty(o)&&this.parser.normalizeLists&&v7e(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:b7e.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Pie.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=nn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):s6(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=n6(e,s,o.options);o.options&fy&&o.content.length==0&&(a|=fy);let l=nn.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):s6(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Yw(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=yx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function v7e(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Aie.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function k7e(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function i6(r){let e={};for(let t in r)e[t]=r[t];return e}function s6(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const $ie=65535,Rie=Math.pow(2,16);function C7e(r,e){return r+e*Rie}function o6(r){return r&$ie}function T7e(r){return(r-(r&$ie))/Rie}const Oie=1,Nie=2,m0=4,_ie=8;let K$=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&_ie)>0}get deletedBefore(){return(this.delInfo&(Oie|m0))>0}get deletedAfter(){return(this.delInfo&(Nie|m0))>0}get deletedAcross(){return(this.delInfo&m0)>0}},Id=class Bh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Bh.empty)return Bh.empty}recover(e){let t=0,n=o6(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+T7e(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:C7e(a/3,e-l),m=e==l?Nie:e==d?Oie:m0;return(t<0?e!=l:e!=d)&&(m|=_ie),new K$(f,m,p)}i+=u-c}return n?e+i:new K$(e+i,0,null)}touches(e,t){let n=0,i=o6(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Bh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Bh.empty:new Bh(e<0?[0,-e,0]:[0,0,e])}};Id.empty=new Id([]);let E7e=class J${constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new J$(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new J$;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new K$(e,i,null)}};const SI=Object.create(null);let Ur=class{getMap(){return Id.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=SI[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in SI)throw new RangeError("Duplicate use of step JSON ID "+e);return SI[e]=t,t.prototype.jsonID=e,t}},wi=class sg{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new sg(e,null)}static fail(e){return new sg(null,e)}static fromReplace(e,t,n,i){try{return sg.ok(e.replace(t,n,i))}catch(s){if(s instanceof lk)return sg.fail(s.message);throw s}}};function _2(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(_2(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Ee.fromArray(n)}let D2=class og extends Ur{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Ke(_2(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return wi.fromReplace(e,this.from,this.to,s)}invert(){return new Ep(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new og(t.pos,n.pos,this.mark)}merge(e){return e instanceof og&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new og(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new og(t.from,t.to,e.markFromJSON(t.mark))}};Ur.jsonID("addMark",D2);let Ep=class ag extends Ur{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ke(_2(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return wi.fromReplace(e,this.from,this.to,n)}invert(){return new D2(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new ag(t.pos,n.pos,this.mark)}merge(e){return e instanceof ag&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ag(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ag(t.from,t.to,e.markFromJSON(t.mark))}};Ur.jsonID("removeMark",Ep);let F2=class lg extends Ur{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return wi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return wi.fromReplace(e,this.pos,this.pos+1,new Ke(Ee.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new lg(this.pos,t.marks[i]);return new lg(this.pos,this.mark)}}return new uk(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new lg(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new lg(t.pos,e.markFromJSON(t.mark))}};Ur.jsonID("addNodeMark",F2);let uk=class V$ extends Ur{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return wi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return wi.fromReplace(e,this.pos,this.pos+1,new Ke(Ee.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new F2(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new V$(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new V$(t.pos,e.markFromJSON(t.mark))}};Ur.jsonID("removeNodeMark",uk);let ca=class ru extends Ur{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&G$(e,this.from,this.to)?wi.fail("Structure replace would overwrite content"):wi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Id([this.from,this.to-this.from,this.slice.size])}invert(e){return new ru(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new ru(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ru)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ke.empty:new Ke(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ru(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ke.empty:new Ke(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ru(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ru(t.from,t.to,Ke.fromJSON(e,t.slice),!!t.structure)}};Ur.jsonID("replace",ca);let Cc=class g0 extends Ur{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(G$(e,this.from,this.gapFrom)||G$(e,this.gapTo,this.to)))return wi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return wi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?wi.fromReplace(e,this.from,this.to,n):wi.fail("Content does not fit in gap")}getMap(){return new Id([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new g0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new g0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new g0(t.from,t.to,t.gapFrom,t.gapTo,Ke.fromJSON(e,t.slice),t.insert,!!t.structure)}};Ur.jsonID("replaceAround",Cc);function G$(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function M7e(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Ep(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new D2(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function I7e(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof Mie){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Ep(o.from,o.to,o.style)))}function z2(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new ca(a,u,Ke.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Ep(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Ke(Ee.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ca(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Ee.empty,!0);r.replace(a,a,new Ke(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function P7e(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function A7e(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!P7e(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function $7e(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Ee.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Ee.from(n.node(p).copy(u)),d++):l--;let h=Ee.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Ee.from(i.node(p).copy(h)),f++):c++;r.step(new Cc(l,c,o,a,new Ke(u.append(h),d,f),u.size-d,!0))}function R7e(r,e,t){let n=Ee.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Ee.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Cc(i,s,i,s,new Ke(n,0,0),t.length,!0))}function O7e(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&N7e(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Fie(r,o,a,s),z2(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new Cc(d,h,d+1,h-1,new Ke(Ee.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Die(r,o,a,s),!1}})}function Die(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Fie(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function N7e(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function _7e(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Cc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ke(Ee.from(o),0,0),1,!0))}function y0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function D7e(r,e,t=1,n){let i=r.doc.resolve(e),s=Ee.empty,o=Ee.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Ee.from(i.node(a).copy(s));let u=n&&n[c];o=Ee.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new ca(e,e,new Ke(s.append(o),t,t),!0))}function zie(r,e){let t=r.resolve(e),n=t.index();return Bie(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function F7e(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Bie(r,e){return!!(r&&e&&!r.isLeaf&&F7e(r,e))}function jie(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Bie(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function z7e(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Fie(r,u.node(),u.before(),a)}o.inlineContent&&z2(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new ca(c,l.map(e+t,-1),Ke.empty,!0)),n===!0){let u=r.doc.resolve(c);Die(r,u.node(),u.before(),r.steps.length)}return r}function B7e(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function j7e(r,e,t=e,n=Ke.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Lie(i,s,n)?new ca(e,t,n):new L7e(i,s,n).fit()}function Lie(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let L7e=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Ee.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ee.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ke(s,o,a);return e>-1?new Cc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new ca(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=wI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Ee.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=wI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ke(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=wI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Ke(cg(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Ke(cg(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Uie(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=ug(this.placed,t,Ee.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Ke.empty:new Ke(cg(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Ke(cg(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!bI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=bI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=bI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=ug(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=ug(this.placed,this.depth,Ee.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Ee.empty,!0);t.childCount&&(this.placed=ug(this.placed,this.frontier.length,t))}};function cg(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(cg(r.firstChild.content,e-1,t)))}function ug(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(ug(r.lastChild.content,e-1,t)))}function wI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Uie(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Uie(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Ee.empty,!0)))),r.copy(n)}function bI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!U7e(t,s.content,o)?a:null}function U7e(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function W7e(r){return r.spec.defining||r.spec.definingForContent}function H7e(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Lie(i,s,n))return r.step(new ca(e,t,n));let o=Hie(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=W7e(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Ke(Wie(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Wie(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Wie(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Ee.empty,!0))}return r}function q7e(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=B7e(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Ke(Ee.from(n),0,0))}function K7e(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Hie(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Hie(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let qie=class x0 extends Ur{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return wi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return wi.fromReplace(e,this.pos,this.pos+1,new Ke(Ee.from(i),0,t.isLeaf?0:1))}getMap(){return Id.empty}invert(e){return new x0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new x0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new x0(t.pos,t.attr,t.value)}};Ur.jsonID("attr",qie);let Kie=class Y$ extends Ur{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return wi.ok(n)}getMap(){return Id.empty}invert(e){return new Y$(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Y$(t.attr,t.value)}};Ur.jsonID("docAttr",Kie);let Kf=class extends Error{};Kf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Kf.prototype=Object.create(Error.prototype);Kf.prototype.constructor=Kf;Kf.prototype.name="TransformError";let J7e=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new E7e}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Kf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ke.empty){let i=j7e(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Ke(Ee.from(n),0,0))}delete(e,t){return this.replace(e,t,Ke.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return H7e(this,e,t,n),this}replaceRangeWith(e,t,n){return q7e(this,e,t,n),this}deleteRange(e,t){return K7e(this,e,t),this}lift(e,t){return $7e(this,e,t),this}join(e,t=1){return z7e(this,e,t),this}wrap(e,t){return R7e(this,e,t),this}setBlockType(e,t=e,n,i=null){return O7e(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return _7e(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new qie(e,t,n)),this}setDocAttribute(e,t){return this.step(new Kie(e,t)),this}addNodeMark(e,t){return this.step(new F2(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof nn)t.isInSet(n.marks)&&this.step(new uk(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new uk(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return D7e(this,e,t,n),this}addMark(e,t,n){return M7e(this,e,t,n),this}removeMark(e,t,n){return I7e(this,e,t,n),this}clearIncompatible(e,t,n){return z2(this,e,t,n),this}};const vI=Object.create(null);let Kt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new V7e(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ke.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Ke.empty:t),a==0&&c6(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),c6(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Pi(e):jh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?jh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):jh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new wf(e.node(0))}static atStart(e){return jh(e,e,0,0,1)||new wf(e)}static atEnd(e){return jh(e,e,e.content.size,e.childCount,-1)||new wf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=vI[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in vI)throw new RangeError("Duplicate use of selection JSON ID "+e);return vI[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Pi.between(this.$anchor,this.$head).getBookmark()}};Kt.prototype.visible=!0;let V7e=class{constructor(e,t){this.$from=e,this.$to=t}},a6=!1;function l6(r){!a6&&!r.parent.inlineContent&&(a6=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Pi=class dg extends Kt{constructor(e,t=e){l6(e),l6(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Kt.near(n);let i=e.resolve(t.map(this.anchor));return new dg(i.parent.inlineContent?i:n,n)}replace(e,t=Ke.empty){if(super.replace(e,t),t==Ke.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof dg&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Jie(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new dg(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Kt.findFrom(t,n,!0)||Kt.findFrom(t,-n,!0);if(s)t=s.$head;else return Kt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Kt.findFrom(e,-n,!0)||Kt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new dg(e,t)}};Kt.jsonID("text",Pi);let Jie=class Vie{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Vie(e.map(this.anchor),e.map(this.head))}resolve(e){return Pi.between(e.resolve(this.anchor),e.resolve(this.head))}},ql=class hg extends Kt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Kt.near(s):new hg(s)}content(){return new Ke(Ee.from(this.node),0,0)}eq(e){return e instanceof hg&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new G7e(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new hg(e.resolve(t.anchor))}static create(e,t){return new hg(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};ql.prototype.visible=!1;Kt.jsonID("node",ql);let G7e=class Gie{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Jie(n,n):new Gie(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&ql.isSelectable(n)?new ql(t):Kt.near(t)}},wf=class S0 extends Kt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ke.empty){if(t==Ke.empty){e.delete(0,e.doc.content.size);let n=Kt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new S0(e)}map(e){return new S0(e)}eq(e){return e instanceof S0}getBookmark(){return Y7e}};Kt.jsonID("all",wf);const Y7e={map(){return this},resolve(r){return new wf(r)}};function jh(r,e,t,n,i,s=!1){if(e.inlineContent)return Pi.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&ql.isSelectable(a))return ql.create(r,t-(i<0?a.nodeSize:0))}else{let l=jh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function c6(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof ca||i instanceof Cc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Kt.near(r.doc.resolve(o),t))}function u6(r,e){return!e||!r?r:r.bind(e)}let Xw=class{constructor(e,t,n){this.name=e,this.init=u6(t.init,n),this.apply=u6(t.apply,n)}};new Xw("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Xw("selection",{init(r,e){return r.selection||Kt.atStart(e.doc)},apply(r){return r.selection}}),new Xw("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Xw("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function Yie(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=Yie(i,e,{})),t[n]=i}return t}let Tc=class{constructor(e){this.spec=e,this.props={},e.props&&Yie(e.props,this,this.props),this.key=e.key?e.key.key:Xie("plugin")}getState(e){return e[this.key]}};const kI=Object.create(null);function Xie(r){return r in kI?r+"$"+ ++kI[r]:(kI[r]=0,r+"$")}let Ec=class{constructor(e="key"){this.key=Xie(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var X7e=Object.defineProperty,B2=(r,e)=>{for(var t in e)X7e(r,t,{get:e[t],enumerable:!0})};function Zie(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var Z7e=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Zie({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},Qie={};B2(Qie,{blur:()=>Q7e,clearContent:()=>eWe,clearNodes:()=>tWe,command:()=>nWe,createParagraphNear:()=>rWe,cut:()=>iWe,deleteCurrentNode:()=>sWe,deleteNode:()=>oWe,deleteRange:()=>aWe,deleteSelection:()=>lWe,enter:()=>cWe,exitCode:()=>uWe,extendMarkRange:()=>hWe,first:()=>fWe,focus:()=>gWe,forEach:()=>yWe,insertContent:()=>xWe,insertContentAt:()=>bWe,joinBackward:()=>CWe,joinDown:()=>kWe,joinForward:()=>TWe,joinItemBackward:()=>EWe,joinItemForward:()=>MWe,joinTextblockBackward:()=>IWe,joinTextblockForward:()=>PWe,joinUp:()=>vWe,keyboardShortcut:()=>$We,lift:()=>RWe,liftEmptyBlock:()=>OWe,liftListItem:()=>NWe,newlineInCode:()=>_We,resetAttributes:()=>DWe,scrollIntoView:()=>FWe,selectAll:()=>zWe,selectNodeBackward:()=>BWe,selectNodeForward:()=>jWe,selectParentNode:()=>LWe,selectTextblockEnd:()=>UWe,selectTextblockStart:()=>WWe,setContent:()=>qWe,setMark:()=>iHe,setMeta:()=>sHe,setNode:()=>oHe,setNodeSelection:()=>aHe,setTextDirection:()=>lHe,setTextSelection:()=>cHe,sinkListItem:()=>uHe,splitBlock:()=>dHe,splitListItem:()=>hHe,toggleList:()=>fHe,toggleMark:()=>pHe,toggleNode:()=>mHe,toggleWrap:()=>gHe,undoInputRule:()=>yHe,unsetAllMarks:()=>xHe,unsetMark:()=>SHe,unsetTextDirection:()=>wHe,updateAttributes:()=>bHe,wrapIn:()=>vHe,wrapInList:()=>kHe});var Q7e=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),eWe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),tWe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=A7e(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},nWe=r=>e=>r(e),rWe=()=>({state:r,dispatch:e})=>uo(r,e),iWe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Pi(n.doc.resolve(Math.max(o-1,0)))),!0},sWe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function kr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var oWe=r=>({tr:e,state:t,dispatch:n})=>{const i=kr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},aWe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},lWe=()=>({state:r,dispatch:e})=>ho(r,e),cWe=()=>({commands:r})=>r.keyboardShortcut("Enter"),uWe=()=>({state:r,dispatch:e})=>fo(r,e);function dWe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function dk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:dWe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function ese(r,e,t={}){return r.find(n=>n.type===e&&dk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function d6(r,e,t={}){return!!ese(r,e,t)}function tse(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!ese([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&d6([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&d6([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Mc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var hWe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=Mc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=tse(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Pi.create(o,d.from,d.to);t.setSelection(h)}}return!0},fWe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function nse(r){return r instanceof Pi}function xu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function pWe(r,e=null){if(!e)return null;const t=Kt.atStart(r),n=Kt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Pi.create(r,xu(0,i,s),xu(r.content.size,i,s)):Pi.create(r,xu(e,i,s),xu(e,i,s))}function mWe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function j2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var gWe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(j2()||mWe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!nse(t.state.selection))return o(),!0;const a=pWe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},yWe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),xWe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),rse=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&rse(n)}return r};function Zw(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return rse(t)}function xx(r,e,t){if(r instanceof Ju||r instanceof Ee)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Ee.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),xx("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new x7e({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?xI.fromSchema(l).parseSlice(Zw(r),t.parseOptions):xI.fromSchema(l).parse(Zw(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=xI.fromSchema(e);return t.slice?s.parseSlice(Zw(r),t.parseOptions).content:s.parse(Zw(r),t.parseOptions)}return xx("",e,t)}function SWe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof ca||i instanceof Cc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Kt.near(r.doc.resolve(o),t))}var wWe=r=>!("type"in r),bWe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{xx(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=xx(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((wWe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Ee){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&SWe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},vWe=()=>({state:r,dispatch:e})=>po(r,e),kWe=()=>({state:r,dispatch:e})=>mo(r,e),CWe=()=>({state:r,dispatch:e})=>go(r,e),TWe=()=>({state:r,dispatch:e})=>yo(r,e),EWe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=jie(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},MWe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=jie(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},IWe=()=>({state:r,dispatch:e})=>xo(r,e),PWe=()=>({state:r,dispatch:e})=>So(r,e);function ise(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function AWe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))j2()||ise()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var $We=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=AWe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function L2(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?kr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>dk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var RWe=(r,e={})=>({state:t,dispatch:n})=>{const i=kr(r,t.schema);return L2(t,i,e)?wo(t,n):!1},OWe=()=>({state:r,dispatch:e})=>bo(r,e),NWe=r=>({state:e,dispatch:t})=>{const n=kr(r,e.schema);return vo(n)(e,t)},_We=()=>({state:r,dispatch:e})=>ko(r,e);function sse(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function h6(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var DWe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=sse(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=kr(r,n.schema)),a==="mark"&&(o=Mc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,h6(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(h6(h.attrs,e))))})})}),l},FWe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),zWe=()=>({tr:r,dispatch:e})=>{if(e){const t=new wf(r.doc);r.setSelection(t)}return!0},BWe=()=>({state:r,dispatch:e})=>Co(r,e),jWe=()=>({state:r,dispatch:e})=>To(r,e),LWe=()=>({state:r,dispatch:e})=>Eo(r,e),UWe=()=>({state:r,dispatch:e})=>Mo(r,e),WWe=()=>({state:r,dispatch:e})=>Io(r,e);function HWe(r,e,t={},n={}){return xx(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var qWe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=HWe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function KWe(r,e){const t=Mc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function JWe(r,e){const t=new J7e(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function VWe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function GWe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function U2(r){return e=>GWe(e.$from,r)}function Sx(r,e,t){return r.config[e]===void 0&&r.parent?Sx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?Sx(r.parent,e,t):null}):r.config[e]}function YWe(r){return typeof r=="function"}function X$(r,e=void 0,...t){return YWe(r)?e?r.bind(e)(...t):r(...t):r}function ose(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function XWe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function ZWe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function QWe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function eHe(r){const e=QWe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function tHe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),eHe(n)}function w0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function nHe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?Mc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>dk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>dk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function f6(r,e){const{nodeExtensions:t}=ose(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=X$(Sx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function ase(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(ase(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function rHe(r,e,t){var n;const{selection:i}=e;let s=null;if(nse(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var iHe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=Mc(r,n.schema);if(i)if(o){const c=KWe(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return rHe(n,t,l)},sHe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),oHe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=kr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},aHe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=xu(r,0,n.content.size),s=ql.create(n,i);e.setSelection(s)}return!0},lHe=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},cHe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Pi.atStart(n).from,a=Pi.atEnd(n).to,l=xu(i,o,a),c=xu(s,o,a),u=Pi.create(n,l,c);e.setSelection(u)}return!0},uHe=r=>({state:e,dispatch:t})=>{const n=kr(r,e.schema);return Po(n)(e,t)};function p6(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var dHe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=w0(c,a.node().type.name,a.node().attrs);if(s instanceof ql&&s.node.isBlock)return!a.parentOffset||!y0(o,a.pos)?!1:(n&&(r&&p6(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:VWe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=y0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&y0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Pi&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&p6(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},hHe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=kr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Ee.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Ee.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...w0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Ee.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Ke(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Pi.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...w0(h,d.type.name,d.attrs),...e},m={...w0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!y0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},CI=(r,e)=>{const t=U2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&zie(r.doc,t.pos)&&r.join(t.pos),!0},TI=(r,e)=>{const t=U2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&zie(r.doc,n)&&r.join(n),!0},fHe=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=kr(r,o.schema),p=kr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=U2(C=>f6(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(f6(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>CI(s,f)).command(()=>TI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>CI(s,f)).command(()=>TI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>CI(s,f)).command(()=>TI(s,f)).run()},pHe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=Mc(r,n.schema);return nHe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},mHe=(r,e,t={})=>({state:n,commands:i})=>{const s=kr(r,n.schema),o=kr(e,n.schema),a=L2(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},gHe=(r,e={})=>({state:t,commands:n})=>{const i=kr(r,t.schema);return L2(t,i,e)?n.lift(i):n.wrapIn(i,e)},yHe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},xHe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},SHe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=Mc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=tse(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},wHe=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},bHe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=sse(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=kr(r,n.schema)),a==="mark"&&(o=Mc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},vHe=(r,e={})=>({state:t,dispatch:n})=>{const i=kr(r,t.schema);return Ao(i,e)(t,n)},kHe=(r,e={})=>({state:t,dispatch:n})=>{const i=kr(r,t.schema);return $o(i,e)(t,n)};function CHe(r){return Object.prototype.toString.call(r).slice(8,-1)}function Qw(r){return CHe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function lse(r,e){const t={...r};return Qw(r)&&Qw(e)&&Object.keys(e).forEach(n=>{Qw(e[n])&&Qw(r[n])?t[n]=lse(r[n],e[n]):t[n]=e[n]}),t}var cse=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...X$(Sx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...X$(Sx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>lse(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},THe={};B2(THe,{ClipboardTextSerializer:()=>EHe,Commands:()=>MHe,Delete:()=>IHe,Drop:()=>PHe,Editable:()=>AHe,FocusEvents:()=>$He,Keymap:()=>RHe,Paste:()=>OHe,Tabindex:()=>NHe,TextDirection:()=>_He,focusEventsPluginKey:()=>dse});var Ca=class use extends cse{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new use(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},EHe=Ca.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Tc({key:new Ec("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=ZWe(t);return XWe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),MHe=Ca.create({name:"commands",addCommands(){return{...Qie}}}),IHe=Ca.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=JWe(r.before,[r,...e]);tHe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Ep){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),PHe=Ca.create({name:"drop",addProseMirrorPlugins(){return[new Tc({key:new Ec("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),AHe=Ca.create({name:"editable",addProseMirrorPlugins(){return[new Tc({key:new Ec("editable"),props:{editable:()=>this.editor.options.editable}})]}}),dse=new Ec("focusEvents"),$He=Ca.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Tc({key:dse,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),RHe=Ca.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Kt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return j2()||ise()?s:i},addProseMirrorPlugins(){return[new Tc({key:new Ec("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Kt.atStart(e.doc).from,c=Kt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!ase(t.doc))return;const h=t.tr,f=Zie({state:t,transaction:h}),{commands:p}=new Z7e({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),OHe=Ca.create({name:"paste",addProseMirrorPlugins(){return[new Tc({key:new Ec("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),NHe=Ca.create({name:"tabindex",addProseMirrorPlugins(){return[new Tc({key:new Ec("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),_He=Ca.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=ose(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Tc({key:new Ec("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}}),DHe={};B2(DHe,{createAtomBlockMarkdownSpec:()=>FHe,createBlockMarkdownSpec:()=>zHe,createInlineMarkdownSpec:()=>LHe,parseAttributes:()=>W2,parseIndentedBlocks:()=>UHe,renderNestedMarkdownContent:()=>WHe,serializeAttributes:()=>H2});function W2(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function H2(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function FHe(r){const{nodeName:e,name:t,parseAttributes:n=W2,serializeAttributes:i=H2,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function zHe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=W2,serializeAttributes:s=H2,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function BHe(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function jHe(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function LHe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=BHe,serializeAttributes:s=jHe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function UHe(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function WHe(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var HHe=class hse extends cse{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new hse(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},qHe=HHe.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(r,e)=>r.content?e.renderChildren(r.content,`

`):""});function fse(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=fse(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function pse(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=pse(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Me=class ii{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new ii(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new ii(n,i)}cutByIndex(e,t){return e==t?ii.empty:e==0&&t==this.content.length?this:new ii(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new ii(i,s)}addToStart(e){return new ii([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ii(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return fse(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return pse(this,e,t,n)}findIndex(e){if(e==0)return eb(0,e);if(e==this.size)return eb(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?eb(t+1,s):eb(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ii.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ii(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ii.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new ii(t||e,n)}static from(e){if(!e)return ii.empty;if(e instanceof ii)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ii([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Me.empty=new Me([],0);const EI={index:0,offset:0};function eb(r,e){return EI.index=r,EI.offset=e,EI}function hk(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!hk(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!hk(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let rn=class Z${constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&hk(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Z$.none;if(e instanceof Z$)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};rn.none=[];let fk=class extends Error{},Je=class Lh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=gse(this.content,e+this.openStart,t);return n&&new Lh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Lh(mse(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Lh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Lh(Me.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Lh(e,n,i)}};Je.empty=new Je(Me.empty,0,0);function mse(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(mse(s.content,e-i-1,t-i-1)))}function gse(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=gse(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function KHe(r,e,t){if(t.openStart>r.depth)throw new fk("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new fk("Inconsistent open depths");return yse(r,e,t,0)}function yse(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=yse(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Gu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=JHe(t,r);return Gu(s,Sse(r,o,a,e,n))}else return Gu(s,pk(r,e,n))}function xse(r,e){if(!e.type.compatibleContent(r.type))throw new fk("Cannot join "+e.type.name+" onto "+r.type.name)}function Q$(r,e,t){let n=r.node(t);return xse(n,e.node(t)),n}function Vu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function py(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Vu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Vu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Vu(e.nodeBefore,n)}function Gu(r,e){return r.type.checkContent(e),r.copy(e)}function Sse(r,e,t,n,i){let s=r.depth>i&&Q$(r,e,i+1),o=n.depth>i&&Q$(t,n,i+1),a=[];return py(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(xse(s,o),Vu(Gu(s,Sse(r,e,t,n,i+1)),a)):(s&&Vu(Gu(s,pk(r,e,i+1)),a),py(e,t,i,a),o&&Vu(Gu(o,pk(t,n,i+1)),a)),py(n,null,i,a),new Me(a)}function pk(r,e,t){let n=[];if(py(null,r,t,n),r.depth>t){let i=Q$(r,e,t+1);Vu(Gu(i,pk(r,e,t+1)),n)}return py(e,null,t,n),new Me(n)}function JHe(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Me.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let m6=class eR{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return rn.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new YHe(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new eR(t,n,s)}static resolveCached(e,t){let n=g6.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else g6.set(e,n=new VHe);let i=n.elts[n.i]=eR.resolve(e,t);return n.i=(n.i+1)%GHe,i}},VHe=class{constructor(){this.elts=[],this.i=0}};const GHe=12,g6=new WeakMap;let YHe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const XHe=Object.create(null);let Yu=class tR{constructor(e,t,n,i=rn.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Me.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&hk(this.attrs,t||e.defaultAttrs||XHe)&&rn.sameSet(this.marks,n||rn.none)}copy(e=null){return e==this.content?this:new tR(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new tR(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Je.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Je(c,i.depth-o,s.depth-o)}replace(e,t,n){return KHe(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return m6.resolveCached(this,e)}resolveNoCache(e){return m6.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),wse(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Me.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=rn.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!rn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Me.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Yu.prototype.text=void 0;let ZHe=class nR extends Yu{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wse(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new nR(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new nR(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function wse(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let wx=class bse{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new QHe(e,t);if(n.next==null)return bse.empty;let i=vse(n);n.next&&n.err("Unexpected trailing text");let s=oqe(sqe(i));return aqe(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Me.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};wx.empty=new wx(!0);let QHe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function vse(r){let e=[];do e.push(eqe(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function eqe(r){let e=[];do e.push(tqe(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function tqe(r){let e=iqe(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=nqe(r,e);else break;return e}function y6(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function nqe(r,e){let t=y6(r),n=t;return r.eat(",")&&(r.next!="}"?n=y6(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function rqe(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function iqe(r){if(r.eat("(")){let e=vse(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=rqe(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function sqe(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function kse(r,e){return e-r}function x6(r,e){let t=[];return n(e),t.sort(kse);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function oqe(r){let e=Object.create(null);return t(x6(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);x6(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new wx(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(kse);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function aqe(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Cse(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Tse(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Ese(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function Mse(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new cqe(r,n,e[n]);return t}let S6=class Ise{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Mse(e,n.attrs),this.defaultAttrs=Cse(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==wx.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Tse(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Yu(this,this.computeAttrs(e),Me.from(t),rn.setFrom(n))}createChecked(e=null,t,n){return t=Me.from(t),this.checkContent(t),new Yu(this,this.computeAttrs(e),t,rn.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Me.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Me.empty,!0);return s?new Yu(this,e,t.append(s),rn.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Ese(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:rn.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Ise(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function lqe(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let cqe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?lqe(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Pse=class Ase{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Mse(e,i.attrs),this.excluded=null;let s=Cse(this.attrs);this.instance=s?new rn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new rn(this,Tse(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Ase(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Ese(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},uqe=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=S6.compile(this.spec.nodes,this),this.marks=Pse.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=wx.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?w6(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:w6(this,o.split(" "))}this.nodeFromJSON=i=>Yu.fromJSON(this,i),this.markFromJSON=i=>rn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof S6){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new ZHe(n,n.defaultAttrs,e,rn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function w6(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function dqe(r){return r.tag!=null}function hqe(r){return r.style!=null}let MI=class rR{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(dqe(i))this.tags.push(i);else if(hqe(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new v6(this,t,!1);return n.addAll(e,rn.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new v6(this,t,!0);return n.addAll(e,rn.none,t.from,t.to),Je.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(mqe(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=k6(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=k6(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new rR(e,rR.schemaRules(e)))}};const $se={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},fqe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Rse={ol:!0,ul:!0},bx=1,iR=2,my=4;function b6(r,e,t){return e!=null?(e?bx:0)|(e==="full"?iR:0):r&&r.whitespace=="pre"?bx|iR:t&~my}let tb=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=rn.none,this.match=s||(o&my?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Me.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&bx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Me.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Me.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!$se.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},v6=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=b6(null,t.preserveWhitespace,0)|(n?my:0);i?s=new tb(i.type,i.attrs,rn.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new tb(null,null,rn.none,!0,null,o):s=new tb(e.schema.topNodeType,null,rn.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&iR?"full":this.localPreserveWS||(i.options&bx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Rse.hasOwnProperty(o)&&this.parser.normalizeLists&&pqe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:fqe.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if($se.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=rn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):C6(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=b6(e,s,o.options);o.options&my&&o.content.length==0&&(a|=my);let l=rn.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):C6(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new tb(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=bx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function pqe(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Rse.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function mqe(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function k6(r){let e={};for(let t in r)e[t]=r[t];return e}function C6(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const Ose=65535,Nse=Math.pow(2,16);function gqe(r,e){return r+e*Nse}function T6(r){return r&Ose}function yqe(r){return(r-(r&Ose))/Nse}const _se=1,Dse=2,b0=4,Fse=8;let sR=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Fse)>0}get deletedBefore(){return(this.delInfo&(_se|b0))>0}get deletedAfter(){return(this.delInfo&(Dse|b0))>0}get deletedAcross(){return(this.delInfo&b0)>0}},Pd=class Uh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Uh.empty)return Uh.empty}recover(e){let t=0,n=T6(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+yqe(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:gqe(a/3,e-l),m=e==l?Dse:e==d?_se:b0;return(t<0?e!=l:e!=d)&&(m|=Fse),new sR(f,m,p)}i+=u-c}return n?e+i:new sR(e+i,0,null)}touches(e,t){let n=0,i=T6(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Uh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Uh.empty:new Uh(e<0?[0,-e,0]:[0,0,e])}};Pd.empty=new Pd([]);let xqe=class oR{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new oR(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new oR;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new sR(e,i,null)}};const II=Object.create(null);let Wr=class{getMap(){return Pd.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=II[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in II)throw new RangeError("Duplicate use of step JSON ID "+e);return II[e]=t,t.prototype.jsonID=e,t}},bi=class fg{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new fg(e,null)}static fail(e){return new fg(null,e)}static fromReplace(e,t,n,i){try{return fg.ok(e.replace(t,n,i))}catch(s){if(s instanceof fk)return fg.fail(s.message);throw s}}};function q2(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(q2(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Me.fromArray(n)}let K2=class pg extends Wr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Je(q2(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return bi.fromReplace(e,this.from,this.to,s)}invert(){return new Mp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new pg(t.pos,n.pos,this.mark)}merge(e){return e instanceof pg&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new pg(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new pg(t.from,t.to,e.markFromJSON(t.mark))}};Wr.jsonID("addMark",K2);let Mp=class mg extends Wr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Je(q2(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return bi.fromReplace(e,this.from,this.to,n)}invert(){return new K2(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new mg(t.pos,n.pos,this.mark)}merge(e){return e instanceof mg&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new mg(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new mg(t.from,t.to,e.markFromJSON(t.mark))}};Wr.jsonID("removeMark",Mp);let J2=class gg extends Wr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return bi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return bi.fromReplace(e,this.pos,this.pos+1,new Je(Me.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new gg(this.pos,t.marks[i]);return new gg(this.pos,this.mark)}}return new mk(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new gg(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new gg(t.pos,e.markFromJSON(t.mark))}};Wr.jsonID("addNodeMark",J2);let mk=class aR extends Wr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return bi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return bi.fromReplace(e,this.pos,this.pos+1,new Je(Me.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new J2(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new aR(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new aR(t.pos,e.markFromJSON(t.mark))}};Wr.jsonID("removeNodeMark",mk);let ua=class iu extends Wr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&lR(e,this.from,this.to)?bi.fail("Structure replace would overwrite content"):bi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Pd([this.from,this.to-this.from,this.slice.size])}invert(e){return new iu(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new iu(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof iu)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Je.empty:new Je(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new iu(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Je.empty:new Je(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new iu(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new iu(t.from,t.to,Je.fromJSON(e,t.slice),!!t.structure)}};Wr.jsonID("replace",ua);let Ic=class v0 extends Wr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(lR(e,this.from,this.gapFrom)||lR(e,this.gapTo,this.to)))return bi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return bi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?bi.fromReplace(e,this.from,this.to,n):bi.fail("Content does not fit in gap")}getMap(){return new Pd([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new v0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new v0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new v0(t.from,t.to,t.gapFrom,t.gapTo,Je.fromJSON(e,t.slice),t.insert,!!t.structure)}};Wr.jsonID("replaceAround",Ic);function lR(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function Sqe(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Mp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new K2(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function wqe(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof Pse){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Mp(o.from,o.to,o.style)))}function V2(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new ua(a,u,Je.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Mp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Je(Me.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ua(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Me.empty,!0);r.replace(a,a,new Je(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function bqe(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function vqe(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!bqe(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function kqe(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Me.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Me.from(n.node(p).copy(u)),d++):l--;let h=Me.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Me.from(i.node(p).copy(h)),f++):c++;r.step(new Ic(l,c,o,a,new Je(u.append(h),d,f),u.size-d,!0))}function Cqe(r,e,t){let n=Me.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Me.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Ic(i,s,i,s,new Je(n,0,0),t.length,!0))}function Tqe(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&Eqe(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Bse(r,o,a,s),V2(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new Ic(d,h,d+1,h-1,new Je(Me.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&zse(r,o,a,s),!1}})}function zse(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Bse(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Eqe(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function Mqe(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Ic(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Je(Me.from(o),0,0),1,!0))}function k0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Iqe(r,e,t=1,n){let i=r.doc.resolve(e),s=Me.empty,o=Me.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Me.from(i.node(a).copy(s));let u=n&&n[c];o=Me.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new ua(e,e,new Je(s.append(o),t,t),!0))}function jse(r,e){let t=r.resolve(e),n=t.index();return Lse(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function Pqe(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Lse(r,e){return!!(r&&e&&!r.isLeaf&&Pqe(r,e))}function Use(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Lse(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function Aqe(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Bse(r,u.node(),u.before(),a)}o.inlineContent&&V2(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new ua(c,l.map(e+t,-1),Je.empty,!0)),n===!0){let u=r.doc.resolve(c);zse(r,u.node(),u.before(),r.steps.length)}return r}function $qe(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function Rqe(r,e,t=e,n=Je.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Wse(i,s,n)?new ua(e,t,n):new Oqe(i,s,n).fit()}function Wse(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let Oqe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Me.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Me.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Je(s,o,a);return e>-1?new Ic(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new ua(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=PI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Me.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=PI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Je(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=PI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Je(yg(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Je(yg(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Hse(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=xg(this.placed,t,Me.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Je.empty:new Je(yg(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Je(yg(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!AI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=AI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=AI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=xg(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=xg(this.placed,this.depth,Me.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Me.empty,!0);t.childCount&&(this.placed=xg(this.placed,this.frontier.length,t))}};function yg(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(yg(r.firstChild.content,e-1,t)))}function xg(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(xg(r.lastChild.content,e-1,t)))}function PI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Hse(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Hse(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Me.empty,!0)))),r.copy(n)}function AI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!Nqe(t,s.content,o)?a:null}function Nqe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function _qe(r){return r.spec.defining||r.spec.definingForContent}function Dqe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Wse(i,s,n))return r.step(new ua(e,t,n));let o=Kse(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=_qe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Je(qse(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function qse(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(qse(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Me.empty,!0))}return r}function Fqe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=$qe(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Je(Me.from(n),0,0))}function zqe(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Kse(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Kse(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let Jse=class C0 extends Wr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return bi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return bi.fromReplace(e,this.pos,this.pos+1,new Je(Me.from(i),0,t.isLeaf?0:1))}getMap(){return Pd.empty}invert(e){return new C0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new C0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new C0(t.pos,t.attr,t.value)}};Wr.jsonID("attr",Jse);let Vse=class cR extends Wr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return bi.ok(n)}getMap(){return Pd.empty}invert(e){return new cR(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new cR(t.attr,t.value)}};Wr.jsonID("docAttr",Vse);let Jf=class extends Error{};Jf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Jf.prototype=Object.create(Error.prototype);Jf.prototype.constructor=Jf;Jf.prototype.name="TransformError";let Bqe=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new xqe}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Jf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Je.empty){let i=Rqe(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Je(Me.from(n),0,0))}delete(e,t){return this.replace(e,t,Je.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Dqe(this,e,t,n),this}replaceRangeWith(e,t,n){return Fqe(this,e,t,n),this}deleteRange(e,t){return zqe(this,e,t),this}lift(e,t){return kqe(this,e,t),this}join(e,t=1){return Aqe(this,e,t),this}wrap(e,t){return Cqe(this,e,t),this}setBlockType(e,t=e,n,i=null){return Tqe(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return Mqe(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Jse(e,t,n)),this}setDocAttribute(e,t){return this.step(new Vse(e,t)),this}addNodeMark(e,t){return this.step(new J2(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof rn)t.isInSet(n.marks)&&this.step(new mk(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new mk(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return Iqe(this,e,t,n),this}addMark(e,t,n){return Sqe(this,e,t,n),this}removeMark(e,t,n){return wqe(this,e,t,n),this}clearIncompatible(e,t,n){return V2(this,e,t,n),this}};const $I=Object.create(null);let Jt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new jqe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Je.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Je.empty:t),a==0&&I6(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),I6(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Ai(e):Wh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Wh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Wh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new bf(e.node(0))}static atStart(e){return Wh(e,e,0,0,1)||new bf(e)}static atEnd(e){return Wh(e,e,e.content.size,e.childCount,-1)||new bf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=$I[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in $I)throw new RangeError("Duplicate use of selection JSON ID "+e);return $I[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ai.between(this.$anchor,this.$head).getBookmark()}};Jt.prototype.visible=!0;let jqe=class{constructor(e,t){this.$from=e,this.$to=t}},E6=!1;function M6(r){!E6&&!r.parent.inlineContent&&(E6=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Ai=class Sg extends Jt{constructor(e,t=e){M6(e),M6(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Jt.near(n);let i=e.resolve(t.map(this.anchor));return new Sg(i.parent.inlineContent?i:n,n)}replace(e,t=Je.empty){if(super.replace(e,t),t==Je.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Sg&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Gse(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Sg(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Jt.findFrom(t,n,!0)||Jt.findFrom(t,-n,!0);if(s)t=s.$head;else return Jt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Jt.findFrom(e,-n,!0)||Jt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new Sg(e,t)}};Jt.jsonID("text",Ai);let Gse=class Yse{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Yse(e.map(this.anchor),e.map(this.head))}resolve(e){return Ai.between(e.resolve(this.anchor),e.resolve(this.head))}},Kl=class wg extends Jt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Jt.near(s):new wg(s)}content(){return new Je(Me.from(this.node),0,0)}eq(e){return e instanceof wg&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Lqe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new wg(e.resolve(t.anchor))}static create(e,t){return new wg(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Kl.prototype.visible=!1;Jt.jsonID("node",Kl);let Lqe=class Xse{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Gse(n,n):new Xse(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Kl.isSelectable(n)?new Kl(t):Jt.near(t)}},bf=class T0 extends Jt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Je.empty){if(t==Je.empty){e.delete(0,e.doc.content.size);let n=Jt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new T0(e)}map(e){return new T0(e)}eq(e){return e instanceof T0}getBookmark(){return Uqe}};Jt.jsonID("all",bf);const Uqe={map(){return this},resolve(r){return new bf(r)}};function Wh(r,e,t,n,i,s=!1){if(e.inlineContent)return Ai.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Kl.isSelectable(a))return Kl.create(r,t-(i<0?a.nodeSize:0))}else{let l=Wh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function I6(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof ua||i instanceof Ic))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Jt.near(r.doc.resolve(o),t))}function P6(r,e){return!e||!r?r:r.bind(e)}let nb=class{constructor(e,t,n){this.name=e,this.init=P6(t.init,n),this.apply=P6(t.apply,n)}};new nb("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new nb("selection",{init(r,e){return r.selection||Jt.atStart(e.doc)},apply(r){return r.selection}}),new nb("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new nb("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function Zse(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=Zse(i,e,{})),t[n]=i}return t}let Pc=class{constructor(e){this.spec=e,this.props={},e.props&&Zse(e.props,this,this.props),this.key=e.key?e.key.key:Qse("plugin")}getState(e){return e[this.key]}};const RI=Object.create(null);function Qse(r){return r in RI?r+"$"+ ++RI[r]:(RI[r]=0,r+"$")}let Ac=class{constructor(e="key"){this.key=Qse(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var Wqe=Object.defineProperty,G2=(r,e)=>{for(var t in e)Wqe(r,t,{get:e[t],enumerable:!0})};function eoe(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var Hqe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:eoe({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},toe={};G2(toe,{blur:()=>qqe,clearContent:()=>Kqe,clearNodes:()=>Jqe,command:()=>Vqe,createParagraphNear:()=>Gqe,cut:()=>Yqe,deleteCurrentNode:()=>Xqe,deleteNode:()=>Zqe,deleteRange:()=>Qqe,deleteSelection:()=>eKe,enter:()=>tKe,exitCode:()=>nKe,extendMarkRange:()=>iKe,first:()=>sKe,focus:()=>lKe,forEach:()=>cKe,insertContent:()=>uKe,insertContentAt:()=>fKe,joinBackward:()=>gKe,joinDown:()=>mKe,joinForward:()=>yKe,joinItemBackward:()=>xKe,joinItemForward:()=>SKe,joinTextblockBackward:()=>wKe,joinTextblockForward:()=>bKe,joinUp:()=>pKe,keyboardShortcut:()=>kKe,lift:()=>CKe,liftEmptyBlock:()=>TKe,liftListItem:()=>EKe,newlineInCode:()=>MKe,resetAttributes:()=>IKe,scrollIntoView:()=>PKe,selectAll:()=>AKe,selectNodeBackward:()=>$Ke,selectNodeForward:()=>RKe,selectParentNode:()=>OKe,selectTextblockEnd:()=>NKe,selectTextblockStart:()=>_Ke,setContent:()=>FKe,setMark:()=>XKe,setMeta:()=>ZKe,setNode:()=>QKe,setNodeSelection:()=>eJe,setTextDirection:()=>tJe,setTextSelection:()=>nJe,sinkListItem:()=>rJe,splitBlock:()=>iJe,splitListItem:()=>sJe,toggleList:()=>oJe,toggleMark:()=>aJe,toggleNode:()=>lJe,toggleWrap:()=>cJe,undoInputRule:()=>uJe,unsetAllMarks:()=>dJe,unsetMark:()=>hJe,unsetTextDirection:()=>fJe,updateAttributes:()=>pJe,wrapIn:()=>mJe,wrapInList:()=>gJe});var qqe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),Kqe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),Jqe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=vqe(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},Vqe=r=>e=>r(e),Gqe=()=>({state:r,dispatch:e})=>uo(r,e),Yqe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Ai(n.doc.resolve(Math.max(o-1,0)))),!0},Xqe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function Cr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var Zqe=r=>({tr:e,state:t,dispatch:n})=>{const i=Cr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Qqe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},eKe=()=>({state:r,dispatch:e})=>ho(r,e),tKe=()=>({commands:r})=>r.keyboardShortcut("Enter"),nKe=()=>({state:r,dispatch:e})=>fo(r,e);function rKe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function gk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:rKe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function noe(r,e,t={}){return r.find(n=>n.type===e&&gk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function A6(r,e,t={}){return!!noe(r,e,t)}function roe(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!noe([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&A6([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&A6([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function $c(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var iKe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=$c(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=roe(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ai.create(o,d.from,d.to);t.setSelection(h)}}return!0},sKe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function ioe(r){return r instanceof Ai}function Su(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function oKe(r,e=null){if(!e)return null;const t=Jt.atStart(r),n=Jt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Ai.create(r,Su(0,i,s),Su(r.content.size,i,s)):Ai.create(r,Su(e,i,s),Su(e,i,s))}function aKe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Y2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var lKe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(Y2()||aKe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!ioe(t.state.selection))return o(),!0;const a=oKe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},cKe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),uKe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),soe=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&soe(n)}return r};function rb(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return soe(t)}function vx(r,e,t){if(r instanceof Yu||r instanceof Me)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Me.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),vx("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new uqe({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?MI.fromSchema(l).parseSlice(rb(r),t.parseOptions):MI.fromSchema(l).parse(rb(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=MI.fromSchema(e);return t.slice?s.parseSlice(rb(r),t.parseOptions).content:s.parse(rb(r),t.parseOptions)}return vx("",e,t)}function dKe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof ua||i instanceof Ic))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Jt.near(r.doc.resolve(o),t))}var hKe=r=>!("type"in r),fKe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{vx(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=vx(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((hKe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Me){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&dKe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},pKe=()=>({state:r,dispatch:e})=>po(r,e),mKe=()=>({state:r,dispatch:e})=>mo(r,e),gKe=()=>({state:r,dispatch:e})=>go(r,e),yKe=()=>({state:r,dispatch:e})=>yo(r,e),xKe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Use(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},SKe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Use(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},wKe=()=>({state:r,dispatch:e})=>xo(r,e),bKe=()=>({state:r,dispatch:e})=>So(r,e);function ooe(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function vKe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))Y2()||ooe()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var kKe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=vKe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function X2(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?Cr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>gk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var CKe=(r,e={})=>({state:t,dispatch:n})=>{const i=Cr(r,t.schema);return X2(t,i,e)?wo(t,n):!1},TKe=()=>({state:r,dispatch:e})=>bo(r,e),EKe=r=>({state:e,dispatch:t})=>{const n=Cr(r,e.schema);return vo(n)(e,t)},MKe=()=>({state:r,dispatch:e})=>ko(r,e);function aoe(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function $6(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var IKe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=aoe(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Cr(r,n.schema)),a==="mark"&&(o=$c(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,$6(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create($6(h.attrs,e))))})})}),l},PKe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),AKe=()=>({tr:r,dispatch:e})=>{if(e){const t=new bf(r.doc);r.setSelection(t)}return!0},$Ke=()=>({state:r,dispatch:e})=>Co(r,e),RKe=()=>({state:r,dispatch:e})=>To(r,e),OKe=()=>({state:r,dispatch:e})=>Eo(r,e),NKe=()=>({state:r,dispatch:e})=>Mo(r,e),_Ke=()=>({state:r,dispatch:e})=>Io(r,e);function DKe(r,e,t={},n={}){return vx(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var FKe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=DKe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function zKe(r,e){const t=$c(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function BKe(r,e){const t=new Bqe(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function jKe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function LKe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function Z2(r){return e=>LKe(e.$from,r)}function kx(r,e,t){return r.config[e]===void 0&&r.parent?kx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?kx(r.parent,e,t):null}):r.config[e]}function UKe(r){return typeof r=="function"}function uR(r,e=void 0,...t){return UKe(r)?e?r.bind(e)(...t):r(...t):r}function loe(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function WKe(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function HKe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function qKe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function KKe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function JKe(r){const e=KKe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function VKe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),JKe(n)}function E0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function GKe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?$c(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>gk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>gk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function R6(r,e){const{nodeExtensions:t}=loe(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=uR(kx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function coe(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(coe(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function YKe(r,e,t){var n;const{selection:i}=e;let s=null;if(ioe(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var XKe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=$c(r,n.schema);if(i)if(o){const c=zKe(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return YKe(n,t,l)},ZKe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),QKe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=Cr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},eJe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=Su(r,0,n.content.size),s=Kl.create(n,i);e.setSelection(s)}return!0},tJe=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},nJe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Ai.atStart(n).from,a=Ai.atEnd(n).to,l=Su(i,o,a),c=Su(s,o,a),u=Ai.create(n,l,c);e.setSelection(u)}return!0},rJe=r=>({state:e,dispatch:t})=>{const n=Cr(r,e.schema);return Po(n)(e,t)};function O6(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var iJe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=E0(c,a.node().type.name,a.node().attrs);if(s instanceof Kl&&s.node.isBlock)return!a.parentOffset||!k0(o,a.pos)?!1:(n&&(r&&O6(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:jKe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=k0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&k0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Ai&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&O6(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},sJe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=Cr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Me.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Me.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...E0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Me.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Je(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Ai.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...E0(h,d.type.name,d.attrs),...e},m={...E0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!k0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},OI=(r,e)=>{const t=Z2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&jse(r.doc,t.pos)&&r.join(t.pos),!0},NI=(r,e)=>{const t=Z2(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&jse(r.doc,n)&&r.join(n),!0},oJe=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=Cr(r,o.schema),p=Cr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=Z2(C=>R6(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(R6(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>OI(s,f)).command(()=>NI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>OI(s,f)).command(()=>NI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>OI(s,f)).command(()=>NI(s,f)).run()},aJe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=$c(r,n.schema);return GKe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},lJe=(r,e,t={})=>({state:n,commands:i})=>{const s=Cr(r,n.schema),o=Cr(e,n.schema),a=X2(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},cJe=(r,e={})=>({state:t,commands:n})=>{const i=Cr(r,t.schema);return X2(t,i,e)?n.lift(i):n.wrapIn(i,e)},uJe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},dJe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},hJe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=$c(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=roe(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},fJe=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},pJe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=aoe(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Cr(r,n.schema)),a==="mark"&&(o=$c(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},mJe=(r,e={})=>({state:t,dispatch:n})=>{const i=Cr(r,t.schema);return Ao(i,e)(t,n)},gJe=(r,e={})=>({state:t,dispatch:n})=>{const i=Cr(r,t.schema);return $o(i,e)(t,n)};function yJe(r){return Object.prototype.toString.call(r).slice(8,-1)}function ib(r){return yJe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function uoe(r,e){const t={...r};return ib(r)&&ib(e)&&Object.keys(e).forEach(n=>{ib(e[n])&&ib(r[n])?t[n]=uoe(r[n],e[n]):t[n]=e[n]}),t}var doe=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...uR(kx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...uR(kx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>uoe(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},xJe={};G2(xJe,{ClipboardTextSerializer:()=>SJe,Commands:()=>wJe,Delete:()=>bJe,Drop:()=>vJe,Editable:()=>kJe,FocusEvents:()=>CJe,Keymap:()=>TJe,Paste:()=>EJe,Tabindex:()=>MJe,TextDirection:()=>IJe,focusEventsPluginKey:()=>foe});var Ta=class hoe extends doe{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new hoe(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},SJe=Ta.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Pc({key:new Ac("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=qKe(t);return HKe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),wJe=Ta.create({name:"commands",addCommands(){return{...toe}}}),bJe=Ta.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=BKe(r.before,[r,...e]);VKe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Mp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),vJe=Ta.create({name:"drop",addProseMirrorPlugins(){return[new Pc({key:new Ac("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),kJe=Ta.create({name:"editable",addProseMirrorPlugins(){return[new Pc({key:new Ac("editable"),props:{editable:()=>this.editor.options.editable}})]}}),foe=new Ac("focusEvents"),CJe=Ta.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Pc({key:foe,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),TJe=Ta.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Jt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Y2()||ooe()?s:i},addProseMirrorPlugins(){return[new Pc({key:new Ac("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Jt.atStart(e.doc).from,c=Jt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!coe(t.doc))return;const h=t.tr,f=eoe({state:t,transaction:h}),{commands:p}=new Hqe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),EJe=Ta.create({name:"paste",addProseMirrorPlugins(){return[new Pc({key:new Ac("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),MJe=Ta.create({name:"tabindex",addProseMirrorPlugins(){return[new Pc({key:new Ac("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),IJe=Ta.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=loe(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Pc({key:new Ac("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}}),PJe={};G2(PJe,{createAtomBlockMarkdownSpec:()=>AJe,createBlockMarkdownSpec:()=>$Je,createInlineMarkdownSpec:()=>NJe,parseAttributes:()=>Q2,parseIndentedBlocks:()=>_Je,renderNestedMarkdownContent:()=>DJe,serializeAttributes:()=>eD});function Q2(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function eD(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function AJe(r){const{nodeName:e,name:t,parseAttributes:n=Q2,serializeAttributes:i=eD,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function $Je(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=Q2,serializeAttributes:s=eD,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function RJe(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function OJe(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function NJe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=RJe,serializeAttributes:s=OJe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function _Je(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function DJe(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var FJe=class poe extends doe{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new poe(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},zJe=FJe.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",WKe(this.options.HTMLAttributes,r)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:r,chain:e,state:t,editor:n})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:i,storedMarks:s}=t;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=n.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}});function moe(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=moe(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function goe(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=goe(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Ie=class si{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new si(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new si(n,i)}cutByIndex(e,t){return e==t?si.empty:e==0&&t==this.content.length?this:new si(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new si(i,s)}addToStart(e){return new si([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new si(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return moe(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return goe(this,e,t,n)}findIndex(e){if(e==0)return sb(0,e);if(e==this.size)return sb(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?sb(t+1,s):sb(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return si.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new si(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return si.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new si(t||e,n)}static from(e){if(!e)return si.empty;if(e instanceof si)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new si([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Ie.empty=new Ie([],0);const _I={index:0,offset:0};function sb(r,e){return _I.index=r,_I.offset=e,_I}function yk(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!yk(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!yk(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let sn=class dR{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&yk(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return dR.none;if(e instanceof dR)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};sn.none=[];let xk=class extends Error{},Ve=class Hh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=xoe(this.content,e+this.openStart,t);return n&&new Hh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Hh(yoe(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Hh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Hh(Ie.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Hh(e,n,i)}};Ve.empty=new Ve(Ie.empty,0,0);function yoe(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(yoe(s.content,e-i-1,t-i-1)))}function xoe(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=xoe(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function BJe(r,e,t){if(t.openStart>r.depth)throw new xk("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new xk("Inconsistent open depths");return Soe(r,e,t,0)}function Soe(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=Soe(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Zu(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=jJe(t,r);return Zu(s,boe(r,o,a,e,n))}else return Zu(s,Sk(r,e,n))}function woe(r,e){if(!e.type.compatibleContent(r.type))throw new xk("Cannot join "+e.type.name+" onto "+r.type.name)}function hR(r,e,t){let n=r.node(t);return woe(n,e.node(t)),n}function Xu(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function gy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(Xu(r.nodeAfter,n),s++));for(let a=s;a<o;a++)Xu(i.child(a),n);e&&e.depth==t&&e.textOffset&&Xu(e.nodeBefore,n)}function Zu(r,e){return r.type.checkContent(e),r.copy(e)}function boe(r,e,t,n,i){let s=r.depth>i&&hR(r,e,i+1),o=n.depth>i&&hR(t,n,i+1),a=[];return gy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(woe(s,o),Xu(Zu(s,boe(r,e,t,n,i+1)),a)):(s&&Xu(Zu(s,Sk(r,e,i+1)),a),gy(e,t,i,a),o&&Xu(Zu(o,Sk(t,n,i+1)),a)),gy(n,null,i,a),new Ie(a)}function Sk(r,e,t){let n=[];if(gy(null,r,t,n),r.depth>t){let i=hR(r,e,t+1);Xu(Zu(i,Sk(r,e,t+1)),n)}return gy(e,null,t,n),new Ie(n)}function jJe(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Ie.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let N6=class fR{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return sn.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new WJe(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new fR(t,n,s)}static resolveCached(e,t){let n=_6.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else _6.set(e,n=new LJe);let i=n.elts[n.i]=fR.resolve(e,t);return n.i=(n.i+1)%UJe,i}},LJe=class{constructor(){this.elts=[],this.i=0}};const UJe=12,_6=new WeakMap;let WJe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const HJe=Object.create(null);let Qu=class pR{constructor(e,t,n,i=sn.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Ie.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&yk(this.attrs,t||e.defaultAttrs||HJe)&&sn.sameSet(this.marks,n||sn.none)}copy(e=null){return e==this.content?this:new pR(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new pR(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ve.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Ve(c,i.depth-o,s.depth-o)}replace(e,t,n){return BJe(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return N6.resolveCached(this,e)}resolveNoCache(e){return N6.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),voe(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Ie.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=sn.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!sn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Ie.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Qu.prototype.text=void 0;let qJe=class mR extends Qu{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):voe(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new mR(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new mR(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function voe(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let Cx=class koe{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new KJe(e,t);if(n.next==null)return koe.empty;let i=Coe(n);n.next&&n.err("Unexpected trailing text");let s=QJe(ZJe(i));return eVe(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Ie.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};Cx.empty=new Cx(!0);let KJe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function Coe(r){let e=[];do e.push(JJe(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function JJe(r){let e=[];do e.push(VJe(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function VJe(r){let e=XJe(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=GJe(r,e);else break;return e}function D6(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function GJe(r,e){let t=D6(r),n=t;return r.eat(",")&&(r.next!="}"?n=D6(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function YJe(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function XJe(r){if(r.eat("(")){let e=Coe(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=YJe(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function ZJe(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Toe(r,e){return e-r}function F6(r,e){let t=[];return n(e),t.sort(Toe);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function QJe(r){let e=Object.create(null);return t(F6(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);F6(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new Cx(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Toe);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function eVe(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Eoe(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Moe(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Ioe(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function Poe(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new nVe(r,n,e[n]);return t}let z6=class Aoe{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Poe(e,n.attrs),this.defaultAttrs=Eoe(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Cx.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Moe(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Qu(this,this.computeAttrs(e),Ie.from(t),sn.setFrom(n))}createChecked(e=null,t,n){return t=Ie.from(t),this.checkContent(t),new Qu(this,this.computeAttrs(e),t,sn.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Ie.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Ie.empty,!0);return s?new Qu(this,e,t.append(s),sn.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Ioe(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:sn.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Aoe(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function tVe(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let nVe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?tVe(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},$oe=class Roe{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Poe(e,i.attrs),this.excluded=null;let s=Eoe(this.attrs);this.instance=s?new sn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new sn(this,Moe(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Roe(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Ioe(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},rVe=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=z6.compile(this.spec.nodes,this),this.marks=$oe.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Cx.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?B6(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:B6(this,o.split(" "))}this.nodeFromJSON=i=>Qu.fromJSON(this,i),this.markFromJSON=i=>sn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof z6){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new qJe(n,n.defaultAttrs,e,sn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function B6(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function iVe(r){return r.tag!=null}function sVe(r){return r.style!=null}let DI=class gR{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(iVe(i))this.tags.push(i);else if(sVe(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new L6(this,t,!1);return n.addAll(e,sn.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new L6(this,t,!0);return n.addAll(e,sn.none,t.from,t.to),Ve.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(lVe(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=U6(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=U6(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new gR(e,gR.schemaRules(e)))}};const Ooe={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},oVe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Noe={ol:!0,ul:!0},Tx=1,yR=2,yy=4;function j6(r,e,t){return e!=null?(e?Tx:0)|(e==="full"?yR:0):r&&r.whitespace=="pre"?Tx|yR:t&~yy}let ob=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=sn.none,this.match=s||(o&yy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ie.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Tx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Ie.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ie.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ooe.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},L6=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=j6(null,t.preserveWhitespace,0)|(n?yy:0);i?s=new ob(i.type,i.attrs,sn.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new ob(null,null,sn.none,!0,null,o):s=new ob(e.schema.topNodeType,null,sn.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&yR?"full":this.localPreserveWS||(i.options&Tx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Noe.hasOwnProperty(o)&&this.parser.normalizeLists&&aVe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:oVe.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Ooe.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=sn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):W6(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=j6(e,s,o.options);o.options&yy&&o.content.length==0&&(a|=yy);let l=sn.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):W6(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new ob(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Tx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function aVe(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Noe.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function lVe(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function U6(r){let e={};for(let t in r)e[t]=r[t];return e}function W6(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const _oe=65535,Doe=Math.pow(2,16);function cVe(r,e){return r+e*Doe}function H6(r){return r&_oe}function uVe(r){return(r-(r&_oe))/Doe}const Foe=1,zoe=2,M0=4,Boe=8;let xR=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Boe)>0}get deletedBefore(){return(this.delInfo&(Foe|M0))>0}get deletedAfter(){return(this.delInfo&(zoe|M0))>0}get deletedAcross(){return(this.delInfo&M0)>0}},Ad=class qh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&qh.empty)return qh.empty}recover(e){let t=0,n=H6(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+uVe(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:cVe(a/3,e-l),m=e==l?zoe:e==d?Foe:M0;return(t<0?e!=l:e!=d)&&(m|=Boe),new xR(f,m,p)}i+=u-c}return n?e+i:new xR(e+i,0,null)}touches(e,t){let n=0,i=H6(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new qh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?qh.empty:new qh(e<0?[0,-e,0]:[0,0,e])}};Ad.empty=new Ad([]);let dVe=class SR{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new SR(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new SR;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new xR(e,i,null)}};const FI=Object.create(null);let Hr=class{getMap(){return Ad.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=FI[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in FI)throw new RangeError("Duplicate use of step JSON ID "+e);return FI[e]=t,t.prototype.jsonID=e,t}},vi=class bg{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new bg(e,null)}static fail(e){return new bg(null,e)}static fromReplace(e,t,n,i){try{return bg.ok(e.replace(t,n,i))}catch(s){if(s instanceof xk)return bg.fail(s.message);throw s}}};function tD(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(tD(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Ie.fromArray(n)}let nD=class vg extends Hr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Ve(tD(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return vi.fromReplace(e,this.from,this.to,s)}invert(){return new Ip(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new vg(t.pos,n.pos,this.mark)}merge(e){return e instanceof vg&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new vg(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new vg(t.from,t.to,e.markFromJSON(t.mark))}};Hr.jsonID("addMark",nD);let Ip=class kg extends Hr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ve(tD(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return vi.fromReplace(e,this.from,this.to,n)}invert(){return new nD(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new kg(t.pos,n.pos,this.mark)}merge(e){return e instanceof kg&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new kg(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new kg(t.from,t.to,e.markFromJSON(t.mark))}};Hr.jsonID("removeMark",Ip);let rD=class Cg extends Hr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return vi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return vi.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new Cg(this.pos,t.marks[i]);return new Cg(this.pos,this.mark)}}return new wk(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Cg(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Cg(t.pos,e.markFromJSON(t.mark))}};Hr.jsonID("addNodeMark",rD);let wk=class wR extends Hr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return vi.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return vi.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new rD(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new wR(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new wR(t.pos,e.markFromJSON(t.mark))}};Hr.jsonID("removeNodeMark",wk);let da=class su extends Hr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&bR(e,this.from,this.to)?vi.fail("Structure replace would overwrite content"):vi.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Ad([this.from,this.to-this.from,this.slice.size])}invert(e){return new su(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new su(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof su)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ve.empty:new Ve(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new su(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ve.empty:new Ve(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new su(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new su(t.from,t.to,Ve.fromJSON(e,t.slice),!!t.structure)}};Hr.jsonID("replace",da);let Rc=class I0 extends Hr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(bR(e,this.from,this.gapFrom)||bR(e,this.gapTo,this.to)))return vi.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return vi.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?vi.fromReplace(e,this.from,this.to,n):vi.fail("Content does not fit in gap")}getMap(){return new Ad([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new I0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new I0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new I0(t.from,t.to,t.gapFrom,t.gapTo,Ve.fromJSON(e,t.slice),t.insert,!!t.structure)}};Hr.jsonID("replaceAround",Rc);function bR(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function hVe(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Ip(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new nD(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function fVe(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof $oe){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Ip(o.from,o.to,o.style)))}function iD(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new da(a,u,Ve.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Ip(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Ve(Ie.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new da(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Ie.empty,!0);r.replace(a,a,new Ve(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function pVe(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function mVe(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!pVe(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function gVe(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Ie.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Ie.from(n.node(p).copy(u)),d++):l--;let h=Ie.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Ie.from(i.node(p).copy(h)),f++):c++;r.step(new Rc(l,c,o,a,new Ve(u.append(h),d,f),u.size-d,!0))}function yVe(r,e,t){let n=Ie.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Ie.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Rc(i,s,i,s,new Ve(n,0,0),t.length,!0))}function xVe(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&SVe(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Loe(r,o,a,s),iD(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new Rc(d,h,d+1,h-1,new Ve(Ie.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&joe(r,o,a,s),!1}})}function joe(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Loe(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function SVe(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function wVe(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Rc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ve(Ie.from(o),0,0),1,!0))}function P0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function bVe(r,e,t=1,n){let i=r.doc.resolve(e),s=Ie.empty,o=Ie.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Ie.from(i.node(a).copy(s));let u=n&&n[c];o=Ie.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new da(e,e,new Ve(s.append(o),t,t),!0))}function Uoe(r,e){let t=r.resolve(e),n=t.index();return Woe(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function vVe(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Woe(r,e){return!!(r&&e&&!r.isLeaf&&vVe(r,e))}function Hoe(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Woe(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function kVe(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Loe(r,u.node(),u.before(),a)}o.inlineContent&&iD(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new da(c,l.map(e+t,-1),Ve.empty,!0)),n===!0){let u=r.doc.resolve(c);joe(r,u.node(),u.before(),r.steps.length)}return r}function CVe(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function TVe(r,e,t=e,n=Ve.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return qoe(i,s,n)?new da(e,t,n):new EVe(i,s,n).fit()}function qoe(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let EVe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Ie.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ie.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ve(s,o,a);return e>-1?new Rc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new da(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=zI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Ie.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=zI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ve(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=zI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Ve(Tg(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Ve(Tg(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Koe(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Eg(this.placed,t,Ie.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Ve.empty:new Ve(Tg(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Ve(Tg(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!BI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=BI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=BI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Eg(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Eg(this.placed,this.depth,Ie.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Ie.empty,!0);t.childCount&&(this.placed=Eg(this.placed,this.frontier.length,t))}};function Tg(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Tg(r.firstChild.content,e-1,t)))}function Eg(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Eg(r.lastChild.content,e-1,t)))}function zI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Koe(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Koe(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Ie.empty,!0)))),r.copy(n)}function BI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!MVe(t,s.content,o)?a:null}function MVe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function IVe(r){return r.spec.defining||r.spec.definingForContent}function PVe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(qoe(i,s,n))return r.step(new da(e,t,n));let o=Voe(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=IVe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Ve(Joe(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Joe(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Joe(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Ie.empty,!0))}return r}function AVe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=CVe(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Ve(Ie.from(n),0,0))}function $Ve(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Voe(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Voe(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let Goe=class A0 extends Hr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return vi.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return vi.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(i),0,t.isLeaf?0:1))}getMap(){return Ad.empty}invert(e){return new A0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new A0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new A0(t.pos,t.attr,t.value)}};Hr.jsonID("attr",Goe);let Yoe=class vR extends Hr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return vi.ok(n)}getMap(){return Ad.empty}invert(e){return new vR(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new vR(t.attr,t.value)}};Hr.jsonID("docAttr",Yoe);let Vf=class extends Error{};Vf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Vf.prototype=Object.create(Error.prototype);Vf.prototype.constructor=Vf;Vf.prototype.name="TransformError";let RVe=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new dVe}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Vf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ve.empty){let i=TVe(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Ve(Ie.from(n),0,0))}delete(e,t){return this.replace(e,t,Ve.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return PVe(this,e,t,n),this}replaceRangeWith(e,t,n){return AVe(this,e,t,n),this}deleteRange(e,t){return $Ve(this,e,t),this}lift(e,t){return gVe(this,e,t),this}join(e,t=1){return kVe(this,e,t),this}wrap(e,t){return yVe(this,e,t),this}setBlockType(e,t=e,n,i=null){return xVe(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return wVe(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Goe(e,t,n)),this}setDocAttribute(e,t){return this.step(new Yoe(e,t)),this}addNodeMark(e,t){return this.step(new rD(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof sn)t.isInSet(n.marks)&&this.step(new wk(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new wk(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return bVe(this,e,t,n),this}addMark(e,t,n){return hVe(this,e,t,n),this}removeMark(e,t,n){return fVe(this,e,t,n),this}clearIncompatible(e,t,n){return iD(this,e,t,n),this}};const jI=Object.create(null);let Vt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new OVe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ve.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Ve.empty:t),a==0&&J6(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),J6(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new $i(e):Kh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Kh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Kh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new vf(e.node(0))}static atStart(e){return Kh(e,e,0,0,1)||new vf(e)}static atEnd(e){return Kh(e,e,e.content.size,e.childCount,-1)||new vf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=jI[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in jI)throw new RangeError("Duplicate use of selection JSON ID "+e);return jI[e]=t,t.prototype.jsonID=e,t}getBookmark(){return $i.between(this.$anchor,this.$head).getBookmark()}};Vt.prototype.visible=!0;let OVe=class{constructor(e,t){this.$from=e,this.$to=t}},q6=!1;function K6(r){!q6&&!r.parent.inlineContent&&(q6=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let $i=class Mg extends Vt{constructor(e,t=e){K6(e),K6(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Vt.near(n);let i=e.resolve(t.map(this.anchor));return new Mg(i.parent.inlineContent?i:n,n)}replace(e,t=Ve.empty){if(super.replace(e,t),t==Ve.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Mg&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Xoe(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Mg(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Vt.findFrom(t,n,!0)||Vt.findFrom(t,-n,!0);if(s)t=s.$head;else return Vt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Vt.findFrom(e,-n,!0)||Vt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new Mg(e,t)}};Vt.jsonID("text",$i);let Xoe=class Zoe{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Zoe(e.map(this.anchor),e.map(this.head))}resolve(e){return $i.between(e.resolve(this.anchor),e.resolve(this.head))}},Jl=class Ig extends Vt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Vt.near(s):new Ig(s)}content(){return new Ve(Ie.from(this.node),0,0)}eq(e){return e instanceof Ig&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NVe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Ig(e.resolve(t.anchor))}static create(e,t){return new Ig(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Jl.prototype.visible=!1;Vt.jsonID("node",Jl);let NVe=class Qoe{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Xoe(n,n):new Qoe(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Jl.isSelectable(n)?new Jl(t):Vt.near(t)}},vf=class $0 extends Vt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ve.empty){if(t==Ve.empty){e.delete(0,e.doc.content.size);let n=Vt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new $0(e)}map(e){return new $0(e)}eq(e){return e instanceof $0}getBookmark(){return _Ve}};Vt.jsonID("all",vf);const _Ve={map(){return this},resolve(r){return new vf(r)}};function Kh(r,e,t,n,i,s=!1){if(e.inlineContent)return $i.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Jl.isSelectable(a))return Jl.create(r,t-(i<0?a.nodeSize:0))}else{let l=Kh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function J6(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof da||i instanceof Rc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Vt.near(r.doc.resolve(o),t))}function V6(r,e){return!e||!r?r:r.bind(e)}let ab=class{constructor(e,t,n){this.name=e,this.init=V6(t.init,n),this.apply=V6(t.apply,n)}};new ab("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new ab("selection",{init(r,e){return r.selection||Vt.atStart(e.doc)},apply(r){return r.selection}}),new ab("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new ab("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function eae(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=eae(i,e,{})),t[n]=i}return t}let Oc=class{constructor(e){this.spec=e,this.props={},e.props&&eae(e.props,this,this.props),this.key=e.key?e.key.key:tae("plugin")}getState(e){return e[this.key]}};const LI=Object.create(null);function tae(r){return r in LI?r+"$"+ ++LI[r]:(LI[r]=0,r+"$")}let Nc=class{constructor(e="key"){this.key=tae(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var DVe=Object.defineProperty,sD=(r,e)=>{for(var t in e)DVe(r,t,{get:e[t],enumerable:!0})};function nae(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var FVe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:nae({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},rae={};sD(rae,{blur:()=>zVe,clearContent:()=>BVe,clearNodes:()=>jVe,command:()=>LVe,createParagraphNear:()=>UVe,cut:()=>WVe,deleteCurrentNode:()=>HVe,deleteNode:()=>qVe,deleteRange:()=>KVe,deleteSelection:()=>JVe,enter:()=>VVe,exitCode:()=>GVe,extendMarkRange:()=>XVe,first:()=>ZVe,focus:()=>tGe,forEach:()=>nGe,insertContent:()=>rGe,insertContentAt:()=>oGe,joinBackward:()=>cGe,joinDown:()=>lGe,joinForward:()=>uGe,joinItemBackward:()=>dGe,joinItemForward:()=>hGe,joinTextblockBackward:()=>fGe,joinTextblockForward:()=>pGe,joinUp:()=>aGe,keyboardShortcut:()=>gGe,lift:()=>yGe,liftEmptyBlock:()=>xGe,liftListItem:()=>SGe,newlineInCode:()=>wGe,resetAttributes:()=>bGe,scrollIntoView:()=>vGe,selectAll:()=>kGe,selectNodeBackward:()=>CGe,selectNodeForward:()=>TGe,selectParentNode:()=>EGe,selectTextblockEnd:()=>MGe,selectTextblockStart:()=>IGe,setContent:()=>AGe,setMark:()=>HGe,setMeta:()=>qGe,setNode:()=>KGe,setNodeSelection:()=>JGe,setTextDirection:()=>VGe,setTextSelection:()=>GGe,sinkListItem:()=>YGe,splitBlock:()=>XGe,splitListItem:()=>ZGe,toggleList:()=>QGe,toggleMark:()=>eYe,toggleNode:()=>tYe,toggleWrap:()=>nYe,undoInputRule:()=>rYe,unsetAllMarks:()=>iYe,unsetMark:()=>sYe,unsetTextDirection:()=>oYe,updateAttributes:()=>aYe,wrapIn:()=>lYe,wrapInList:()=>cYe});var zVe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),BVe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),jVe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=mVe(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},LVe=r=>e=>r(e),UVe=()=>({state:r,dispatch:e})=>uo(r,e),WVe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new $i(n.doc.resolve(Math.max(o-1,0)))),!0},HVe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function Tr(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var qVe=r=>({tr:e,state:t,dispatch:n})=>{const i=Tr(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},KVe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},JVe=()=>({state:r,dispatch:e})=>ho(r,e),VVe=()=>({commands:r})=>r.keyboardShortcut("Enter"),GVe=()=>({state:r,dispatch:e})=>fo(r,e);function YVe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function bk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:YVe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function iae(r,e,t={}){return r.find(n=>n.type===e&&bk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function G6(r,e,t={}){return!!iae(r,e,t)}function sae(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!iae([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&G6([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&G6([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function _c(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var XVe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=_c(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=sae(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=$i.create(o,d.from,d.to);t.setSelection(h)}}return!0},ZVe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function oae(r){return r instanceof $i}function wu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function QVe(r,e=null){if(!e)return null;const t=Vt.atStart(r),n=Vt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?$i.create(r,wu(0,i,s),wu(r.content.size,i,s)):$i.create(r,wu(e,i,s),wu(e,i,s))}function eGe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function oD(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var tGe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(oD()||eGe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!oae(t.state.selection))return o(),!0;const a=QVe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},nGe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),rGe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),aae=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&aae(n)}return r};function lb(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return aae(t)}function Ex(r,e,t){if(r instanceof Qu||r instanceof Ie)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Ie.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),Ex("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new rVe({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?DI.fromSchema(l).parseSlice(lb(r),t.parseOptions):DI.fromSchema(l).parse(lb(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=DI.fromSchema(e);return t.slice?s.parseSlice(lb(r),t.parseOptions).content:s.parse(lb(r),t.parseOptions)}return Ex("",e,t)}function iGe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof da||i instanceof Rc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Vt.near(r.doc.resolve(o),t))}var sGe=r=>!("type"in r),oGe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{Ex(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=Ex(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((sGe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Ie){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&iGe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},aGe=()=>({state:r,dispatch:e})=>po(r,e),lGe=()=>({state:r,dispatch:e})=>mo(r,e),cGe=()=>({state:r,dispatch:e})=>go(r,e),uGe=()=>({state:r,dispatch:e})=>yo(r,e),dGe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Hoe(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},hGe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Hoe(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},fGe=()=>({state:r,dispatch:e})=>xo(r,e),pGe=()=>({state:r,dispatch:e})=>So(r,e);function lae(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function mGe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))oD()||lae()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var gGe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=mGe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function aD(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?Tr(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>bk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var yGe=(r,e={})=>({state:t,dispatch:n})=>{const i=Tr(r,t.schema);return aD(t,i,e)?wo(t,n):!1},xGe=()=>({state:r,dispatch:e})=>bo(r,e),SGe=r=>({state:e,dispatch:t})=>{const n=Tr(r,e.schema);return vo(n)(e,t)},wGe=()=>({state:r,dispatch:e})=>ko(r,e);function cae(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function Y6(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var bGe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=cae(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Tr(r,n.schema)),a==="mark"&&(o=_c(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,Y6(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(Y6(h.attrs,e))))})})}),l},vGe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),kGe=()=>({tr:r,dispatch:e})=>{if(e){const t=new vf(r.doc);r.setSelection(t)}return!0},CGe=()=>({state:r,dispatch:e})=>Co(r,e),TGe=()=>({state:r,dispatch:e})=>To(r,e),EGe=()=>({state:r,dispatch:e})=>Eo(r,e),MGe=()=>({state:r,dispatch:e})=>Mo(r,e),IGe=()=>({state:r,dispatch:e})=>Io(r,e);function PGe(r,e,t={},n={}){return Ex(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var AGe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=PGe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function $Ge(r,e){const t=_c(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function RGe(r,e){const t=new RVe(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function OGe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function NGe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function lD(r){return e=>NGe(e.$from,r)}function Mx(r,e,t){return r.config[e]===void 0&&r.parent?Mx(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?Mx(r.parent,e,t):null}):r.config[e]}function _Ge(r){return typeof r=="function"}function vk(r,e=void 0,...t){return _Ge(r)?e?r.bind(e)(...t):r(...t):r}function uae(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function DGe(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function FGe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function zGe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function BGe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function jGe(r){const e=BGe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function LGe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),jGe(n)}function R0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function UGe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?_c(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>bk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>bk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function X6(r,e){const{nodeExtensions:t}=uae(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=vk(Mx(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function dae(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(dae(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function WGe(r,e,t){var n;const{selection:i}=e;let s=null;if(oae(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var HGe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=_c(r,n.schema);if(i)if(o){const c=$Ge(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return WGe(n,t,l)},qGe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),KGe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=Tr(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},JGe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=wu(r,0,n.content.size),s=Jl.create(n,i);e.setSelection(s)}return!0},VGe=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},GGe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=$i.atStart(n).from,a=$i.atEnd(n).to,l=wu(i,o,a),c=wu(s,o,a),u=$i.create(n,l,c);e.setSelection(u)}return!0},YGe=r=>({state:e,dispatch:t})=>{const n=Tr(r,e.schema);return Po(n)(e,t)};function Z6(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var XGe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=R0(c,a.node().type.name,a.node().attrs);if(s instanceof Jl&&s.node.isBlock)return!a.parentOffset||!P0(o,a.pos)?!1:(n&&(r&&Z6(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:OGe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=P0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&P0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof $i&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&Z6(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},ZGe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=Tr(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Ie.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Ie.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...R0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Ie.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Ve(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection($i.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...R0(h,d.type.name,d.attrs),...e},m={...R0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!P0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},UI=(r,e)=>{const t=lD(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Uoe(r.doc,t.pos)&&r.join(t.pos),!0},WI=(r,e)=>{const t=lD(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Uoe(r.doc,n)&&r.join(n),!0},QGe=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=Tr(r,o.schema),p=Tr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=lD(C=>X6(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(X6(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>UI(s,f)).command(()=>WI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>UI(s,f)).command(()=>WI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>UI(s,f)).command(()=>WI(s,f)).run()},eYe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=_c(r,n.schema);return UGe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},tYe=(r,e,t={})=>({state:n,commands:i})=>{const s=Tr(r,n.schema),o=Tr(e,n.schema),a=aD(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},nYe=(r,e={})=>({state:t,commands:n})=>{const i=Tr(r,t.schema);return aD(t,i,e)?n.lift(i):n.wrapIn(i,e)},rYe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},iYe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},sYe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=_c(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=sae(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},oYe=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},aYe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=cae(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Tr(r,n.schema)),a==="mark"&&(o=_c(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},lYe=(r,e={})=>({state:t,dispatch:n})=>{const i=Tr(r,t.schema);return Ao(i,e)(t,n)},cYe=(r,e={})=>({state:t,dispatch:n})=>{const i=Tr(r,t.schema);return $o(i,e)(t,n)},uYe=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function dYe(r){return Object.prototype.toString.call(r).slice(8,-1)}function cb(r){return dYe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function hae(r,e){const t={...r};return cb(r)&&cb(e)&&Object.keys(e).forEach(n=>{cb(e[n])&&cb(r[n])?t[n]=hae(r[n],e[n]):t[n]=e[n]}),t}var fae=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...vk(Mx(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...vk(Mx(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>hae(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},hYe={};sD(hYe,{ClipboardTextSerializer:()=>fYe,Commands:()=>pYe,Delete:()=>mYe,Drop:()=>gYe,Editable:()=>yYe,FocusEvents:()=>xYe,Keymap:()=>SYe,Paste:()=>wYe,Tabindex:()=>bYe,TextDirection:()=>vYe,focusEventsPluginKey:()=>mae});var Ea=class pae extends fae{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new pae(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},fYe=Ea.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Oc({key:new Nc("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=zGe(t);return FGe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),pYe=Ea.create({name:"commands",addCommands(){return{...rae}}}),mYe=Ea.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=RGe(r.before,[r,...e]);LGe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Ip){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),gYe=Ea.create({name:"drop",addProseMirrorPlugins(){return[new Oc({key:new Nc("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),yYe=Ea.create({name:"editable",addProseMirrorPlugins(){return[new Oc({key:new Nc("editable"),props:{editable:()=>this.editor.options.editable}})]}}),mae=new Nc("focusEvents"),xYe=Ea.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Oc({key:mae,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),SYe=Ea.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Vt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return oD()||lae()?s:i},addProseMirrorPlugins(){return[new Oc({key:new Nc("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Vt.atStart(e.doc).from,c=Vt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!dae(t.doc))return;const h=t.tr,f=nae({state:t,transaction:h}),{commands:p}=new FVe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),wYe=Ea.create({name:"paste",addProseMirrorPlugins(){return[new Oc({key:new Nc("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),bYe=Ea.create({name:"tabindex",addProseMirrorPlugins(){return[new Oc({key:new Nc("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),vYe=Ea.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=uae(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Oc({key:new Nc("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function kYe(r){return new uYe({find:r.find,handler:({state:e,range:t,match:n})=>{const i=e.doc.resolve(t.from),s=vk(r.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,s)},undoable:r.undoable})}var CYe={};sD(CYe,{createAtomBlockMarkdownSpec:()=>TYe,createBlockMarkdownSpec:()=>EYe,createInlineMarkdownSpec:()=>PYe,parseAttributes:()=>cD,parseIndentedBlocks:()=>AYe,renderNestedMarkdownContent:()=>$Ye,serializeAttributes:()=>uD});function cD(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function uD(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function TYe(r){const{nodeName:e,name:t,parseAttributes:n=cD,serializeAttributes:i=uD,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function EYe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=cD,serializeAttributes:s=uD,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function MYe(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function IYe(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function PYe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=MYe,serializeAttributes:s=IYe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function AYe(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function $Ye(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var RYe=class gae extends fae{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new gae(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},OYe=RYe.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:e}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,DGe(this.options.HTMLAttributes,e),0]},parseMarkdown:(r,e)=>e.createNode("heading",{level:r.depth||1},e.parseInline(r.tokens||[])),renderMarkdown:(r,e)=>{var t;const n=(t=r.attrs)!=null&&t.level?parseInt(r.attrs.level,10):1,i="#".repeat(n);return r.content?`${i} ${e.renderChildren(r.content)}`:""},addCommands(){return{setHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.setNode(this.name,r):!1,toggleHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,e)=>({...r,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(r=>kYe({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}}),NYe=f2.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",Ha(this.options.HTMLAttributes,r)]},markdownTokenName:"hr",parseMarkdown:(r,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:r,state:e})=>{if(!U3e(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$to:n}=t,i=r();return o3e(t)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:s,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(Ln.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(co.create(o.doc,l.pos)):o.setSelection(Ln.create(o.doc,l.pos));else{const u=s.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u?.create();d&&(o.insert(c,d),o.setSelection(Ln.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[L3e({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),_Ye=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,DYe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,FYe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,zYe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,BYe=kp.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",Ha(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(r,e)=>e.applyMark("italic",e.parseInline(r.tokens||[])),renderMarkdown:(r,e)=>`*${e.renderChildren(r)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Wf({find:_Ye,type:this.type}),Wf({find:FYe,type:this.type})]},addPasteRules(){return[Td({find:DYe,type:this.type}),Td({find:zYe,type:this.type})]}}),dD="[\0- -\u2029]",jYe=new RegExp(dD),LYe=new RegExp(`${dD}$`),UYe=new RegExp(dD,"g");function WYe(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function HYe(r){return new Oo({key:new No("autolink"),appendTransaction:(e,t,n)=>{const i=e.some(c=>c.docChanged)&&!t.doc.eq(n.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=n,a=Zte(t.doc,[...e]);if(ene(a).forEach(({newRange:c})=>{const u=YLe(n.doc,c,f=>f.isTextblock);let d,h;if(u.length>1)d=u[0],h=n.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=n.doc.textBetween(c.from,c.to," "," ");if(!LYe.test(f))return;d=u[0],h=n.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){const f=h.split(jYe).filter(Boolean);if(f.length<=0)return!1;const p=f[f.length-1],m=d.pos+h.lastIndexOf(p);if(!p)return!1;const g=qde(p).map(y=>y.toObject(r.defaultProtocol));if(!WYe(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>n.schema.marks.code?!n.doc.rangeHasMark(y.from,y.to,n.schema.marks.code):!0).filter(y=>r.validate(y.value)).filter(y=>r.shouldAutoLink(y.value)).forEach(y=>{c2(y.from,y.to,n.doc).some(S=>S.mark.type===r.type)||o.addMark(y.from,y.to,r.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function qYe(r){return new Oo({key:new No("handleClickLink"),props:{handleClick:(e,t,n)=>{var i,s;if(n.button!==0||!e.editable)return!1;let o=!1;if(r.enableClickSelection&&(o=r.editor.commands.extendMarkRange(r.type.name)),r.openOnClick){let a=null;if(n.target instanceof HTMLAnchorElement)a=n.target;else{let d=n.target;const h=[];for(;d.nodeName!=="DIV";)h.push(d),d=d.parentNode;a=h.find(f=>f.nodeName==="A")}if(!a)return o;const l=n3e(e.state,r.type.name),c=(i=a?.href)!=null?i:l.href,u=(s=a?.target)!=null?s:l.target;a&&c&&(window.open(c,u),o=!0)}return o}}})}function KYe(r){return new Oo({key:new No("handlePasteLink"),props:{handlePaste:(e,t,n)=>{const{shouldAutoLink:i}=r,{state:s}=e,{selection:o}=s,{empty:a}=o;if(a)return!1;let l="";n.content.forEach(u=>{l+=u.textContent});const c=HU(l,{defaultProtocol:r.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||i!==void 0&&!i(c.href)?!1:r.editor.commands.setMark(r.type,{href:c.href})}}})}function Gc(r,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&t.push(i)}),!r||r.replace(UYe,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var JYe=kp.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){sF(r);return}sF(r.scheme,r.optionalSlashes)})},onDestroy(){Kde()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,e)=>!!Gc(r,e.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const e=r.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!Gc(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:e=>!!Gc(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Ha(this.options.HTMLAttributes,r),0]:["a",Ha(this.options.HTMLAttributes,{...r,href:""}),0]},markdownTokenName:"link",parseMarkdown:(r,e)=>e.applyMark("link",e.parseInline(r.tokens||[]),{href:r.href,title:r.title||null}),renderMarkdown:(r,e)=>{var t;const n=((t=r.attrs)==null?void 0:t.href)||"";return`[${e.renderChildren(r)}](${n})`},addCommands(){return{setLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:n=>!!Gc(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:e})=>{const{href:t}=r||{};return t&&!this.options.isAllowedUri(t,{defaultValidate:n=>!!Gc(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Td({find:r=>{const e=[];if(r){const{protocols:t,defaultProtocol:n}=this.options,i=HU(r).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!Gc(o,t),protocols:t,defaultProtocol:n}));i.length&&i.forEach(s=>{this.options.shouldAutoLink(s.value)&&e.push({text:s.value,data:{href:s.href},index:s.start})})}return e},type:this.type,getAttributes:r=>{var e;return{href:(e=r.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&r.push(HYe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!Gc(i,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),r.push(qYe({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&r.push(KYe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),r}});function yae(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=yae(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function xae(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=xae(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}let Pe=class oi{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new oi(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new oi(n,i)}cutByIndex(e,t){return e==t?oi.empty:e==0&&t==this.content.length?this:new oi(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new oi(i,s)}addToStart(e){return new oi([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new oi(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return yae(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return xae(this,e,t,n)}findIndex(e){if(e==0)return ub(0,e);if(e==this.size)return ub(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?ub(t+1,s):ub(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return oi.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new oi(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return oi.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new oi(t||e,n)}static from(e){if(!e)return oi.empty;if(e instanceof oi)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new oi([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Pe.empty=new Pe([],0);const HI={index:0,offset:0};function ub(r,e){return HI.index=r,HI.offset=e,HI}function kk(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!kk(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!kk(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let on=class kR{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&kk(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return kR.none;if(e instanceof kR)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};on.none=[];let Ck=class extends Error{},Ge=class Jh{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=wae(this.content,e+this.openStart,t);return n&&new Jh(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Jh(Sae(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Jh.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Jh(Pe.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new Jh(e,n,i)}};Ge.empty=new Ge(Pe.empty,0,0);function Sae(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(Sae(s.content,e-i-1,t-i-1)))}function wae(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=wae(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function VYe(r,e,t){if(t.openStart>r.depth)throw new Ck("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Ck("Inconsistent open depths");return bae(r,e,t,0)}function bae(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=bae(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return td(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=GYe(t,r);return td(s,kae(r,o,a,e,n))}else return td(s,Tk(r,e,n))}function vae(r,e){if(!e.type.compatibleContent(r.type))throw new Ck("Cannot join "+e.type.name+" onto "+r.type.name)}function CR(r,e,t){let n=r.node(t);return vae(n,e.node(t)),n}function ed(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function xy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(ed(r.nodeAfter,n),s++));for(let a=s;a<o;a++)ed(i.child(a),n);e&&e.depth==t&&e.textOffset&&ed(e.nodeBefore,n)}function td(r,e){return r.type.checkContent(e),r.copy(e)}function kae(r,e,t,n,i){let s=r.depth>i&&CR(r,e,i+1),o=n.depth>i&&CR(t,n,i+1),a=[];return xy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(vae(s,o),ed(td(s,kae(r,e,t,n,i+1)),a)):(s&&ed(td(s,Tk(r,e,i+1)),a),xy(e,t,i,a),o&&ed(td(o,Tk(t,n,i+1)),a)),xy(n,null,i,a),new Pe(a)}function Tk(r,e,t){let n=[];if(xy(null,r,t,n),r.depth>t){let i=CR(r,e,t+1);ed(td(i,Tk(r,e,t+1)),n)}return xy(e,null,t,n),new Pe(n)}function GYe(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Pe.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}let Q6=class TR{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return on.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new ZYe(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new TR(t,n,s)}static resolveCached(e,t){let n=e8.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else e8.set(e,n=new YYe);let i=n.elts[n.i]=TR.resolve(e,t);return n.i=(n.i+1)%XYe,i}},YYe=class{constructor(){this.elts=[],this.i=0}};const XYe=12,e8=new WeakMap;let ZYe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};const QYe=Object.create(null);let nd=class ER{constructor(e,t,n,i=on.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Pe.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&kk(this.attrs,t||e.defaultAttrs||QYe)&&on.sameSet(this.marks,n||on.none)}copy(e=null){return e==this.content?this:new ER(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new ER(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Ge.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Ge(c,i.depth-o,s.depth-o)}replace(e,t,n){return VYe(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return Q6.resolveCached(this,e)}resolveNoCache(e){return Q6.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Cae(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Pe.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=on.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!on.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Pe.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};nd.prototype.text=void 0;let eXe=class MR extends nd{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Cae(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new MR(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new MR(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function Cae(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}let Ix=class Tae{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new tXe(e,t);if(n.next==null)return Tae.empty;let i=Eae(n);n.next&&n.err("Unexpected trailing text");let s=lXe(aXe(i));return cXe(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Pe.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}};Ix.empty=new Ix(!0);let tXe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function Eae(r){let e=[];do e.push(nXe(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function nXe(r){let e=[];do e.push(rXe(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function rXe(r){let e=oXe(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=iXe(r,e);else break;return e}function t8(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function iXe(r,e){let t=t8(r),n=t;return r.eat(",")&&(r.next!="}"?n=t8(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function sXe(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function oXe(r){if(r.eat("(")){let e=Eae(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=sXe(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function aXe(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Mae(r,e){return e-r}function n8(r,e){let t=[];return n(e),t.sort(Mae);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function lXe(r){let e=Object.create(null);return t(n8(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);n8(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new Ix(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Mae);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function cXe(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Iae(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Pae(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Aae(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function $ae(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new dXe(r,n,e[n]);return t}let r8=class Rae{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=$ae(e,n.attrs),this.defaultAttrs=Iae(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ix.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Pae(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new nd(this,this.computeAttrs(e),Pe.from(t),on.setFrom(n))}createChecked(e=null,t,n){return t=Pe.from(t),this.checkContent(t),new nd(this,this.computeAttrs(e),t,on.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Pe.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Pe.empty,!0);return s?new nd(this,e,t.append(s),on.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Aae(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:on.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Rae(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function uXe(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}let dXe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?uXe(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Oae=class Nae{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=$ae(e,i.attrs),this.excluded=null;let s=Iae(this.attrs);this.instance=s?new on(this,s):null}create(e=null){return!e&&this.instance?this.instance:new on(this,Pae(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Nae(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Aae(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},hXe=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=r8.compile(this.spec.nodes,this),this.marks=Oae.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Ix.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?i8(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:i8(this,o.split(" "))}this.nodeFromJSON=i=>nd.fromJSON(this,i),this.markFromJSON=i=>on.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof r8){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new eXe(n,n.defaultAttrs,e,on.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function i8(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function fXe(r){return r.tag!=null}function pXe(r){return r.style!=null}let qI=class IR{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(fXe(i))this.tags.push(i);else if(pXe(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new o8(this,t,!1);return n.addAll(e,on.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new o8(this,t,!0);return n.addAll(e,on.none,t.from,t.to),Ge.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(yXe(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=a8(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=a8(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new IR(e,IR.schemaRules(e)))}};const _ae={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},mXe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Dae={ol:!0,ul:!0},Px=1,PR=2,Sy=4;function s8(r,e,t){return e!=null?(e?Px:0)|(e==="full"?PR:0):r&&r.whitespace=="pre"?Px|PR:t&~Sy}let db=class{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=on.none,this.match=s||(o&Sy?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Pe.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Px)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Pe.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Pe.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!_ae.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},o8=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=s8(null,t.preserveWhitespace,0)|(n?Sy:0);i?s=new db(i.type,i.attrs,on.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new db(null,null,on.none,!0,null,o):s=new db(e.schema.topNodeType,null,on.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&PR?"full":this.localPreserveWS||(i.options&Px)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Dae.hasOwnProperty(o)&&this.parser.normalizeLists&&gXe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:mXe.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(_ae.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=on.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):l8(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=s8(e,s,o.options);o.options&Sy&&o.content.length==0&&(a|=Sy);let l=on.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):l8(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new db(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Px)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function gXe(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Dae.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function yXe(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function a8(r){let e={};for(let t in r)e[t]=r[t];return e}function l8(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}const Fae=65535,zae=Math.pow(2,16);function xXe(r,e){return r+e*zae}function c8(r){return r&Fae}function SXe(r){return(r-(r&Fae))/zae}const Bae=1,jae=2,O0=4,Lae=8;let AR=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Lae)>0}get deletedBefore(){return(this.delInfo&(Bae|O0))>0}get deletedAfter(){return(this.delInfo&(jae|O0))>0}get deletedAcross(){return(this.delInfo&O0)>0}},$d=class Vh{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Vh.empty)return Vh.empty}recover(e){let t=0,n=c8(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+SXe(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:xXe(a/3,e-l),m=e==l?jae:e==d?Bae:O0;return(t<0?e!=l:e!=d)&&(m|=Lae),new AR(f,m,p)}i+=u-c}return n?e+i:new AR(e+i,0,null)}touches(e,t){let n=0,i=c8(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Vh(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Vh.empty:new Vh(e<0?[0,-e,0]:[0,0,e])}};$d.empty=new $d([]);let wXe=class $R{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new $R(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new $R;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new AR(e,i,null)}};const KI=Object.create(null);let qr=class{getMap(){return $d.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=KI[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in KI)throw new RangeError("Duplicate use of step JSON ID "+e);return KI[e]=t,t.prototype.jsonID=e,t}},ki=class Pg{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Pg(e,null)}static fail(e){return new Pg(null,e)}static fromReplace(e,t,n,i){try{return Pg.ok(e.replace(t,n,i))}catch(s){if(s instanceof Ck)return Pg.fail(s.message);throw s}}};function hD(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(hD(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Pe.fromArray(n)}let fD=class Ag extends qr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new Ge(hD(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return ki.fromReplace(e,this.from,this.to,s)}invert(){return new Pp(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Ag(t.pos,n.pos,this.mark)}merge(e){return e instanceof Ag&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ag(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ag(t.from,t.to,e.markFromJSON(t.mark))}};qr.jsonID("addMark",fD);let Pp=class $g extends qr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Ge(hD(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return ki.fromReplace(e,this.from,this.to,n)}invert(){return new fD(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new $g(t.pos,n.pos,this.mark)}merge(e){return e instanceof $g&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new $g(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new $g(t.from,t.to,e.markFromJSON(t.mark))}};qr.jsonID("removeMark",Pp);let pD=class Rg extends qr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ki.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return ki.fromReplace(e,this.pos,this.pos+1,new Ge(Pe.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new Rg(this.pos,t.marks[i]);return new Rg(this.pos,this.mark)}}return new Ek(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Rg(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Rg(t.pos,e.markFromJSON(t.mark))}};qr.jsonID("addNodeMark",pD);let Ek=class RR extends qr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ki.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return ki.fromReplace(e,this.pos,this.pos+1,new Ge(Pe.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new pD(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new RR(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RR(t.pos,e.markFromJSON(t.mark))}};qr.jsonID("removeNodeMark",Ek);let ha=class ou extends qr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&OR(e,this.from,this.to)?ki.fail("Structure replace would overwrite content"):ki.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new $d([this.from,this.to-this.from,this.slice.size])}invert(e){return new ou(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new ou(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ou)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ge.empty:new Ge(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ou(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ge.empty:new Ge(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ou(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ou(t.from,t.to,Ge.fromJSON(e,t.slice),!!t.structure)}};qr.jsonID("replace",ha);let Dc=class N0 extends qr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(OR(e,this.from,this.gapFrom)||OR(e,this.gapTo,this.to)))return ki.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return ki.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?ki.fromReplace(e,this.from,this.to,n):ki.fail("Content does not fit in gap")}getMap(){return new $d([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new N0(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new N0(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new N0(t.from,t.to,t.gapFrom,t.gapTo,Ge.fromJSON(e,t.slice),t.insert,!!t.structure)}};qr.jsonID("replaceAround",Dc);function OR(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function bXe(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new Pp(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new fD(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function vXe(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof Oae){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new Pp(o.from,o.to,o.style)))}function mD(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new ha(a,u,Ge.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Pp(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new Ge(Pe.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ha(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Pe.empty,!0);r.replace(a,a,new Ge(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function kXe(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function CXe(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!kXe(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function TXe(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Pe.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Pe.from(n.node(p).copy(u)),d++):l--;let h=Pe.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Pe.from(i.node(p).copy(h)),f++):c++;r.step(new Dc(l,c,o,a,new Ge(u.append(h),d,f),u.size-d,!0))}function EXe(r,e,t=null,n=r){let i=MXe(r,e),s=i&&IXe(n,e);return s?i.map(u8).concat({type:e,attrs:t}).concat(s.map(u8)):null}function u8(r){return{type:r,attrs:null}}function MXe(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return t.canReplaceWith(n,i,o)?s:null}function IXe(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=n;l&&c<i;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function PXe(r,e,t){let n=Pe.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Pe.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Dc(i,s,i,s,new Ge(n,0,0),t.length,!0))}function AXe(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&$Xe(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Wae(r,o,a,s),mD(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new Dc(d,h,d+1,h-1,new Ge(Pe.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Uae(r,o,a,s),!1}})}function Uae(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Wae(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function $Xe(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function RXe(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Dc(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ge(Pe.from(o),0,0),1,!0))}function _0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function OXe(r,e,t=1,n){let i=r.doc.resolve(e),s=Pe.empty,o=Pe.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Pe.from(i.node(a).copy(s));let u=n&&n[c];o=Pe.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new ha(e,e,new Ge(s.append(o),t,t),!0))}function gD(r,e){let t=r.resolve(e),n=t.index();return Hae(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function NXe(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Hae(r,e){return!!(r&&e&&!r.isLeaf&&NXe(r,e))}function qae(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Hae(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function _Xe(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Wae(r,u.node(),u.before(),a)}o.inlineContent&&mD(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new ha(c,l.map(e+t,-1),Ge.empty,!0)),n===!0){let u=r.doc.resolve(c);Uae(r,u.node(),u.before(),r.steps.length)}return r}function DXe(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function FXe(r,e,t=e,n=Ge.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return Kae(i,s,n)?new ha(e,t,n):new zXe(i,s,n).fit()}function Kae(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}let zXe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Pe.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Pe.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ge(s,o,a);return e>-1?new Dc(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new ha(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=JI(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Pe.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=JI(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ge(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=JI(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new Ge(Og(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new Ge(Og(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Jae(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Ng(this.placed,t,Pe.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Ge.empty:new Ge(Og(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new Ge(Og(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!VI(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=VI(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=VI(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Ng(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Ng(this.placed,this.depth,Pe.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Pe.empty,!0);t.childCount&&(this.placed=Ng(this.placed,this.frontier.length,t))}};function Og(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Og(r.firstChild.content,e-1,t)))}function Ng(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Ng(r.lastChild.content,e-1,t)))}function JI(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Jae(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Jae(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Pe.empty,!0)))),r.copy(n)}function VI(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!BXe(t,s.content,o)?a:null}function BXe(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function jXe(r){return r.spec.defining||r.spec.definingForContent}function LXe(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(Kae(i,s,n))return r.step(new ha(e,t,n));let o=Gae(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=jXe(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new Ge(Vae(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function Vae(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(Vae(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Pe.empty,!0))}return r}function UXe(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=DXe(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new Ge(Pe.from(n),0,0))}function WXe(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=Gae(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Gae(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}let Yae=class D0 extends qr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return ki.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return ki.fromReplace(e,this.pos,this.pos+1,new Ge(Pe.from(i),0,t.isLeaf?0:1))}getMap(){return $d.empty}invert(e){return new D0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new D0(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new D0(t.pos,t.attr,t.value)}};qr.jsonID("attr",Yae);let Xae=class NR extends qr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return ki.ok(n)}getMap(){return $d.empty}invert(e){return new NR(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new NR(t.attr,t.value)}};qr.jsonID("docAttr",Xae);let Gf=class extends Error{};Gf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Gf.prototype=Object.create(Error.prototype);Gf.prototype.constructor=Gf;Gf.prototype.name="TransformError";let HXe=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new wXe}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Gf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Ge.empty){let i=FXe(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new Ge(Pe.from(n),0,0))}delete(e,t){return this.replace(e,t,Ge.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return LXe(this,e,t,n),this}replaceRangeWith(e,t,n){return UXe(this,e,t,n),this}deleteRange(e,t){return WXe(this,e,t),this}lift(e,t){return TXe(this,e,t),this}join(e,t=1){return _Xe(this,e,t),this}wrap(e,t){return PXe(this,e,t),this}setBlockType(e,t=e,n,i=null){return AXe(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return RXe(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Yae(e,t,n)),this}setDocAttribute(e,t){return this.step(new Xae(e,t)),this}addNodeMark(e,t){return this.step(new pD(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof on)t.isInSet(n.marks)&&this.step(new Ek(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new Ek(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return OXe(this,e,t,n),this}addMark(e,t,n){return bXe(this,e,t,n),this}removeMark(e,t,n){return vXe(this,e,t,n),this}clearIncompatible(e,t,n){return mD(this,e,t,n),this}};const GI=Object.create(null);let Gt=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new qXe(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ge.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Ge.empty:t),a==0&&f8(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),f8(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new Ri(e):Gh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Gh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Gh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new kf(e.node(0))}static atStart(e){return Gh(e,e,0,0,1)||new kf(e)}static atEnd(e){return Gh(e,e,e.content.size,e.childCount,-1)||new kf(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=GI[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in GI)throw new RangeError("Duplicate use of selection JSON ID "+e);return GI[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ri.between(this.$anchor,this.$head).getBookmark()}};Gt.prototype.visible=!0;let qXe=class{constructor(e,t){this.$from=e,this.$to=t}},d8=!1;function h8(r){!d8&&!r.parent.inlineContent&&(d8=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}let Ri=class _g extends Gt{constructor(e,t=e){h8(e),h8(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Gt.near(n);let i=e.resolve(t.map(this.anchor));return new _g(i.parent.inlineContent?i:n,n)}replace(e,t=Ge.empty){if(super.replace(e,t),t==Ge.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof _g&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Zae(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new _g(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=Gt.findFrom(t,n,!0)||Gt.findFrom(t,-n,!0);if(s)t=s.$head;else return Gt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(Gt.findFrom(e,-n,!0)||Gt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new _g(e,t)}};Gt.jsonID("text",Ri);let Zae=class Qae{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Qae(e.map(this.anchor),e.map(this.head))}resolve(e){return Ri.between(e.resolve(this.anchor),e.resolve(this.head))}},Vl=class Dg extends Gt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?Gt.near(s):new Dg(s)}content(){return new Ge(Pe.from(this.node),0,0)}eq(e){return e instanceof Dg&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new KXe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Dg(e.resolve(t.anchor))}static create(e,t){return new Dg(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Vl.prototype.visible=!1;Gt.jsonID("node",Vl);let KXe=class ele{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Zae(n,n):new ele(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Vl.isSelectable(n)?new Vl(t):Gt.near(t)}},kf=class F0 extends Gt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ge.empty){if(t==Ge.empty){e.delete(0,e.doc.content.size);let n=Gt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new F0(e)}map(e){return new F0(e)}eq(e){return e instanceof F0}getBookmark(){return JXe}};Gt.jsonID("all",kf);const JXe={map(){return this},resolve(r){return new kf(r)}};function Gh(r,e,t,n,i,s=!1){if(e.inlineContent)return Ri.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Vl.isSelectable(a))return Vl.create(r,t-(i<0?a.nodeSize:0))}else{let l=Gh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function f8(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof ha||i instanceof Dc))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(Gt.near(r.doc.resolve(o),t))}function p8(r,e){return!e||!r?r:r.bind(e)}let hb=class{constructor(e,t,n){this.name=e,this.init=p8(t.init,n),this.apply=p8(t.apply,n)}};new hb("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new hb("selection",{init(r,e){return r.selection||Gt.atStart(e.doc)},apply(r){return r.selection}}),new hb("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new hb("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function tle(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=tle(i,e,{})),t[n]=i}return t}let Fc=class{constructor(e){this.spec=e,this.props={},e.props&&tle(e.props,this,this.props),this.key=e.key?e.key.key:nle("plugin")}getState(e){return e[this.key]}};const YI=Object.create(null);function nle(r){return r in YI?r+"$"+ ++YI[r]:(YI[r]=0,r+"$")}let zc=class{constructor(e="key"){this.key=nle(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var VXe=Object.defineProperty,yD=(r,e)=>{for(var t in e)VXe(r,t,{get:e[t],enumerable:!0})};function rle(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var GXe=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,t),y=f(...m)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:rle({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},ile={};yD(ile,{blur:()=>YXe,clearContent:()=>XXe,clearNodes:()=>ZXe,command:()=>QXe,createParagraphNear:()=>eZe,cut:()=>tZe,deleteCurrentNode:()=>nZe,deleteNode:()=>rZe,deleteRange:()=>iZe,deleteSelection:()=>sZe,enter:()=>oZe,exitCode:()=>aZe,extendMarkRange:()=>cZe,first:()=>uZe,focus:()=>fZe,forEach:()=>pZe,insertContent:()=>mZe,insertContentAt:()=>xZe,joinBackward:()=>bZe,joinDown:()=>wZe,joinForward:()=>vZe,joinItemBackward:()=>kZe,joinItemForward:()=>CZe,joinTextblockBackward:()=>TZe,joinTextblockForward:()=>EZe,joinUp:()=>SZe,keyboardShortcut:()=>IZe,lift:()=>PZe,liftEmptyBlock:()=>AZe,liftListItem:()=>$Ze,newlineInCode:()=>RZe,resetAttributes:()=>OZe,scrollIntoView:()=>NZe,selectAll:()=>_Ze,selectNodeBackward:()=>DZe,selectNodeForward:()=>FZe,selectParentNode:()=>zZe,selectTextblockEnd:()=>BZe,selectTextblockStart:()=>jZe,setContent:()=>UZe,setMark:()=>iQe,setMeta:()=>sQe,setNode:()=>oQe,setNodeSelection:()=>aQe,setTextDirection:()=>lQe,setTextSelection:()=>cQe,sinkListItem:()=>uQe,splitBlock:()=>dQe,splitListItem:()=>hQe,toggleList:()=>fQe,toggleMark:()=>pQe,toggleNode:()=>mQe,toggleWrap:()=>gQe,undoInputRule:()=>yQe,unsetAllMarks:()=>xQe,unsetMark:()=>SQe,unsetTextDirection:()=>wQe,updateAttributes:()=>bQe,wrapIn:()=>vQe,wrapInList:()=>kQe});var YXe=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),XXe=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),ZXe=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=CXe(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},QXe=r=>e=>r(e),eZe=()=>({state:r,dispatch:e})=>uo(r,e),tZe=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Ri(n.doc.resolve(Math.max(o-1,0)))),!0},nZe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function Wn(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var rZe=r=>({tr:e,state:t,dispatch:n})=>{const i=Wn(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},iZe=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},sZe=()=>({state:r,dispatch:e})=>ho(r,e),oZe=()=>({commands:r})=>r.keyboardShortcut("Enter"),aZe=()=>({state:r,dispatch:e})=>fo(r,e);function lZe(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Mk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:lZe(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function sle(r,e,t={}){return r.find(n=>n.type===e&&Mk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function m8(r,e,t={}){return!!sle(r,e,t)}function ole(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!sle([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&m8([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&m8([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Bc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var cZe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=Bc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=ole(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=Ri.create(o,d.from,d.to);t.setSelection(h)}}return!0},uZe=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function ale(r){return r instanceof Ri}function bu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function dZe(r,e=null){if(!e)return null;const t=Gt.atStart(r),n=Gt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?Ri.create(r,bu(0,i,s),bu(r.content.size,i,s)):Ri.create(r,bu(e,i,s),bu(e,i,s))}function hZe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function xD(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var fZe=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(xD()||hZe())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!ale(t.state.selection))return o(),!0;const a=dZe(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},pZe=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),mZe=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),lle=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&lle(n)}return r};function fb(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return lle(t)}function Ax(r,e,t){if(r instanceof nd||r instanceof Pe)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Pe.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),Ax("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new hXe({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?qI.fromSchema(l).parseSlice(fb(r),t.parseOptions):qI.fromSchema(l).parse(fb(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=qI.fromSchema(e);return t.slice?s.parseSlice(fb(r),t.parseOptions).content:s.parse(fb(r),t.parseOptions)}return Ax("",e,t)}function gZe(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof ha||i instanceof Dc))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(Gt.near(r.doc.resolve(o),t))}var yZe=r=>!("type"in r),xZe=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{Ax(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=Ax(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((yZe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Pe){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&gZe(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},SZe=()=>({state:r,dispatch:e})=>po(r,e),wZe=()=>({state:r,dispatch:e})=>mo(r,e),bZe=()=>({state:r,dispatch:e})=>go(r,e),vZe=()=>({state:r,dispatch:e})=>yo(r,e),kZe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=qae(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},CZe=()=>({state:r,dispatch:e,tr:t})=>{try{const n=qae(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},TZe=()=>({state:r,dispatch:e})=>xo(r,e),EZe=()=>({state:r,dispatch:e})=>So(r,e);function cle(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function MZe(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))xD()||cle()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var IZe=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=MZe(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function Yf(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?Wn(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Mk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var PZe=(r,e={})=>({state:t,dispatch:n})=>{const i=Wn(r,t.schema);return Yf(t,i,e)?wo(t,n):!1},AZe=()=>({state:r,dispatch:e})=>bo(r,e),$Ze=r=>({state:e,dispatch:t})=>{const n=Wn(r,e.schema);return vo(n)(e,t)},RZe=()=>({state:r,dispatch:e})=>ko(r,e);function ule(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function g8(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var OZe=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=ule(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Wn(r,n.schema)),a==="mark"&&(o=Bc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,g8(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(g8(h.attrs,e))))})})}),l},NZe=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),_Ze=()=>({tr:r,dispatch:e})=>{if(e){const t=new kf(r.doc);r.setSelection(t)}return!0},DZe=()=>({state:r,dispatch:e})=>Co(r,e),FZe=()=>({state:r,dispatch:e})=>To(r,e),zZe=()=>({state:r,dispatch:e})=>Eo(r,e),BZe=()=>({state:r,dispatch:e})=>Mo(r,e),jZe=()=>({state:r,dispatch:e})=>Io(r,e);function LZe(r,e,t={},n={}){return Ax(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var UZe=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=LZe(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function WZe(r,e){const t=Bc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function HZe(r,e){const t=new HXe(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function qZe(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function KZe(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function sC(r){return e=>KZe(e.$from,r)}function $x(r,e,t){return r.config[e]===void 0&&r.parent?$x(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?$x(r.parent,e,t):null}):r.config[e]}function JZe(r){return typeof r=="function"}function Ik(r,e=void 0,...t){return JZe(r)?e?r.bind(e)(...t):r(...t):r}function dle(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function Xf(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=n[i]?n[i].split(" "):[],c=a.filter(u=>!l.includes(u));n[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[i]?n[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[i]=s}),n},{})}function VZe(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function GZe(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function YZe(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function XZe(r){const e=YZe(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function ZZe(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),XZe(n)}var QZe=(r,e,t,n=20)=>{const i=r.doc.resolve(t);let s=n,o=null;for(;s>0&&o===null;){const a=i.node(s);a?.type.name===e?o=a:s-=1}return[o,s]};function z0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function eQe(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?Bc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Mk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Mk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}var tQe=(r,e)=>{const{$from:t,$to:n,$anchor:i}=r.selection;if(e){const s=sC(a=>a.type.name===e)(r.selection);if(!s)return!1;const o=r.doc.resolve(s.pos+1);return i.pos+1===o.end()}return!(n.parentOffset<n.parent.nodeSize-2||t.pos!==n.pos)},nQe=r=>{const{$from:e,$to:t}=r.selection;return!(e.parentOffset>0||e.pos!==t.pos)};function y8(r,e){const{nodeExtensions:t}=dle(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=Ik($x(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function hle(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(hle(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function rQe(r,e,t){var n;const{selection:i}=e;let s=null;if(ale(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var iQe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=Bc(r,n.schema);if(i)if(o){const c=WZe(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return rQe(n,t,l)},sQe=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),oQe=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=Wn(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},aQe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=bu(r,0,n.content.size),s=Vl.create(n,i);e.setSelection(s)}return!0},lQe=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},cQe=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=Ri.atStart(n).from,a=Ri.atEnd(n).to,l=bu(i,o,a),c=bu(s,o,a),u=Ri.create(n,l,c);e.setSelection(u)}return!0},uQe=r=>({state:e,dispatch:t})=>{const n=Wn(r,e.schema);return Po(n)(e,t)};function x8(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var dQe=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=z0(c,a.node().type.name,a.node().attrs);if(s instanceof Vl&&s.node.isBlock)return!a.parentOffset||!_0(o,a.pos)?!1:(n&&(r&&x8(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:qZe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=_0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&_0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof Ri&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&x8(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},hQe=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=Wn(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Pe.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Pe.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...z0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Pe.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new Ge(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(Ri.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...z0(h,d.type.name,d.attrs),...e},m={...z0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!_0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},XI=(r,e)=>{const t=sC(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&gD(r.doc,t.pos)&&r.join(t.pos),!0},ZI=(r,e)=>{const t=sC(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&gD(r.doc,n)&&r.join(n),!0},fQe=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=Wn(r,o.schema),p=Wn(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=sC(C=>y8(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(y8(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>XI(s,f)).command(()=>ZI(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>XI(s,f)).command(()=>ZI(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>XI(s,f)).command(()=>ZI(s,f)).run()},pQe=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=Bc(r,n.schema);return eQe(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},mQe=(r,e,t={})=>({state:n,commands:i})=>{const s=Wn(r,n.schema),o=Wn(e,n.schema),a=Yf(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},gQe=(r,e={})=>({state:t,commands:n})=>{const i=Wn(r,t.schema);return Yf(t,i,e)?n.lift(i):n.wrapIn(i,e)},yQe=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},xQe=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},SQe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=Bc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=ole(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},wQe=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},bQe=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=ule(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Wn(r,n.schema)),a==="mark"&&(o=Bc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},vQe=(r,e={})=>({state:t,dispatch:n})=>{const i=Wn(r,t.schema);return Ao(i,e)(t,n)},kQe=(r,e={})=>({state:t,dispatch:n})=>{const i=Wn(r,t.schema);return $o(i,e)(t,n)},CQe=class{constructor(r){var e;this.find=r.find,this.handler=r.handler,this.undoable=(e=r.undoable)!=null?e:!0}};function TQe(r){return Object.prototype.toString.call(r).slice(8,-1)}function pb(r){return TQe(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function fle(r,e){const t={...r};return pb(r)&&pb(e)&&Object.keys(e).forEach(n=>{pb(e[n])&&pb(r[n])?t[n]=fle(r[n],e[n]):t[n]=e[n]}),t}var ple=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...Ik($x(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Ik($x(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>fle(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},EQe={};yD(EQe,{ClipboardTextSerializer:()=>MQe,Commands:()=>IQe,Delete:()=>PQe,Drop:()=>AQe,Editable:()=>$Qe,FocusEvents:()=>RQe,Keymap:()=>OQe,Paste:()=>NQe,Tabindex:()=>_Qe,TextDirection:()=>DQe,focusEventsPluginKey:()=>gle});var Ks=class mle extends ple{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new mle(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},MQe=Ks.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Fc({key:new zc("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=GZe(t);return VZe(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),IQe=Ks.create({name:"commands",addCommands(){return{...ile}}}),PQe=Ks.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=HZe(r.before,[r,...e]);ZZe(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Pp){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),AQe=Ks.create({name:"drop",addProseMirrorPlugins(){return[new Fc({key:new zc("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),$Qe=Ks.create({name:"editable",addProseMirrorPlugins(){return[new Fc({key:new zc("editable"),props:{editable:()=>this.editor.options.editable}})]}}),gle=new zc("focusEvents"),RQe=Ks.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Fc({key:gle,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),OQe=Ks.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Gt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return xD()||cle()?s:i},addProseMirrorPlugins(){return[new Fc({key:new zc("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=Gt.atStart(e.doc).from,c=Gt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!hle(t.doc))return;const h=t.tr,f=rle({state:t,transaction:h}),{commands:p}=new GXe({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),NQe=Ks.create({name:"paste",addProseMirrorPlugins(){return[new Fc({key:new zc("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),_Qe=Ks.create({name:"tabindex",addProseMirrorPlugins(){return[new Fc({key:new zc("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),DQe=Ks.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=dle(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Fc({key:new zc("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}});function Rx(r){return new CQe({find:r.find,handler:({state:e,range:t,match:n,chain:i})=>{const s=Ik(r.getAttributes,void 0,n)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&EXe(l,r.type,s);if(!c)return null;if(o.wrap(l,c),r.keepMarks&&r.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:f}=r.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>f.includes(g.type.name));o.ensureMarks(m)}}if(r.keepAttributes){const d=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&gD(o.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(n,u))&&o.join(t.from-1)},undoable:r.undoable})}var FQe={};yD(FQe,{createAtomBlockMarkdownSpec:()=>zQe,createBlockMarkdownSpec:()=>BQe,createInlineMarkdownSpec:()=>UQe,parseAttributes:()=>SD,parseIndentedBlocks:()=>WQe,renderNestedMarkdownContent:()=>HQe,serializeAttributes:()=>wD});function SD(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function wD(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function zQe(r){const{nodeName:e,name:t,parseAttributes:n=SD,serializeAttributes:i=wD,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function BQe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=SD,serializeAttributes:s=wD,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function jQe(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function LQe(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function UQe(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=jQe,serializeAttributes:s=LQe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function WQe(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function HQe(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}var ES=class yle extends ple{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new yle(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},qQe=Object.defineProperty,KQe=(r,e)=>{for(var t in e)qQe(r,t,{get:e[t],enumerable:!0})},JQe="listItem",S8="textStyle",w8=/^\s*([-+*])\s$/,xle=ES.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",Xf(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(JQe,this.editor.getAttributes(S8)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=Rx({find:w8,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Rx({find:w8,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(S8),editor:this.editor})),[r]}}),Sle=ES.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",Xf(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),VQe={};KQe(VQe,{findListItemPos:()=>MS,getNextListDepth:()=>bD,handleBackspace:()=>_R,handleDelete:()=>DR,hasListBefore:()=>wle,hasListItemAfter:()=>GQe,hasListItemBefore:()=>ble,listItemHasSubList:()=>vle,nextListIsDeeper:()=>kle,nextListIsHigher:()=>Cle});var MS=(r,e)=>{const{$from:t}=e.selection,n=Wn(r,e.schema);let i=null,s=t.depth,o=t.pos,a=null;for(;s>0&&a===null;)i=t.node(s),i.type===n?a=s:(s-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},bD=(r,e)=>{const t=MS(r,e);if(!t)return!1;const[,n]=QZe(e,r,t.$pos.pos+4);return n},wle=(r,e,t)=>{const{$anchor:n}=r.selection,i=Math.max(0,n.pos-2),s=r.doc.resolve(i).node();return!(!s||!t.includes(s.type.name))},ble=(r,e)=>{var t;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((t=i.nodeBefore)==null?void 0:t.type.name)!==r)},vle=(r,e,t)=>{if(!t)return!1;const n=Wn(r,e.schema);let i=!1;return t.descendants(s=>{s.type===n&&(i=!0)}),i},_R=(r,e,t)=>{if(r.commands.undoInputRule())return!0;if(r.state.selection.from!==r.state.selection.to)return!1;if(!Yf(r.state,e)&&wle(r.state,e,t)){const{$anchor:a}=r.state.selection,l=r.state.doc.resolve(a.before()-1),c=[];l.node().descendants((h,f)=>{h.type.name===e&&c.push({node:h,pos:f})});const u=c.at(-1);if(!u)return!1;const d=r.state.doc.resolve(l.start()+u.pos+1);return r.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!Yf(r.state,e)||!nQe(r.state))return!1;const n=MS(e,r.state);if(!n)return!1;const s=r.state.doc.resolve(n.$pos.pos-2).node(n.depth),o=vle(e,r.state,s);return ble(e,r.state)&&!o?r.commands.joinItemBackward():r.chain().liftListItem(e).run()},kle=(r,e)=>{const t=bD(r,e),n=MS(r,e);return!n||!t?!1:t>n.depth},Cle=(r,e)=>{const t=bD(r,e),n=MS(r,e);return!n||!t?!1:t<n.depth},DR=(r,e)=>{if(!Yf(r.state,e)||!tQe(r.state,e))return!1;const{selection:t}=r.state,{$from:n,$to:i}=t;return!t.empty&&n.sameParent(i)?!1:kle(e,r.state)?r.chain().focus(r.state.selection.from+4).lift(e).joinBackward().run():Cle(e,r.state)?r.chain().joinForward().joinBackward().run():r.commands.joinItemForward()},GQe=(r,e)=>{var t;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((t=i.nodeAfter)==null?void 0:t.type.name)!==r)},Tle=Ks.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{r.state.schema.nodes[t]!==void 0&&DR(r,t)&&(e=!0)}),e},"Mod-Delete":({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{r.state.schema.nodes[t]!==void 0&&DR(r,t)&&(e=!0)}),e},Backspace:({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:n})=>{r.state.schema.nodes[t]!==void 0&&_R(r,t,n)&&(e=!0)}),e},"Mod-Backspace":({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:n})=>{r.state.schema.nodes[t]!==void 0&&_R(r,t,n)&&(e=!0)}),e}}}}),YQe="listItem",b8="textStyle",v8=/^(\d+)\.\s$/,Ele=ES.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:e,...t}=r;return e===1?["ol",Xf(this.options.HTMLAttributes,t),0]:["ol",Xf(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(YQe,this.editor.getAttributes(b8)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=Rx({find:v8,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Rx({find:v8,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(b8)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[r]}}),XQe=/^\s*(\[([( |x])?\])\s$/,ZQe=ES.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:r=>{const e=r.getAttribute("data-checked");return e===""||e==="true"},renderHTML:r=>({"data-checked":r.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:r,HTMLAttributes:e}){return["li",Xf(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:r.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const r={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...r,Tab:()=>this.editor.commands.sinkListItem(this.name)}:r},addNodeView(){return({node:r,HTMLAttributes:e,getPos:t,editor:n})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,h;a.ariaLabel=((h=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:h.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(r),s.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;n.isEditable&&typeof t=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const f=t();if(typeof f!="number")return!1;const p=h.doc.nodeAt(f);return h.setNodeMarkup(f,void 0,{...p?.attrs,checked:d}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(r,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{i.setAttribute(u,d)}),i.dataset.checked=r.attrs.checked,a.checked=r.attrs.checked,s.append(a,o),i.append(s,l),Object.entries(e).forEach(([u,d])=>{i.setAttribute(u,d)}),{dom:i,contentDOM:l,update:u=>u.type!==this.type?!1:(i.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[Rx({find:XQe,type:this.type,getAttributes:r=>({checked:r[r.length-1]==="x"})})]}}),QQe=ES.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:r}){return["ul",Xf(this.options.HTMLAttributes,r,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:r})=>r.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Ks.create({name:"listKit",addExtensions(){const r=[];return this.options.bulletList!==!1&&r.push(xle.configure(this.options.bulletList)),this.options.listItem!==!1&&r.push(Sle.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(Tle.configure(this.options.listKeymap)),this.options.orderedList!==!1&&r.push(Ele.configure(this.options.orderedList)),this.options.taskItem!==!1&&r.push(ZQe.configure(this.options.taskItem)),this.options.taskList!==!1&&r.push(QQe.configure(this.options.taskList)),r}});var eet=f2.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",Ha(this.options.HTMLAttributes,r),0]},parseMarkdown:(r,e)=>{const t=r.tokens||[];return t.length===1&&t[0].type==="image"?e.parseChildren([t[0]]):e.createNode("paragraph",void 0,e.parseInline(t))},renderMarkdown:(r,e)=>!r||!Array.isArray(r.content)?"":e.renderChildren(r.content),addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),tet=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,net=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,ret=kp.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",Ha(this.options.HTMLAttributes,r),0]},markdownTokenName:"del",parseMarkdown:(r,e)=>e.applyMark("strike",e.parseInline(r.tokens||[])),renderMarkdown:(r,e)=>`~~${e.renderChildren(r)}~~`,addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Wf({find:tet,type:this.type})]},addPasteRules(){return[Td({find:net,type:this.type})]}}),iet=f2.create({name:"text",group:"inline",parseMarkdown:r=>({type:"text",text:r.text||""}),renderMarkdown:r=>r.text||""}),set=kp.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["u",Ha(this.options.HTMLAttributes,r),0]},parseMarkdown(r,e){return e.applyMark(this.name||"underline",e.parseInline(r.tokens||[]))},renderMarkdown(r,e){return`++${e.renderChildren(r)}++`},markdownTokenizer:{name:"underline",level:"inline",start(r){return r.indexOf("++")},tokenize(r,e,t){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(r);if(!i)return;const s=i[2].trim();return{type:"underline",raw:i[0],text:s,tokens:t.inlineTokens(s)}}},addCommands(){return{setUnderline:()=>({commands:r})=>r.setMark(this.name),toggleUnderline:()=>({commands:r})=>r.toggleMark(this.name),unsetUnderline:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function Mle(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=Mle(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function Ile(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=Ile(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}class Q{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Q(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),i+=a.nodeSize),o=l}return new Q(n,i)}cutByIndex(e,t){return e==t?Q.empty:e==0&&t==this.content.length?this:new Q(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new Q(i,s)}addToStart(e){return new Q([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Q(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return Mle(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Ile(this,e,t,n)}findIndex(e){if(e==0)return mb(0,e);if(e==this.size)return mb(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let i=this.child(t),s=n+i.nodeSize;if(s>=e)return s==e?mb(t+1,s):mb(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Q.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Q(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Q.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new Q(t||e,n)}static from(e){if(!e)return Q.empty;if(e instanceof Q)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Q([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Q.empty=new Q([],0);const QI={index:0,offset:0};function mb(r,e){return QI.index=r,QI.offset=e,QI}function Pk(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Pk(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Pk(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}class Pt{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Pk(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=n.create(t.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Pt.none;if(e instanceof Pt)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}}Pt.none=[];class Ak extends Error{}class fe{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=Ale(this.content,e+this.openStart,t);return n&&new fe(n,this.openStart,this.openEnd)}removeBetween(e,t){return new fe(Ple(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return fe.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new fe(Q.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new fe(e,n,i)}}fe.empty=new fe(Q.empty,0,0);function Ple(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(i==e||s.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(Ple(s.content,e-i-1,t-i-1)))}function Ale(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=Ale(o.content,e-s-1,t,o);return a&&r.replaceChild(i,o.copy(a))}function oet(r,e,t){if(t.openStart>r.depth)throw new Ak("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Ak("Inconsistent open depths");return $le(r,e,t,0)}function $le(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=$le(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return id(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=aet(t,r);return id(s,Ole(r,o,a,e,n))}else return id(s,$k(r,e,n))}function Rle(r,e){if(!e.type.compatibleContent(r.type))throw new Ak("Cannot join "+e.type.name+" onto "+r.type.name)}function FR(r,e,t){let n=r.node(t);return Rle(n,e.node(t)),n}function rd(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function wy(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(rd(r.nodeAfter,n),s++));for(let a=s;a<o;a++)rd(i.child(a),n);e&&e.depth==t&&e.textOffset&&rd(e.nodeBefore,n)}function id(r,e){return r.type.checkContent(e),r.copy(e)}function Ole(r,e,t,n,i){let s=r.depth>i&&FR(r,e,i+1),o=n.depth>i&&FR(t,n,i+1),a=[];return wy(null,r,i,a),s&&o&&e.index(i)==t.index(i)?(Rle(s,o),rd(id(s,Ole(r,e,t,n,i+1)),a)):(s&&rd(id(s,$k(r,e,i+1)),a),wy(e,t,i,a),o&&rd(id(o,$k(t,n,i+1)),a)),wy(n,null,i,a),new Q(a)}function $k(r,e,t){let n=[];if(wy(null,r,t,n),r.depth>t){let i=FR(r,e,t+1);rd(id(i,$k(r,e,t+1)),n)}return wy(e,null,t,n),new Q(n)}function aet(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(Q.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}class Ox{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Pt.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let a=n;n=i,i=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new det(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(n.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new Ox(t,n,s)}static resolveCached(e,t){let n=k8.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else k8.set(e,n=new cet);let i=n.elts[n.i]=Ox.resolve(e,t);return n.i=(n.i+1)%uet,i}}class cet{constructor(){this.elts=[],this.i=0}}const uet=12,k8=new WeakMap;class det{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const het=Object.create(null);let sd=class zR{constructor(e,t,n,i=Pt.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Q.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Pk(this.attrs,t||e.defaultAttrs||het)&&Pt.sameSet(this.marks,n||Pt.none)}copy(e=null){return e==this.content?this:new zR(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new zR(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return fe.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new fe(c,i.depth-o,s.depth-o)}replace(e,t,n){return oet(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return Ox.resolveCached(this,e)}resolveNoCache(e){return Ox.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Nle(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Q.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Pt.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Pt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Q.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};sd.prototype.text=void 0;class Rk extends sd{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Nle(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Rk(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Rk(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Nle(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}class Rd{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new fet(e,t);if(n.next==null)return Rd.empty;let i=_le(n);n.next&&n.err("Unexpected trailing text");let s=bet(wet(i));return vet(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return Q.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let h=s(d,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}}Rd.empty=new Rd(!0);class fet{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function _le(r){let e=[];do e.push(pet(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function pet(r){let e=[];do e.push(met(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function met(r){let e=xet(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=get(r,e);else break;return e}function C8(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function get(r,e){let t=C8(r),n=t;return r.eat(",")&&(r.next!="}"?n=C8(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function yet(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function xet(r){if(r.eat("(")){let e=_le(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=yet(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function wet(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),i(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return i(s(o.expr,a),l),i(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),i(s(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Dle(r,e){return e-r}function T8(r,e){let t=[];return n(e),t.sort(Dle);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&t.indexOf(l)==-1&&n(l)}}}function bet(r){let e=Object.create(null);return t(T8(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);T8(r,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[n.join(",")]=new Rd(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Dle);s.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return s}}function vet(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(c)==-1&&n.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Fle(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function zle(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Ble(r,e,t,n){for(let i in e)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(e[i])}}function jle(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Cet(r,n,e[n]);return t}let E8=class Lle{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=jle(e,n.attrs),this.defaultAttrs=Fle(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Rd.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:zle(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new sd(this,this.computeAttrs(e),Q.from(t),Pt.setFrom(n))}createChecked(e=null,t,n){return t=Q.from(t),this.checkContent(t),new sd(this,this.computeAttrs(e),t,Pt.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=Q.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(Q.empty,!0);return s?new sd(this,e,t.append(s),Pt.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Ble(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Pt.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new Lle(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function ket(r,e,t){let n=t.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${s}`)}}class Cet{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?ket(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class oC{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=jle(e,i.attrs),this.excluded=null;let s=Fle(this.attrs);this.instance=s?new Pt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Pt(this,zle(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new oC(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Ble(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Tet{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=yn.from(e.nodes),t.marks=yn.from(e.marks||{}),this.nodes=E8.compile(this.spec.nodes,this),this.marks=oC.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Rd.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?M8(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:M8(this,o.split(" "))}this.nodeFromJSON=i=>sd.fromJSON(this,i),this.markFromJSON=i=>Pt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof E8){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new Rk(n,n.defaultAttrs,e,Pt.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function M8(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let a in r.marks){let l=r.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function Eet(r){return r.tag!=null}function Met(r){return r.style!=null}let B0=class BR{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(i=>{if(Eet(i))this.tags.push(i);else if(Met(i)){let s=/[^=]*/.exec(i.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new P8(this,t,!1);return n.addAll(e,Pt.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new P8(this,t,!0);return n.addAll(e,Pt.none,t.from,t.to),fe.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Aet(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=A8(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=A8(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new BR(e,BR.schemaRules(e)))}};const Ule={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Iet={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Wle={ol:!0,ul:!0},Nx=1,jR=2,by=4;function I8(r,e,t){return e!=null?(e?Nx:0)|(e==="full"?jR:0):r&&r.whitespace=="pre"?Nx|jR:t&~by}class gb{constructor(e,t,n,i,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=Pt.none,this.match=s||(o&by?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Q.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Nx)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=Q.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Q.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ule.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class P8{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=t.topNode,s,o=I8(null,t.preserveWhitespace,0)|(n?by:0);i?s=new gb(i.type,i.attrs,Pt.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new gb(null,null,Pt.none,!0,null,o):s=new gb(e.schema.topNodeType,null,Pt.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,i=this.top,s=i.options&jR?"full":this.localPreserveWS||(i.options&Nx)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)if(s==="full")n=n.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=n.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(o.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Wle.hasOwnProperty(o)&&this.parser.normalizeLists&&Pet(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:Iet.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Ule.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,i){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,t,n,i){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t,n){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let i=this.findPlace(e,t,n);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Pt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):$8(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,t,n,i){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,i)),s}enterInner(e,t,n,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=I8(e,s,o.options);o.options&by&&o.content.length==0&&(a|=by);let l=Pt.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):$8(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new gb(e,t,l,i,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Nx)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}}function Pet(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Wle.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function Aet(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function A8(r){let e={};for(let t in r)e[t]=r[t];return e}function $8(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class aC{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=eP(t).createDocumentFragment());let i=n,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=j0(eP(t),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&j0(eP(n),i(e,t),null,e.attrs)}static renderSpec(e,t,n=null,i){return j0(e,t,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new aC(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=R8(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return R8(e.marks)}}function R8(r){let e={};for(let t in r){let n=r[t].spec.toDOM;n&&(e[t]=n)}return e}function eP(r){return r.document||window.document}const O8=new WeakMap;function $et(r){let e=O8.get(r);return e===void 0&&O8.set(r,e=Ret(r)),e}function Ret(r){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)t(n[i]);else for(let i in n)t(n[i])}return t(r),e}function j0(r,e,t,n){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(s=$et(n))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(t=i.slice(0,o),i=i.slice(o+1));let a,l=t?r.createElementNS(t,i):r.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=j0(r,h,t,n);if(l.appendChild(f),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const Hle=65535,qle=Math.pow(2,16);function Oet(r,e){return r+e*qle}function N8(r){return r&Hle}function Net(r){return(r-(r&Hle))/qle}const Kle=1,Jle=2,L0=4,Vle=8;class LR{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Vle)>0}get deletedBefore(){return(this.delInfo&(Kle|L0))>0}get deletedAfter(){return(this.delInfo&(Jle|L0))>0}get deletedAcross(){return(this.delInfo&L0)>0}}class ls{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&ls.empty)return ls.empty}recover(e){let t=0,n=N8(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+Net(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+i+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:Oet(a/3,e-l),m=e==l?Jle:e==d?Kle:L0;return(t<0?e!=l:e!=d)&&(m|=Vle),new LR(f,m,p)}i+=u-c}return n?e+i:new LR(e+i,0,null)}touches(e,t){let n=0,i=N8(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+t],u=this.ranges[i+n];e(a,a+c,l,l+u),s+=u-c}}invert(){return new ls(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ls.empty:new ls(e<0?[0,-e,0]:[0,0,e])}}ls.empty=new ls([]);class Ok{constructor(e,t,n=0,i=e?e.length:0){this.mirror=t,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Ok(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new Ok;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return n?e:new LR(e,i,null)}}const tP=Object.create(null);class Kr{getMap(){return ls.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=tP[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in tP)throw new RangeError("Duplicate use of step JSON ID "+e);return tP[e]=t,t.prototype.jsonID=e,t}}class Nn{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Nn(e,null)}static fail(e){return new Nn(null,e)}static fromReplace(e,t,n,i){try{return Nn.ok(e.replace(t,n,i))}catch(s){if(s instanceof Ak)return Nn.fail(s.message);throw s}}}function vD(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(vD(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return Q.fromArray(n)}class El extends Kr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new fe(vD(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return Nn.fromReplace(e,this.from,this.to,s)}invert(){return new no(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new El(t.pos,n.pos,this.mark)}merge(e){return e instanceof El&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new El(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new El(t.from,t.to,e.markFromJSON(t.mark))}}Kr.jsonID("addMark",El);class no extends Kr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new fe(vD(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return Nn.fromReplace(e,this.from,this.to,n)}invert(){return new El(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new no(t.pos,n.pos,this.mark)}merge(e){return e instanceof no&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new no(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new no(t.from,t.to,e.markFromJSON(t.mark))}}Kr.jsonID("removeMark",no);class Ml extends Kr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Nn.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Nn.fromReplace(e,this.pos,this.pos+1,new fe(Q.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new Ml(this.pos,t.marks[i]);return new Ml(this.pos,this.mark)}}return new Od(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ml(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ml(t.pos,e.markFromJSON(t.mark))}}Kr.jsonID("addNodeMark",Ml);class Od extends Kr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Nn.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Nn.fromReplace(e,this.pos,this.pos+1,new fe(Q.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ml(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Od(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Od(t.pos,e.markFromJSON(t.mark))}}Kr.jsonID("removeNodeMark",Od);class er extends Kr{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&UR(e,this.from,this.to)?Nn.fail("Structure replace would overwrite content"):Nn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ls([this.from,this.to-this.from,this.slice.size])}invert(e){return new er(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new er(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof er)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?fe.empty:new fe(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new er(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?fe.empty:new fe(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new er(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new er(t.from,t.to,fe.fromJSON(e,t.slice),!!t.structure)}}Kr.jsonID("replace",er);class Us extends Kr{constructor(e,t,n,i,s,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(UR(e,this.from,this.gapFrom)||UR(e,this.gapTo,this.to)))return Nn.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Nn.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Nn.fromReplace(e,this.from,this.to,n):Nn.fail("Content does not fit in gap")}getMap(){return new ls([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Us(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new Us(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Us(t.from,t.to,t.gapFrom,t.gapTo,fe.fromJSON(e,t.slice),t.insert,!!t.structure)}}Kr.jsonID("replaceAround",Us);function UR(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function _et(r,e,t,n){let i=[],s=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:i.push(o=new no(h,f,d[m])));a&&a.to==h?a.to=f:s.push(a=new El(h,f,n))}}),i.forEach(l=>r.step(l)),s.forEach(l=>r.step(l))}function Det(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof oC){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&d.eq(i[f].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>r.step(new no(o.from,o.to,o.style)))}function kD(r,e,t,n=t.contentMatch,i=!0){let s=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new er(a,u,fe.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new no(a,u,c.marks[h]));if(i&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new fe(Q.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new er(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(Q.empty,!0);r.replace(a,a,new fe(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function Fet(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function zet(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth,i=0,s=0;;--n){let o=r.$from.node(n),a=r.$from.index(n)+i,l=r.$to.indexAfter(n)-s;if(n<r.depth&&o.canReplace(a,l,t))return n;if(n==0||o.type.spec.isolating||!Fet(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function Bet(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),a=i.after(s+1),l=o,c=a,u=Q.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=Q.from(n.node(p).copy(u)),d++):l--;let h=Q.empty,f=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,h=Q.from(i.node(p).copy(h)),f++):c++;r.step(new Us(l,c,o,a,new fe(u.append(h),d,f),u.size-d,!0))}function jet(r,e,t){let n=Q.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Q.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Us(i,s,i,s,new fe(n,0,0),t.length,!0))}function Let(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,l)&&Uet(r.doc,r.mapping.slice(s).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&Yle(r,o,a,s),kD(r,r.mapping.slice(s).map(a,1),n,void 0,c===null);let u=r.mapping.slice(s),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new Us(d,h,d+1,h-1,new fe(Q.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Gle(r,o,a,s),!1}})}function Gle(r,e,t,n){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=r.mapping.slice(n).map(t+1+s+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Yle(r,e,t,n){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+s);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Uet(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function Wet(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Us(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new fe(Q.from(o),0,0),1,!0))}function U0(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=t-2;c>s;c--,u--){let d=i.node(c),h=i.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Het(r,e,t=1,n){let i=r.doc.resolve(e),s=Q.empty,o=Q.empty;for(let a=i.depth,l=i.depth-t,c=t-1;a>l;a--,c--){s=Q.from(i.node(a).copy(s));let u=n&&n[c];o=Q.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}r.step(new er(e,e,new fe(s.append(o),t,t),!0))}function Xle(r,e){let t=r.resolve(e),n=t.index();return Zle(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function qet(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==n?r.type.schema.nodes.text:s.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(s.marks))return!1}return t.validEnd}function Zle(r,e){return!!(r&&e&&!r.isLeaf&&qet(r,e))}function Qle(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,a=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),a++,o=n.node(i).maybeChild(a)):(s=n.node(i).maybeChild(a-1),o=n.node(i+1)),s&&!s.isTextblock&&Zle(s,o)&&n.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function Ket(r,e,t){let n=null,{linebreakReplacement:i}=r.doc.type.schema,s=r.doc.resolve(e-t),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);Yle(r,u.node(),u.before(),a)}o.inlineContent&&kD(r,e+t-1,o,s.node().contentMatchAt(s.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new er(c,l.map(e+t,-1),fe.empty,!0)),n===!0){let u=r.doc.resolve(c);Gle(r,u.node(),u.before(),r.steps.length)}return r}function Jet(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function Vet(r,e,t){let n=r.resolve(e);if(!t.content.size)return e;let i=t.content;for(let s=0;s<t.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=n.depth;o>=0;o--){let a=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,l=n.index(o)+(a>0?1:0),c=n.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?n.pos:a<0?n.before(o+1):n.after(o+1)}return null}function Get(r,e,t=e,n=fe.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return ece(i,s,n)?new er(e,t,n):new Yet(i,s,n).fit()}function ece(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}class Yet{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Q.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Q.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new fe(s,o,a);return e>-1?new Us(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new er(n.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=nP(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Q.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=nP(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new fe(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=nP(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new fe(Fg(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new fe(Fg(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(tce(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=zg(this.placed,t,Q.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?fe.empty:new fe(Fg(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new fe(Fg(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!rP(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=rP(e,t,i,n,s);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=rP(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=zg(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=zg(this.placed,this.depth,Q.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Q.empty,!0);t.childCount&&(this.placed=zg(this.placed,this.frontier.length,t))}}function Fg(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Fg(r.firstChild.content,e-1,t)))}function zg(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(zg(r.lastChild.content,e-1,t)))}function nP(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function tce(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,tce(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(Q.empty,!0)))),r.copy(n)}function rP(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!Xet(t,s.content,o)?a:null}function Xet(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function Zet(r){return r.spec.defining||r.spec.definingForContent}function Qet(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(ece(i,s,n))return r.step(new er(e,t,n));let o=rce(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,f=i.pos-1;h>0;h--,f--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=Zet(f.type);if(p&&!f.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let S=i.node(g-1),w=i.index(g-1);if(S.canReplaceWith(w,w,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new fe(nce(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=i.before(f),t=s.after(f))}}function nce(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(nce(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(Q.empty,!0))}return r}function ett(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=Jet(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new fe(Q.from(n),0,0))}function ttt(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=rce(n,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return r.delete(n.before(a),i.after(a))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function rce(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}class Cf extends Kr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Nn.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return Nn.fromReplace(e,this.pos,this.pos+1,new fe(Q.from(i),0,t.isLeaf?0:1))}getMap(){return ls.empty}invert(e){return new Cf(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Cf(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Cf(t.pos,t.attr,t.value)}}Kr.jsonID("attr",Cf);class _x extends Kr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return Nn.ok(n)}getMap(){return ls.empty}invert(e){return new _x(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new _x(t.attr,t.value)}}Kr.jsonID("docAttr",_x);let Zf=class extends Error{};Zf=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Zf.prototype=Object.create(Error.prototype);Zf.prototype.constructor=Zf;Zf.prototype.name="TransformError";class ntt{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ok}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Zf(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=fe.empty){let i=Get(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new fe(Q.from(n),0,0))}delete(e,t){return this.replace(e,t,fe.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Qet(this,e,t,n),this}replaceRangeWith(e,t,n){return ett(this,e,t,n),this}deleteRange(e,t){return ttt(this,e,t),this}lift(e,t){return Bet(this,e,t),this}join(e,t=1){return Ket(this,e,t),this}wrap(e,t){return jet(this,e,t),this}setBlockType(e,t=e,n,i=null){return Let(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return Wet(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Cf(e,t,n)),this}setDocAttribute(e,t){return this.step(new _x(e,t)),this}addNodeMark(e,t){return this.step(new Ml(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof Pt)t.isInSet(n.marks)&&this.step(new Od(e,t));else{let i=n.marks,s,o=[];for(;s=t.isInSet(i);)o.push(new Od(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return Het(this,e,t,n),this}addMark(e,t,n){return _et(this,e,t,n),this}removeMark(e,t,n){return Det(this,e,t,n),this}clearIncompatible(e,t,n){return kD(this,e,t,n),this}}const iP=Object.create(null);class kt{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new rtt(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=fe.empty){let n=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?fe.empty:t),a==0&&F8(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),F8(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new mt(e):Yh(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?Yh(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Yh(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new so(e.node(0))}static atStart(e){return Yh(e,e,0,0,1)||new so(e)}static atEnd(e){return Yh(e,e,e.content.size,e.childCount,-1)||new so(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=iP[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in iP)throw new RangeError("Duplicate use of selection JSON ID "+e);return iP[e]=t,t.prototype.jsonID=e,t}getBookmark(){return mt.between(this.$anchor,this.$head).getBookmark()}}kt.prototype.visible=!0;class rtt{constructor(e,t){this.$from=e,this.$to=t}}let _8=!1;function D8(r){!_8&&!r.parent.inlineContent&&(_8=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class mt extends kt{constructor(e,t=e){D8(e),D8(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return kt.near(n);let i=e.resolve(t.map(this.anchor));return new mt(i.parent.inlineContent?i:n,n)}replace(e,t=fe.empty){if(super.replace(e,t),t==fe.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof mt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new lC(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new mt(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=kt.findFrom(t,n,!0)||kt.findFrom(t,-n,!0);if(s)t=s.$head;else return kt.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(kt.findFrom(e,-n,!0)||kt.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new mt(e,t)}}kt.jsonID("text",mt);class lC{constructor(e,t){this.anchor=e,this.head=t}map(e){return new lC(e.map(this.anchor),e.map(this.head))}resolve(e){return mt.between(e.resolve(this.anchor),e.resolve(this.head))}}class ut extends kt{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?kt.near(s):new ut(s)}content(){return new fe(Q.from(this.node),0,0)}eq(e){return e instanceof ut&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new CD(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ut(e.resolve(t.anchor))}static create(e,t){return new ut(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ut.prototype.visible=!1;kt.jsonID("node",ut);class CD{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new lC(n,n):new CD(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&ut.isSelectable(n)?new ut(t):kt.near(t)}}class so extends kt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=fe.empty){if(t==fe.empty){e.delete(0,e.doc.content.size);let n=kt.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new so(e)}map(e){return new so(e)}eq(e){return e instanceof so}getBookmark(){return itt}}kt.jsonID("all",so);const itt={map(){return this},resolve(r){return new so(r)}};function Yh(r,e,t,n,i,s=!1){if(e.inlineContent)return mt.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&ut.isSelectable(a))return ut.create(r,t-(i<0?a.nodeSize:0))}else{let l=Yh(r,a,t+i,i<0?a.childCount:0,i,s);if(l)return l}t+=a.nodeSize*i}return null}function F8(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof er||i instanceof Us))return;let s=r.mapping.maps[n],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(kt.near(r.doc.resolve(o),t))}function z8(r,e){return!e||!r?r:r.bind(e)}class yb{constructor(e,t,n){this.name=e,this.init=z8(t.init,n),this.apply=z8(t.apply,n)}}new yb("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new yb("selection",{init(r,e){return r.selection||kt.atStart(e.doc)},apply(r){return r.selection}}),new yb("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new yb("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function ice(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=ice(i,e,{})),t[n]=i}return t}class vs{constructor(e){this.spec=e,this.props={},e.props&&ice(e.props,this,this.props),this.key=e.key?e.key.key:sce("plugin")}getState(e){return e[this.key]}}const sP=Object.create(null);function sce(r){return r in sP?r+"$"+ ++sP[r]:(sP[r]=0,r+"$")}class ks{constructor(e="key"){this.key=sce(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Vd=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},oce=function(r,e,t,n){return t&&(B8(r,e,t,n,-1)||B8(r,e,t,n,1))},stt=/^(img|br|input|textarea|hr)$/i;function B8(r,e,t,n,i){for(var s;;){if(r==t&&e==n)return!0;if(e==(i<0?0:Nk(r))){let o=r.parentNode;if(!o||o.nodeType!=1||TD(r)||stt.test(r.nodeName)||r.contentEditable=="false")return!1;e=Vd(r)+(i<0?0:1),r=o}else if(r.nodeType==1){let o=r.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else r=o,e=i<0?Nk(r):0}else return!1}}function Nk(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function ott(r,e,t){for(let n=e==0,i=e==Nk(r);n||i;){if(r==t)return!0;let s=Vd(r);if(r=r.parentNode,!r)return!1;n=n&&s==0,i=i&&s==Nk(r)}}function TD(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const ace=function(r){return r.focusNode&&oce(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function lce(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}const fa=typeof navigator<"u"?navigator:null,j8=typeof document<"u"?document:null,jc=fa&&fa.userAgent||"",WR=/Edge\/(\d+)/.exec(jc),cce=/MSIE \d/.exec(jc),HR=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(jc),IS=!!(cce||HR||WR),uce=cce?document.documentMode:HR?+HR[1]:WR?+WR[1]:0,cC=!IS&&/gecko\/(\d+)/i.test(jc);cC&&+(/Firefox\/(\d+)/.exec(jc)||[0,0])[1];const qR=!IS&&/Chrome\/(\d+)/.exec(jc),rl=!!qR,dce=qR?+qR[1]:0,Gd=!IS&&!!fa&&/Apple Computer/.test(fa.vendor),ED=Gd&&(/Mobile\/\w+/.test(jc)||!!fa&&fa.maxTouchPoints>2),Rs=ED||(fa?/Mac/.test(fa.platform):!1),hce=fa?/Win/.test(fa.platform):!1,PS=/Android \d/.test(jc),MD=!!j8&&"webkitFontSmoothing"in j8.documentElement.style,att=MD?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ltt(r,e=null){let t=r.domSelectionRange(),n=r.state.doc;if(!t.focusNode)return null;let i=r.docView.nearestDesc(t.focusNode),s=i&&i.size==0,o=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=n.resolve(o),l,c;if(ace(t)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&ut.isSelectable(d)&&i.parent&&!(d.isInline&&ott(t.focusNode,t.focusOffset,i.dom))){let h=i.posBefore;c=new ut(o==h?a:n.resolve(h))}}else{if(t instanceof r.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let d=o,h=o;for(let f=0;f<t.rangeCount;f++){let p=t.getRangeAt(f);d=Math.min(d,r.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,r.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=h==r.state.selection.anchor?[h,d]:[d,h],a=n.resolve(o)}else l=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=n.resolve(l);if(!c){let d=e=="pointer"||r.state.selection.head<a.pos&&!s?1:-1;c=pce(r,u,a,d)}return c}function fce(r){return r.editable?r.hasFocus():htt(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function ID(r,e=!1){let t=r.state.selection;if(dtt(r,t),!!fce(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&rl){let n=r.domSelectionRange(),i=r.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&oce(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)utt(r);else{let{anchor:n,head:i}=t,s,o;L8&&!(t instanceof mt)&&(t.$from.parent.inlineContent||(s=U8(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=U8(r,t.to))),r.docView.setSelection(n,i,r,e),L8&&(s&&W8(s),o&&W8(o)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ctt(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const L8=Gd||rl&&dce<63;function U8(r,e){let{node:t,offset:n}=r.docView.domFromPos(e,0),i=n<t.childNodes.length?t.childNodes[n]:null,s=n?t.childNodes[n-1]:null;if(Gd&&i&&i.contentEditable=="false")return oP(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return oP(i);if(s)return oP(s)}}function oP(r){return r.contentEditable="true",Gd&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function W8(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function ctt(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),n=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=n||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!fce(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function utt(r){let e=r.domSelection();if(!e)return;let t=r.cursorWrapper.dom,n=t.nodeName=="IMG";n?e.collapse(t.parentNode,Vd(t)+1):e.collapse(t,0),!n&&!r.state.selection.visible&&IS&&uce<=11&&(t.disabled=!0,t.disabled=!1)}function dtt(r,e){if(e instanceof ut){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(H8(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else H8(r)}function H8(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function pce(r,e,t,n){return r.someProp("createSelectionBetween",i=>i(r,e,t))||mt.between(e,t,n)}function htt(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function KR(r,e){let{$anchor:t,$head:n}=r.selection,i=e>0?t.max(n):t.min(n),s=i.parent.inlineContent?i.depth?r.doc.resolve(e>0?i.after():i.before()):null:i;return s&&kt.findFrom(s,e)}function wl(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function q8(r,e,t){let n=r.state.selection;if(n instanceof mt)if(t.indexOf("s")>-1){let{$head:i}=n,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=r.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return wl(r,new mt(n.$anchor,o))}else if(n.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let i=KR(r.state,e);return i&&i instanceof ut?wl(r,i):!1}else if(!(Rs&&t.indexOf("m")>-1)){let i=n.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=r.docView.descAt(a))&&!o.contentDOM?ut.isSelectable(s)?wl(r,new ut(e<0?r.state.doc.resolve(i.pos-s.nodeSize):i)):MD?wl(r,new mt(r.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(n instanceof ut&&n.node.isInline)return wl(r,new mt(e>0?n.$to:n.$from));{let i=KR(r.state,e);return i?wl(r,i):!1}}}function _k(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function vy(r,e){let t=r.pmViewDesc;return t&&t.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function fh(r,e){return e<0?ftt(r):ptt(r)}function ftt(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i,s,o=!1;for(cC&&t.nodeType==1&&n<_k(t)&&vy(t.childNodes[n],-1)&&(o=!0);;)if(n>0){if(t.nodeType!=1)break;{let a=t.childNodes[n-1];if(vy(a,-1))i=t,s=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}}else{if(mce(t))break;{let a=t.previousSibling;for(;a&&vy(a,-1);)i=t.parentNode,s=Vd(a),a=a.previousSibling;if(a)t=a,n=_k(t);else{if(t=t.parentNode,t==r.dom)break;n=0}}}o?JR(r,t,n):i&&JR(r,i,s)}function ptt(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i=_k(t),s,o;for(;;)if(n<i){if(t.nodeType!=1)break;let a=t.childNodes[n];if(vy(a,1))s=t,o=++n;else break}else{if(mce(t))break;{let a=t.nextSibling;for(;a&&vy(a,1);)s=a.parentNode,o=Vd(a)+1,a=a.nextSibling;if(a)t=a,n=0,i=_k(t);else{if(t=t.parentNode,t==r.dom)break;n=i=0}}}s&&JR(r,s,o)}function mce(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function mtt(r,e){for(;r&&e==r.childNodes.length&&!TD(r);)e=Vd(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let t=r.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=0}}function gtt(r,e){for(;r&&!e&&!TD(r);)e=Vd(r),r=r.parentNode;for(;r&&e;){let t=r.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=r.childNodes.length}}function JR(r,e,t){if(e.nodeType!=3){let s,o;(o=mtt(e,t))?(e=o,t=0):(s=gtt(e,t))&&(e=s,t=s.nodeValue.length)}let n=r.domSelection();if(!n)return;if(ace(n)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),n.removeAllRanges(),n.addRange(s)}else n.extend&&n.extend(e,t);r.domObserver.setCurSelection();let{state:i}=r;setTimeout(()=>{r.state==i&&ID(r)},50)}function K8(r,e){let t=r.state.doc.resolve(e);if(!(rl||hce)&&t.parent.inlineContent){let i=r.coordsAtPos(e);if(e>t.start()){let s=r.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<t.end()){let s=r.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function J8(r,e,t){let n=r.state.selection;if(n instanceof mt&&!n.empty||t.indexOf("s")>-1||Rs&&t.indexOf("m")>-1)return!1;let{$from:i,$to:s}=n;if(!i.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let o=KR(r.state,e);if(o&&o instanceof ut)return wl(r,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=n instanceof so?kt.near(o,e):kt.findFrom(o,e);return a?wl(r,a):!1}return!1}function V8(r,e){if(!(r.state.selection instanceof mt))return!0;let{$head:t,$anchor:n,empty:i}=r.state.selection;if(!t.sameParent(n))return!0;if(!i)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=r.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),r.dispatch(o),!0}return!1}function G8(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function ytt(r){if(!Gd||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;G8(r,n,"true"),setTimeout(()=>G8(r,n,"false"),20)}return!1}function xtt(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function Stt(r,e){let t=e.keyCode,n=xtt(e);if(t==8||Rs&&t==72&&n=="c")return V8(r,-1)||fh(r,-1);if(t==46&&!e.shiftKey||Rs&&t==68&&n=="c")return V8(r,1)||fh(r,1);if(t==13||t==27)return!0;if(t==37||Rs&&t==66&&n=="c"){let i=t==37?K8(r,r.state.selection.from)=="ltr"?-1:1:-1;return q8(r,i,n)||fh(r,i)}else if(t==39||Rs&&t==70&&n=="c"){let i=t==39?K8(r,r.state.selection.from)=="ltr"?1:-1:1;return q8(r,i,n)||fh(r,i)}else{if(t==38||Rs&&t==80&&n=="c")return J8(r,-1,n)||fh(r,-1);if(t==40||Rs&&t==78&&n=="c")return ytt(r)||J8(r,1,n)||fh(r,1);if(n==(Rs?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function gce(r,e){r.someProp("transformCopied",f=>{e=f(e,r)});let t=[],{content:n,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,s--;let f=n.firstChild;t.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),n=f.content}let o=r.someProp("clipboardSerializer")||aC.fromSchema(r.state.schema),a=vce(),l=a.createElement("div");l.appendChild(o.serializeFragment(n,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=bce[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let h=r.someProp("clipboardTextSerializer",f=>f(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function yce(r,e,t,n,i){let s=i.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=!!e&&(n||s||!t);if(l){if(r.someProp("transformPastedText",h=>{e=h(e,s||n,r)}),s)return a=new fe(Q.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),r.someProp("transformPasted",h=>{a=h(a,r,!0)}),a;let d=r.someProp("clipboardTextParser",h=>h(e,i,n,r));if(d)a=d;else{let h=i.marks(),{schema:f}=r.state,p=aC.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(f.text(m,h)))})}}else r.someProp("transformPastedHTML",d=>{t=d(t,r)}),o=ktt(t),MD&&Ctt(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(r.someProp("clipboardParser")||r.someProp("domParser")||B0.fromSchema(r.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!wtt.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Ttt(Y8(a,+u[1],+u[2]),u[4]);else if(a=fe.maxOpen(btt(a.content,i),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=Y8(a,d,h)}return r.someProp("transformPasted",d=>{a=d(a,r,l)}),a}const wtt=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function btt(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(r.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&Sce(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=wce(o[o.length-1],s.length));let u=xce(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return Q.from(o)}return r}function xce(r,e,t=0){for(let n=e.length-1;n>=t;n--)r=e[n].create(null,Q.from(r));return r}function Sce(r,e,t,n,i){if(i<r.length&&i<e.length&&r[i]==e[i]){let s=Sce(r,e,t,n.lastChild,i+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(i==r.length-1?t.type:r[i+1]))return n.copy(n.content.append(Q.from(xce(t,r,i+1))))}}function wce(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,wce(r.lastChild,e-1)),n=r.contentMatchAt(r.childCount).fillBefore(Q.empty,!0);return r.copy(t.append(n))}function VR(r,e,t,n,i,s){let o=e<0?r.firstChild:r.lastChild,a=o.content;return r.childCount>1&&(s=0),i<n-1&&(a=VR(a,e,t,n,i+1,s)),i>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Q.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,o.copy(a))}function Y8(r,e,t){return e<r.openStart&&(r=new fe(VR(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new fe(VR(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const bce={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let X8=null;function vce(){return X8||(X8=document.implementation.createHTMLDocument("title"))}let aP=null;function vtt(r){let e=window.trustedTypes;return e?(aP||(aP=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),aP.createHTML(r)):r}function ktt(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=vce().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(r),i;if((i=n&&bce[n[1].toLowerCase()])&&(r=i.map(s=>"<"+s+">").join("")+r+i.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=vtt(r),i)for(let s=0;s<i.length;s++)t=t.querySelector(i[s])||t;return t}function Ctt(r){let e=r.querySelectorAll(rl?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let n=e[t];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),n)}}function Ttt(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return r}let{content:i,openStart:s,openEnd:o}=r;for(let a=n.length-2;a>=0;a-=2){let l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;i=Q.from(l.create(n[a+1],i)),s++,o++}return new fe(i,s,o)}const Do={},ys={};function Il(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}ys.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!Cce(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(PS&&rl&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),ED&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let n=Date.now();r.input.lastIOSEnter=n,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==n&&(r.someProp("handleKeyDown",i=>i(r,lce(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",n=>n(r,t))||Stt(r,t)?t.preventDefault():Il(r,"key")};ys.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};ys.keypress=(r,e)=>{let t=e;if(Cce(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||Rs&&t.metaKey)return;if(r.someProp("handleKeyPress",i=>i(r,t))){t.preventDefault();return}let n=r.state.selection;if(!(n instanceof mt)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(t.charCode),s=()=>r.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!r.someProp("handleTextInput",o=>o(r,n.$from.pos,n.$to.pos,i,s))&&r.dispatch(s()),t.preventDefault()}};function uC(r){return{left:r.clientX,top:r.clientY}}function Ett(r,e){let t=e.x-r.clientX,n=e.y-r.clientY;return t*t+n*n<100}function PD(r,e,t,n,i){if(n==-1)return!1;let s=r.state.doc.resolve(n);for(let o=s.depth+1;o>0;o--)if(r.someProp(e,a=>o>s.depth?a(r,t,s.nodeAfter,s.before(o),i,!0):a(r,t,s.node(o),s.before(o),i,!1)))return!0;return!1}function Tf(r,e,t){if(r.focused||r.focus(),r.state.selection.eq(e))return;let n=r.state.tr.setSelection(e);n.setMeta("pointer",!0),r.dispatch(n)}function Mtt(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&ut.isSelectable(n)?(Tf(r,new ut(t)),!0):!1}function Itt(r,e){if(e==-1)return!1;let t=r.state.selection,n,i;t instanceof ut&&(n=t.node);let s=r.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(ut.isSelectable(a)){n&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?i=s.before(t.$from.depth):i=s.before(o);break}}return i!=null?(Tf(r,ut.create(r.state.doc,i)),!0):!1}function Ptt(r,e,t,n,i){return PD(r,"handleClickOn",e,t,n)||r.someProp("handleClick",s=>s(r,e,n))||(i?Itt(r,t):Mtt(r,t))}function Att(r,e,t,n){return PD(r,"handleDoubleClickOn",e,t,n)||r.someProp("handleDoubleClick",i=>i(r,e,n))}function $tt(r,e,t,n){return PD(r,"handleTripleClickOn",e,t,n)||r.someProp("handleTripleClick",i=>i(r,e,n))||Rtt(r,t,n)}function Rtt(r,e,t){if(t.button!=0)return!1;let n=r.state.doc;if(e==-1)return n.inlineContent?(Tf(r,mt.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)Tf(r,mt.create(n,a+1,a+1+o.content.size));else if(ut.isSelectable(o))Tf(r,ut.create(n,a));else continue;return!0}}function AD(r){return Dk(r)}const kce=Rs?"metaKey":"ctrlKey";Do.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let n=AD(r),i=Date.now(),s="singleClick";i-r.input.lastClick.time<500&&Ett(t,r.input.lastClick)&&!t[kce]&&r.input.lastClick.button==t.button&&(r.input.lastClick.type=="singleClick"?s="doubleClick":r.input.lastClick.type=="doubleClick"&&(s="tripleClick")),r.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:s,button:t.button};let o=r.posAtCoords(uC(t));o&&(s=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new Ott(r,o,t,!!n)):(s=="doubleClick"?Att:$tt)(r,o.pos,o.inside,t)?t.preventDefault():Il(r,"pointer"))};class Ott{constructor(e,t,n,i){this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[kce],this.allowDefault=n.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:n.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof ut&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&cC&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Il(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ID(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(uC(e))),this.updateAllowDefault(e),this.allowDefault||!t?Il(this.view,"pointer"):Ptt(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Gd&&this.mightDrag&&!this.mightDrag.node.isAtom||rl&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Tf(this.view,kt.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Il(this.view,"pointer")}move(e){this.updateAllowDefault(e),Il(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Do.touchstart=r=>{r.input.lastTouch=Date.now(),AD(r),Il(r,"pointer")};Do.touchmove=r=>{r.input.lastTouch=Date.now(),Il(r,"pointer")};Do.contextmenu=r=>AD(r);function Cce(r,e){return r.composing?!0:Gd&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const Ntt=PS?5e3:-1;ys.compositionstart=ys.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$to;if(e.selection instanceof mt&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)||rl&&hce&&_tt(r)))r.markCursor=r.state.storedMarks||t.marks(),Dk(r,!0),r.markCursor=null;else if(Dk(r,!e.selection.empty),cC&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let n=r.domSelectionRange();for(let i=n.focusNode,s=n.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=r.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}r.input.composing=!0}Tce(r,Ntt)};function _tt(r){let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(!e||e.nodeType!=1||t>=e.childNodes.length)return!1;let n=e.childNodes[t];return n.nodeType==1&&n.contentEditable=="false"}ys.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,Tce(r,20))};function Tce(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>Dk(r),e))}function Dtt(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=Ftt());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function Ftt(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function Dk(r,e=!1){if(!(PS&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),Dtt(r),e||r.docView&&r.docView.dirty){let t=ltt(r),n=r.state.selection;return t&&!t.eq(n)?r.dispatch(r.state.tr.setSelection(t)):(r.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function ztt(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),r.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const Dx=IS&&uce<15||ED&&att<604;Do.copy=ys.cut=(r,e)=>{let t=e,n=r.state.selection,i=t.type=="cut";if(n.empty)return;let s=Dx?null:t.clipboardData,o=n.content(),{dom:a,text:l}=gce(r,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):ztt(r,a),i&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Btt(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function jtt(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,n=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),n.parentNode&&n.parentNode.removeChild(n),t?GR(r,n.value,null,i,e):GR(r,n.textContent,n.innerHTML,i,e)},50)}function GR(r,e,t,n,i){let s=yce(r,e,t,n,r.state.selection.$from);if(r.someProp("handlePaste",l=>l(r,i,s||fe.empty)))return!0;if(!s)return!1;let o=Btt(s),a=o?r.state.tr.replaceSelectionWith(o,n):r.state.tr.replaceSelection(s);return r.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Ece(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let t=r.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}ys.paste=(r,e)=>{let t=e;if(r.composing&&!PS)return;let n=Dx?null:t.clipboardData,i=r.input.shiftKey&&r.input.lastKeyCode!=45;n&&GR(r,Ece(n),n.getData("text/html"),i,t)?t.preventDefault():jtt(r,t)};let Ltt=class{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}};const Utt=Rs?"altKey":"ctrlKey";function Mce(r,e){let t=r.someProp("dragCopies",n=>!n(e));return t??!e[Utt]}Do.dragstart=(r,e)=>{let t=e,n=r.input.mouseDown;if(n&&n.done(),!t.dataTransfer)return;let i=r.state.selection,s=i.empty?null:r.posAtCoords(uC(t)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof ut?i.to-1:i.to))){if(n&&n.mightDrag)o=ut.create(r.state.doc,n.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=r.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=r.docView&&(o=ut.create(r.state.doc,d.posBefore))}}let a=(o||r.state.selection).content(),{dom:l,text:c,slice:u}=gce(r,a);(!t.dataTransfer.files.length||!rl||dce>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Dx?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Dx||t.dataTransfer.setData("text/plain",c),r.dragging=new Ltt(u,Mce(r,t),o)};Do.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};ys.dragover=ys.dragenter=(r,e)=>e.preventDefault();ys.drop=(r,e)=>{try{Wtt(r,e,r.dragging)}finally{r.dragging=null}};function Wtt(r,e,t){if(!e.dataTransfer)return;let n=r.posAtCoords(uC(e));if(!n)return;let i=r.state.doc.resolve(n.pos),s=t&&t.slice;s?r.someProp("transformPasted",f=>{s=f(s,r,!1)}):s=yce(r,Ece(e.dataTransfer),Dx?null:e.dataTransfer.getData("text/html"),!1,i);let o=!!(t&&Mce(r,e));if(r.someProp("handleDrop",f=>f(r,e,s||fe.empty,o))){e.preventDefault();return}if(!s)return;e.preventDefault();let a=s?Vet(r.state.doc,i.pos,s):i.pos;a==null&&(a=i.pos);let l=r.state.tr;if(o){let{node:f}=t;f?f.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=l.doc;if(u?l.replaceRangeWith(c,c,s.content.firstChild):l.replaceRange(c,c,s),l.doc.eq(d))return;let h=l.doc.resolve(c);if(u&&ut.isSelectable(s.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(s.content.firstChild))l.setSelection(new ut(h));else{let f=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((p,m,g,y)=>f=y),l.setSelection(pce(r,h,l.doc.resolve(f)))}r.focus(),r.dispatch(l.setMeta("uiEvent","drop"))}Do.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&ID(r)},20))};Do.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};Do.beforeinput=(r,e)=>{if(rl&&PS&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:n}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=n||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",s=>s(r,lce(8,"Backspace")))))return;let{$cursor:i}=r.state.selection;i&&i.pos>0&&r.dispatch(r.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let r in ys)Do[r]=ys[r];function Fx(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}class Fk{constructor(e,t){this.toDOM=e,this.spec=t||od,this.side=this.spec.side||0}map(e,t,n,i){let{pos:s,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new zs(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Fk&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Fx(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Nl{constructor(e,t){this.attrs=e,this.spec=t||od}map(e,t,n,i){let s=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return s>=o?null:new zs(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Nl&&Fx(this.attrs,e.attrs)&&Fx(this.spec,e.spec)}static is(e){return e.type instanceof Nl}destroy(){}}class $D{constructor(e,t){this.attrs=e,this.spec=t||od}map(e,t,n,i){let s=e.mapResult(t.from+i,1);if(s.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=s.pos?null:new zs(s.pos-n,o.pos-n,this)}valid(e,t){let{index:n,offset:i}=e.content.findIndex(t.from),s;return i==t.from&&!(s=e.child(n)).isText&&i+s.nodeSize==t.to}eq(e){return this==e||e instanceof $D&&Fx(this.attrs,e.attrs)&&Fx(this.spec,e.spec)}destroy(){}}class zs{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new zs(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new zs(e,e,new Fk(t,n))}static inline(e,t,n,i){return new zs(e,t,new Nl(n,i))}static node(e,t,n,i){return new zs(e,t,new $D(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Nl}get widget(){return this.type instanceof Fk}}const Xh=[],od={};class bn{constructor(e,t){this.local=e.length?e:Xh,this.children=t.length?t:Xh}static create(e,t){return t.length?zk(t,e,0,od):ai}find(e,t,n){let i=[];return this.findInner(e??0,t??1e9,i,0,n),i}findInner(e,t,n,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!s||s(a.spec))&&n.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,n,i+a,s)}}map(e,t,n){return this==ai||e.maps.length==0?this:this.mapInner(e,t,0,0,n||od)}mapInner(e,t,n,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,n,i);l&&l.type.valid(t,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?Htt(this.children,o||[],e,t,n,i,s):o?new bn(o.sort(ad),Xh):ai}add(e,t){return t.length?this==ai?bn.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,s=0;e.forEach((a,l)=>{let c=l+n,u;if(u=Pce(t,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,zk(u,a,c+1,od)),s+=3}});let o=Ice(s?Ace(t):t,-n);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new bn(o.length?this.local.concat(o).sort(ad):this.local,i||this.children)}remove(e){return e.length==0||this==ai?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let s=0;s<n.length;s+=3){let o,a=n[s]+t,l=n[s+1]+t;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;n==this.children&&(n=this.children.slice());let c=n[s+2].removeInner(o,a+1);c!=ai?n[s+2]=c:(n.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new bn(i,n):ai}forChild(e,t){if(this==ai)return this;if(t.isLeaf)return bn.empty;let n,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(n=this.children[a+2]);break}let s=e+1,o=s+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof Nl){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new bn(i.sort(ad),Xh);return n?new cu([a,n]):a}return n||ai}eq(e){if(this==e)return!0;if(!(e instanceof bn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return RD(this.localsInner(e))}localsInner(e){if(this==ai)return Xh;if(e.inlineContent||!this.local.some(Nl.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Nl||t.push(this.local[n]);return t}forEachSet(e){e(this)}}bn.empty=new bn([],[]);bn.removeOverlap=RD;const ai=bn.empty;class cu{constructor(e){this.members=e}map(e,t){const n=this.members.map(i=>i.map(e,t,od));return cu.from(n)}forChild(e,t){if(t.isLeaf)return bn.empty;let n=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,t);s!=ai&&(s instanceof cu?n=n.concat(s.members):n.push(s))}return cu.from(n)}eq(e){if(!(e instanceof cu)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!t)t=s;else{n&&(t=t.slice(),n=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?RD(n?t:t.sort(ad)):Xh}static from(e){switch(e.length){case 0:return ai;case 1:return e[0];default:return new cu(e.every(t=>t instanceof bn)?e:e.reduce((t,n)=>t.concat(n instanceof bn?n:n.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Htt(r,e,t,n,i,s,o){let a=r.slice();for(let c=0,u=s;c<t.maps.length;c++){let d=0;t.maps[c].forEach((h,f,p,m)=>{let g=m-p-(f-h);for(let y=0;y<a.length;y+=3){let S=a[y+1];if(S<0||h>S+u-d)continue;let w=a[y]+u-d;f>=w?a[y+1]=h<=w?-2:-1:h>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(r[c]+s),d=u-i;if(d<0||d>=n.content.size){l=!0;continue}let h=t.map(r[c+1]+s,-1),f=h-i,{index:p,offset:m}=n.content.findIndex(d),g=n.maybeChild(p);if(g&&m==d&&m+g.nodeSize==f){let y=a[c+2].mapInner(t,g,u+1,r[c]+s+1,o);y!=ai?(a[c]=d,a[c+1]=f,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=qtt(a,r,e,t,i,s,o),u=zk(c,n,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new bn(e.sort(ad),a)}function Ice(r,e){if(!e||!r.length)return r;let t=[];for(let n=0;n<r.length;n++){let i=r[n];t.push(new zs(i.from+e,i.to+e,i.type))}return t}function qtt(r,e,t,n,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(n,i,c);d?t.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<r.length;l+=3)r[l+1]==-1&&a(r[l+2],e[l]+s+1);return t}function Pce(r,e,t){if(e.isLeaf)return null;let n=t+e.nodeSize,i=null;for(let s=0,o;s<r.length;s++)(o=r[s])&&o.from>t&&o.to<n&&((i||(i=[])).push(o),r[s]=null);return i}function Ace(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function zk(r,e,t,n){let i=[],s=!1;e.forEach((a,l)=>{let c=Pce(r,a,l+t);if(c){s=!0;let u=zk(c,a,t+l+1,n);u!=ai&&i.push(l,l+a.nodeSize,u)}});let o=Ice(s?Ace(r):r,-t).sort(ad);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(n.onRemove&&n.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new bn(o,i):ai}function ad(r,e){return r.from-e.from||r.to-e.to}function RD(r){let e=r;for(let t=0;t<e.length-1;t++){let n=e[t];if(n.from!=n.to)for(let i=t+1;i<e.length;i++){let s=e[i];if(s.from==n.from){s.to!=n.to&&(e==r&&(e=r.slice()),e[i]=s.copy(s.from,n.to),Z8(e,i+1,s.copy(n.to,s.to)));continue}else{s.from<n.to&&(e==r&&(e=r.slice()),e[t]=n.copy(n.from,s.from),Z8(e,i,n.copy(s.from,n.to)));break}}}return e}function Z8(r,e,t){for(;e<r.length&&ad(t,r[e])>0;)e++;r.splice(e,0,t)}var Ktt=Object.defineProperty,OD=(r,e)=>{for(var t in e)Ktt(r,t,{get:e[t],enumerable:!0})};function $ce(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}var Jtt=class{constructor(r){this.editor=r.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=r.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:r,editor:e,state:t}=this,{view:n}=e,{tr:i}=t,s=this.buildProps(i);return Object.fromEntries(Object.entries(r).map(([o,a])=>[o,(...c)=>{const u=a(...c)(s);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(r,e=!0){const{rawCommands:t,editor:n,state:i}=this,{view:s}=n,o=[],a=!!r,l=r||i.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(t).map(([d,h])=>[d,(...p)=>{const m=this.buildProps(l,e),g=h(...p)(m);return o.push(g),u}])),run:c};return u}createCan(r){const{rawCommands:e,state:t}=this,n=!1,i=r||t.tr,s=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...s,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(r,e=!0){const{rawCommands:t,editor:n,state:i}=this,{view:s}=n,o={tr:r,editor:n,view:s,state:$ce({state:i,transaction:r}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(r,e),can:()=>this.createCan(r),get commands(){return Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},Rce={};OD(Rce,{blur:()=>Vtt,clearContent:()=>Gtt,clearNodes:()=>Ytt,command:()=>Xtt,createParagraphNear:()=>Ztt,cut:()=>Qtt,deleteCurrentNode:()=>ent,deleteNode:()=>tnt,deleteRange:()=>nnt,deleteSelection:()=>rnt,enter:()=>int,exitCode:()=>snt,extendMarkRange:()=>ant,first:()=>lnt,focus:()=>dnt,forEach:()=>hnt,insertContent:()=>fnt,insertContentAt:()=>gnt,joinBackward:()=>Snt,joinDown:()=>xnt,joinForward:()=>wnt,joinItemBackward:()=>bnt,joinItemForward:()=>vnt,joinTextblockBackward:()=>knt,joinTextblockForward:()=>Cnt,joinUp:()=>ynt,keyboardShortcut:()=>Ent,lift:()=>Mnt,liftEmptyBlock:()=>Int,liftListItem:()=>Pnt,newlineInCode:()=>Ant,resetAttributes:()=>$nt,scrollIntoView:()=>Rnt,selectAll:()=>Ont,selectNodeBackward:()=>Nnt,selectNodeForward:()=>_nt,selectParentNode:()=>Dnt,selectTextblockEnd:()=>Fnt,selectTextblockStart:()=>znt,setContent:()=>jnt,setMark:()=>ert,setMeta:()=>trt,setNode:()=>nrt,setNodeSelection:()=>rrt,setTextDirection:()=>irt,setTextSelection:()=>srt,sinkListItem:()=>ort,splitBlock:()=>art,splitListItem:()=>lrt,toggleList:()=>crt,toggleMark:()=>urt,toggleNode:()=>drt,toggleWrap:()=>hrt,undoInputRule:()=>frt,unsetAllMarks:()=>prt,unsetMark:()=>mrt,unsetTextDirection:()=>grt,updateAttributes:()=>yrt,wrapIn:()=>xrt,wrapInList:()=>Srt});var Vtt=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),Gtt=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),Ytt=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=zet(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},Xtt=r=>e=>r(e),Ztt=()=>({state:r,dispatch:e})=>uo(r,e),Qtt=(r,e)=>({editor:t,tr:n})=>{const{state:i}=t,s=i.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new mt(n.doc.resolve(Math.max(o-1,0)))),!0},ent=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const a=i.before(s),l=i.after(s);r.delete(a,l).scrollIntoView()}return!0}return!1};function Er(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}var tnt=r=>({tr:e,state:t,dispatch:n})=>{const i=Er(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},nnt=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},rnt=()=>({state:r,dispatch:e})=>ho(r,e),int=()=>({commands:r})=>r.keyboardShortcut("Enter"),snt=()=>({state:r,dispatch:e})=>fo(r,e);function ont(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function Bk(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:ont(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function Oce(r,e,t={}){return r.find(n=>n.type===e&&Bk(Object.fromEntries(Object.keys(t).map(i=>[i,n.attrs[i]])),t))}function Q8(r,e,t={}){return!!Oce(r,e,t)}function Nce(r,e,t){var n;if(!r||!e)return;let i=r.parent.childAfter(r.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=r.parent.childBefore(r.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(t=t||((n=i.node.marks[0])==null?void 0:n.attrs),!Oce([...i.node.marks],e,t)))return;let o=i.index,a=r.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&Q8([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&Q8([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Lc(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}var ant=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=Lc(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(i){const d=Nce(l,s,e);if(d&&d.from<=c&&d.to>=u){const h=mt.create(o,d.from,d.to);t.setSelection(h)}}return!0},lnt=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function _ce(r){return r instanceof mt}function vu(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function cnt(r,e=null){if(!e)return null;const t=kt.atStart(r),n=kt.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?mt.create(r,vu(0,i,s),vu(r.content.size,i,s)):mt.create(r,vu(e,i,s),vu(e,i,s))}function unt(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function ND(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var dnt=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(ND()||unt())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!_ce(t.state.selection))return o(),!0;const a=cnt(i.doc,r)||t.state.selection,l=t.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},hnt=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),fnt=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Dce=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&Dce(n)}return r};function xb(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Dce(t)}function zx(r,e,t){if(r instanceof sd||r instanceof Q)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,i=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return Q.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(s){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",s),zx("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new Tet({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?B0.fromSchema(l).parseSlice(xb(r),t.parseOptions):B0.fromSchema(l).parse(xb(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=B0.fromSchema(e);return t.slice?s.parseSlice(xb(r),t.parseOptions).content:s.parse(xb(r),t.parseOptions)}return zx("",e,t)}function pnt(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof er||i instanceof Us))return;const s=r.mapping.maps[n];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(kt.near(r.doc.resolve(o),t))}var mnt=r=>!("type"in r),gnt=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{var o;if(i){t={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{zx(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=zx(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},h=!0,f=!0;if((mnt(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=n.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Q){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;n.insertText(m,u,d)}else{m=a;const g=n.doc.resolve(u),y=g.node(),S=g.parentOffset===0,w=y.isText||y.isTextblock,b=y.content.size>0;S&&w&&b&&(u=Math.max(0,u-1)),n.replaceWith(u,d,m)}t.updateSelection&&pnt(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:u,text:m}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:u,text:m})}return!0},ynt=()=>({state:r,dispatch:e})=>po(r,e),xnt=()=>({state:r,dispatch:e})=>mo(r,e),Snt=()=>({state:r,dispatch:e})=>go(r,e),wnt=()=>({state:r,dispatch:e})=>yo(r,e),bnt=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Qle(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},vnt=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Qle(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},knt=()=>({state:r,dispatch:e})=>xo(r,e),Cnt=()=>({state:r,dispatch:e})=>So(r,e);function Fce(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Tnt(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))ND()||Fce()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}var Ent=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=Tnt(r).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&i&&n.maybeStep(u)}),!0};function _D(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?Er(e,r.schema):null,a=[];r.doc.nodesBetween(n,i,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(i,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=i-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Bk(d.node.attrs,t,{strict:!1}));return s?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var Mnt=(r,e={})=>({state:t,dispatch:n})=>{const i=Er(r,t.schema);return _D(t,i,e)?wo(t,n):!1},Int=()=>({state:r,dispatch:e})=>bo(r,e),Pnt=r=>({state:e,dispatch:t})=>{const n=Er(r,e.schema);return vo(n)(e,t)},Ant=()=>({state:r,dispatch:e})=>ko(r,e);function zce(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function eU(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}var $nt=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=zce(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Er(r,n.schema)),a==="mark"&&(o=Lc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&t.setNodeMarkup(d,void 0,eU(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,i&&t.addMark(d,d+u.nodeSize,o.create(eU(h.attrs,e))))})})}),l},Rnt=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),Ont=()=>({tr:r,dispatch:e})=>{if(e){const t=new so(r.doc);r.setSelection(t)}return!0},Nnt=()=>({state:r,dispatch:e})=>Co(r,e),_nt=()=>({state:r,dispatch:e})=>To(r,e),Dnt=()=>({state:r,dispatch:e})=>Eo(r,e),Fnt=()=>({state:r,dispatch:e})=>Mo(r,e),znt=()=>({state:r,dispatch:e})=>Io(r,e);function Bnt(r,e,t={},n={}){return zx(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}var jnt=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(n.preserveWhitespace!=="full"){const c=Bnt(r,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&s.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function Lnt(r,e){const t=Lc(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Unt(r,e){const t=new ntt(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function Wnt(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function Hnt(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function DD(r){return e=>Hnt(e.$from,r)}function Qf(r,e,t){return r.config[e]===void 0&&r.parent?Qf(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?Qf(r.parent,e,t):null}):r.config[e]}function qnt(r){return typeof r=="function"}function jk(r,e=void 0,...t){return qnt(r)?e?r.bind(e)(...t):r(...t):r}function Bce(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function Knt(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,i,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=s);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,i-c))}),a}function Jnt(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function Vnt(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function Gnt(r){const e=Vnt(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function Ynt(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),Gnt(n)}function W0(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function Xnt(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?Lc(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Bk(d.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),S=Math.min(p,g+m.nodeSize),w=S-y;o+=w,a.push(...m.marks.map(b=>({mark:b,from:y,to:S})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Bk(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function tU(r,e){const{nodeExtensions:t}=Bce(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=jk(Qf(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function FD(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let i=!0;return r.content.forEach(s=>{i!==!1&&(FD(s,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function Znt(r){return r instanceof ut}function Qnt(r,e,t){var n;const{selection:i}=e;let s=null;if(_ce(i)&&(s=i.$cursor),s){const a=(n=r.storedMarks)!=null?n:s.marks();return s.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var ert=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:a}=s,l=Lc(r,n.schema);if(i)if(o){const c=Lnt(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return Qnt(n,t,l)},trt=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),nrt=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=Er(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>xn(s,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>xn(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},rrt=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=vu(r,0,n.content.size),s=ut.create(n,i);e.setSelection(s)}return!0},irt=(r,e)=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=n;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:r})}),!0},srt=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=mt.atStart(n).from,a=mt.atEnd(n).to,l=vu(i,o,a),c=vu(s,o,a),u=mt.create(n,l,c);e.setSelection(u)}return!0},ort=r=>({state:e,dispatch:t})=>{const n=Er(r,e.schema);return Po(n)(e,t)};function nU(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e?.includes(i.type.name));r.tr.ensureMarks(n)}}var art=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=W0(c,a.node().type.name,a.node().attrs);if(s instanceof ut&&s.node.isBlock)return!a.parentOffset||!U0(o,a.pos)?!1:(n&&(r&&nU(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Wnt(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=U0(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&U0(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(s instanceof mt&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&nU(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},lrt=(r,e={})=>({tr:t,state:n,dispatch:i,editor:s})=>{var o;const a=Er(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Q.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-S;M>=l.depth-3;M-=1)y=Q.from(l.node(M).copy(y));const w=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,b={...W0(h,l.node().type.name,l.node().attrs),...e},v=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(b))||void 0;y=y.append(Q.from(a.createAndFill(null,v)||void 0));const C=l.before(l.depth-(S-1));t.replace(C,l.after(-w),new fe(y,4-S,0));let E=-1;t.doc.nodesBetween(C,t.doc.content.size,(M,P)=>{if(E>-1)return!1;M.isTextblock&&M.content.size===0&&(E=P+1)}),E>-1&&t.setSelection(mt.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...W0(h,d.type.name,d.attrs),...e},m={...W0(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!U0(t.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:S}=n,{splittableMarks:w}=s.extensionManager,b=S||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!b||!i)return!0;const v=b.filter(C=>w.includes(C.type.name));t.ensureMarks(v)}return!0},lP=(r,e)=>{const t=DD(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Xle(r.doc,t.pos)&&r.join(t.pos),!0},cP=(r,e)=>{const t=DD(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===i?.type&&Xle(r.doc,n)&&r.join(n),!0},crt=(r,e,t,n={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=i.extensionManager,f=Er(r,o.schema),p=Er(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:S}=m,w=y.blockRange(S),b=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const v=DD(C=>tU(C.type.name,d))(m);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===f)return c.liftListItem(p);if(tU(v.node.type.name,d)&&f.validContent(v.node.content)&&a)return l().command(()=>(s.setNodeMarkup(v.pos,f),!0)).command(()=>lP(s,f)).command(()=>cP(s,f)).run()}return!t||!b||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>lP(s,f)).command(()=>cP(s,f)).run():l().command(()=>{const C=u().wrapInList(f,n),E=b.filter(M=>h.includes(M.type.name));return s.ensureMarks(E),C?!0:c.clearNodes()}).wrapInList(f,n).command(()=>lP(s,f)).command(()=>cP(s,f)).run()},urt=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=Lc(r,n.schema);return Xnt(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},drt=(r,e,t={})=>({state:n,commands:i})=>{const s=Er(r,n.schema),o=Er(e,n.schema),a=_D(n,s,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...t})},hrt=(r,e={})=>({state:t,commands:n})=>{const i=Er(r,t.schema);return _D(t,i,e)?n.lift(i):n.wrapIn(i,e)},frt=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},prt=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},mrt=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=Lc(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:h,to:f}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=Nce(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},grt=r=>({tr:e,state:t,dispatch:n})=>{const{selection:i}=t;let s,o;return typeof r=="number"?(s=r,o=r):r&&"from"in r&&"to"in r?(s=r.from,o=r.to):(s=i.from,o=i.to),n&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},yrt=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const a=zce(typeof r=="string"?r:r.name,n.schema);if(!a)return!1;a==="node"&&(s=Er(r,n.schema)),a==="mark"&&(o=Lc(r,n.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;t.selection.empty?n.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):n.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&t.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(S=>{if(o===S.type&&(l=!0,i)){const w=Math.max(y,u),b=Math.min(y+g.nodeSize,d);t.addMark(w,b,o.create({...S.attrs,...e}))}}))}),f&&(h!==void 0&&i&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&i&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},xrt=(r,e={})=>({state:t,dispatch:n})=>{const i=Er(r,t.schema);return Ao(i,e)(t,n)},Srt=(r,e={})=>({state:t,dispatch:n})=>{const i=Er(r,t.schema);return $o(i,e)(t,n)};function wrt(r){return Object.prototype.toString.call(r).slice(8,-1)}function Sb(r){return wrt(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function jce(r,e){const t={...r};return Sb(r)&&Sb(e)&&Object.keys(e).forEach(n=>{Sb(e[n])&&Sb(r[n])?t[n]=jce(r[n],e[n]):t[n]=e[n]}),t}var brt=class{constructor(r={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...r},this.name=this.config.name}get options(){return{...jk(Qf(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...jk(Qf(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(r={}){const e=this.extend({...this.config,addOptions:()=>jce(this.options,r)});return e.name=this.name,e.parent=this.parent,e}extend(r={}){const e=new this.constructor({...this.config,...r});return e.parent=this,this.child=e,e.name="name"in r?r.name:e.parent.name,e}},vrt={};OD(vrt,{ClipboardTextSerializer:()=>krt,Commands:()=>Crt,Delete:()=>Trt,Drop:()=>Ert,Editable:()=>Mrt,FocusEvents:()=>Irt,Keymap:()=>Prt,Paste:()=>Art,Tabindex:()=>$rt,TextDirection:()=>Rrt,focusEventsPluginKey:()=>Uce});var Vn=class Lce extends brt{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new Lce(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},krt=Vn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new vs({key:new ks("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=Jnt(t);return Knt(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Crt=Vn.create({name:"commands",addCommands(){return{...Rce}}}),Trt=Vn.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=Unt(r.before,[r,...e]);Ynt(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof no){const y=h.slice(p).map(f.from,-1),S=h.slice(p).map(f.to),w=h.invert().map(y,-1),b=h.invert().map(S),v=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(E=>E.eq(f.mark)),C=(g=u.doc.nodeAt(S))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:w,to:b},newRange:{from:y,to:S},partial:!!(C||v),editor:this.editor,transaction:r,combinedTransform:u})}})};(i=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||i?setTimeout(s,0):s()}}),Ert=Vn.create({name:"drop",addProseMirrorPlugins(){return[new vs({key:new ks("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),Mrt=Vn.create({name:"editable",addProseMirrorPlugins(){return[new vs({key:new ks("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Uce=new ks("focusEvents"),Irt=Vn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new vs({key:Uce,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),Prt=Vn.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:kt.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ND()||Fce()?s:i},addProseMirrorPlugins(){return[new vs({key:new ks("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),i=r.some(m=>m.getMeta("preventClearDocument"));if(!n||i)return;const{empty:s,from:o,to:a}=e.selection,l=kt.atStart(e.doc).from,c=kt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!FD(t.doc))return;const h=t.tr,f=$ce({state:t,transaction:h}),{commands:p}=new Jtt({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),Art=Vn.create({name:"paste",addProseMirrorPlugins(){return[new vs({key:new ks("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),$rt=Vn.create({name:"tabindex",addProseMirrorPlugins(){return[new vs({key:new ks("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Rrt=Vn.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:r}=Bce(this.extensions);return[{types:r.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new vs({key:new ks("textDirection"),props:{attributes:()=>{const r=this.options.direction;return r?{dir:r}:{}}}})]}}),Ort={};OD(Ort,{createAtomBlockMarkdownSpec:()=>Nrt,createBlockMarkdownSpec:()=>_rt,createInlineMarkdownSpec:()=>zrt,parseAttributes:()=>zD,parseIndentedBlocks:()=>Brt,renderNestedMarkdownContent:()=>jrt,serializeAttributes:()=>BD});function zD(r){if(!r?.trim())return{};const e={},t=[],n=r.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),i=n.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=n.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(n.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=t[h];f&&(e[c]=f.slice(1,-1))});const l=n.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function BD(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.class&&String(r.class).split(/\s+/).filter(Boolean).forEach(n=>e.push(`.${n}`)),r.id&&e.push(`#${r.id}`),Object.entries(r).forEach(([t,n])=>{t==="class"||t==="id"||(n===!0?e.push(t):n!==!1&&n!=null&&e.push(`${t}="${String(n)}"`))}),e.join(" ")}function Nrt(r){const{nodeName:e,name:t,parseAttributes:n=zD,serializeAttributes:i=BD,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=r,l=t||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...s,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=n(m);if(!o.find(S=>!(S in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=i(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function _rt(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=zD,serializeAttributes:s=BD,defaultAttributes:o={},content:a="block",allowedAttributes:l}=r,c=t||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(n){const m=n(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,S=""]=g,w=i(S);let b=1;const v=y.length;let C="";const E=/^:::([\w-]*)(\s.*)?/gm,M=d.slice(v);for(E.lastIndex=0;;){const P=E.exec(M);if(P===null)break;const $=P.index,A=P[1];if(!((p=P[2])!=null&&p.endsWith(":::"))){if(A)b+=1;else if(b-=1,b===0){const O=M.slice(0,$);C=O.trim();const _=d.slice(0,v+$+P[0].length);let I=[];if(C)if(a==="block")for(I=f.blockTokens(O),I.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=f.inlineTokens(R.text))});I.length>0;){const R=I[I.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))I.pop();else break}else I=f.inlineTokens(C);return{type:e,raw:_,attributes:w,content:C,tokens:I}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=s(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function Drt(r){if(!r.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let n=t.exec(r);for(;n!==null;){const[,i,s,o]=n;e[i]=s||o,n=t.exec(r)}return e}function Frt(r){return Object.entries(r).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function zrt(r){const{nodeName:e,name:t,getContent:n,parseAttributes:i=Drt,serializeAttributes:s=Frt,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=r,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in h){const y=h[m];if(g!==void 0&&y===g)return;f[m]=y}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=n?n(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p?.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",S="";if(a){const[,b]=g;S=b}else{const[,b,v]=g;S=b,y=v||""}const w=i(S.trim());return{type:e,raw:g[0],content:y.trim(),attributes:w}}},renderMarkdown:h=>{let f="";n?f=n(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function Brt(r,e,t){var n,i,s,o;const a=r.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const v=a[u];if(v.trim()===""){const E=a.slice(u+1).findIndex($=>$.trim()!=="");if(E===-1)break;if((((i=(n=a[u+1+E].match(/^(\s*)/))==null?void 0:n[1])==null?void 0:i.length)||0)>m){y.push(v),c=`${c}${v}
`,u+=1;continue}else break}if((((o=(s=v.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(v),c=`${c}${v}
`,u+=1;else break}let S;const w=y.slice(1);if(w.length>0){const v=w.map(C=>C.slice(m+d)).join(`
`);v.trim()&&(e.customNestedParser?S=e.customNestedParser(v):S=t.blockTokens(v))}const b=e.createToken(p,S);l.push(b)}if(l.length!==0)return{items:l,raw:c}}function jrt(r,e,t,n){if(!r||!Array.isArray(r.content))return"";const i=typeof t=="function"?t(n):t,[s,...o]=r.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}Vn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:r=>r.length,wordCounter:r=>r.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=r=>{const e=r?.node||this.editor.state.doc;if((r?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=r=>{const e=r?.node||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let r=!1;return[new vs({key:new ks("characterCount"),appendTransaction:(e,t,n)=>{if(r)return;const i=this.options.limit;if(i==null||i===0){r=!0;return}const s=this.storage.characters({node:n.doc});if(s>i){const o=s-i,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const c=n.tr.deleteRange(a,l);return r=!0,c}r=!0},filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:t.doc}),s=this.storage.characters({node:e.doc});if(s<=n||i>n&&s>n&&s<=i)return!0;if(i>n&&s>n&&s>i||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=s-n,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>n)}})]}});var Lrt=Vn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Jde(this.options)]}});Vn.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new vs({key:new ks("focus"),props:{decorations:({doc:r,selection:e})=>{const{isEditable:t,isFocused:n}=this.editor,{anchor:i}=e,s=[];if(!t||!n)return bn.create(r,[]);let o=0;this.options.mode==="deepest"&&r.descendants((l,c)=>{if(l.isText)return;if(!(i>=c&&i<=c+l.nodeSize-1))return!1;o+=1});let a=0;return r.descendants((l,c)=>{if(l.isText||!(i>=c&&i<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";s.push(zs.node(c,c+l.nodeSize,{class:this.options.className}))}),bn.create(r,s)}}})]}});var Urt=Vn.create({name:"gapCursor",addProseMirrorPlugins(){return[Vde()]},extendNodeSchema(r){var e;const t={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(e=jk(Qf(r,"allowGapCursor",t)))!=null?e:null}}});Vn.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new vs({key:new ks("placeholder"),props:{decorations:({doc:r,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!t)return null;const s=this.editor.isEmpty;return r.descendants((o,a)=>{const l=n>=a&&n<=a+o.nodeSize,c=!o.isLeaf&&FD(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const d=zs.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),bn.create(r,i)}}})]}});Vn.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:r,options:e}=this;return[new vs({key:new ks("selection"),props:{decorations(t){return t.selection.empty||r.isFocused||!r.isEditable||Znt(t.selection)||r.view.dragging?null:bn.create(t.doc,[zs.inline(t.selection.from,t.selection.to,{class:e.className})])}}})]}});function rU({types:r,node:e}){return e&&Array.isArray(r)&&r.includes(e.type)||e?.type===r}var Wrt=Vn.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var r;const e=new ks(this.name),t=this.options.node||((r=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:r.name)||"paragraph",n=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(t).includes(i.name));return[new vs({key:e,appendTransaction:(i,s,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,h=c.nodes[t];if(u)return l.insert(d,h.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!rU({node:o,types:n})},apply:(i,s)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return s;const o=i.doc.lastChild;return!rU({node:o,types:n})}}})]}}),Hrt=Vn.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>Xde(r,e),redo:()=>({state:r,dispatch:e})=>Yde(r,e)}},addProseMirrorPlugins(){return[Gde(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),qrt=_o.create({name:"starterKit",addExtensions(){var r,e,t,n;const i=[];return this.options.bold!==!1&&i.push(e8e.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(G6e.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(xle.configure(this.options.bulletList)),this.options.code!==!1&&i.push(r8e.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(Q9e.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(qHe.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Lrt.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Urt.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(zJe.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(OYe.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(Hrt.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(NYe.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(BYe.configure(this.options.italic)),this.options.listItem!==!1&&i.push(Sle.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(Tle.configure((r=this.options)==null?void 0:r.listKeymap)),this.options.link!==!1&&i.push(JYe.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(Ele.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(eet.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(ret.configure(this.options.strike)),this.options.text!==!1&&i.push(iet.configure(this.options.text)),this.options.underline!==!1&&i.push(set.configure((t=this.options)==null?void 0:t.underline)),this.options.trailingNode!==!1&&i.push(Wrt.configure((n=this.options)==null?void 0:n.trailingNode)),i}});const Wce={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},Krt=pn(Wce).flatMap(r=>pn(r).flatMap(e=>Object.values(e))),Jrt=Ro.create({name:"textDirection",addGlobalAttributes(){return[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:r=>{const e=r.getAttribute("dir");return e&&["ltr","rtl","auto"].includes(e)?e:"auto"},renderHTML:r=>({dir:r.dir})}}}]}}),Vrt=Ro.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts(){return{"Shift-Enter":({editor:r})=>r.commands.enter()}}});iFe.config.excludes=void 0;rte.config.priority=1100;const AS=[qrt.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1,link:{openOnClick:!1,autolink:!0}}),rte,Vrt,Jrt],Grt=new Ar;function jD(r,e){return Grt.get(e,()=>{const t=r.getTextOptions().tipTapConfig?.extensions??AS;return tNe(e,t).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function Bx(r,e){return`<div class="tl-rich-text">${jD(r,e)}</div>`}const Yrt=new Ar;function mn(r){return r.content.length===1&&!r.content[0].content}function Gl(r,e){return mn(e)?"":Yrt.get(e,()=>{const t=r.getTextOptions().tipTapConfig?.extensions??AS;return rNe(e,t,{blockSeparator:`
`})})}function Xrt(r,e){const t=r.getTextOptions().tipTapConfig?.extensions??AS;return nNe(e,t)}function Hce(r,e,t){for(const o of r.marks)o.type.name==="bold"&&e.weight!=="bold"&&(e={...e,weight:"bold"}),o.type.name==="italic"&&e.style!=="italic"&&(e={...e,style:"italic"}),o.type.name==="code"&&e.family!=="tldraw_mono"&&(e={...e,family:"tldraw_mono"});const n=Cn(Wce,e.family);if(!n)return e;const i=Cn(n,e.style);if(!i)return e;const s=Cn(i,e.weight);return s&&t(s),e}const Zrt="  ";class jx{static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(jx.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(jx.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}}const Qrt=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function qce(r){return Qrt.test(r)}function eit(r){return r.replace(/\t/g,Zrt)}function tit(r){const e=r.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const n of e)if(n.trim().length>0){const i=n.length-n.trimStart().length;t=Math.min(t,i)}return e.map(n=>n.slice(t)).join(`
`)}const Kce={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"","&#8212;":"","&#8216;":"","&#8217;":"","&#8220;":"","&#8221;":"","&#8230;":""},nit=new RegExp(Object.keys(Kce).join("|"),"g");function Jce(r){return r.replace(nit,e=>Kce[e])}function rit(r){return r.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function iit(r){return rit(tit(eit(r)))}const sit=5e3,oit=10*1024*1024;function ait(r,e){r.registerExternalAssetHandler("file",async t=>lit(r,t,e)),r.registerExternalAssetHandler("url",async t=>uit(r,t,e)),r.registerExternalContentHandler("svg-text",async t=>dit(r,t)),r.registerExternalContentHandler("embed",t=>hit(r,t)),r.registerExternalContentHandler("files",async t=>fit(r,t,e)),r.registerExternalContentHandler("file-replace",async t=>cit(r,t,e)),r.registerExternalContentHandler("text",async t=>pit(r,t)),r.registerExternalContentHandler("url",async t=>mit(r,t,e)),r.registerExternalContentHandler("tldraw",async t=>git(r,t)),r.registerExternalContentHandler("excalidraw",async t=>yit(r,t))}async function lit(r,{file:e,assetId:t},n){LD(e,n)||se(!1,"File checks failed");const s=await Yce(e,n,t),o=await r.uploadAsset(s,e);return s.props.src=o.src,o.meta&&(s.meta={...s.meta,...o.meta}),Ld.create(s)}async function cit(r,{file:e,shapeId:t,isImage:n},i){LD(e,i)||se(!1,"File checks failed");const o=r.getShape(t);o||se(!1,"Shape not found");const a=hW(await e.arrayBuffer()),l=Ld.createId(a);r.createTemporaryAssetPreview(l,e);const c=await Vce(e,l,n,!n);if(r.createAssets([c]),o.type==="image"){const d=o,h=d.props.crop;let f=c.props.w,p=c.props.h,m=d.x,g=d.y,y=h;if(h){const S=o$e(d,c.props.w,c.props.h);y=S.crop,f=S.w,p=S.h,m=S.x,g=S.y}r.updateShapes([{id:d.id,type:d.type,props:{assetId:l,crop:y,w:f,h:p},x:m,y:g}])}else o.type==="video"&&r.updateShapes([{id:o.id,type:o.type,props:{assetId:l,w:c.props.w,h:c.props.h}}]);const u=await r.getAssetForExternalContent({type:"file",file:e,assetId:l});return r.updateAssets([{...u,id:l}]),u}async function uit(r,{url:e},{toasts:t,msg:n}){let i;try{const o=await(await Ua(e,{method:"GET",mode:"no-cors"})).text(),a=new DOMParser().parseFromString(o,"text/html");i={image:a.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:a.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??a.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:a.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??e,description:a.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""},i.image.startsWith("http")||(i.image=new URL(i.image,e).href),i.favicon.startsWith("http")||(i.favicon=new URL(i.favicon,e).href)}catch(s){console.error(s),t.addToast({title:n("assets.url.failed"),severity:"error"}),i={image:"",favicon:"",title:"",description:""}}return{id:Ld.createId(dW(e)),typeName:"asset",type:"bookmark",props:{src:e,description:i.description,image:i.image,favicon:i.favicon,title:i.title},meta:{}}}async function dit(r,{point:e,text:t}){const n=e??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),i=new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg");if(!i)throw new Error("No <svg/> element present");let s=parseFloat(i.getAttribute("width")||"0"),o=parseFloat(i.getAttribute("height")||"0");if(!(s&&o)){document.body.appendChild(i);const l=i.getBoundingClientRect();document.body.removeChild(i),s=l.width,o=l.height}const a=await r.getAssetForExternalContent({type:"file",file:new File([t],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");Gce(r,[a],n)}function hit(r,{point:e,url:t,embed:n}){const i=e??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),{width:s,height:o}=n,a=Ct(),l=ms(new T(i.x-(s||450)/2,i.y-(o||450)/2),r),c={id:a,type:"embed",x:l.x,y:l.y,props:{w:s,h:o,url:t}};r.canCreateShape(c)&&r.createShape(c).select(a)}async function fit(r,{point:e,files:t},n){const{acceptedImageMimeTypes:i=ap,toasts:s,msg:o}=n;if(t.length>r.options.maxFilesAtOnce){s.addToast({title:o("assets.files.amount-too-many"),severity:"error"});return}const a=e??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),l=new T(a.x,a.y),c=[],u=[];for(const d of t){if(!LD(d,n))continue;const f=await Yce(d,n);i.includes(d.type)&&r.createTemporaryAssetPreview(f.id,d),c.push(f),u.push({asset:f,file:d})}Promise.allSettled(u.map(async d=>{try{const h=await r.getAssetForExternalContent({type:"file",file:d.file});if(!h)throw Error("Could not create an asset");r.updateAssets([{...h,id:d.asset.id}])}catch(h){s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(h),r.deleteAssets([d.asset.id]);return}})),Gce(r,c,l)}async function pit(r,{point:e,text:t,html:n}){const i=e??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),s=r.getShapeUtil("text").getDefaultProps(),o=iit(t),a=n?Xrt(r,n):ir(o);let l,c,u,d="middle";const h=n??o.replace(/\n/g,"<br>"),f=n?a.content.length>1:o.split(`
`).length>1,p=qce(o);f&&(d=f?p?"end":"start":"middle");const m=r.textMeasure.measureHtml(h,{...Ei,fontFamily:Ll[s.font],fontSize:Bf[s.size],maxWidth:null}),g=Math.min(f?r.getViewportPageBounds().width*.9:920,Math.max(200,r.getViewportPageBounds().width*.9));if(m.w>g){const w=r.textMeasure.measureHtml(h,{...Ei,fontFamily:Ll[s.font],fontSize:Bf[s.size],maxWidth:g});l=w.w,c=w.h,u=!1,d=p?"end":"start"}else l=Math.max(m.w,10),c=Math.max(m.h,10),u=!0;i.y-c/2<r.getViewportPageBounds().minY+40&&(i.y=r.getViewportPageBounds().minY+40+c/2);const y=ms(new T(i.x-l/2,i.y-c/2),r),S=Ct();r.createShapes([{id:S,type:"text",x:y.x,y:y.y,props:{richText:a,textAlign:d,autoSize:u,w:l}}])}async function mit(r,{point:e,url:t},{toasts:n,msg:i}){const o=r.getShapeUtil("embed")?.getEmbedDefinition(t);if(o&&o.definition.embedOnPaste!==!1)return r.putExternalContent({type:"embed",url:o.url,point:e,embed:o.definition});const a=e??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center);if(!(await kY(r,{url:t,center:a})).ok){n.addToast({title:i("assets.url.failed"),severity:"error"});return}}async function git(r,{point:e,content:t}){r.run(()=>{const n=r.getSelectionPageBounds();r.markHistoryStoppingPoint("paste");for(const s of t.shapes)t.rootShapeIds.includes(s.id)&&(s.isLocked=!1);r.putContentOntoCurrentPage(t,{point:e,select:!0});const i=r.getSelectionPageBounds();n&&i&&n?.collides(i)&&(r.updateInstanceState({isChangingStyle:!0}),r.timers.setTimeout(()=>{r.updateInstanceState({isChangingStyle:!1})},150))})}async function yit(r,{point:e,content:t}){r.run(()=>{HDe(r,t,e)})}async function Vce(r,e,t,n,i){let s=r.type;r.type==="video/quicktime"&&(s="video/mp4");const o=t?await cs.getImageSize(r):await cs.getVideoSize(r),a=await cs.isAnimated(r)||n,l={id:e,type:t?"image":"video",typeName:"asset",props:{name:r.name,src:"",w:o.w,h:o.h,fileSize:r.size,mimeType:s,isAnimated:a},meta:{}};if(i&&isFinite(i)){const c={w:l.props.w,h:l.props.h},u=WDe(c,{w:i,h:i});c!==u&&cs.isStaticImageType(r.type)&&(l.props.w=u.w,l.props.h=u.h)}return l}async function Gce(r,e,t){if(!e.length)return[];const n=T.From(t),i=[];for(let s=0;s<e.length;s++){const o=e[s];switch(o.type){case"image":{i.push({id:Ct(),type:"image",x:n.x,y:n.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),n.x+=o.props.w;break}case"video":i.push({id:Ct(),type:"video",x:n.x,y:n.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),n.x+=o.props.w}}return r.run(()=>{const s=e.filter(o=>!r.getAsset(o.id));r.store.atomic(()=>{r.canCreateShapes(i)&&(s.length&&r.createAssets(s),r.createShapes(i).select(...i.map(o=>o.id)),xit(r,t))})}),i.map(s=>s.id)}function xit(r,e){const t=r.getViewportPageBounds();let n=r.getSelectionPageBounds();if(n){const i=n.center.sub(e);r.updateShapes(r.getSelectedShapes().map(s=>{const o=r.getShapeParentTransform(s).decompose().rotation,a=T.Rot(i,-o);return{id:s.id,type:s.type,x:s.x-a.x,y:s.y-a.y}}))}if(n=r.getSelectionPageBounds(),n&&r.getInstanceState().isGridMode){const i=r.getDocumentSettings().gridSize,s=new T(n.minX,n.minY),o=s.clone().snapToGrid(i),a=T.Sub(s,o);r.updateShapes(r.getSelectedShapes().map(l=>{const c={x:l.x-a.x,y:l.y-a.y};return{id:l.id,type:l.type,x:c.x,y:c.y}}))}n=r.getSelectionPageBounds(),n&&!t.contains(n)&&r.zoomToSelection({animation:{duration:r.options.animationMediumMs}})}function LD(r,e){const{acceptedImageMimeTypes:t=ap,acceptedVideoMimeTypes:n=r1,maxAssetSize:i=oit,toasts:s,msg:o}=e,a=t.includes(r.type),l=n.includes(r.type);if(!a&&!l)return s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),!1;if(r.size>i){const c=u=>{if(u===0)return"0 bytes";const d=["bytes","KB","MB","GB","TB","PB"],h=1024,f=Math.floor(Math.log(u)/Math.log(h)),p=u/Math.pow(h,f);return`${p%1===0?p.toString():p.toFixed(1)} ${d[f]}`};return s.addToast({title:o("assets.files.size-too-big"),description:o("assets.files.maximum-size").replace("{size}",c(i)),severity:"error"}),!1}return r.type?!0:(s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1)}async function Yce(r,e,t){const{acceptedImageMimeTypes:n=ap,acceptedVideoMimeTypes:i=r1,maxImageDimension:s=sit}=e,o=n.includes(r.type),a=i.includes(r.type),l=hW(await r.arrayBuffer());return t??=Ld.createId(l),await Vce(r,t,o,a,s)}let Sit=class extends he{static id="idle";isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(e){this.parent.transition("pointing",{...e,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){j_(this.editor),this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(e){if(this.update(),e.key==="Enter"){if(this.editor.getIsReadonly())return null;const t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}update(){const e=this.editor.getShapeUtil("arrow"),t=iC({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});t&&t.target.id!==this.preciseTargetId?(this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=t.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},e.options.hoverPreciseTimeout)):!t&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId))}},wit=class extends he{static id="pointing";shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(e){if(this.markId="",this.isPrecise=!!e.isPrecise,!iC({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0})&&(this.createArrowShape(),!this.shape)){this.cancel();return}this.startPreciseTimeout()}onExit(){this.shape=void 0,j_(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape){this.cancel();return}this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){const{originPagePoint:e}=this.editor.inputs,t=Ct();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${t}`);const n=ms(e,this.editor);this.editor.createShape({id:t,type:"arrow",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(t);if(!i)return;const s=this.editor.getShapeHandles(i);if(!s)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=s.find(u=>u.id==="start"),c=o.onHandleDrag?.(i,{handle:{...l,x:0,y:0},isPrecise:!0,isCreatingShape:!0,initial:a});c&&this.editor.updateShapes([c]),this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");{const n=this.editor.getShapeUtil("arrow"),i=this.shape,s=t.find(a=>a.id==="start"),o=n.onHandleDrag?.(e,{handle:{...s,x:0,y:0},isPrecise:this.isPrecise,isCreatingShape:!0,initial:i});o&&this.editor.updateShapes([o])}{const n=this.editor.getShapeUtil("arrow"),i=this.shape,s=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),o=t.find(l=>l.id==="end"),a=n.onHandleDrag?.(this.editor.getShape(e),{handle:{...o,x:s.x,y:s.y},isPrecise:this.isPrecise,isCreatingShape:!0,initial:i});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){const e=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},e.options.pointingPreciseTimeout)}clearPreciseTimeout(){this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}};class bit extends he{static id="arrow";static initial="idle";static children(){return[Sit,wit]}shapeType="arrow"}class Xce extends he{static id="drawing";info={};initialShape;shapeType=this.parent.id==="highlight"?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;markId=null;onEnter(e){this.markId=null,this.info=e,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:e}=this.editor;if(this.isPen&&!e.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?T.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(e){if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(e){if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(e,t,n){if(!this.canClose())return!1;const i=_n[t],s=e[0].points[0],o=e[e.length-1],a=o.points[o.points.length-1];return s!==a&&this.currentLineLength>i*4*n&&T.DistMin(s,a,i*2*n)}startShape(){const{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:n=.5}=this.info.point;this.isPen=t,this.isPenOrStylus=t||n>0&&n<.5||n>.5&&n<1;const i=this.isPenOrStylus?n*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const l=Xn(a.props.segments);if(!l)throw Error("Expected a previous segment!");const c=Xn(l.points);if(!c)throw Error("Expected a previous point!");const{x:u,y:d}=this.editor.getPointInShapeSpace(a,e).toFixed(),h={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+i.toFixed(2)},{x:u,y:d,z:+i.toFixed(2)}]},f=J.applyToPoint(this.editor.getShapePageTransform(a.id),c);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const p=[...a.props.segments,h];this.currentLineLength<_n[a.props.size]*4&&(this.currentLineLength=this.getLineLength(p));const m={id:a.id,type:this.shapeType,props:{segments:p}};this.canClose()&&(m.props.isClosed=this.getIsClosed(p,a.props.size,a.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const s=Ct();if(this.editor.createShape({id:s,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}),!this.editor.getShape(s)){this.cancel();return}this.currentLineLength=0,this.initialShape=this.editor.getShape(s)}updateDrawingShape(){const{initialShape:e}=this,{inputs:t}=this.editor;if(!e)return;const{id:n,props:{size:i,scale:s}}=e,o=this.editor.getShape(n);if(!o)return;const{segments:a}=o.props,{x:l,y:c,z:u}=this.editor.getPointInShapeSpace(o,t.currentPagePoint).toFixed(),d=this.isPenOrStylus?+(t.currentPagePoint.z*1.25).toFixed(2):.5,h={x:l,y:c,z:d};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(T.Dist2(f,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const m=Xn(a);if(!m)throw Error("Expected a previous segment!");const g=Xn(m.points);if(!g)throw Error("Expected a previous last point!");let y;const S=this.editor.getPointInShapeSpace(o,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(m.type==="straight"){this.currentLineLength+=T.Dist(g,S),y={type:"straight",points:[{...g},S]};const b=this.editor.getShapePageTransform(o);this.pagePointWhereCurrentSegmentChanged=J.applyToPoint(b,g)}else y={type:"straight",points:[S,h]};const w={id:n,type:this.shapeType,props:{segments:[...a,y]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(a,i,s)),this.editor.updateShapes([w])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(T.Dist2(f,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const m=a.slice(),g=m[m.length-1],y=Xn(g.points);if(!y)throw Error("No previous point!");const S={type:"free",points:[...T.PointsBetween(y,h,6).map(v=>({x:Zs(v.x),y:Zs(v.y),z:Zs(v.z)}))]},w=[...m,S];this.currentLineLength<_n[o.props.size]*4&&(this.currentLineLength=this.getLineLength(w));const b={id:n,type:this.shapeType,props:{segments:w}};this.canClose()&&(b.props.isClosed=this.getIsClosed(w,i,s)),this.editor.updateShapes([b])}break}case"straight":{const f=a.slice(),p=f[f.length-1],{pagePointWhereCurrentSegmentChanged:m}=this,{ctrlKey:g,currentPagePoint:y}=this.editor.inputs;if(!m)throw Error("We should have a point where the segment changed");let S,w=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(w=!g,this.didJustShiftClickToExtendPreviousShapeLine=!1):w=!g;let b=this.editor.getPointInShapeSpace(o,y).toFixed().toJson(),v=!1,C;if((this.editor.user.getIsSnapMode()?!g:g)&&f.length>2){let P,$=8/this.editor.getZoomLevel();for(let A=0,O=a.length-2;A<O;A++){const _=a[A];if(!_)break;if(_.type==="free")continue;const I=_.points[0],R=Xn(_.points);if(!(I&&R))continue;const B=T.NearestPointOnLineSegment(I,R,b);if(T.DistMin(B,b,$)){P=B.toFixed().toJson(),$=T.Dist(B,b),C=_;break}}P&&(v=!0,b=P)}if(v&&C){const P=this.editor.getShapePageTransform(o),$=C.points[0],A=Xn(C.points);if(!A)throw Error("Expected a last point!");const O=J.applyToPoint(P,$),_=J.applyToPoint(P,A),I=J.applyToPoint(P,b);this.editor.snaps.setIndicators([{id:ft(),type:"points",points:[O,I,_]}])}else{if(this.editor.snaps.clearIndicators(),w){const P=T.Angle(m,y),A=uv(P,24)-P;S=T.RotWith(y,m,A)}else S=y;b=this.editor.getPointInShapeSpace(o,S).toFixed().toJson()}this.currentLineLength+=T.Dist(p.points[0],b),f[f.length-1]={...p,type:"straight",points:[p.points[0],b]};const M={id:n,type:this.shapeType,props:{segments:f}};this.canClose()&&(M.props.isClosed=this.getIsClosed(a,i,s)),this.editor.updateShapes([M]);break}case"free":{const f=a.slice(),p=f[f.length-1],m=[...p.points];if(m.length&&this.mergeNextPoint){const{z:y}=m[m.length-1];m[m.length-1]={x:h.x,y:h.y,z:y?Math.max(y,h.z):h.z}}else this.currentLineLength+=T.Dist(m[m.length-1],h),m.push(h);f[f.length-1]={...p,points:m},this.currentLineLength<_n[o.props.size]*4&&(this.currentLineLength=this.getLineLength(f));const g={id:n,type:this.shapeType,props:{segments:f}};if(this.canClose()&&(g.props.isClosed=this.getIsClosed(f,i,s)),this.editor.updateShapes([g]),m.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);const y=Ct(),S=this.editor.getShape(n).props;if(!this.editor.canCreateShapes([y]))return this.cancel();this.editor.createShape({id:y,type:this.shapeType,x:Zs(t.currentPagePoint.x),y:Zs(t.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:S.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(u*1.25).toFixed():.5}]}]}});const w=this.editor.getShape(y);if(!w)return this.cancel();this.initialShape=vn(w),this.mergeNextPoint=!1,this.lastRecordedPoint=t.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let t=0;for(const n of e)for(let i=0;i<n.points.length-1;i++){const s=n.points[i],o=n.points[i+1];t+=T.Dist2(o,s)}return Math.sqrt(t)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}let Zce=class extends he{static id="idle";onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};class vit extends he{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[Zce,Xce]}shapeType="draw";onExit(){const e=this.children.drawing;e.initialShape=void 0}}class kit extends nCe{static id="frame";static initial="idle";shapeType="frame";onCreate(e){if(!e)return;const t=this.editor.getShapePageBounds(e),n=[],i=this.editor.getShapeAncestors(e).map(s=>s.id);this.editor.getSortedChildIdsForParent(e.parentId).map(s=>{const o=this.editor.getShape(s);if(!o||o.id===e.id||o.isLocked)return;const a=this.editor.getShapePageBounds(o);a&&t.contains(a)&&Cit(o,i,e)&&n.push(o.id)}),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}function Cit(r,e,t){return e.includes(r.id)?!1:r.parentId===t.parentId}let Tit=class extends he{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}onCancel(){this.editor.setCurrentTool("select")}},Eit=class extends he{static id="pointing";onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=Ct(),i=this.editor.markHistoryStoppingPoint(`creating_geo:${n}`),s=ms(t,this.editor);if(this.editor.createShapes([{id:n,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Vo),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n),!this.editor.getShape(n)){this.cancel();return}this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=Ct();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(Vo),s=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Vo),scale:n,...s}}]);const o=this.editor.getShape(t);if(!o){this.cancel();return}const{w:a,h:l}=o.props,c=new T(a/2,l/2).mul(n),u=this.editor.getShapeParentTransform(o);u&&c.rot(-u.rotation());const d=ms(new T(o.x-c.x,o.y-c.y),this.editor);this.editor.select(t),this.editor.updateShape({id:o.id,type:"geo",x:d.x,y:d.y,props:{geo:this.editor.getStyleForNextShape(Vo),w:a*n,h:l*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};class Mit extends he{static id="geo";static initial="idle";static children(){return[Tit,Eit]}shapeType="geo"}class Iit extends he{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[Zce,Xce]}static isLockable=!1;shapeType="highlight";onExit(){const e=this.children.drawing;e.initialShape=void 0}}let Pit=class extends he{static id="idle";shapeId="";onEnter(e){this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}};const iU=2;let Ait=class extends he{static id="pointing";shape={};markId;onEnter(e){const{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&t.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i.id}`),this.shape=i;const s=this.editor.getShapeHandles(this.shape);if(!s)return;const o=s.filter(f=>f.type==="vertex").sort(Fn),a=o[o.length-1],l=o[o.length-2],c=J.applyToPoint(this.editor.getShapeParentTransform(this.shape),new T(this.shape.x,this.shape.y)),u=T.Sub(n,c).addXY(.1,.1),d=ms(u,this.editor),h=vn(this.shape.props.points);if(T.DistMin(a,l,iU)||T.DistMin(d,a,iU))h[a.id]={id:a.id,index:a.index,x:d.x,y:d.y};else{const f=_s(a.index);h[f]={id:f,index:f,x:d.x,y:d.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:h}}])}else{const s=Ct();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s}`);const o=ms(n,this.editor);if(this.editor.createShapes([{id:s,type:"line",x:o.x,y:o.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(s)){this.cancel();return}this.editor.select(s),this.shape=this.editor.getShape(s)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=Xn(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};class $it extends he{static id="line";static initial="idle";static children(){return[Pit,Ait]}shapeType="line"}let Rit=class extends he{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};const Oit=0,vt=200,dC=new T(vt/2,vt/2),Qce=10,Nit=r=>[[["a1"],new T(vt*.5,vt*-.5-r.options.adjacentShapeMargin)],[["a2"],new T(vt*1.5+r.options.adjacentShapeMargin,vt*.5)],[["a3"],new T(vt*.5,vt*1.5+r.options.adjacentShapeMargin)],[["a4"],new T(vt*-.5-r.options.adjacentShapeMargin,vt*.5)]];function _it(r,e){if(e===1)return Nit(r);const t=vt*e,n=r.options.adjacentShapeMargin*e;return[[["a1"],new T(t*.5,t*-.5-n)],[["a2"],new T(t*1.5+n,t*.5)],[["a3"],new T(t*.5,t*1.5+n)],[["a4"],new T(t*-.5-n,t*.5)]]}function eue(r,e,t,n,i,s){return Object.fromEntries(_it(r,s).map(([o,a],l)=>{const c=a.clone();return l===0&&i?c.y-=i:l===2&&n&&(c.y+=n),[o,c.rot(t).add(e)]}))}function tue(r,e,t,n){const i=new Set(r.getSelectedShapeIds()),s=(vt+r.options.adjacentShapeMargin+n)**2,o=new Map,a=[];for(const u of r.getCurrentPageShapes()){if(!r.isShapeOfType(u,"note")||t!==u.props.scale||i.has(u.id))continue;const d=r.getShapePageTransform(u.id);e===d.rotation()&&(o.set(u,r.getShapePageBounds(u).center),a.push(...Object.values(eue(r,d.point(),e,u.props.growY,n,t))))}const l=a.length;let c;for(const[u,d]of o)for(let h=0;h<l;h++)c=a[h],c&&(T.Dist2(d,c)>s||r.isPointInShape(u,c)&&(a[h]=void 0));return Re(a)}function nue(r,e,t,n,i=!1){let s;const o=r.getCurrentPageShapesSorted(),a=(vt+r.options.adjacentShapeMargin**2)**e.props.scale;for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.type==="note"&&c.id!==e.id){const u=r.getShapePageBounds(c);if(u&&T.Dist2(u.center,t)<a&&r.isPointInShape(c,t)){s=c;break}}}if(r.complete(),!s||i){r.markHistoryStoppingPoint("creating note shape");const l=Ct();r.createShape({id:l,type:"note",x:t.x,y:t.y,rotation:n,opacity:e.opacity,props:{...e.props,richText:ir(""),growY:0,fontSizeAdjustment:0,url:""}});const c=r.getShape(l);if(!c)return;const u=r.getPointInParentSpace(c,T.Sub(t,T.Rot(dC.clone().mul(c.props.scale),n)));r.updateShape({id:l,type:"note",x:u.x,y:u.y}),s=r.getShape(l)}return r.zoomToSelectionIfOffscreen(16,{animation:{duration:r.options.animationMediumMs},inset:0}),s}let Dit=class extends he{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){const{editor:e}=this,t=Ct();this.markId=e.markHistoryStoppingPoint(`creating_note:${t}`);const n=this.editor.inputs.originPagePoint.clone(),i=Fit(this.editor,n,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&n.sub(i);const s=zit(this.editor,t,n);s?this.shape=s:this.cancel()}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};function Fit(r,e,t){let n=Qce/r.getZoomLevel(),i;for(const s of tue(r,0,t,0)){const o=T.Sub(e,s),a=o.len();a<n&&(n=a,i=o)}return i}function zit(r,e,t){r.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:r.user.getIsDynamicResizeMode()?1/r.getZoomLevel():1}});const n=r.getShape(e);if(!n)return;r.select(e);const i=r.getShapeGeometry(n).bounds,s=ms(new T(n.x-i.width/2,n.y-i.height/2),r);return r.updateShapes([{id:e,type:"note",x:s.x,y:s.y}]),r.getShape(e)}class Bit extends he{static id="note";static initial="idle";static children(){return[Rit,Dit]}shapeType="note"}function jit(r){const e=r.getShapeAtPoint(r.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:r.options.hitTestMargin/r.getZoomLevel(),renderingOnly:!0});if(!e)return r.setHoveredShape(null);let t;const n=r.getOutermostSelectableShape(e);return n===e||n.id===r.getFocusedGroupId()||r.getSelectedShapeIds().includes(n.id)?t=e:t=n,r.setHoveredShape(t.id)}const za=lW(jit,32);let Lit=class extends he{static id="idle";onPointerMove(e){switch(e.target){case"shape":case"canvas":za(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){za.cancel()}onKeyDown(e){if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}onCancel(){this.editor.setCurrentTool("select")}},Uit=class extends he{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(e){if(Date.now()-this.enterTime<150)return;const{editor:t}=this,{isPointing:n}=t.inputs;if(!n)return;const{originPagePoint:i,currentPagePoint:s}=t.inputs,o=Math.abs(i.x-s.x),l=Math.sqrt(t.getInstanceState().isCoarsePointer?t.options.coarseDragDistanceSquared:t.options.dragDistanceSquared)*6/t.getZoomLevel();if(o>l){const c=Ct();this.markId=t.markHistoryStoppingPoint(`creating_text:${c}`);const u=this.createTextShape(c,i,!1,o);if(!u){this.cancel();return}this.shape=t.getShape(u),t.select(c);const d=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;t.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:o*d,y:1},onInteractionEnd:"text",onCreate:()=>{t.setEditingShape(u.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const e=Ct(),{originPagePoint:t}=this.editor.inputs;this.createTextShape(e,t,!0,20)&&(this.editor.select(e),this.editor.setEditingShape(e))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,t,n,i){this.editor.createShape({id:e,type:"text",x:t.x,y:t.y,props:{richText:ir(""),autoSize:n,w:i,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(e);if(!s){this.cancel();return}const o=this.editor.getShapePageBounds(s),a=new T;if(n)switch(s.props.textAlign){case"start":{a.x=0;break}case"middle":{a.x=-o.width/2;break}case"end":{a.x=-o.width;break}}else a.x=0;if(a.y=-o.height/2,li(s.parentId)){const u=this.editor.getShapeParentTransform(s);a.rot(-u.rotation())}const l=s.x+a.x,c=s.y+a.y;if(this.editor.getInstanceState().isGridMode){const u=new T(l,c),d=ms(u,this.editor),h=T.Sub(u,d);this.editor.updateShape({...s,x:l-h.x,y:c-h.y})}else this.editor.updateShape({...s,x:l,y:c});return s}};class Wit extends he{static id="text";static initial="idle";static children(){return[Lit,Uit]}shapeType="text"}const Hit=[Wit,vit,Mit,Bit,$it,kit,bit,Iit],qit=Be.forwardRef(function({shapeId:e,isEditing:t,richText:n,handleFocus:i,handleChange:s,handleBlur:o,handleKeyDown:a,handleDoubleClick:l,hasCustomTabBehavior:c,handlePaste:u},d){const h=z(),f=Ud("tip-tap-editor"),p=h.getTextOptions().tipTapConfig,m=k.useRef(n),g=k.useRef(null),y=k.useRef(null);k.useLayoutEffect(()=>{g.current?m.current!==n&&g.current.commands.setContent(n):m.current=n},[n]);const S=k.useRef({selectAll:!1,caretPosition:null});k.useLayoutEffect(()=>{function P(A){A.shapeId===h.getEditingShapeId()&&(S.current.selectAll=!0)}function $(A){A.shapeId===h.getEditingShapeId()&&(S.current.caretPosition=A.point)}return h.on("select-all-text",P),h.on("place-caret",$),()=>{h.off("select-all-text",P),h.off("place-caret",$)}},[h,t]);const w=qo(s),b=qo(a),v=qo(i),C=qo(o),E=qo(l),M=qo(u);return k.useLayoutEffect(()=>{if(!t||!p||!y.current)return;const{editorProps:P,...$}=p,A=new N_e({element:y.current,autofocus:!0,editable:t,onUpdate:_=>{const I=_.editor.state.doc.toJSON();m.current=I,w({richText:I})},onFocus:v,onBlur:C,onCreate:_=>{if(h.getEditingShapeId()!==e)return;const I=_.editor;h.setRichTextEditor(I);const{selectAll:R,caretPosition:B}=S.current;if(R)I.chain().focus().selectAll().run();else if(B){const U=I.view.posAtCoords({left:B.x,top:B.y})?.pos;U?I.chain().focus().setTextSelection(U).run():I.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(_,I)=>{!c&&I.key==="Tab"&&Kit(h,_,I),b(I)},handlePaste:(_,I)=>{if(M(I),I.defaultPrevented)return!0},handleDoubleClick:(_,I,R)=>E(R),...P},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:`
`}},...$,content:m.current}),O=h.timers.setTimeout(()=>{S.current.caretPosition||S.current.selectAll?A.commands.focus():A.commands.focus("end"),S.current.selectAll=!1,S.current.caretPosition=null},100);return g.current=A,()=>{g.current=null,clearTimeout(O),A.destroy()}},[t,p,v,C,E,w,M,b,h,e,c]),!t||!p?null:x.jsx("div",{id:f,ref:d,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:t?P=>P.stopPropagation():void 0,onPointerDownCapture:P=>P.stopPropagation(),onTouchEnd:P=>P.stopPropagation(),onDragStart:Oe,children:x.jsx("div",{className:"tl-rich-text",ref:y})})});function Kit(r,e,t){t.preventDefault();const n=r.getRichTextEditor();if(n?.isActive("bulletList")||n?.isActive("orderedList"))return;const{state:i,dispatch:s}=e,{$from:o,$to:a}=i.selection,l=t.shiftKey;let c=i.tr,u=a.end();for(;u>=o.start();){const h=i.doc.resolve(u).blockRange();if(!h)break;const f=h.start,p=h.end,m=i.doc.textBetween(f,p,`
`);let g=!1;i.doc.nodesBetween(f,p,y=>{if(y.type.name==="bulletList"||y.type.name==="orderedList")return g=!0,!1}),g||(l?m.startsWith("	")&&(c=c.delete(f+1,f+2)):c=c.insertText("	",f+1)),u=f-1}const d=i.selection.map(c.doc,c.mapping);c.setSelection(d),c.docChanged&&s(c)}function rue(r){return r==="start-legacy"||r==="middle-legacy"||r==="end-legacy"}function Jit(r,e,t){const n=iue(r),i=n.isEditing,s=z(),o=k.useRef(null),a=(t||"").trim().length===0;k.useEffect(()=>{function u(d){d.shapeId===r&&o.current?.select?.()}return s.on("select-all-text",u),()=>{s.off("select-all-text",u)}},[s,r,i]),k.useEffect(()=>{i&&(document.activeElement!==o.current&&o.current?.focus(),s.getInstanceState().isCoarsePointer&&o.current?.select(),ht.isSafari&&(o.current?.blur(),o.current?.focus()))},[s,i]);const l=k.useCallback(u=>{if(s.getEditingShapeId()===r)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&s.complete();break}}},[s,r]),c=k.useCallback(({plaintext:u})=>{if(s.getEditingShapeId()!==r)return;const d=jx.normalizeText(u||"");s.updateShape({id:r,type:e,props:{text:d}})},[s,r,e]);return{rInput:o,handleKeyDown:l,handleChange:c,isEmpty:a,...n}}function UD(r,e){return F("isReadyForEditing",()=>{const t=r.getEditingShapeId();return t!==null&&(t===e||r.getHoveredShapeId()===e)},[r,e])}function iue(r){const e=z(),t=F("isEditing",()=>e.getEditingShapeId()===r,[e]),n=UD(e,r),i=k.useCallback(o=>{e.dispatch({...nr(e,o),type:"pointer",name:"pointer_down",target:"shape",shape:e.getShape(r)}),o.stopPropagation()},[e,r]),s=k.useCallback(o=>{if(e.getEditingShapeId()===r&&o.clipboardData){const a=o.clipboardData.getData("text/html");a&&a.includes("<div data-tldraw")&&Oe(o)}},[e,r]);return{handleFocus:Ey,handleBlur:Ey,handleInputPointerDown:i,handleDoubleClick:e.markEventAsHandled,handlePaste:s,isEditing:t,isReadyForEditing:n}}function Vit(r,e,t){const n=iue(r),i=n.isEditing,s=z(),o=k.useRef(null),a=t&&mn(t);k.useEffect(()=>{if(!i)return;const u=o.current?.querySelector("[contenteditable]");u&&document.activeElement!==o.current&&u.focus()},[s,i]);const l=k.useCallback(u=>{s.getEditingShapeId()===r&&u.key==="Enter"&&zt(u)&&s.complete()},[s,r]),c=k.useCallback(({richText:u})=>{s.getEditingShapeId()===r&&s.updateShape({id:r,type:e,props:{richText:u}})},[s,r,e]);return{rInput:o,handleKeyDown:l,handleChange:c,isEmpty:a,...n}}const hC=Be.memo(function({shapeId:e,type:t,richText:n,labelColor:i,font:s,fontSize:o,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:d,padding:h=0,onKeyDown:f,classNamePrefix:p,style:m,textWidth:g,textHeight:y,hasCustomTabBehavior:S}){const w=z(),b=Be.useRef(!1),{rInput:v,isEmpty:C,isEditing:E,isReadyForEditing:M,...P}=Vit(e,t,n),$=k.useMemo(()=>{if(n)return jD(w,n)},[w,n]),A=F("isSelectToolActive",()=>w.getCurrentToolId()==="select",[w]);tN("isDragging",()=>{w.getInstanceState(),b.current=w.inputs.isDragging},[w]);const O=rue(l),_=R=>{if(R.target instanceof HTMLElement&&(R.target.tagName==="A"||R.target.closest("a"))){if(Oe(R),!A)return;const B=R.target.closest("a")?.getAttribute("href")??"",U=H=>{H.name!=="pointer_up"||!B||(b.current||e_(B,"_blank",!1),w.off("event",U))};w.on("event",U)}};if(!E&&C)return null;const I=p||"tl-text";return x.jsx("div",{className:`${I}-label tl-text-wrapper tl-rich-text-wrapper`,"aria-hidden":!E,"data-font":s,"data-align":l,"data-hastext":!C,"data-isediting":E,"data-textwrap":!!u,"data-isselected":d,style:{justifyContent:l==="middle"||O?"center":l,alignItems:c==="middle"?"center":c,padding:h,...m},children:x.jsxs("div",{className:`${I}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(g||0),color:i,width:g?Math.ceil(g):void 0,height:y?Math.ceil(y):void 0},children:[x.jsx("div",{className:`${I} tl-text tl-text-content`,dir:"auto",children:n&&x.jsx("div",{className:"tl-rich-text","data-is-select-tool-active":A,dangerouslySetInnerHTML:{__html:$||""},onPointerDown:_,"data-is-ready-for-editing":M})}),(M||d)&&x.jsx(qit,{ref:v,richText:n,isEditing:E,shapeId:e,...P,hasCustomTabBehavior:S,handleKeyDown:f??P.handleKeyDown})]})})});function fC({bounds:r,richText:e,fontSize:t,font:n,align:i,verticalAlign:s,wrap:o,labelColor:a,padding:l,showTextOutline:c=!0}){const u=z(),d=jD(u,e),h=i==="middle"?"center":i==="start"?"start":"end",f=i==="middle"?"center":i==="start"?"flex-start":"flex-end",p=s==="middle"?"center":s==="start"?"flex-start":"flex-end",m={display:"flex",fontFamily:kxe[n],height:"100%",justifyContent:f,alignItems:p,padding:`${l}px`},g={fontSize:`${t}px`,wrap:o?"wrap":"nowrap",color:a,lineHeight:Ei.lineHeight,textAlign:h,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:c?"var(--tl-text-outline)":"none"};return x.jsx("foreignObject",{x:r.minX,y:r.minY,width:r.w,height:r.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:x.jsx("div",{style:m,children:x.jsx("div",{dangerouslySetInnerHTML:{__html:d},style:g})})})}function WD(r){return{key:`${Fl.id}:${r}`,async getElement(){return r!=="pattern"?null:x.jsx(Git,{})}}}function Git(){const r=qD(),e=Ud(),t=qs(),n=8/12;return x.jsxs(x.Fragment,{children:[x.jsxs("mask",{id:e,children:[x.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),x.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[x.jsx("line",{x1:n*1,y1:n*3,x2:n*3,y2:n*1}),x.jsx("line",{x1:n*5,y1:n*7,x2:n*7,y2:n*5}),x.jsx("line",{x1:n*9,y1:n*11,x2:n*11,y2:n*9})]})]}),x.jsx("pattern",{id:r(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:x.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function HD(){return{key:`${Fl.id}:pattern`,component:Qit}}const Bg=8,sU=(r,e,t)=>new Promise((n,i)=>{const s=Bg*e*r,o=document.createElement("canvas");o.width=s,o.height=s;const a=o.getContext("2d");if(!a)return;a.fillStyle=t?iv.darkMode.solid:iv.lightMode.solid,a.fillRect(0,0,s,s),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*r;const l=8/12,c=u=>u*e*r;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),o.toBlob(u=>{!u||Yt.throwToBlob.get()?i():n(u)})}),oU=(r,e)=>{const t=document.createElement("canvas");t.width=r[0],t.height=r[1];const n=t.getContext("2d");return n?(e(n),t.toDataURL()):""};let uP=null;function Yit(){return uP||(uP={white:oU([1,1],r=>{r.fillStyle="#f8f9fa",r.fillRect(0,0,1,1)}),black:oU([1,1],r=>{r.fillStyle="#212529",r.fillRect(0,0,1,1)})}),uP}function sue(r){return Math.ceil(Math.log2(Math.max(1,r)))}function qD(){const r=ro("hash_pattern");return k.useCallback((e,t)=>{const n=sue(e);return TN(r,`${t}_${n}`)},[r])}function oue(r){const e=[],n=sue(r);for(let i=0;i<=n;i++)e.push(Math.pow(2,i));return e}function Xit(r){const e=Yit();return oue(r).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function Zit(){const r=z(),e=F("devicePixelRatio",()=>r.getInstanceState().devicePixelRatio,[r]),t=F("maxZoom",()=>Math.ceil(Xn(r.getCameraOptions().zoomSteps)),[r]),[n,i]=k.useState(!1),[s,o]=k.useState(()=>Xit(t)),a=qD();return k.useEffect(()=>{const c=Promise.all(oue(t).flatMap(d=>[sU(e,d,!1).then(h=>({zoom:d,theme:"light",url:URL.createObjectURL(h)})),sU(e,d,!0).then(h=>({zoom:d,theme:"dark",url:URL.createObjectURL(h)}))]));let u=!1;return c.then(d=>{u||(o(d),i(!0))}),()=>{u=!0,i(!1),c.then(d=>{for(const{url:h}of d)URL.revokeObjectURL(h)})}},[e,t]),{defs:x.jsx(x.Fragment,{children:s.map(c=>{const u=a(c.zoom,c.theme);return x.jsx("pattern",{id:u,width:Bg,height:Bg,patternUnits:"userSpaceOnUse",children:x.jsx("image",{href:c.url,width:Bg,height:Bg})},u)})}),isReady:n}}function Qit(){const r=z(),e=k.useRef(null),{defs:t,isReady:n}=Zit();return k.useEffect(()=>{if(n&&ht.isSafari){const i=aue(e.current);i&&r.timers.requestAnimationFrame(()=>{i.style.display="none",r.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[r,n]),x.jsx("g",{ref:e,"data-testid":n?"ready-pattern-fill-defs":void 0,children:t})}function aue(r){return r.classList.contains("tl-html-layer")?r:r.parentElement?aue(r.parentElement):null}const Lx=Be.memo(function({theme:e,d:t,color:n,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return x.jsx("path",{fill:ot(e,n,"semi"),d:t});case"semi":return x.jsx("path",{fill:e.solid,d:t});case"fill":return x.jsx("path",{fill:ot(e,n,"fill"),d:t});case"pattern":return x.jsx(est,{theme:e,color:n,fill:i,d:t,scale:s});case"lined-fill":return x.jsx("path",{fill:ot(e,n,"linedFill"),d:t})}});function est({d:r,color:e,theme:t}){const n=z(),i=dS(),s=F("zoomLevel",()=>n.getZoomLevel(),[n]),o=qD(),a=n.getZoomLevel()<=.18;return x.jsxs(x.Fragment,{children:[x.jsx("path",{fill:ot(t,e,"pattern"),d:r}),x.jsx("path",{fill:i?`url(#${o(1,t.id)})`:a?ot(t,e,"semi"):`url(#${o(s,t.id)})`,d:r})]})}function lue(r,e,t){switch(e.type){case"straight":return new dt().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).lineTo(e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(t);case"arc":return new dt().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).circularArcTo(e.bodyArc.radius,!!e.bodyArc.largeArcFlag,!!e.bodyArc.sweepFlag,e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(t);case"elbow":{const n=new dt;n.moveTo(e.start.point.x,e.start.point.y,{offset:0});for(let i=1;i<e.route.points.length;i++){const s=e.route.points[i];e.route.skipPointsWhenDrawing.has(s)||n.lineTo(s.x,s.y,{offset:i===e.route.points.length-1?0:void 0})}return n.toSvg(t)}default:at(e,"type")}}function tst(r,e){switch(r.type){case"straight":return new dt().moveTo(r.start.handle.x,r.start.handle.y).lineTo(r.end.handle.x,r.end.handle.y).toSvg(e);case"arc":return new dt().moveTo(r.start.handle.x,r.start.handle.y).circularArcTo(r.handleArc.radius,!!r.handleArc.largeArcFlag,!!r.handleArc.sweepFlag,r.end.handle.x,r.end.handle.y).toSvg(e);case"elbow":{const t=NIe(r.elbow,r.route);return dt.lineThroughPoints(t.points).toSvg(e)}default:at(r,"type")}}function ep(r,e){const t=Ns(r,e);switch(t.type){case"straight":return new Of({start:T.From(t.start.point),end:T.From(t.end.point)});case"arc":return new pG({center:T.Cast(t.handleArc.center),start:T.Cast(t.start.point),end:T.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});case"elbow":return new uS({points:t.route.points});default:at(t,"type")}}const nst=d1("arrow label size",(r,e)=>{r.fonts.trackFontsForShape(e);let t=0,n=0;const i=ep(r,e),s=mn(e.props.richText),o=Bx(r,s?ir("i"):e.props.richText),a=i.bounds,l=YR(e),{w:c,h:u}=r.textMeasure.measureHtml(o,{...Ei,fontFamily:Ll[e.props.font],fontSize:l,maxWidth:null});t=c,n=u;let d=!1;const h=Ns(r,e),f=uue(e),p=h.type==="elbow"?Math.max(h.elbow.A.arrowheadOffset+f,32)+Math.max(h.elbow.B.arrowheadOffset+f,32):64;if(a.width>a.height?(t=Math.max(Math.min(c,p),Math.min(a.width-p,c)),d=!0):t>16*l&&(t=16*l,d=!0),d){const{w:m,h:g}=r.textMeasure.measureHtml(o,{...Ei,fontFamily:Ll[e.props.font],fontSize:l,maxWidth:t});t=m,n=g}return new T(t,n).addScalar(HA*2*e.props.scale)},{areRecordsEqual:(r,e)=>{if(r.props===e.props)return!0;const t=Ume(r.props,e.props);return t.length===1&&t[0]==="labelPosition"}});function cue(r,e){return nst.get(r,e.id)??new T(0,0)}function uue(r){const e=_n[r.props.size];return(UDe+(e-_n.s)*2+(e===_n.xl?20:0))*r.props.scale}function rst(r,e,t){const n=ep(r,e),i=[],s=[new ts({children:[n],debugColor:"lime"})],o=cue(r,e),a=uue(e),l=a/n.length;let c,u;if(t.type==="elbow")i.push(t.start.point,t.end.point),c=V.FromCenter(t.start.point,o).expandBy(a),u=V.FromCenter(t.end.point,o).expandBy(a);else{const y=n.interpolateAlongEdge(l),S=n.interpolateAlongEdge(1-l);i.push(y,S),c=V.FromCenter(y,o),u=V.FromCenter(S,o)}const d=n.intersectPolygon(c.corners),h=n.intersectPolygon(u.corners),f=aU(t.start.point,d),p=aU(t.end.point,h);let m=f?n.uninterpolateAlongEdge(f):.5,g=p?n.uninterpolateAlongEdge(p):.5;m>g&&(m=.5,g=.5);for(const y of[...d,...h,...i])s.push(new yv({x:y.x-3,y:y.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return s.push(new Oy({points:c.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new Oy({points:u.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:m,end:g,dbg:s}}function H0(r,e){if(!(r.getEditingShapeId()===e.id)&&mn(e.props.richText)){const h=ep(r,e).interpolateAlongEdge(.5);return{box:V.FromCenter(h,new T(0,0)),debugGeom:[]}}const n=[],i=Ns(r,e),s={hasStartBinding:!!i.bindings.start,hasEndBinding:!!i.bindings.end,hasStartArrowhead:i.start.arrowhead!=="none",hasEndArrowhead:i.end.arrowhead!=="none"},o=rst(r,e,i);o.dbg&&n.push(...o.dbg);const a=ist(e,o,s),c=ep(r,e).interpolateAlongEdge(a),u=cue(r,e);return{box:V.FromCenter(c,u),debugGeom:n}}function ist(r,e,t){const{hasEndArrowhead:n,hasEndBinding:i,hasStartBinding:s,hasStartArrowhead:o}=t;return _e(r.props.labelPosition,o||s?e.start:0,n||i?e.end:1)}function aU(r,e){let t=null,n=-1/0;for(const i of e){const s=T.Dist2(r,i);s>n&&(t=i,n=s)}return t}function YR(r){return LDe[r.props.size]*r.props.scale}function due(r,e){const t=Ns(r,e);switch(t.type){case"straight":case"arc":return .5;case"elbow":{const n=t.route.midpointHandle,i=ep(r,e);return n&&i?i.uninterpolateAlongEdge(n.point):.5}default:at(t,"type")}}function hue(r,e){if(!r.isShapeOfType(e,"arrow"))return!1;const t=r.getPointInShapeSpace(e,r.inputs.currentPagePoint),n=r.getShapeGeometry(e).children[1];return n&&hi(t,n.vertices)}function sst(r,e,t){const n=e==="end"?r.end.point:r.start.point;let i;switch(r.type){case"straight":{const s=e==="end"?r.start.point:r.end.point,o=T.Dist(s,n),a=_e(o/5,t,t*3);i=T.Nudge(n,s,a);break}case"arc":{const s=Math.abs(r.bodyArc.length),o=_e(s/5,t,t*3),a=mwe(n,o,r.handleArc.center,r.handleArc.radius);i=e==="end"?r.handleArc.sweepFlag?a[0]:a[1]:r.handleArc.sweepFlag?a[1]:a[0];break}case"elbow":{const s=e==="end"?r.route.points[r.route.points.length-2]:r.route.points[1],o=T.ManhattanDist(s,n),a=_e(o/2,t,t*3);i=s?T.Nudge(n,s,a):n;break}default:at(r,"type")}return T.IsNaN(i)&&(i=n),{point:n,int:i}}function ost({point:r,int:e}){const t=T.RotWith(e,r,pt/6),n=T.RotWith(e,r,-pt/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y}`}function ast({point:r,int:e}){const t=T.RotWith(e,r,pt/6),n=T.RotWith(e,r,-pt/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function lst({point:r,int:e}){const t=T.Sub(e,r).div(2),n=T.Add(r,T.Rot(t,kn)),i=T.Sub(r,T.Rot(t,kn));return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function cst({point:r,int:e}){const t=T.Lrp(r,e,.45),n=T.Dist(t,r);return`M ${t.x-n},${t.y}
  a ${n},${n} 0 1,0 ${n*2},0
  a ${n},${n} 0 1,0 -${n*2},0 `}function ust({point:r,int:e}){const t=T.Lrp(r,e,.75),n=T.RotWith(t,r,pt/4),i=T.RotWith(t,r,-pt/4),s=T.Lrp(n,i,.5);return s.add(T.Sub(s,r)),`M ${s.x} ${s.y} L ${i.x} ${i.y} ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function dst({int:r,point:e}){const t=T.Lrp(e,r,.85),n=T.Sub(t,e).div(2),i=T.Add(e,T.Rot(n,kn)),s=T.Sub(e,T.Rot(n,kn)),o=T.Add(t,T.Rot(n,kn)),a=T.Sub(t,T.Rot(n,kn));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${s.x} ${s.y} Z`}function hst({int:r,point:e}){const t=T.Sub(r,e).div(2),n=T.Add(e,T.Rot(t,kn)),i=T.Sub(e,T.Rot(t,kn));return`M ${n.x} ${n.y} L ${i.x} ${i.y}`}function Lk(r,e,t){const n=e==="end"?r.end.arrowhead:r.start.arrowhead;if(n==="none")return;const i=sst(r,e,t);if(i){switch(n){case"bar":return hst(i);case"square":return dst(i);case"diamond":return ust(i);case"dot":return cst(i);case"inverted":return lst(i);case"arrow":return ost(i);case"triangle":return ast(i)}return""}}function fst({arrow:r}){const e=z(),t=F("elbow arrow grid",()=>{try{return WY(e,e.getShape(r.id),zn(e,r))}catch(o){console.error(o);return}},[e,r.id]);if(!t)return null;const n=V.Common([t.A.original,t.B.original]).expandBy(50),i=t.route?.name??"",s=t.route?.midpointHandle;return x.jsxs(x.Fragment,{children:[t.midX!==null&&x.jsx(ku,{a:{x:t.midX,y:n.minY},b:{x:t.midX,y:n.maxY},stroke:"red"}),t.midY!==null&&x.jsx(ku,{a:{x:n.minX,y:t.midY},b:{x:n.maxX,y:t.midY},stroke:"blue"}),s?.axis==="x"&&t.midXRange&&x.jsx(ku,{a:{x:t.midXRange.lo,y:s.point.y},b:{x:t.midXRange.hi,y:s.point.y},stroke:"red",strokeDasharray:"0 2"}),s?.axis==="y"&&t.midYRange&&x.jsx(ku,{a:{x:s.point.x,y:t.midYRange.lo},b:{x:s.point.x,y:t.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),x.jsx(ph,{box:t.A.original,stroke:"orange"}),x.jsx(ph,{box:t.A.expanded,stroke:"orange",strokeWidth:.5}),x.jsx(ph,{box:t.A.original.clone().expandBy(t.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),x.jsx(ph,{box:t.B.original,stroke:"lightskyblue"}),x.jsx(ph,{box:t.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),x.jsx(ph,{box:t.B.original.clone().expandBy(t.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),x.jsx(hl,{edge:t.A.edges.top,axis:"x",stroke:"orange"}),x.jsx(hl,{edge:t.B.edges.top,axis:"x",stroke:"lightskyblue"}),x.jsx(hl,{edge:t.A.edges.right,axis:"y",stroke:"orange"}),x.jsx(hl,{edge:t.B.edges.right,axis:"y",stroke:"lightskyblue"}),x.jsx(hl,{edge:t.A.edges.bottom,axis:"x",stroke:"orange"}),x.jsx(hl,{edge:t.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),x.jsx(hl,{edge:t.A.edges.left,axis:"y",stroke:"orange"}),x.jsx(hl,{edge:t.B.edges.left,axis:"y",stroke:"lightskyblue"}),t.route&&x.jsx(pst,{route:t.route.points,strokeWidth:10}),x.jsx("text",{x:n.minX+5,y:n.minY-3,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:i}),x.jsxs("text",{x:t.A.expanded.x,y:t.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",t.route&&`, ${t.route.aEdgePicking}`,t.A.isPoint&&", point"]}),x.jsxs("text",{x:t.B.expanded.x,y:t.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",t.route&&`, ${t.route.bEdgePicking}`,t.B.isPoint&&", point"]})]})}function ku({a:r,b:e,...t}){return x.jsx("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:r.x,y1:r.y,x2:e.x,y2:e.y,...t})}function pst({route:r,...e}){return x.jsx("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:r.map(t=>`${t.x},${t.y}`).join(" "),...e})}function hl({edge:r,axis:e,...t}){if(!r||r.expanded===null)return null;const n=i=>e==="x"?{x:i.y,y:i.x}:i;return x.jsxs("g",{children:[x.jsx(ku,{a:n({x:r.expanded,y:r.cross.min}),b:n({x:r.expanded,y:r.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...t}),x.jsx(ku,{a:n({x:r.expanded-4,y:r.cross.min}),b:n({x:r.expanded+4,y:r.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...t}),x.jsx(ku,{a:n({x:r.expanded-4,y:r.cross.max}),b:n({x:r.expanded+4,y:r.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...t})]})}function ph({box:r,...e}){return x.jsx("rect",{x:r.minX,y:r.minY,width:r.width,height:r.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...e})}const mst=new Ar;function gst(r){return mst.get(r,e=>{const t=q("current selected arrow shape",()=>{const i=e.getOnlySelectedShape();return!i||!e.isShapeOfType(i,"arrow")?null:i.id}),n=e.store.query.ids("shape",()=>{const i=t.get();return i?{type:{eq:"arrow"},id:{neq:i}}:{type:{eq:"arrow"}}});return q("elbow arrow snap lines",()=>{const i=new Map,s=e.getCurrentPageShapeIds(),o=e.getViewportPageBounds();for(const a of n.get()){if(!s.has(a))continue;const l=e.getShape(a);if(l?.type!=="arrow")continue;const c=e.getShapePageBounds(a);if(!c||!o.includes(c))continue;const u=zn(e,l),d=e.getShapePageTransform(a);if(!d)continue;const h=e.getShapeGeometry(a),f=d.applyToPoints(h.vertices);for(let p=1;p<f.length;p++){const m=f[p-1],g=f[p];let y=T.Angle(m,g);y<0&&(y+=Math.PI);let S=i.get(y);S||(S=new Set,i.set(y,S));const w=jg(m,y);S.add({perpDistance:w,startBoundShapeId:u.start?.toId,endBoundShapeId:u.end?.toId})}}return i})}).get()}function jg(r,e){const t=T.FromAngle(e).per();return T.Dpr(r,t)}class yst extends ac{static type="arrow";static props=AH;static migrations=$H;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:_n.s*3,m:_n.m*3,l:_n.l*3,xl:_n.xl*3},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:e=>e.inputs.altKey,shouldIgnoreTargets:e=>e.inputs.ctrlKey};canEdit(){return!0}canBind({toShapeType:e}){return e!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}hideInMinimap(){return!0}canBeLaidOut(e,t){if(t.type==="flip"){const n=zn(this.editor,e),{start:i,end:s}=n,{shapes:o=[]}=t;if(i&&!o.find(a=>a.id===i.toId)||s&&!o.find(a=>a.id===s.toId))return!1}return!0}getFontFaces(e){return mn(e.props.richText)?gn:N1(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",richText:ir(""),labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const t=this.editor.getEditingShapeId()===e.id,n=Ns(this.editor,e),i=[],s=n.type==="straight"?new Of({start:T.From(n.start.point),end:T.From(n.end.point)}):n.type==="arc"?new pG({center:T.Cast(n.handleArc.center),start:T.Cast(n.start.point),end:T.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag}):new uS({points:n.route.points});let o;if(t||!mn(e.props.richText)){const a=H0(this.editor,e);Yt.debugGeometry.get()&&i.push(...a.debugGeom),o=new ao({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new ts({children:[...o?[s,o]:[s],...i]})}getHandles(e){const t=Ns(this.editor,e),n=[{id:"start",type:"vertex",index:"a1",x:t.start.handle.x,y:t.start.handle.y},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y}];if(e.props.kind==="arc"&&(t.type==="straight"||t.type==="arc")&&n.push({id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y}),e.props.kind==="elbow"&&t.type==="elbow"&&t.route.midpointHandle){const i=this.editor.getShapePageTransform(e.id),s=i.applyToPoint(t.route.midpointHandle.segmentStart),o=i.applyToPoint(t.route.midpointHandle.segmentEnd);T.Dist(s,o)*this.editor.getZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&n.push({id:"middle",type:"vertex",index:"a2",x:t.route.midpointHandle.point.x,y:t.route.midpointHandle.point.y})}return n}getText(e){return Gl(this.editor,e.props.richText)}onHandleDrag(e,t){const n=t.handle.id;switch(n){case"middle":switch(e.props.kind){case"arc":return this.onArcMidpointHandleDrag(e,t);case"elbow":return this.onElbowMidpointHandleDrag(e,t);default:at(e.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(e,t,n);default:at(n)}}onArcMidpointHandleDrag(e,{handle:t}){const n=zn(this.editor,e),{start:i,end:s}=sf(this.editor,e,n),o=T.Sub(s,i),a=T.Per(o),l=T.Med(s,i),c=T.Sub(l,a),u=T.Add(l,a),d=T.NearestPointOnLineSegment(c,u,t,!1);let h=T.Dist(d,l);return T.Clockwise(d,s,l)&&(h*=-1),{id:e.id,type:e.type,props:{bend:h}}}onElbowMidpointHandleDrag(e,{handle:t}){const n=Ns(this.editor,e);if(n?.type!=="elbow")return;const i=this.editor.getShapePageTransform(e.id),s=i.applyToPoint(t),o=n.route.midpointHandle?.axis;if(!o)return;const a=jy[o],l=n.elbow[a.midRange];if(!l)return;let c=T.Angle(i.applyToPoint(a.v(0,0)),i.applyToPoint(a.v(0,1)));c<0&&(c+=Math.PI);const u=jg(s,c),d=jg(i.applyToPoint(a.v(l.lo,0)),c),h=jg(i.applyToPoint(a.v(l.hi,0)),c),f=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),p=jg(i.applyToPoint(a.v(Ye(l.lo,l.hi,.5),0)),c);let m=p,g=Math.abs(p-u);for(const[S,w]of gst(this.editor)){const{isParallel:b,isFlippedParallel:v}=wst(c,S);if(b||v)for(const C of w){const E=C.startBoundShapeId&&(C.startBoundShapeId===n.bindings.start?.toId||C.startBoundShapeId===n.bindings.end?.toId),M=C.endBoundShapeId&&(C.endBoundShapeId===n.bindings.start?.toId||C.endBoundShapeId===n.bindings.end?.toId);if(!E&&!M)continue;const P=v?-C.perpDistance:C.perpDistance,$=Math.abs(P-u);$<g&&(m=P,g=$)}}g>f&&(m=u);const y=_e(Iy(d,h,m),0,1);return{id:e.id,type:e.type,props:{elbowMidPoint:y}}}onTerminalHandleDrag(e,{handle:t,isPrecise:n},i){const s=zn(this.editor,e),o={id:e.id,type:"arrow",props:{}},a=s[i],c=s[i==="start"?"end":"start"],u=iC({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(e.id).applyToPoint(t),arrow:e,isPrecise:n,currentBinding:a,oppositeBinding:c});if(!u){fm(this.editor,e,i);const f=ms(new T(t.x,t.y),this.editor);return o.props[i]={x:f.x,y:f.y},o}const d={terminal:i,normalizedAnchor:u.normalizedAnchor,isPrecise:u.isPrecise,isExact:u.isExact,snap:u.snap};Up(this.editor,e,u.target.id,d);const h=zn(this.editor,e);return h.start&&h.end&&h.start.toId===h.end.toId&&T.Equals(h.start.props.normalizedAnchor,h.end.props.normalizedAnchor)&&Up(this.editor,e,h.end.toId,{...h.end.props,normalizedAnchor:{x:h.end.props.normalizedAnchor.x+.05,y:h.end.props.normalizedAnchor.y}}),o}onTranslateStart(e){const t=zn(this.editor,e);if(e.props.kind==="elbow"&&this.editor.getOnlySelectedShapeId()===e.id){const o=Ns(this.editor,e);if(!o)return;const a={id:e.id,type:"arrow",props:{}};return t.start&&(a.props.start={x:o.start.point.x,y:o.start.point.y},fm(this.editor,e,"start")),t.end&&(a.props.end={x:o.end.point.x,y:o.end.point.y},fm(this.editor,e,"end")),a}const n=sf(this.editor,e,t),i=this.editor.getShapePageTransform(e.id),s=this.editor.getSelectedShapeIds();if(!(t.start&&(s.includes(t.start.toId)||this.editor.isAncestorSelected(t.start.toId))||t.end&&(s.includes(t.end.toId)||this.editor.isAncestorSelected(t.end.toId)))){cU.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:tc(n,(o,a)=>{const l=t[o];return l?{binding:l,shapePosition:a,pagePosition:i.applyToPoint(a)}:null})}),t.start&&(zv({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),t.end&&zv({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const o of["start","end"]){const a=t[o];a&&this.editor.updateBinding({...a,props:{...a.props,isPrecise:!0}})}}}onTranslate(e,t){const n=cU.get(e);if(!n)return;const i=this.editor.getShapePageTransform(t.id),s=T.Sub(i.applyToPoint(t),n.pagePosition);for(const o of Object.values(n.terminalBindings)){if(!o)continue;const a=T.Add(o.pagePosition,T.Mul(s,.5)),l=this.editor.getShapeAtPoint(a,{hitInside:!0,hitFrameInside:!0,margin:0,filter:c=>!c.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:c,binding:"arrow"})});if(l?.id===o.binding.toId){const c=V.ZeroFix(this.editor.getShapeGeometry(l).bounds),u=this.editor.getPointInShapeSpace(l,a),d={x:(u.x-c.minX)/c.width,y:(u.y-c.minY)/c.height};Up(this.editor,t,l.id,{...o.binding.props,normalizedAnchor:d,isPrecise:!0})}else fm(this.editor,t,o.binding.props.terminal)}}_resizeInitialBindings=new Ar;onResize(e,t){const{scaleX:n,scaleY:i}=t,s=this._resizeInitialBindings.get(e,()=>zn(this.editor,e)),o=sf(this.editor,e,s),{start:a,end:l}=vn(e.props);let{bend:c}=e.props;s.start||(a.x=o.start.x*n,a.y=o.start.y*i),s.end||(l.x=o.end.x*n,l.y=o.end.y*i);const u=Math.abs(n),d=Math.abs(i),h=s?.start?T.From(s.start.props.normalizedAnchor):null,f=s?.end?T.From(s.end.props.normalizedAnchor):null;return n<0&&i>=0?(c!==0&&(c*=-1,c*=Math.max(u,d)),h&&(h.x=1-h.x),f&&(f.x=1-f.x)):n>=0&&i<0?(c!==0&&(c*=-1,c*=Math.max(u,d)),h&&(h.y=1-h.y),f&&(f.y=1-f.y)):n>=0&&i>=0?c!==0&&(c*=Math.max(u,d)):n<0&&i<0&&(c!==0&&(c*=Math.max(u,d)),h&&(h.x=1-h.x,h.y=1-h.y),f&&(f.x=1-f.x,f.y=1-f.y)),s.start&&h&&Up(this.editor,e,s.start.toId,{...s.start.props,normalizedAnchor:h.toJson()}),s.end&&f&&Up(this.editor,e,s.end.toId,{...s.end.props,normalizedAnchor:f.toJson()}),{props:{start:a,end:l,bend:c}}}onDoubleClickHandle(e,t){switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(e){const t=qs(),n=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly();if(!Ns(this.editor,e)?.isValid)return null;const o=H0(this.editor,e),a=e.id===this.editor.getOnlySelectedShapeId(),c=this.editor.getEditingShapeId()===e.id||!mn(e.props.richText);return x.jsxs(x.Fragment,{children:[x.jsxs(zl,{style:{minWidth:50,minHeight:50},children:[x.jsx(lU,{shape:e,shouldDisplayHandles:i&&n?.id===e.id}),e.props.kind==="elbow"&&Yt.debugElbowArrows.get()&&x.jsx(fst,{arrow:e})]}),c&&x.jsx(hC,{shapeId:e.id,type:"arrow",font:e.props.font,fontSize:YR(e),lineHeight:Ei.lineHeight,align:"middle",verticalAlign:"middle",labelColor:ot(t,e.props.labelColor,"solid"),richText:e.props.richText,textWidth:o.box.w-HA*2*e.props.scale,isSelected:a,padding:0,style:{transform:`translate(${o.box.center.x}px, ${o.box.center.y}px)`}})]})}indicator(e){const t=yS(e.id),n=ro(e.id+"_clip"),i=Ns(this.editor,e);if(!i)return null;const{start:s,end:o}=sf(this.editor,e,i?.bindings),a=this.editor.getShapeGeometry(e),l=a.bounds,c=mn(e.props.richText),u=t||!c?a.children[1]:null;if(T.Equals(s,o))return null;const d=_n[e.props.size]*e.props.scale,h=i.start.arrowhead&&Lk(i,"start",d),f=i.end.arrowhead&&Lk(i,"end",d),p=h&&i.start.arrowhead!=="arrow"||f&&i.end.arrowhead!=="arrow"||!!u,m=u?u.getBounds():new V(0,0,0,0);if(t&&u)return x.jsx("rect",{x:D(m.x),y:D(m.y),width:m.w,height:m.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale});const g=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),y=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow");return x.jsxs("g",{children:[p&&x.jsx("defs",{children:x.jsx(fue,{radius:3.5*e.props.scale,hasText:!c,bounds:l,labelBounds:m,as:g&&h?h:"",ae:y&&f?f:""})}),x.jsxs("g",{style:{clipPath:p?`url(#${n})`:void 0,WebkitClipPath:p?`url(#${n})`:void 0},children:[p&&x.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),lue(e,i,e.props.dash==="draw"?{style:"draw",randomSeed:e.id,strokeWidth:1,passes:1,offset:0,roundness:d*2,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),h&&x.jsx("path",{d:h}),f&&x.jsx("path",{d:f}),u&&x.jsx("rect",{x:D(m.x),y:D(m.y),width:m.w,height:m.h,rx:3.5,ry:3.5})]})}onEditStart(e){if(mn(e.props.richText)){const t=due(this.editor,e);this.editor.updateShape({id:e.id,type:e.type,props:{labelPosition:t}})}}toSvg(e,t){t.addExportDef(WD(e.props.fill));const n=sc(t),i=1/e.props.scale;return x.jsxs("g",{transform:`scale(${i})`,children:[x.jsx(lU,{shape:e,shouldDisplayHandles:!1}),x.jsx(fC,{fontSize:YR(e),font:e.props.font,align:"middle",verticalAlign:"middle",labelColor:ot(n,e.props.labelColor,"solid"),richText:e.props.richText,bounds:H0(this.editor,e).box.clone().expandBy(-HA*e.props.scale),padding:0,showTextOutline:!0})]})}getCanvasSvgDefs(){return[HD(),{key:"arrow:dot",component:xst},{key:"arrow:cross",component:Sst}]}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,scale:Ye(e.props.scale,t.props.scale,n),start:{x:Ye(e.props.start.x,t.props.start.x,n),y:Ye(e.props.start.y,t.props.start.y,n)},end:{x:Ye(e.props.end.x,t.props.end.x,n),y:Ye(e.props.end.y,t.props.end.y,n)},bend:Ye(e.props.bend,t.props.bend,n),labelPosition:Ye(e.props.labelPosition,t.props.labelPosition,n)}}}const lU=In(function({shape:e,shouldDisplayHandles:t}){const n=z(),i=qs(),s=Ns(n,e),o=F("force solid",()=>n.getZoomLevel()<.2,[n]),a=ro(e.id+"_clip"),l=ro("arrowhead-dot"),c=ro("arrowhead-cross"),u=yS(e.id),d=n.getShapeGeometry(e);if(!d)return null;const h=V.ZeroFix(d.bounds),f=zn(n,e),p=mn(e.props.richText);if(!s?.isValid)return null;const m=_n[e.props.size]*e.props.scale,g=s.start.arrowhead&&Lk(s,"start",m),y=s.end.arrowhead&&Lk(s,"end",m);let S=null;t&&(f.start||f.end)&&(S=tst(s,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/n.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:f.start?f.start.props.isExact?"":f.start.props.isPrecise?`url(#${c})`:`url(#${l})`:"",markerEnd:f.end?f.end.props.isExact?"":f.end.props.isPrecise?`url(#${c})`:`url(#${l})`:"",opacity:.16}}));const w=H0(n,e),b=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),v=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return x.jsxs(x.Fragment,{children:[x.jsx("defs",{children:x.jsx("clipPath",{id:a,children:x.jsx(fue,{radius:3.5*e.props.scale,hasText:u||!p,bounds:h,labelBounds:w.box,as:b&&g?g:"",ae:v&&y?y:""})})}),x.jsxs("g",{fill:"none",stroke:ot(i,e.props.color,"solid"),strokeWidth:m,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[S,x.jsxs("g",{style:{clipPath:`url(#${a})`,WebkitClipPath:`url(#${a})`},children:[x.jsx("rect",{x:D(h.minX-100),y:D(h.minY-100),width:D(h.width+200),height:D(h.height+200),opacity:0}),lue(e,s,{style:e.props.dash,strokeWidth:m,forceSolid:o,randomSeed:e.id})]}),g&&b&&e.props.fill!=="none"&&x.jsx(Lx,{theme:i,d:g,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),y&&v&&e.props.fill!=="none"&&x.jsx(Lx,{theme:i,d:y,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),g&&x.jsx("path",{d:g}),y&&x.jsx("path",{d:y})]})]})});function fue({radius:r,hasText:e,bounds:t,labelBounds:n,as:i,ae:s}){const o=k.useMemo(()=>{const a=new dt;return a.moveTo(t.left-100,t.top-100).lineTo(t.right+100,t.top-100).lineTo(t.right+100,t.bottom+100).lineTo(t.left-100,t.bottom+100).close(),e&&a.moveTo(n.left,n.top+r).lineTo(n.left,n.bottom-r).circularArcTo(r,!1,!1,n.left+r,n.bottom).lineTo(n.right-r,n.bottom).circularArcTo(r,!1,!1,n.right,n.bottom-r).lineTo(n.right,n.top+r).circularArcTo(r,!1,!1,n.right-r,n.top).lineTo(n.left+r,n.top).circularArcTo(r,!1,!1,n.left,n.top+r).close(),a.toD()},[r,e,t.bottom,t.left,t.right,t.top,n.bottom,n.left,n.right,n.top]);return x.jsx("path",{d:`${o}${i}${s}`})}const cU=new WeakMap;function xst(){const r=ro("arrowhead-dot");return x.jsx("marker",{id:r,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:x.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Sst(){const r=ro("arrowhead-cross");return x.jsxs("marker",{id:r,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[x.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),x.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}function wst(r,e,t=1e-4){const n=Math.abs(r-e),i=n<t,s=Math.abs(n-Math.PI)<t,o=Math.abs(n-At)<t;return{isParallel:i||o,isFlippedParallel:s}}const uU="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function tp({url:r}){const e=z(),t=F("zoomLevel",()=>e.getZoomLevel()<.32,[e]),n=k.useCallback(i=>{e.inputs.shiftKey||e.markEventAsHandled(i)},[e]);return x.jsx("a",{className:oe("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:r,target:"_blank",rel:"noopener noreferrer",onPointerDown:n,onPointerUp:n,title:r,draggable:!1,children:x.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${uU}") center 100% / 100% no-repeat`,WebkitMask:`url("${uU}") center 100% / 100% no-repeat`}})})}const dU="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",bst=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Uk(r){return bst.map(t=>{const{offsetX:n,offsetY:i,blur:s,spread:o,color:a}=t,l=new T(n,i),{x:c,y:u}=l.rot(-r);return`${c}px ${u}px ${s}px ${o}px ${a}`}).join(", ")}class vst extends mp{static type="bookmark";static props=FH;static migrations=zH;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getAriaDescriptor(e){const t=e.props.assetId?this.editor.getAsset(e.props.assetId):null;if(t?.props.title)return Jce(t.props.title)+(t.props.description?", "+t.props.description:"")}getDefaultProps(){return{url:"",w:zy,h:r_,assetId:null}}component(e){const{assetId:t,url:n,h:i}=e.props,s=this.editor.getShapePageTransform(e).rotation();return x.jsx(mue,{assetId:t,url:n,h:i,rotation:s})}indicator(e){return x.jsx(pue,{w:e.props.w,h:e.props.h})}onBeforeCreate(e){return DL(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(ps.isValid(t.props.url))fMe(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return DL(this.editor,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n)}}}function pue({w:r,h:e}){return x.jsx("rect",{width:D(r),height:D(e),rx:"6",ry:"6"})}function mue({assetId:r,rotation:e,url:t,h:n,showImageContainer:i=!0}){const s=z(),o=r?s.getAsset(r):null,a=!!dS()&&ht.isSafari,l=hMe(t),[c,u]=k.useState(!0),d=()=>u(!1),h=k.useCallback(f=>{s.inputs.shiftKey||s.markEventAsHandled(f)},[s]);return x.jsx(Pl,{children:x.jsxs("div",{className:oe("tl-bookmark__container",a&&"tl-bookmark__container--safariExport"),style:{boxShadow:a?void 0:Uk(e),maxHeight:n},children:[i&&(!o||o.props.image)&&x.jsxs("div",{className:"tl-bookmark__image_container",children:[o?x.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:o?.props.image,alt:o?.props.title||""}):x.jsx("div",{className:"tl-bookmark__placeholder"}),o?.props.image&&x.jsx(tp,{url:t})]}),x.jsxs("div",{className:"tl-bookmark__copy_container",children:[o?.props.title?x.jsx("a",{className:"tl-bookmark__link",href:t||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:h,onPointerUp:h,children:x.jsx("h2",{className:"tl-bookmark__heading",children:Jce(o.props.title)})}):null,o?.props.description&&o?.props.image?x.jsx("p",{className:"tl-bookmark__description",children:o.props.description}):null,x.jsxs("a",{className:"tl-bookmark__link",href:t||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:h,onPointerUp:h,children:[c&&o?.props.favicon?x.jsx("img",{className:"tl-bookmark__favicon",src:o?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:d,alt:`favicon of ${l}`}):x.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${dU}") center 100% / 100% no-repeat`,WebkitMask:`url("${dU}") center 100% / 100% no-repeat`}}),x.jsx("span",{children:l})]})]})]})})}function Ux(r,e=!1){const t=r.length;if(t<2)return"";let n=r[0].point,i=r[1].point;if(t===2)return`M${Zn(n)}L${Zn(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)n=r[o].point,i=r[o+1].point,s+=Ji(n,i);return e?`M${Ji(r[0].point,r[1].point)}Q${Zn(r[1].point)}${Ji(r[1].point,r[2].point)}T${s}${Ji(r[t-1].point,r[0].point)}${Ji(r[0].point,r[1].point)}Z`:`M${Zn(r[0].point)}Q${Zn(r[1].point)}${Ji(r[1].point,r[2].point)}${r.length>3?"T":""}${s}L${Zn(r[t-1].point)}`}function kst(r,e={}){const{start:t={},end:n={}}=e,{cap:i=!0}=t,{cap:s=!0}=n;se(!t.taper&&!n.taper,"cap taper not supported here"),se(!t.easing&&!n.easing,"cap easing not supported here"),se(i&&s,"cap must be true");const o=jl(r,e);L_(o,e);const a=Cst(o);let l="";for(const c of a)l+=Est(c,e);return l}function Cst(r){if(r.length<=2)return[r];const e=[];let t=[r[0]],n=T.Sub(r[1].point,r[0].point).uni(),i,s,o,a,l;for(let c=1,u=r.length;c<u-1;c++){if(o=r[c-1],a=r[c],l=r[c+1],i=T.Sub(l.point,a.point).uni(),s=T.Dpr(n,i),n=i,s<-.8){const d={...a,point:a.input};t.push(d),e.push(dP(t)),t=[d];continue}if(t.push(a),!(s>.7)&&(T.Dist2(o.point,a.point)+T.Dist2(a.point,l.point))/((o.radius+a.radius+l.radius)/3)**2<1.5){t.push(a),e.push(dP(t)),t=[a];continue}}return t.push(r[r.length-1]),e.push(dP(t)),e}function dP(r){const e=r[0];let t;for(;r.length>2&&(t=r[1],T.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)r.splice(1,1);const n=r[r.length-1];let i;for(;r.length>2&&(i=r[r.length-2],T.Dist2(n.point,i.point)<((n.radius+i.radius)/2*.5)**2);)r.splice(r.length-2,1);return r.length>1&&(r[0]={...r[0],vector:T.Sub(r[0].point,r[1].point).uni()},r[r.length-1]={...r[r.length-1],vector:T.Sub(r[r.length-2].point,r[r.length-1].point).uni()}),r}function Tst(r,e,t){return"M "+r+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function Est(r,e={}){if(r.length===0)return"";if(r.length===1)return Tst(r[0].point.x,r[0].point.y,r[0].radius);const{left:t,right:n}=ZQ(r,e);n.reverse();let i=`M${Zn(t[0])}T`;for(let s=1;s<t.length;s++)i+=Ji(t[s-1],t[s]);{const s=r[r.length-1],o=s.radius,a=s.vector.clone().per().neg(),l=T.Add(s.point,T.Mul(a,o)),c=T.Add(s.point,T.Mul(a,-o));i+=`${Zn(l)}A${D(o)},${D(o)} 0 0 1 ${Zn(c)}T`}for(let s=1;s<n.length;s++)i+=Ji(n[s-1],n[s]);{const s=r[0],o=s.radius,a=s.vector.clone().per(),l=T.Add(s.point,T.Mul(a,o)),c=T.Add(s.point,T.Mul(a,-o));i+=`${Zn(l)}A${D(o)},${D(o)} 0 0 1 ${Zn(c)}Z`}return i}const gue=(r,e,t)=>{const n=[],i=[];r.forEach(c=>n.push(...c.points)),e.forEach(c=>i.push(...c.points));const s=Math.max(n.length,i.length),o=[],a=[];for(let c=0;c<s;c++)o.push(n[c]||n[n.length-1]),a.push(i[c]||i[i.length-1]);return[{type:"free",points:o.map((c,u)=>{let d=.5;return a[u].z!==void 0&&c.z!==void 0&&(d=Ye(c.z,a[u].z,t)),{x:Ye(c.x,a[u].x,t),y:Ye(c.y,a[u].y,t),z:d}})}]},Mst=r=>r*.65+TSe(r*pt/2)*.35,Ist=r=>({size:r,thinning:.5,streamline:oo(r,[9,16],[.64,.74],!0),smoothing:.62,easing:gr.easeOutSine,simulatePressure:!0}),Pst=r=>({size:1+r*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Mst}),hU=r=>({size:r,thinning:0,streamline:oo(r,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:gr.linear}),Ast=r=>({size:r,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:gr.linear});function KD({strokeWidth:r,showAsComplete:e}){return{size:1+r,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:gr.easeOutSine,last:e}}function XR(r,e,t,n){const i=r.isComplete||t;return n?r.isPen?{...Ast(e),last:i}:{...hU(e),last:i}:r.dash==="draw"?r.isPen?{...Pst(e),last:i}:{...Ist(e),last:i}:{...hU(e),last:i}}function np(r){const e=[];for(const t of r)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(T.Cast));else{const n=Math.max(4,Math.floor(T.Dist(t.points[0],t.points[1])/16));e.push(...T.PointsBetween(t.points[0],t.points[1],n))}return e}function $st(r,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[r.props.dash]}class Rst extends ac{static type="draw";static props=jH;static migrations=LH;options={maxPointsPerShape:600};hideResizeHandles(e){return hP(e)}hideRotateHandle(e){return hP(e)}hideSelectionBoundsFg(e){return hP(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=np(e.props.segments),n=(_n[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const s=V.FromPoints(t);if(s.width<n*2&&s.height<n*2)return new yv({x:-n,y:-n,radius:n,isFilled:!0})}const i=jl(t,XR(e.props,n,e.props.isPen,!0)).map(s=>s.point);return e.props.isClosed&&i.length>2?new Oy({points:i,isFilled:e.props.fill!=="none"}):i.length===1?new yv({x:-n,y:-n,radius:n,isFilled:!0}):new uS({points:i})}component(e){return x.jsx(zl,{children:x.jsx(fU,{shape:e})})}indicator(e){const t=np(e.props.segments);let n=(_n[e.props.size]+1)*e.props.scale;!F("force solid",()=>{const c=this.editor.getZoomLevel();return c<.5&&c<1.5/n},[this.editor,n])&&!e.props.isPen&&e.props.dash==="draw"&&t.length===1&&(n+=Dd(e.id)()*(n/6));const s=e.props.isComplete||Xn(e.props.segments)?.type==="straight",o=XR(e.props,n,s,!0),a=jl(t,o),l=a.length>1?Ux(a,e.props.isClosed):yue(t[0],n);return x.jsx("path",{d:l})}toSvg(e,t){t.addExportDef(WD(e.props.fill));const n=1/e.props.scale;return x.jsx("g",{transform:`scale(${n})`,children:x.jsx(fU,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[HD()]}onResize(e,t){const{scaleX:n,scaleY:i}=t,s=[];for(const o of e.props.segments)s.push({...o,points:o.points.map(({x:a,y:l,z:c})=>({x:Zs(n*a),y:Zs(i*l),z:c}))});return{props:{segments:s}}}expandSelectionOutlinePx(e){const t=e.props.dash==="draw"?1.6:1;return _n[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,segments:gue(e.props.segments,t.props.segments,n),scale:Ye(e.props.scale,t.props.scale,n)}}}function yue(r,e){const t=(e+1)*.5;return`M ${r.x} ${r.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function hP(r){return r.props.segments.length===1&&r.props.segments[0].points.length<2}function fU({shape:r,zoomOverride:e}){const t=qs(),n=z(),i=np(r.props.segments),s=r.props.isComplete||Xn(r.props.segments)?.type==="straight";let o=(_n[r.props.size]+1)*r.props.scale;const a=F("force solid",()=>{const f=e??n.getZoomLevel();return f<.5&&f<1.5/o},[n,o,e]),l=F("dot adjustment",()=>(e??n.getZoomLevel())<.2?0:.1,[n,e]);!a&&!r.props.isPen&&r.props.dash==="draw"&&i.length===1&&(o+=Dd(r.id)()*(o/6));const c=XR(r.props,o,s,a);if(!a&&r.props.dash==="draw")return x.jsxs(x.Fragment,{children:[r.props.isClosed&&r.props.fill&&i.length>1?x.jsx(Lx,{d:Ux(jl(i,c),r.props.isClosed),theme:t,color:r.props.color,fill:r.props.isClosed?r.props.fill:"none",scale:r.props.scale}):null,x.jsx("path",{d:kst(i,c),strokeLinecap:"round",fill:ot(t,r.props.color,"solid")})]});const u=jl(i,c),d=u.length<2,h=d?yue(i[0],0):Ux(u,r.props.isClosed);return x.jsxs(x.Fragment,{children:[x.jsx(Lx,{d:h,theme:t,color:r.props.color,fill:d||r.props.isClosed?r.props.fill:"none",scale:r.props.scale}),x.jsx("path",{d:h,strokeLinecap:"round",fill:d?ot(t,r.props.color,"solid"):"none",stroke:ot(t,r.props.color,"solid"),strokeWidth:o,strokeDasharray:d?"none":$st(r,o,l),strokeDashoffset:"0"})]})}function Ost(r){if(typeof r!="string")throw new TypeError("Expected a string");return r.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Nst(r,e){const t=je(e);if(!t)return;const n=t.host.replace("www.","");for(const i of r)if(xue(i.hostnames,n)){const s=i.fromEmbedUrl(e);if(s)return{definition:i,url:s,embedUrl:e}}}const _st=r=>r.split("*").map(e=>Ost(e)).join(".+"),xue=(r,e)=>!!r.find(t=>{const n=new RegExp(_st(t));return e.match(n)});function Dst(r,e){const t=je(e);if(!t)return;const n=t.host.replace("www.","");for(const i of r)if(xue(i.hostnames,n)){const s=i.toEmbedUrl(e);if(s)return{definition:i,embedUrl:s,url:e}}}function Fst(r,e){try{return Dst(r,e)??Nst(r,e)}catch{return}}const zst=r=>Object.entries(r).filter(([e,t])=>t).map(([e])=>e).join(" ");class Ef extends mp{static type="embed";static props=UH;static migrations=WH;static embedDefinitions=s_;static setEmbedDefinitions(e){Ef.embedDefinitions=e}getEmbedDefinitions(){return Ef.embedDefinitions}getEmbedDefinition(e){return Fst(Ef.embedDefinitions,e)}getText(e){return e.props.url}getAriaDescriptor(e){return this.getEmbedDefinition(e.props.url)?.definition.title}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){return!!this.getEmbedDefinition(e.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}getGeometry(e){return this.getEmbedDefinition(e.props.url)?.definition?super.getGeometry(e):new ao({width:zy,height:dA,isFilled:!0})}isAspectRatioLocked(e){return this.getEmbedDefinition(e.props.url)?.definition.isAspectRatioLocked??!1}onResize(e,t){const n=this.isAspectRatioLocked(e),i=this.getEmbedDefinition(e.props.url);let s=i?.definition.minWidth??200,o=i?.definition.minHeight??200;if(n){const a=e.props.w/e.props.h;a>1?s*=a:o/=a}return R1(e,t,{minWidth:s,minHeight:o})}component(e){const t=dS(),{w:n,h:i,url:s}=e.props,o=yS(e.id),a=this.getEmbedDefinition(s),l=F("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:p}=this.editor.getCurrentPageState();if(f&&p!==f){const m=this.editor.getShape(f);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation();if(t)return x.jsx(Pl,{className:"tl-embed-container",id:e.id,children:x.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:Uk(c),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor??"var(--tl-color-background)",width:n,height:i}})});const u=o||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&a?.definition.type==="tldraw")return null;if(a?.definition.type==="github_gist"){const f=a.url.split("/").pop();if(!f)throw Error("No gist id!");return x.jsx(Pl,{className:"tl-embed-container",id:e.id,children:x.jsx(Bst,{id:f,width:D(n),height:D(i),isInteractive:u,pageRotation:c})})}const h=zst({...wMe,...a?.definition.overridePermissions??{}});return x.jsx(Pl,{className:"tl-embed-container",id:e.id,children:a?.definition?x.jsx("iframe",{className:"tl-embed",sandbox:h,src:a.embedUrl,width:D(n),height:D(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:o?0:-1,style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:Uk(c),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor}}):x.jsx(mue,{url:s,h:i,rotation:c,assetId:null,showImageContainer:!1})})}indicator(e){const t=this.getEmbedDefinition(e.props.url);return t?.definition?x.jsx("rect",{width:D(e.props.w),height:D(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8}):x.jsx(pue,{w:zy,h:dA})}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n)}}}function Bst({id:r,isInteractive:e,width:t,height:n,style:i,pageRotation:s}){if(!r.match(/^[0-9a-f]+$/))throw Error("No gist id!");return x.jsx("iframe",{className:"tl-embed",draggable:!1,width:D(t),height:D(n),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:e?0:-1,style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:Uk(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${r}.js`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function jst(r){return r.replace(/\s/g,"")}function Lst(r,e,t){const{padding:n=0}=t;if(e.length===0)return null;const i=V.From(e[0].box);for(const{box:c}of e)i.union(c);const s=n+(t.offsetX??0),o=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?n:t.verticalTextAlign==="end"?t.height-n-i.height:(Math.ceil(t.height)-i.height)/2);let a=null;const l=[];for(const{text:c,box:u}of e)a!==null&&u.y>a&&l.push(x.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:u.y+o,children:`
`},l.length)),l.push(x.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+s,y:u.y+o,unicodeBidi:"plaintext",children:jst(c)},l.length)),a=u.y;return x.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:l})}function ZR(r,e){const i=((cv(r.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(i)}const pU=new WeakMap;function mU(r,e,t){let n=pU.get(e.props);if(!n){const i=JD(e.props.name,"Frame")+"",s=r.textMeasure.measureTextSpans(i,t),o=s[0],a=Xn(s);n=a.box.w+a.box.x-o.box.x,pU.set(e.props,n)}return new V(0,-t.height,n,t.height)}function gU(r,e){return{fontSize:12,fontFamily:e?"Arial":"Inter, sans-serif",textAlign:"start",width:r,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function Sue(r,e,t){const n=t?"":"px",i=t?"":"deg";let s;switch(e){case 0:s="";break;case 3:s=`translate(${D(r.props.w)}${n}, 0${n}) rotate(90${i})`;break;case 2:s=`translate(${D(r.props.w)}${n}, ${D(r.props.h)}${n}) rotate(180${i})`;break;case 1:s=`translate(0${n}, ${D(r.props.h)}${n}) rotate(270${i})`;break;default:throw Error("labelSide out of bounds")}return s}const Ust=k.forwardRef(({id:r,name:e,isEditing:t},n)=>{const i=z(),s=Jn(),o=F("isCoarsePointer",()=>i.getInstanceState().isCoarsePointer,[i]),a=s<an.TABLET_SM&&o,l=k.useRef(!1),c=ie(),u=k.useCallback(m=>{t&&i.markEventAsHandled(m)},[i,t]),d=k.useCallback(m=>{m.key==="Enter"&&!m.nativeEvent.isComposing&&(i.markEventAsHandled(m),m.currentTarget.blur(),i.setEditingShape(null))},[i]),h=k.useCallback(m=>{const g=i.getShape(r);!g||g.props.name===m||i.updateShapes([{id:r,type:"frame",props:{name:m}}])},[r,i]),f=k.useCallback(m=>{h(m.currentTarget.value)},[h]),p=k.useCallback(m=>{h(m.currentTarget.value)},[h]);return k.useEffect(()=>{if(!t){l.current=!1;return}if(t&&a&&!l.current){l.current=!0;const g=i.getShape(r)?.props.name??"",y=window.prompt(c("action.rename"),g);l.current=!1,y!==null&&h(y),i.setEditingShape(null)}},[t,a,r,c,h,i]),x.jsxs("div",{className:`tl-frame-label ${t&&!a?"tl-frame-label__editing":""}`,children:[x.jsx("input",{className:"tl-frame-name-input",ref:n,disabled:!t||a,readOnly:!t||a,style:{display:t?void 0:"none"},value:e,autoFocus:!a,onKeyDown:d,onBlur:f,onChange:p,onPointerDown:u,draggable:!1}),JD(e,"Frame")+""]})}),Wst=k.memo(function({id:e,name:t,width:n,height:i,fill:s,stroke:o,color:a,offsetX:l,showColors:c}){const u=z(),{side:d,translation:h}=F("shape rotation",()=>{const m=u.getShape(e);if(!m)return{side:0,translation:"translate(0, 0)"};const g=ZR(u,m);return{side:g,translation:Sue(m,g,!1)}},[u,l,e]),f=k.useRef(null),p=yS(e);return k.useEffect(()=>{const m=f.current;m&&p&&(m.focus(),m.select())},[f,p]),x.jsx("div",{className:"tl-frame-heading",style:{overflow:p?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(d===0||d===2?n:i)}px + ${c?"0px":"var(--tl-frame-offset-width)"})`,bottom:"100%",transform:`${h} scale(var(--tl-scale)) translateX(${l}px)`},children:x.jsx("div",{className:"tl-frame-heading-hit-area",style:{color:a,backgroundColor:s,boxShadow:`inset 0px 0px 0px 1px ${o}`},children:x.jsx(Ust,{ref:f,id:e,name:t,isEditing:p})})})}),Hst=12,qst=32,Kst=-7,Jst=4;function JD(r,e){return r.match(/^\s*$/)?e:r}class Vst extends mp{static type="frame";static props=HH;static migrations=qH;options={showColors:!1};static configure(e){const t=super.configure.call(this,e);return e.showColors&&(t.props={...t.props,color:Oi}),t}canEdit(){return!0}canResize(){return!0}canResizeChildren(){return!1}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(e){return e.props.name}getGeometry(e){const{editor:t}=this,n=t.getZoomLevel(),i=ZR(t,e),s=i%2===1,o=s?e.props.h:e.props.w,a=gU(o,!1),l=mU(t,e,a),c=this.options.showColors,u=Hst/n,d=qst/n,h=o+(c?1:u),f=l.w/n,p=l.h/n,m=_e(f+u,d,h),g=(c?-1:Kst)/n,y=Jst/n,S=s?p:m,w=s?m:p;let b,v;switch(i){case 0:{b=g,v=-(p+y);break}case 1:{b=-(p+y),v=e.props.h-(g+m);break}case 2:{b=e.props.w-(g+m),v=e.props.h+y;break}case 3:{b=e.props.w+y,v=g;break}}return new ts({children:[new ao({width:e.props.w,height:e.props.h,isFilled:!1}),new ao({x:b,y:v,width:S,height:w,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getText(e){return e.props.name}component(e){const t=qs(),n=F("is creating this shape",()=>{const d=this.editor.getStateDescendant("select.resizing");if(!d||!d.getIsActive())return!1;const h=d?.info;return h?h.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]),i=this.options.showColors,s=i?e.props.color:"black",o=ot(t,s,"frameFill"),a=ot(t,s,"frameStroke"),l=i?ot(t,s,"frameHeadingStroke"):t.background,c=i?ot(t,s,"frameHeadingFill"):t.background,u=ot(t,s,"frameText");return x.jsxs(x.Fragment,{children:[x.jsx(zl,{children:x.jsx("rect",{className:oe("tl-frame__body",{"tl-frame__creating":n}),fill:o,stroke:a,style:{width:`calc(${e.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${e.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),n?null:x.jsx(Wst,{id:e.id,name:e.props.name,fill:c,stroke:l,color:u,width:e.props.w,height:e.props.h,offsetX:i?-1:-7,showColors:this.options.showColors})]})}toSvg(e,t){const n=sc({isDarkMode:t.isDarkMode}),i=ZR(this.editor,e),o=i%2===1?e.props.h:e.props.w,a=Sue(e,i,!0),l=gU(o-12,!0),c=JD(e.props.name,"Frame")+"",u=mU(this.editor,e,l),d=this.editor.textMeasure.measureTextSpans(c,l),h=Lst(this.editor,d,l),f=this.options.showColors,p=f?e.props.color:"black",m=ot(n,p,"frameFill"),g=ot(n,p,"frameStroke"),y=f?ot(n,p,"frameHeadingStroke"):n.background,S=f?ot(n,p,"frameHeadingFill"):n.background,w=ot(n,p,"frameText");return x.jsxs(x.Fragment,{children:[x.jsx("rect",{width:e.props.w,height:e.props.h,fill:m,stroke:g,strokeWidth:1,x:0,rx:0,ry:0}),x.jsxs("g",{fill:w,transform:a,children:[x.jsx("rect",{x:u.x-(f?0:6),y:u.y-6,width:Math.min(o,u.width+12),height:u.height,fill:S,stroke:y,rx:4,ry:4}),x.jsx("g",{transform:`translate(${f?8:0}, 4)`,children:h})]})]})}indicator(e){return x.jsx("rect",{width:D(e.props.w),height:D(e.props.h),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}getClipPath(e){return this.editor.getShapeGeometry(e.id).vertices}canReceiveNewChildrenOfType(e){return!e.isLocked}onResize(e,t){return R1(e,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n)}}onDoubleClickEdge(e,t){if(t.target!=="selection")return;const{handle:n}=t;if(!n)return;const i=n==="left"||n==="right",s=n==="top"||n==="bottom",o=this.editor.getSortedChildIdsForParent(e.id),a=Re(o.map(h=>this.editor.getShape(h)));if(!a.length)return;const{dx:l,dy:c,w:u,h:d}=CY(a,this.editor,{padding:10});return this.editor.run(()=>{const h=o.map(f=>{const p=this.editor.getShape(f);return{id:p.id,type:p.type,x:i?p.x+l:p.x,y:s?p.y+c:p.y}});this.editor.updateShapes(h)}),{id:e.id,type:e.type,props:{w:i?u:e.props.w,h:s?d:e.props.h}}}onDoubleClickCorner(e){return TY(this.editor,e.id,{padding:10}),{id:e.id,type:e.type}}onDragShapesIn(e,t,{initialParentIds:n,initialIndices:i}){const{editor:s}=this;if(t.every(l=>l.parentId===e.id))return;let o=!1;const a=t.filter(l=>e.id===n.get(l.id));if(a.length>0){const l=Re(s.getSortedChildIdsForParent(e).map(c=>s.getShape(c)));a.every(c=>!l.find(u=>u.index===c.index))&&(o=!0)}if(!t.some(l=>s.hasAncestor(e,l.id))&&(s.reparentShapes(t,e.id),o))for(const l of a)s.updateShape({id:l.id,type:l.type,index:i.get(l.id)})}onDragShapesOut(e,t,n){const{editor:i}=this;n.nextDraggingOverShapeId||i.reparentShapes(t.filter(s=>s.parentId===e.id&&this.canReceiveNewChildrenOfType(s)),i.getCurrentPageId())}}const Gst=new Ar;function QR(r){return Gst.get(r,Yst)}function Yst(r){const e=Math.max(1,r.props.w),t=Math.max(1,r.props.h+r.props.growY),n=e/2,i=t/2,s=us[r.props.size]*r.props.scale,o=r.props.fill!=="none";switch(r.props.geo){case"arrow-down":{const a=e*.16,l=Math.min(e,t)*.38;return new dt().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e-a,t-l).lineTo(e,t-l).lineTo(e/2,t).lineTo(0,t-l).lineTo(a,t-l).close()}case"arrow-left":{const a=Math.min(e,t)*.38,l=t*.16;return new dt().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(a,l).lineTo(e,l).lineTo(e,t-l).lineTo(a,t-l).lineTo(a,t).lineTo(0,t/2).close()}case"arrow-right":{const a=Math.min(e,t)*.38,l=t*.16;return new dt().moveTo(0,l,{geometry:{isFilled:o}}).lineTo(e-a,l).lineTo(e-a,0).lineTo(e,t/2).lineTo(e-a,t).lineTo(e-a,t-l).lineTo(0,t-l).close()}case"arrow-up":{const a=e*.16,l=Math.min(e,t)*.38;return new dt().moveTo(e/2,0,{geometry:{isFilled:o}}).lineTo(e,l).lineTo(e-a,l).lineTo(e-a,t).lineTo(a,t).lineTo(a,l).lineTo(0,l).close()}case"check-box":{const a=Math.min(e,t)*.82,l=(e-a)/2,c=(t-a)/2;return new dt().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e,t).lineTo(0,t).close().moveTo(_e(l+a*.25,0,e),_e(c+a*.52,0,t),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo(_e(l+a*.45,0,e),_e(c+a*.82,0,t)).lineTo(_e(l+a*.82,0,e),_e(c+a*.22,0,t),{offset:0})}case"diamond":return new dt().moveTo(n,0,{geometry:{isFilled:o}}).lineTo(e,i).lineTo(n,t).lineTo(0,i).close();case"ellipse":return new dt().moveTo(0,i,{geometry:{isFilled:o}}).arcTo(n,i,!1,!0,0,e,i).arcTo(n,i,!1,!0,0,0,i).close();case"heart":{const a=e/4,l=t/4;return new dt().moveTo(n,t,{geometry:{isFilled:o}}).cubicBezierTo(0,l*1.2,a*1.5,l*3,0,l*2.5).cubicBezierTo(n,l*.9,0,-l*.32,a*1.85,-l*.32).cubicBezierTo(e,l*1.2,a*2.15,-l*.32,e,-l*.32).cubicBezierTo(n,t,e,l*2.5,a*2.5,l*3).close()}case"hexagon":return dt.lineThroughPoints(NE(e,t,6),{geometry:{isFilled:o}}).close();case"octagon":return dt.lineThroughPoints(NE(e,t,8),{geometry:{isFilled:o}}).close();case"oval":return Zst(e,t,o);case"pentagon":return dt.lineThroughPoints(NE(e,t,5),{geometry:{isFilled:o}}).close();case"rectangle":return new dt().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e,t).lineTo(0,t).close();case"rhombus":{const a=Math.min(e*.38,t*.38);return new dt().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e,0).lineTo(e-a,t).lineTo(0,t).close()}case"rhombus-2":{const a=Math.min(e*.38,t*.38);return new dt().moveTo(0,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e,t).lineTo(a,t).close()}case"star":return Qst(e,t,o);case"trapezoid":{const a=Math.min(e*.38,t*.38);return new dt().moveTo(a,0,{geometry:{isFilled:o}}).lineTo(e-a,0).lineTo(e,t).lineTo(0,t).close()}case"triangle":return new dt().moveTo(n,0,{geometry:{isFilled:o}}).lineTo(e,t).lineTo(0,t).close();case"x-box":return Xst(e,t,s,r.props.dash,o);case"cloud":return rot(e,t,r.id,r.props.size,r.props.scale,o);default:at(r.props.geo)}}function Xst(r,e,t,n,i){const s=r/2,o=e/2,a=new dt().moveTo(0,0,{geometry:{isFilled:i}}).lineTo(r,0).lineTo(r,e).lineTo(0,e).close();if(n==="dashed"||n==="dotted")return a.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(r,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(0,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o).moveTo(r,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(s,o);const l=n==="draw"?.62:0;return a.moveTo(_e(t*l,0,r),_e(t*l,0,e),{geometry:{isInternal:!0,isFilled:!1}}).lineTo(_e(r-t*l,0,r),_e(e-t*l,0,e)).moveTo(_e(r-t*l,0,r),_e(t*l,0,e)).lineTo(_e(t*l,0,r),_e(e-t*l,0,e)),a}function Zst(r,e,t){if(e>r){const i=r/2;return new dt().moveTo(0,i,{geometry:{isFilled:t}}).arcTo(i,i,!1,!0,0,r,i).lineTo(r,e-i).arcTo(i,i,!1,!0,0,0,e-i).close()}const n=e/2;return new dt().moveTo(n,e,{geometry:{isFilled:t}}).arcTo(n,n,!1,!0,0,n,0).lineTo(r-n,0).arcTo(n,n,!1,!0,0,r-n,e).close()}function Qst(r,e,t){const i=At/5/2,s=Math.floor(5/4)*2,o=10-s,a=0,l=Math.floor(5/2)*2,c=Math.cos(-kn+s*i)*r/2,u=Math.cos(-kn+o*i)*r/2,d=Math.sin(-kn+a*i)*e/2,h=Math.sin(-kn+l*i)*e/2,f=r-Math.abs(c-u),p=e-Math.abs(h-d),m=r/2+u-(r/2-c),g=e/2+d-(e/2-h),y=1,S=(r-m)/2,w=(e-g)/2,b=(r+f)/2,v=(e+p)/2,C=b*y/2,E=v*y/2;return dt.lineThroughPoints(Array.from(Array(10),(M,P)=>{const $=-kn+P*i;return new T(S+(P%2?C:b)*Math.cos($),w+(P%2?E:v)*Math.sin($))}),{geometry:{isFilled:t}}).close()}function yU(r,e){return r>e?(pt*(e/2)+(r-e))*2:(pt*(r/2)+(e-r))*2}function eot(r,e,t){const n=Math.min(r,e)/2,i=Math.max(r,e)-n*2,o=(Math.PI*(n*2)+2*i)/t,a=r>e?[{type:"straight",start:new T(n,0),delta:new T(1,0)},{type:"arc",center:new T(r-n,n),startAngle:-pt/2},{type:"straight",start:new T(r-n,e),delta:new T(-1,0)},{type:"arc",center:new T(n,n),startAngle:pt/2}]:[{type:"straight",start:new T(r,n),delta:new T(0,1)},{type:"arc",center:new T(n,e-n),startAngle:0},{type:"straight",start:new T(0,e-n),delta:new T(0,-1)},{type:"arc",center:new T(n,n),startAngle:pt}];let l=0;const c=[];for(let u=0;u<t;u++){const d=a[0];d.type==="straight"?c.push(T.Add(d.start,T.Mul(d.delta,l))):c.push(kN(d.center,n,d.startAngle+l/n)),l+=o;let h=d.type==="straight"?i:pt*n;for(;l>h;)l-=h,a.push(a.shift()),h=a[0].type==="straight"?i:pt*n}return c}const tot={s:50,m:70,l:100,xl:130},not=.2;function rot(r,e,t,n,i,s){const o=new dt,a=Dd(t),l=yU(r,e),c=Math.max(Math.ceil(l/tot[n]),6,Math.ceil(l/Math.min(r,e))),u=l/c*not,d=Math.max(r-u*2,1),h=Math.max(e-u*2,1),p=yU(d,h)/c,m=(r-d)/2,g=(e-h)/2,y=eot(d,h,c).map(v=>v.addXY(m,g)),S=r<20?0:u*.3,w=e<20?0:u*.3,b=y.slice(0);for(let v=0;v<Math.floor(c/2);v++)b[v]=T.AddXY(b[v],a()*S*i,a()*w*i),b[c-v-1]=T.AddXY(b[c-v-1],a()*S*i,a()*w*i);for(let v=0;v<b.length;v++){const C=v===b.length-1?0:v+1,E=b[v],M=b[C],P=y[v],$=y[C],A=T.Dist(P,$),O=p-A,I=T.Dist(E,M)/A,R=(Math.max(m,g)+O)*I,B=T.Lrp(P,$,.5).add(T.Sub($,P).uni().per().mul(R));B.x<0?B.x=0:B.x>r&&(B.x=r),B.y<0?B.y=0:B.y>e&&(B.y=e);const U=cq(E,M,B),H=T.Dist(U||T.Average([E,M]),E);v===0&&o.moveTo(E.x,E.y,{geometry:{isFilled:s}}),o.circularArcTo(H,!1,!0,M.x,M.y)}return o.close()}function xU({shape:r,shouldScale:e,forceSolid:t}){const n=e?r.props.scale:1,i=qs(),{props:s}=r,{color:o,fill:a,dash:l,size:c}=s,u=_n[c]*n,d=QR(r),h=l==="draw"&&!t?d.toDrawD({strokeWidth:u,randomSeed:r.id,passes:1,offset:0,onlyFilled:!0}):d.toD({onlyFilled:!0});return x.jsxs(x.Fragment,{children:[x.jsx(Lx,{theme:i,d:h,color:o,fill:a,scale:n}),d.toSvg({style:l,strokeWidth:u,forceSolid:t,randomSeed:r.id,props:{fill:"none",stroke:ot(i,o,"solid")}})]})}const SU=51;class iot extends mp{static type="geo";static props=KH;static migrations=JH;canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:ir("")}}getGeometry(e){const t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),i=QR(e),s=wb(this.editor,e),o=t/e.props.scale,a=n/e.props.scale,l=Math.min(100,o/2),c=Math.min(Ol[e.props.size]*Ei.lineHeight+di*2,a/2),u=Math.min(o,Math.max(s.w,Math.min(l,Math.max(1,o-8)))),d=Math.min(a,Math.max(s.h,Math.min(c,Math.max(1,a-8))));return new ts({children:[i.toGeometry(),new ao({x:e.props.align==="start"?0:e.props.align==="end"?(o-u)*e.props.scale:(o-u)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(a-d)*e.props.scale:(a-d)/2*e.props.scale,width:u*e.props.scale,height:d*e.props.scale,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0,isEmptyLabel:mn(e.props.richText)})]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.vertices,t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:at(e.props.geo)}}getText(e){return Gl(this.editor,e.props.richText)}getFontFaces(e){return mn(e.props.richText)?gn:N1(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){const{id:t,type:n,props:i}=e,{fill:s,font:o,align:a,verticalAlign:l,size:c,richText:u}=i,d=qs(),{editor:h}=this,f=F("isGeoOnlySelected",()=>e.id===h.getOnlySelectedShapeId(),[h]),p=UD(h,e.id),m=mn(e.props.richText),g=p||!m,y=F("force solid",()=>h.getZoomLevel()<.2,[h]);return x.jsxs(x.Fragment,{children:[x.jsx(zl,{children:x.jsx(xU,{shape:e,shouldScale:!0,forceSolid:y})}),g&&x.jsx(Pl,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:x.jsx(hC,{shapeId:t,type:n,font:o,fontSize:Ol[c]*e.props.scale,lineHeight:Ei.lineHeight,padding:di*e.props.scale,fill:s,align:a,verticalAlign:l,richText:u,isSelected:f,labelColor:ot(d,i.labelColor,"solid"),wrap:!0})}),e.props.url&&x.jsx(tp,{url:e.props.url})]})}indicator(e){const t=F("isZoomedOut",()=>this.editor.getZoomLevel()<.25,[this.editor]),{size:n,dash:i,scale:s}=e.props,o=_n[n];return QR(e).toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:o*2*s,props:{strokeWidth:void 0},forceSolid:t})}toSvg(e,t){const n=e.props.scale,i={...e,props:{...e.props,w:e.props.w/n,h:(e.props.h+e.props.growY)/n,growY:0}},s=i.props;t.addExportDef(WD(s.fill));let o;if(!mn(s.richText)){const a=sc(t),l=new V(0,0,s.w,(e.props.h+e.props.growY)/n);o=x.jsx(fC,{fontSize:Ol[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,richText:s.richText,labelColor:ot(a,s.labelColor,"solid"),bounds:l,padding:di})}return x.jsxs(x.Fragment,{children:[x.jsx(xU,{shouldScale:!1,shape:i,forceSolid:!1}),o]})}getCanvasSvgDefs(){return[HD()]}onResize(e,{handle:t,newPoint:n,scaleX:i,scaleY:s,initialShape:o}){const a=o.props.w/o.props.scale,l=o.props.h/o.props.scale,c=o.props.growY/o.props.scale;let u=a*i,d=(l+c)*s,h=0,f=0;const p=SU;if(!mn(e.props.richText)){let b=Math.max(Math.abs(u),p),v=Math.max(Math.abs(d),p);b<p&&v===p&&(b=p),b===p&&v<p&&(v=p);const C=wb(this.editor,{...e,props:{...e.props,w:b*e.props.scale,h:v*e.props.scale}}),E=Math.max(Math.abs(u),C.w)*Math.sign(u),M=Math.max(Math.abs(d),C.h)*Math.sign(d);h=Math.abs(E)-Math.abs(u),f=Math.abs(M)-Math.abs(d),u=E,d=M}const m=u*e.props.scale,g=d*e.props.scale,y=new T(0,0);i<0&&(y.x+=m),(t==="left"||t==="top_left"||t==="bottom_left")&&(y.x+=i<0?h:-h),s<0&&(y.y+=g),(t==="top"||t==="top_left"||t==="top_right")&&(y.y+=s<0?f:-f);const{x:S,y:w}=y.rot(e.rotation).add(n);return{x:S,y:w,props:{w:Math.max(Math.abs(m),1),h:Math.max(Math.abs(g),1),growY:0}}}onBeforeCreate(e){if(mn(e.props.richText))return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,n=wb(this.editor,e).h;let i=null;if(n>t?i=n-t:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i*e.props.scale}}}onBeforeUpdate(e,t){if(Yl(e.props.richText,t.props.richText)&&e.props.font===t.props.font&&e.props.size===t.props.size)return;const n=mn(e.props.richText),i=mn(t.props.richText);if(!n&&i)return{...t,props:{...t.props,growY:0}};const s=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,l=wb(this.editor,t);if(n&&!i&&Gl(this.editor,t.props.richText)){let u=Math.max(s,l.w),d=Math.max(o,l.h);const h=SU;return s<h&&o<h&&(u=Math.max(u,h),d=Math.max(d,h),u=Math.max(u,d),d=Math.max(u,d)),{...t,props:{...t.props,w:u*t.props.scale,h:d*t.props.scale,growY:0}}}let c=null;if(l.h>o?c=l.h-o:a&&(c=0),c!==null){const u=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:c*t.props.scale,w:Math.max(u,l.w)*t.props.scale}}}if(l.w>s)return{...t,props:{...t.props,w:l.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n),scale:Ye(e.props.scale,t.props.scale,n)}}}const sot={s:12,m:14,l:16,xl:20},oot={s:2,m:3.5,l:5,xl:10};function wb(r,e){const{richText:t,font:n,size:i,w:s}=e.props;if(!t||mn(t))return{w:0,h:0};const o=sot[i],a=Bx(r,t),l=r.textMeasure.measureHtml(a,{...Ei,fontFamily:Ll[n],fontSize:Ol[i],minWidth:o,maxWidth:Math.max(0,Math.ceil(o+oot[i]),Math.ceil(s/e.props.scale-di*2))});return{w:l.w+di*2,h:l.h+di*2}}function aot(){const[r,e]=k.useState(!1);return k.useEffect(()=>{const n=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(n&&i.matches);const s=()=>e(n&&i.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),F(Yt.forceSrgb)||!r?"srgb":"p3"}class lot extends ac{static type="highlight";static props=YH;static migrations=XH;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};hideResizeHandles(e){return bb(e)}hideRotateHandle(e){return bb(e)}hideSelectionBoundsFg(e){return bb(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=au(e);if(bb(e))return new yv({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:n,sw:i}=wU(e,t,!0),s=KD({strokeWidth:i,showAsComplete:!0});return L_(n,s),new Oy({points:QQ(n,s),isFilled:!0})}component(e){const t=fP(this.editor,e),n=au(e);return x.jsx(zl,{children:x.jsx(vb,{shape:e,forceSolid:t,strokeWidth:n,opacity:this.options.overlayOpacity})})}backgroundComponent(e){const t=fP(this.editor,e),n=au(e);return x.jsx(zl,{children:x.jsx(vb,{shape:e,forceSolid:t,strokeWidth:n,opacity:this.options.underlayOpacity})})}indicator(e){const t=fP(this.editor,e),n=au(e),{strokePoints:i,sw:s}=wU(e,n,t),o=np(e.props.segments);let a;return i.length<2?a=uot(o[0],s):a=Ux(i,!1),x.jsx("path",{d:a})}toSvg(e){const t=au(e),n=t<1.5,i=1/e.props.scale;return x.jsx("g",{transform:`scale(${i})`,children:x.jsx(vb,{forceSolid:n,strokeWidth:t,shape:e,opacity:this.options.overlayOpacity})})}toBackgroundSvg(e){const t=au(e),n=t<1.5,i=1/e.props.scale;return x.jsx("g",{transform:`scale(${i})`,children:x.jsx(vb,{forceSolid:n,strokeWidth:t,shape:e,opacity:this.options.underlayOpacity})})}onResize(e,t){const{scaleX:n,scaleY:i}=t,s=[];for(const o of e.props.segments)s.push({...o,points:o.points.map(({x:a,y:l,z:c})=>({x:n*a,y:i*l,z:c}))});return{props:{segments:s}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,...t.props,segments:gue(e.props.segments,t.props.segments,n),scale:Ye(e.props.scale,t.props.scale,n)}}}function cot(r){return`M ${r.x} ${r.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function uot(r,e){const t=e/2;return`M ${r.x} ${r.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function wU(r,e,t){const n=np(r.props.segments),i=r.props.isComplete||Xn(r.props.segments)?.type==="straight";let s=e;!t&&!r.props.isPen&&n.length===1&&(s+=Dd(r.id)()*(e/6));const o=KD({strokeWidth:s,showAsComplete:i});return{strokePoints:jl(n,o),sw:s}}function au(r){return Bf[r.props.size]*1.12*r.props.scale}function bb(r){return r.props.segments.length===1&&r.props.segments[0].points.length<2}function vb({strokeWidth:r,forceSolid:e,shape:t,opacity:n}){const i=qs(),s=np(t.props.segments);let o=r;!e&&!t.props.isPen&&s.length===1&&(o+=Dd(t.id)()*(o/6));const a=KD({strokeWidth:o,showAsComplete:t.props.isComplete||Xn(t.props.segments)?.type==="straight"}),l=jl(s,a),c=l.length>1?Ux(l,!1):cot(t.props.segments[0].points[0]),u=aot(),d=ot(i,t.props.color,u==="p3"?"highlightP3":"highlightSrgb");return x.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:d,strokeWidth:o,opacity:n})}function fP(r,e){return F("forceSolid",()=>{const t=au(e),n=r.getZoomLevel();return t/n<1.5},[r])}function wue(){return x.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[x.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),x.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),x.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function bue({shapeId:r,assetId:e,width:t}){const n=z(),i=dS(),s=Zwe(),[o,a]=k.useState(()=>({asset:e?n.getAsset(e)??null:null,url:null})),l=k.useRef(!1),c=k.useRef(null);return k.useEffect(()=>{if(!e)return;let u=!1,d;const h=Zi("update state",()=>{if(!i&&r&&n.getCulledShapes().has(r))return;const f=n.getAsset(e);if(!f){a(g=>({...g,asset:null,url:null}));return}if(!f.props.src){const g=n.getTemporaryAssetPreview(f.id);if(g){c.current!==g&&(c.current=g,a(y=>({...y,isPlaceholder:!0,url:g})),s());return}}const p=i?i.scale*(t/f.props.w):n.getZoomLevel()*(t/f.props.w);function m(g,y){u||c.current!==y&&(l.current=!0,c.current=y,a({asset:g,url:y}),s())}if(l.current){let g=0;const y=()=>{g++,g>500/16&&(bU(n,e,p,i,S=>m(f,S)),d?.())};d?.(),n.on("tick",y),d=()=>n.off("tick",y)}else bU(n,e,p,i,g=>m(f,g))});return()=>{h(),d?.(),u=!0}},[n,e,i,s,r,t]),o}function bU(r,e,t,n,i){r.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:n?n.pixelRatio===null:!1,dpr:n?.pixelRatio??void 0}).then(s=>{i(s)})}async function dot(r){const t=await(await Ua(r)).blob();return mr.blobToDataUrl(t)}const hot=new Ar;class fot extends mp{static type="image";static props=ZH;static migrations=QH;isAspectRatioLocked(){return!0}canCrop(){return!0}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(e){return e.props.crop?.isCircle?new lCe({width:e.props.w,height:e.props.h,isFilled:!0}):new ao({width:e.props.w,height:e.props.h,isFilled:!0})}getAriaDescriptor(e){return e.props.altText}onResize(e,t){let n=R1(e,t);const{flipX:i,flipY:s}=t.initialShape.props,{scaleX:o,scaleY:a,mode:l}=t;if(n={...n,props:{...n.props,flipX:o<0!==i,flipY:a<0!==s}},!e.props.crop)return n;const c=l==="scale_shape"&&o===-1||l==="resize_bounds"&&i!==n.props.flipX,u=l==="scale_shape"&&a===-1||l==="resize_bounds"&&s!==n.props.flipY,{topLeft:d,bottomRight:h}=e.props.crop;return n.props.crop={topLeft:{x:c?1-h.x:d.x,y:u?1-h.y:d.y},bottomRight:{x:c?1-d.x:h.x,y:u?1-d.y:h.y},isCircle:e.props.crop.isCircle},n}component(e){return x.jsx(pot,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:e.props.crop?.isCircle?x.jsx("ellipse",{cx:D(e.props.w/2),cy:D(e.props.h/2),rx:D(e.props.w/2),ry:D(e.props.h/2)}):x.jsx("rect",{width:D(e.props.w),height:D(e.props.h)})}async toSvg(e,t){const n=e.props;if(!n.assetId)return null;const i=this.editor.getAsset(n.assetId);if(!i)return null;const{w:s}=lo(e.props,n.crop),o=await hot.get(i,async()=>{let a=await t.resolveAssetUrl(i.id,s);if(!a)return null;if((a.startsWith("blob:")||a.startsWith("http")||a.startsWith("/")||a.startsWith("./"))&&(a=await dot(a)||""),vue(this.editor,i.id)){const{promise:l}=Cue(a);a=await l}return a});return o?x.jsx(mot,{shape:e,src:o}):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const n=vn(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:i,h:s}=lo(e.props,n),o=new T(n.topLeft.x*i,n.topLeft.y*s).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:s}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,n){function i(s,o){if(s.props.crop===null&&o.props.crop===null)return null;const a=s.props.crop?.topLeft||{x:0,y:0},l=s.props.crop?.bottomRight||{x:1,y:1},c=o.props.crop?.topLeft||{x:0,y:0},u=o.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:Ye(a.x,c.x,n),y:Ye(a.y,c.y,n)},bottomRight:{x:Ye(l.x,u.x,n),y:Ye(l.y,u.y,n)}}}return{...n>.5?t.props:e.props,w:Ye(e.props.w,t.props.w,n),h:Ye(e.props.h,t.props.h,n),crop:i(e,t)}}}const pot=k.memo(function({shape:e}){const t=z(),{w:n}=lo(e.props,e.props.crop),{asset:i,url:s}=bue({shapeId:e.id,assetId:e.props.assetId,width:n}),o=yY(),[a,l]=k.useState(""),[c,u]=k.useState(null),d=i&&vue(t,i.id);k.useEffect(()=>{if(s&&d){const{promise:S,cancel:w}=Cue(s);return S.then(b=>{l(b),u(s)}),()=>{w()}}},[t,d,o,s]);const h=F("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),f=o&&(i?.props.mimeType?.includes("video")||d),p=kue(e),m=s===c?null:s,g=f?a:c;if(!s&&!i?.props.src)return x.jsxs(Pl,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--tl-color-text-3)",backgroundColor:"var(--tl-color-low)",border:"1px solid var(--tl-color-low-border)"},children:[x.jsx("div",{className:oe("tl-image-container",i&&"tl-image-container-loading"),style:p,children:i?null:x.jsx(wue,{})}),"url"in e.props&&e.props.url&&x.jsx(tp,{url:e.props.url})]});const y=d?"anonymous":void 0;return x.jsxs(x.Fragment,{children:[h&&g&&x.jsx("div",{style:p,children:x.jsx("img",{className:"tl-image",style:{...ky(e),opacity:.1},crossOrigin:y,src:g,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),x.jsxs(Pl,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,borderRadius:e.props.crop?.isCircle?"50%":void 0},children:[x.jsxs("div",{className:oe("tl-image-container"),style:p,children:[g&&x.jsx("img",{className:"tl-image",style:ky(e),crossOrigin:y,src:g,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},g),m&&x.jsx("img",{className:"tl-image",style:ky(e),crossOrigin:y,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:e.props.altText,onLoad:()=>u(m)},m)]}),e.props.url&&x.jsx(tp,{url:e.props.url})]})]})});function vue(r,e){const t=e?r.getAsset(e):void 0;return t?"mimeType"in t.props&&cs.isAnimatedImageType(t?.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function kue(r){const e=r.props.crop,t=e?.topLeft;if(!t)return{width:r.props.w,height:r.props.h};const{w:n,h:i}=lo(r.props,e),s=-t.x*n,o=-t.y*i;return{transform:`translate(${s}px, ${o}px)`,width:n,height:i}}function ky(r,e){const{flipX:t,flipY:n,crop:i}=r.props;if(!t&&!n)return;let s,o;if(i){const{w:c,h:u}=lo(r.props,i),d=i.bottomRight.x-i.topLeft.x,h=i.bottomRight.y-i.topLeft.y;s=oo(i.topLeft.x,[0,1-d],[0,c-r.props.w]),o=oo(i.topLeft.y,[0,1-h],[0,u-r.props.h])}const a=`scale(${t?-1:1}, ${n?-1:1})`;return{transform:`${e?`translate(${(t?e.width:0)-(s||0)}px,
		             ${(n?e.height:0)-(o||0)}px)`:""} ${a}`,transformOrigin:e?"0 0":"center center"}}function mot({shape:r,src:e}){const t=Ud(),n=kue(r),i=r.props.crop;if(n.transform&&i){const{transform:s,width:o,height:a}=n,l=(i.bottomRight.x-i.topLeft.x)*o,c=(i.bottomRight.y-i.topLeft.y)*a,u=[new T(0,0),new T(l,0),new T(l,c),new T(0,c)],d=ky(r,{width:o,height:a});return x.jsxs(x.Fragment,{children:[x.jsx("defs",{children:x.jsx("clipPath",{id:t,children:i.isCircle?x.jsx("ellipse",{cx:l/2,cy:c/2,rx:l/2,ry:c/2}):x.jsx("polygon",{points:u.map(h=>`${h.x},${h.y}`).join(" ")})})}),x.jsx("g",{clipPath:`url(#${t})`,children:x.jsx("image",{href:e,width:o,height:a,"aria-label":r.props.altText,style:d?{...d}:{transform:s}})})]})}else return x.jsx("image",{href:e,width:r.props.w,height:r.props.h,"aria-label":r.props.altText,style:ky(r,{width:r.props.w,height:r.props.h})})}function Cue(r){let e=!1;return{promise:new Promise(n=>{const i=My();i.onload=()=>{if(e)return;const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const o=s.getContext("2d");o&&(o.drawImage(i,0,0),n(s.toDataURL()))},i.crossOrigin="anonymous",i.src=r}),cancel:()=>e=!0}}const got=new Ar;class yot extends ac{static type="line";static props=eq;static migrations=tq;hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}hideInMinimap(){return!0}getDefaultProps(){const[e,t]=Py(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){const t=eO(e).toGeometry();return se(t instanceof lA),t}getHandles(e){return got.get(e.props,()=>{const t=this.getGeometry(e),n=Lg(e),i=n.map(s=>({...s,id:s.index,type:"vertex",canSnap:!0}));for(let s=0;s<n.length-1;s++){const o=Pf(n[s].index,n[s+1].index),l=t.getSegments()[s].interpolateAlongEdge(.5);i.push({id:o,type:"create",index:o,x:l.x,y:l.y,canSnap:!0})}return i.sort(Fn)})}onResize(e,t){const{scaleX:n,scaleY:i}=t;return{props:{points:tc(e.props.points,(s,{id:o,index:a,x:l,y:c})=>({id:o,index:a,x:l*n,y:c*i}))}}}onBeforeCreate(e){const{props:{points:t}}=e,n=Object.keys(t);if(n.length<2)return;const i=t[n[0]];if(n.every(o=>{const a=t[o];return a.x===i.x&&a.y===i.y})){const o=n[n.length-1];return t[o]={...t[o],x:t[o].x+.1,y:t[o].y+.1},e}}onHandleDrag(e,{handle:t}){const n=ms(new T(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:n.x,y:n.y}}}}}onHandleDragStart(e,{handle:t}){if(t.type==="create")return{...e,props:{...e.props,points:{...e.props.points,[t.index]:{id:t.index,index:t.index,x:t.x,y:t.y}}}}}component(e){return x.jsx(zl,{style:{minWidth:50,minHeight:50},children:x.jsx(vU,{shape:e})})}indicator(e){const t=us[e.props.size]*e.props.scale,n=eO(e),{dash:i}=e.props;return n.toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:t*2,props:{strokeWidth:void 0}})}toSvg(e){return x.jsx(vU,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=Lg(e);return{points:t,getSelfSnapPoints:n=>{const i=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===n.id);return t.filter((s,o)=>Math.abs(o-i)>1).map(T.From)},getSelfSnapOutline:n=>{const i=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===n.id),s=this.getGeometry(e).getSegments().filter((o,a)=>a!==i-1&&a!==i);return s.length?new ts({children:s}):null}}}getInterpolatedProps(e,t,n){const i=Lg(e),s=Lg(t),o=[],a=[];let l=FO;if(i.length>s.length)for(let c=0;c<i.length;c++)o[c]={...i[c]},s[c]===void 0?a[c]={...s[s.length-1],id:l}:a[c]={...s[c],id:l},l=_s(l);else if(s.length>i.length)for(let c=0;c<s.length;c++)a[c]={...s[c]},i[c]===void 0?o[c]={...i[i.length-1],id:l}:o[c]={...i[c],id:l},l=_s(l);else for(let c=0;c<s.length;c++)o[c]=i[c],a[c]=s[c];return{...n>.5?t.props:e.props,points:Object.fromEntries(o.map((c,u)=>{const d=a[u];return[c.id,{...c,x:Ye(c.x,d.x,n),y:Ye(c.y,d.y,n)}]})),scale:Ye(e.props.scale,t.props.scale,n)}}}function Lg(r){return Object.values(r.props.points).sort(Fn)}const xot=new Ar;function eO(r){return xot.get(r,()=>{const e=Lg(r).map(T.From);switch(r.props.spline){case"cubic":return dt.cubicSplineThroughPoints(e,{endOffsets:0});case"line":return dt.lineThroughPoints(e,{endOffsets:0})}})}function vU({shape:r,shouldScale:e=!1,forceSolid:t=!1}){const n=qs(),i=eO(r),{dash:s,color:o,size:a}=r.props,l=1/r.props.scale,c=e?l:1,u=us[a]*r.props.scale;return i.toSvg({style:s,strokeWidth:u,forceSolid:t,randomSeed:r.id,props:{transform:`scale(${c})`,stroke:ot(n,o,"solid"),fill:"none"}})}function Wk(r,e,t=!1){r.select(e),r.setEditingShape(e),r.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&r.emit("select-all-text",{shapeId:e.id})}class Sot extends ac{static type="note";static props=nq;static migrations=rq;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){const{resizeMode:e}=this.options;switch(e){case"none":return!0;case"scale":return!1;default:throw at(e)}}isAspectRatioLocked(){return this.options.resizeMode==="scale"}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:ir(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:n}=Tue(this.editor,e),{scale:i}=e.props,s=t*i,o=n*i,a=vt*i,l=kb(e);return new ts({children:[new ao({width:a,height:l,isFilled:!0}),new ao({x:e.props.align==="start"?0:e.props.align==="end"?a-o:(a-o)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?l-s:(l-s)/2,width:o,height:s,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const i=this.editor.getZoomLevel();if(i*t<.25)return[];const s=kb(e),o=vt*t,a=Oit/i*t;return i*t<.5?[{id:"bottom",index:"a3",type:"clone",x:o/2,y:s+a}]:[{id:"top",index:"a1",type:"clone",x:o/2,y:-a},{id:"right",index:"a2",type:"clone",x:o+a,y:s/2},{id:"bottom",index:"a3",type:"clone",x:o/2,y:s+a},{id:"left",index:"a4",type:"clone",x:-a,y:s/2}]}onResize(e,t){const{resizeMode:n}=this.options;switch(n){case"none":return;case"scale":return fG(e,t);default:throw at(n)}}getText(e){return Gl(this.editor,e.props.richText)}getFontFaces(e){return mn(e.props.richText)?gn:N1(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){const{id:t,type:n,props:{labelColor:i,scale:s,color:o,font:a,size:l,align:c,richText:u,verticalAlign:d,fontSizeAdjustment:h}}=e,f=vot(t),p=qs(),m=vt*s,g=kb(e),y=F("shape rotation",()=>this.editor.getShapePageTransform(t)?.rotation()??0,[this.editor]),S=F("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),w=F("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),b=e.id===this.editor.getOnlySelectedShapeId(),v=UD(this.editor,e.id),C=mn(u);return x.jsxs(x.Fragment,{children:[x.jsx("div",{id:t,className:"tl-note__container",style:{width:m,height:g,backgroundColor:ot(p,o,"noteFill"),borderBottom:S?w?`${2*s}px solid rgb(20, 20, 20)`:`${2*s}px solid rgb(144, 144, 144)`:"none",boxShadow:S?"none":kot(e.id,y,s)},children:(b||v||!C)&&x.jsx(hC,{shapeId:t,type:n,font:a,fontSize:(h||Ol[l])*s,lineHeight:Ei.lineHeight,align:c,verticalAlign:d,richText:u,isSelected:b,labelColor:i==="black"?ot(p,o,"noteText"):ot(p,i,"fill"),wrap:!0,padding:di*s,hasCustomTabBehavior:!0,onKeyDown:f})}),"url"in e.props&&e.props.url&&x.jsx(tp,{url:e.props.url})]})}indicator(e){const{scale:t}=e.props;return x.jsx("rect",{rx:t,width:D(vt*t),height:D(kb(e))})}toSvg(e,t){const n=sc({isDarkMode:t.isDarkMode}),i=Cot(e),s=x.jsx(fC,{fontSize:e.props.fontSizeAdjustment||Ol[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,richText:e.props.richText,labelColor:ot(n,e.props.color,"noteText"),bounds:i,padding:di,showTextOutline:!1});return x.jsxs(x.Fragment,{children:[x.jsx("rect",{x:5,y:5,rx:1,width:vt-10,height:i.h,fill:"rgba(0,0,0,.1)"}),x.jsx("rect",{rx:1,width:vt,height:i.h,fill:ot(n,e.props.color,"noteFill")}),s]})}onBeforeCreate(e){return kU(this.editor,e)}onBeforeUpdate(e,t){if(!(Yl(e.props.richText,t.props.richText)&&e.props.font===t.props.font&&e.props.size===t.props.size))return kU(this.editor,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,scale:Ye(e.props.scale,t.props.scale,n)}}}function kU(r,e){const{labelHeight:t,fontSizeAdjustment:n}=Tue(r,e),i=Math.max(0,t-vt);if(i!==e.props.growY||n!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:n}}}function wot(r,e){const{richText:t}=e.props;if(mn(t))return{labelHeight:Ol[e.props.size]*Ei.lineHeight+di*2,labelWidth:100,fontSizeAdjustment:0};const n=Ol[e.props.size];let i=0,s=0,o=vt,a=vt;const l=1;do{i=Math.min(n,n-s);const c=Bx(r,t),u=r.textMeasure.measureHtml(c,{...Ei,fontFamily:Ll[e.props.font],fontSize:i,maxWidth:vt-di*2-l,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(o=u.h+di*2,a=u.w+di*2,i<=14){const d=Bx(r,t),h=r.textMeasure.measureHtml(d,{...Ei,fontFamily:Ll[e.props.font],fontSize:i,maxWidth:vt-di*2-l});o=h.h+di*2,a=h.w+di*2;break}if(u.scrollWidth.toFixed(0)===u.w.toFixed(0))break}while(s++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:i}}const bot=new Ar;function Tue(r,e){return bot.get(e,()=>wot(r,e))}function vot(r){const e=z(),t=k.useContext(n_);return k.useCallback(n=>{const i=e.getShape(r);if(!i)return;const s=n.key==="Tab",o=(n.metaKey||n.ctrlKey)&&n.key==="Enter";if(s||o){n.preventDefault();const a=e.getShapePageTransform(r),l=a.rotation(),c=!!(t?.dir==="rtl"||qce(Gl(e,i.props.richText))),u=(vt+e.options.adjacentShapeMargin+(o&&!n.shiftKey?i.props.growY:0))*i.props.scale,d=new T(s?n.shiftKey!=c?-1:1:0,o?n.shiftKey?-1:1:0).mul(u).add(dC.clone().mul(i.props.scale)).rot(l).add(a.point()),h=nue(e,i,d,l);h&&Wk(e,h,!0)}},[r,e,t?.dir])}function kb(r){return(vt+r.props.growY)*r.props.scale}function kot(r,e,t){const n=Dd(r),i=Math.abs(n())+.5,s=Math.cos(e),o=5*t,a=4*t,l=6*t,c=7*t;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+i*c)*Math.max(0,s)}px ${l+i*c}px -${a+i*l}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+n()*.005)*((1+s)/2)).toFixed(2)})`}function Cot(r){return new V(0,0,vt,vt+r.props.growY)}const Tot=d1("text size",(r,e)=>(r.fonts.trackFontsForShape(e),Eue(r,e.props)),{areRecordsEqual:(r,e)=>r.props===e.props});class Eot extends ac{static type="text";static props=iq;static migrations=sq;options={extraArrowHorizontalPadding:10};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:ir("")}}getMinDimensions(e){return Tot.get(this.editor,e.id)}getGeometry(e,t){const{scale:n}=e.props,{width:i,height:s}=this.getMinDimensions(e),o=t?.context??"none";return new ao({x:(o==="@tldraw/arrow-without-arrowhead"?-this.options.extraArrowHorizontalPadding:0)*n,width:(i+(o==="@tldraw/arrow-without-arrowhead"?this.options.extraArrowHorizontalPadding*2:0))*n,height:s*n,isFilled:!0,isLabel:!0})}getFontFaces(e){return N1(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}getText(e){return Gl(this.editor,e.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:n,size:i,richText:s,color:o,scale:a,textAlign:l}}=e,{width:c,height:u}=this.getMinDimensions(e),d=e.id===this.editor.getOnlySelectedShapeId(),h=qs(),f=Mot(t);return x.jsx(hC,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:n,fontSize:Bf[i],lineHeight:Ei.lineHeight,align:l,verticalAlign:"middle",richText:s,labelColor:ot(h,o,"solid"),isSelected:d,textWidth:c,textHeight:u,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:f})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,n=z();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:x.jsx("rect",{width:D(t.width),height:D(t.height)})}toSvg(e,t){const n=this.editor.getShapeGeometry(e).bounds,i=n.width/(e.props.scale??1),s=n.height/(e.props.scale??1),o=sc(t),a=new V(0,0,i,s);return x.jsx(fC,{fontSize:Bf[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",richText:e.props.richText,labelColor:ot(o,e.props.color,"solid"),bounds:a,padding:0})}onResize(e,t){const{newPoint:n,initialBounds:i,initialShape:s,scaleX:o,handle:a}=t;if(t.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...fG(e,t)};{const l=Math.max(1,Math.abs(i.width*o)),{x:c,y:u}=o<0?T.Sub(n,T.FromAngle(e.rotation).mul(l)):n;return{id:e.id,type:e.type,x:c,y:u,props:{w:l/s.props.scale,autoSize:!1}}}}onEditEnd(e){Gl(this.editor,e.props.richText).trimEnd().length===0&&this.editor.deleteShapes([e.id])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const n=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,i=!Yl(e.props.richText,t.props.richText);if(!n&&!i)return;const s=this.getMinDimensions(e),o=Eue(this.editor,t.props),a=s.width*e.props.scale,l=s.height*e.props.scale,c=o.width*t.props.scale,u=o.height*t.props.scale;let d;switch(t.props.textAlign){case"middle":{d=new T((c-a)/2,i?0:(u-l)/2);break}case"end":{d=new T(c-a,i?0:(u-l)/2);break}default:{if(i)break;d=new T(0,(u-l)/2);break}}if(d){d.rot(t.rotation);const{x:h,y:f}=t;return{...t,x:h-d.x,y:f-d.y,props:{...t.props,w:c}}}else return{...t,props:{...t.props,w:c}}}}function Eue(r,e){const{font:t,richText:n,size:i,w:s}=e,o=16,a=Bf[i],l=e.autoSize?null:Math.max(o,Math.floor(s)),c=Bx(r,n),u=r.textMeasure.measureHtml(c,{...Ei,fontFamily:Ll[t],fontSize:a,maxWidth:l});return{width:l??Math.max(o,u.w+1),height:Math.max(a,u.h)}}function Mot(r){const e=z();return k.useCallback(t=>{if(e.getEditingShapeId()===r)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}}},[e,r])}const Iot=new Ar;class Pot extends mp{static type="video";static props=oq;static migrations=aq;options={autoplay:!0};canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(e){return e.props.altText}component(e){return x.jsx(Aot,{shape:e})}indicator(e){return x.jsx("rect",{width:D(e.props.w),height:D(e.props.h)})}async toSvg(e,t){const n=e.props;if(!n.assetId)return null;const i=this.editor.getAsset(n.assetId);if(!i)return null;const s=await Iot.get(i,async()=>{const o=await t.resolveAssetUrl(i.id,n.w);if(!o)return null;const a=await cs.loadVideo(o);return await cs.getVideoFrameAsDataUrl(a,0)});return s?x.jsx("image",{href:s,width:n.w,height:n.h,"aria-label":e.props.altText}):null}}const Aot=k.memo(function({shape:e}){const t=z(),n=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,i=yS(e.id),s=yY(),{Spinner:o}=Tt(),{asset:a,url:l}=bue({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),c=k.useRef(null),[u,d]=k.useState(!1),h=k.useCallback(m=>{m.currentTarget&&d(!0)},[]),[f,p]=k.useState(!1);return k.useEffect(()=>{const m=()=>p(document.fullscreenElement===c.current);return document.addEventListener("fullscreenchange",m),()=>document.removeEventListener("fullscreenchange",m)}),k.useEffect(()=>{const m=c.current;m&&i&&document.activeElement!==m&&m.focus()},[i,u]),x.jsxs(x.Fragment,{children:[x.jsx(Pl,{id:e.id,style:{color:"var(--tl-color-text-3)",backgroundColor:a?"transparent":"var(--tl-color-low)",border:a?"none":"1px solid var(--tl-color-low-border)"},children:x.jsx("div",{className:"tl-counter-scaled",children:x.jsx("div",{className:"tl-video-container",children:a?o&&!a.props.src?x.jsx(o,{}):l?x.jsxs(x.Fragment,{children:[x.jsx("video",{ref:c,style:i?{pointerEvents:"all"}:u?void 0:{display:"none"},className:oe("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":f}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:e.props.autoplay&&!s,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:i&&n,onLoadedData:h,hidden:!u,"aria-label":e.props.altText,children:x.jsx("source",{src:l})},l),!u&&o&&x.jsx(o,{})]}):null:x.jsx(wue,{})})})}),"url"in e.props&&e.props.url&&x.jsx(tp,{url:e.props.url})]})}),Mue=[Eot,vst,Rst,iot,Sot,yot,Vst,yst,lot,Ef,fot,Pot];function $ot(r){return r.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const n=r.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?n||r.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&n&&r.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!r.isIn("select.editing_shape")){const n=r.getEditingShape();n&&n.type==="text"&&r.isInAny("text.pointing","select.resizing")&&r.getInstanceState().isToolLocked?r.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):r.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&r.isIn("select.editing_shape")&&r.setCurrentTool("select.idle")}}})}class Rot extends he{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;_isHoldingAccelKey=!1;_firstErasingShapeId=null;_erasingShapeIds=[];onEnter(e){this._isHoldingAccelKey=zt(this.editor.inputs),this._firstErasingShapeId=this.editor.getErasingShapeIds()[0],this._erasingShapeIds=this.editor.getErasingShapeIds(),this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=e;const{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const s=this.editor.getPointInShapeSpace(i,t);return this.editor.getShapeGeometry(i).bounds.containsPoint(s)}return!1}).map(i=>i.id));const n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onKeyUp(){this._isHoldingAccelKey=zt(this.editor.inputs),this.update()}onKeyDown(){this._isHoldingAccelKey=zt(this.editor.inputs),this.update()}update(){const{editor:e,excludedShapeIds:t}=this,n=e.getErasingShapeIds(),i=e.getZoomLevel(),s=e.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:o,previousPagePoint:a}}=e;this.pushPointToScribble();const l=new Set(n),c=this.editor.options.hitTestMargin/i;for(const u of s){if(e.isShapeOfType(u,"group"))continue;const d=e.getShapeMask(u.id);if(d&&!hi(o,d))continue;const h=e.getShapeGeometry(u),f=e.getShapePageTransform(u);if(!h||!f)continue;const p=f.clone().invert(),m=p.applyToPoint(a),g=p.applyToPoint(o),{bounds:y}=h;y.minX-c>Math.max(m.x,g.x)||y.minY-c>Math.max(m.y,g.y)||y.maxX+c<Math.min(m.x,g.x)||y.maxY+c<Math.min(m.y,g.y)||(h.hitTestLineSegment(m,g,c)&&l.add(e.getOutermostSelectableShape(u).id),this._erasingShapeIds=[...l])}if(this._isHoldingAccelKey&&this._firstErasingShapeId){const u=this._firstErasingShapeId;u&&this.editor.getShape(u)&&e.setErasingShapes([u]);return}this.editor.setErasingShapes(this._erasingShapeIds.filter(u=>!t.has(u)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),this.parent.transition("idle"),this._erasingShapeIds=[],this._firstErasingShapeId=null}cancel(){const{editor:e}=this;e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}let Oot=class extends he{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},Not=class extends he{static id="pointing";_isHoldingAccelKey=!1;onEnter(){this._isHoldingAccelKey=zt(this.editor.inputs);const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,i=new Set,s=i.size;for(let o=t.length,a=o-1;a>=0;a--){const l=t[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>s||(i.add(c.id),this._isHoldingAccelKey))break}}this.editor.setErasingShapes([...i])}onKeyUp(){this._isHoldingAccelKey=zt(this.editor.inputs)}onKeyDown(){this._isHoldingAccelKey=zt(this.editor.inputs)}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this._isHoldingAccelKey||this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}};class _ot extends he{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[Oot,Not,Rot]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class Dot extends he{static id="dragging";initialCamera=new T;onEnter(){this.initialCamera=T.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:e,editor:t}=this,{currentScreenPoint:n,originScreenPoint:i}=t.inputs,s=T.Sub(n,i).div(t.getZoomLevel());s.len2()!==0&&t.setCamera(e.clone().add(s))}complete(){const{editor:e}=this,{pointerVelocity:t}=e.inputs,n=Math.min(t.len(),2);n>.1&&this.editor.slideCamera({speed:n,direction:t}),this.parent.transition("idle")}}let Fot=class extends he{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},zot=class extends he{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}};class Bot extends he{static id="hand";static initial="idle";static isLockable=!1;static children(){return[Fot,zot,Dot]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:gr.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:gr.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:n}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:gr.easeOutQuint}}):this.editor.resetZoom(n,{animation:{duration:320,easing:gr.easeOutQuint}})}}}let jot=class extends he{static id="idle";onCancel(){this.editor.setCurrentTool("select")}onPointerDown(e){this.parent.transition("lasering",e)}};class Lot extends he{static id="lasering";scribbleId="id";onEnter(){const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class Uot extends he{static id="laser";static initial="idle";static children(){return[jot,Lot]}static isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class Wot extends he{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}onEnter(e){const{editor:t}=this,{altKey:n}=t.inputs;this.isWrapMode=t.user.getIsWrapMode(),this.viewportDidChange=!1;let i=!0;if(this.cleanupViewportChangeReactor=Zi("viewport change while brushing",()=>{t.getViewportPageBounds(),!i&&!this.viewportDidChange&&(this.viewportDidChange=!0)}),n){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(t.getCurrentPageShapes().filter(s=>t.isShapeOfType(s,"group")||t.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=e,this.initialSelectedShapeIds=t.getSelectedShapeIds().slice(),this.hitTestShapes(),i=!1}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:e}){const{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(e){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)}onKeyDown(e){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:t,isWrapMode:n}=this,{inputs:{originPagePoint:i,currentPagePoint:s,shiftKey:o,ctrlKey:a}}=e,l=new Set(o?this.initialSelectedShapeIds:[]),c=n?!a:a,u=V.FromPoints([i,s]),{corners:d}=u;let h,f,p,m,g,y;const w=e.getViewportPageBounds().contains(u)&&!this.viewportDidChange?e.getCurrentPageRenderingShapesSorted():e.getCurrentPageShapesSorted(),b=e.getCurrentPageId();e:for(let E=0,M=w.length;E<M;E++){if(p=w[E],t.has(p.id)||l.has(p.id)||(m=e.getShapePageBounds(p),!m))continue e;if(u.contains(m)){this.handleHit(p,s,b,l,d);continue e}if(c||e.isShapeOfType(p,"frame"))continue e;if(u.collides(m)){if(g=e.getShapePageTransform(p),!g)continue e;y=g.clone().invert().applyToPoints(d);const P=e.getShapeGeometry(p);t:for(let $=0;$<4;$++)if(h=y[$],f=y[($+1)%4],P.hitTestLineSegment(h,f,0)){this.handleHit(p,s,b,l,d);break t}}}const v=e.getInstanceState().brush;(!v||!u.equals(v))&&e.updateInstanceState({brush:{...u.toJson()}});const C=e.getSelectedShapeIds();(C.length!==l.size||C.some(E=>!l.has(E)))&&e.setSelectedShapes(Array.from(l))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(e,t,n,i,s){if(e.parentId===n){i.add(e.id);return}const o=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(o.id);a&&!Nq(a,s)&&!hi(t,a)||i.add(o.id)}}const rp={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Hot extends he{static id="pointing_resize_handle";info={};updateCursor(){const e=this.editor.getSelectedShapes(),t=rp[this.info.handle];this.editor.setCursor({type:t,rotation:e.length===1?this.editor.getSelectionRotation():0})}onEnter(e){this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e();return}this.parent.transition("idle")}cancel(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e();return}this.parent.transition("idle")}}class Iue extends he{static id="cropping";info={};markId="";snapshot={};onEnter(e){this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0)}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const t=rp[this.info.handle];this.editor.setCursor({type:t,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e)return;const n=this.editor.getShapeUtil(e.type);if(!n)return;const{shiftKey:i}=this.editor.inputs,s=this.editor.inputs.currentPagePoint.clone().sub(t),o=this.editor.inputs.originPagePoint.clone().sub(t),a=s.clone().sub(o).rot(-e.rotation),l=e.props.crop??to(),c=lo(e.props,l),d=(n.onCrop?.bind(n)??r$e)(e,{handle:this.info.handle,change:a,crop:l,uncroppedSize:c,initialShape:this.snapshot.shape,aspectRatioLocked:i});d&&(this.editor.updateShapes([{id:e.id,type:e.type,...d}]),this.updateCursor())}complete(){this.updateShapes(),wt(this.editor,[this.snapshot.shape.id]);const{onInteractionEnd:e}=this.info;e?typeof e=="string"?this.editor.setCurrentTool(e,this.info):e():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId);const{onInteractionEnd:e}=this.info;e?typeof e=="string"?this.editor.setCurrentTool(e,this.info):e():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),s=T.RotWith(i.getHandlePoint(this.info.handle),i.point,e),o=T.Sub(t,s);return{shape:n,cursorHandleOffset:o}}}function VD(r,e=!1){const t=r.getZoomLevel(),{inputs:{currentPagePoint:n}}=r;return r.getShapeAtPoint(n,{hitInside:!1,hitLabels:e,margin:r.options.hitTestMargin/t,renderingOnly:!0})??r.getSelectedShapeAtPoint(n)}function Pue(r,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:n}=e.props;if(!n)return;const i=r.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const{w:s,h:o}=lo(e.props,n),a=n.bottomRight.x-n.topLeft.x,l=n.bottomRight.y-n.topLeft.y,c=vn(n),u=1-a,d=1-l;return c.topLeft.x=_e(c.topLeft.x-t.x/s,0,u),c.topLeft.y=_e(c.topLeft.y-t.y/o,0,d),c.bottomRight.x=c.topLeft.x+a,c.bottomRight.y=c.topLeft.y+l,{id:e.id,type:e.type,props:{crop:c}}}let qot=class extends he{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const t=VD(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const n=this.editor.getShape(t);if(!n)return;const i=this.editor.getShapeUtil(n);if(i){if(e.target==="selection"){i.onDoubleClickEdge?.(n,e);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.key){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),i=new T(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new T(0,0)))return;n&&i.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const o=Pue(this.editor,s,i);o&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([o]))}};class Kot extends he{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.startDragging(e)}onLongPress(e){this.startDragging(e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}startDragging(e){this.editor.setCurrentTool("select.crop.translating_crop",e)}}class Aue extends he{static id="pointing_crop_handle";info={};onEnter(e){this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd);const t=this.editor.getSelectedShapes()[0];if(!t)return;const n=rp[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(t.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,this.info):e();return}this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle")}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,this.info):e();return}this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle")}}class Jot extends he{static id="translating_crop";info={};markId="";snapshot={};onEnter(e){this.info=e,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(e){switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(e){switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,i=n.clone().sub(t),s=Pue(this.editor,e,i);s&&this.editor.updateShapes([s])}}class Vot extends he{static id="crop";static initial="idle";static children(){return[qot,Jot,Kot,Aue,Iue]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}class Got extends he{static id="dragging_handle";shapeId;initialHandle;initialAdjacentHandle;initialPagePoint;markId;initialPageTransform;initialPageRotation;info;isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(e){const{shape:t,isCreating:n,creatingMarkId:i,handle:s}=e;if(this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId="",n)if(i)this.markId=i;else{const d=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);d&&(this.markId=d)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=vn(s),this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:n?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(t).sort(Fn),a=o.findIndex(d=>d.id===e.handle.id);if(this.initialAdjacentHandle=null,e.handle.snapReferenceHandleId){const d=o.find(h=>h.id===e.handle.snapReferenceHandleId);d&&(this.initialAdjacentHandle=d)}if(!this.initialAdjacentHandle){for(let d=a+1;d<o.length;d++){const h=o[d];if(h.type==="vertex"&&h.id!=="middle"&&h.id!==e.handle.id){this.initialAdjacentHandle=h;break}}if(!this.initialAdjacentHandle)for(let d=o.length-1;d>=0;d--){const h=o[d];if(h.type==="vertex"&&h.id!=="middle"&&h.id!==e.handle.id){this.initialAdjacentHandle=h;break}}}if(this.editor.isShapeOfType(t,"arrow")){const d=zn(this.editor,t)[e.handle.id];this.isPrecise=!1,d&&(this.isPrecise=d.props.isPrecise,this.isPrecise?this.isPreciseId=d.toId:this.resetExactTimeout())}const l={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:t},u=this.editor.getShapeUtil(t).onHandleDragStart?.(t,l);u&&this.editor.updateShapes([{...u,id:t.id,type:t.type}]),this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){const t=this.editor.getShapeUtil("arrow").options.pointingPreciseTimeout;this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},t)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),j_(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),wt(this.editor,[this.shapeId]);const e=this.editor.getShape(this.shapeId);if(e){const n=this.editor.getShapeUtil(e),i={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape},s=n.onHandleDragEnd?.(e,i);s&&this.editor.updateShapes([{...s,id:e.id,type:e.type}])}const{onInteractionEnd:t}=this.info;if(t)if(typeof t=="string"){if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}}else{t?.();return}this.parent.transition("idle")}cancel(){const e=this.editor.getShape(this.shapeId);if(e){const n=this.editor.getShapeUtil(e),i={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape};n.onHandleDragCancel?.(e,i)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){typeof t=="string"?this.editor.setCurrentTool(t,{shapeId:this.shapeId}):t?.();return}this.parent.transition("idle")}update(){const{editor:e,shapeId:t,initialPagePoint:n}=this,{initialHandle:i,initialPageRotation:s,initialAdjacentHandle:o}=this,a=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:c,shiftKey:u,ctrlKey:d,altKey:h,pointerVelocity:f}}=e,p=this.info.shape,m=e.getShape(t);if(!m)return;const g=e.getShapeUtil(m),y=e.isShapeOfType(m,"arrow")?zn(e,m)[i.id]:void 0;let S=c.clone().sub(n).rot(-s).add(i);if(u&&o&&i.id!=="middle"){const E=T.Angle(o,S),P=uv(E,24)-E;S=T.RotWith(S,o,P)}e.snaps.clearIndicators();let w={...i,x:S.x,y:S.y},b=!1;if(i.canSnap&&i.snapType?sge("canSnap is deprecated. Cannot use both canSnap and snapType together - snapping disabled. Please use only snapType."):b=i.canSnap||i.snapType!==void 0,b&&(a?!d:d)){if(!e.getShapePageTransform(m.id))throw Error("Expected a page transform");const M=l.handles.snapHandle({currentShapeId:t,handle:w});M&&(M.nudge.rot(-e.getShapeParentTransform(m).rotation()),S.add(M.nudge),w={...i,x:S.x,y:S.y})}const v=g.onHandleDrag?.(m,{handle:w,isPrecise:this.isPrecise||h,isCreatingShape:!!this.info.isCreating,initial:p}),C={id:m.id,type:m.type,...v};if(i.type==="vertex"&&this.editor.isShapeOfType(m,"arrow")){const E=zn(e,m)[i.id];E?y?.toId!==E.toId&&(this.pointingId=E.toId,this.isPrecise=f.len()<.5||h,this.isPreciseId=this.isPrecise?E.toId:null,this.resetExactTimeout()):y&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}v&&e.updateShapes([C])}}function $ue(r){return r.isLabel?[r]:r instanceof ts?r.children.filter(e=>e.isLabel):[]}class Yot extends he{static id="editing_shape";hitShapeForPointerUp=null;info={};onEnter(e){const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=e,e.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),za(this.editor),this.editor.select(t)}onExit(){const{editingShapeId:e}=this.editor.getCurrentPageState();e&&(this.editor.setEditingShape(null),za.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(e){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{za(this.editor);return}}}onPointerDown(e){switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{const t=VD(this.editor,!0);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}break}case"shape":{const{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(t).getGeometry(t),s=$ue(i),o=s.length===1?s[0]:void 0,a=this.editor.isShapeOfType(n,"text")&&Gl(this.editor,n.props.richText).trim()==="";if(o&&!a){const l=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(l,0)&&o.hitTestPoint(l)){if(t.id===n.id)return;this.hitShapeForPointerUp=t,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(t.id);return}}else{if(t.id===n.id)this.editor.isShapeOfType(t,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e));else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)}onPointerUp(e){const t=this.hitShapeForPointerUp;if(!t)return;this.hitShapeForPointerUp=null;const n=this.editor.getShapeUtil(t);if(t.isLocked)return;if(this.editor.getIsReadonly()&&!n.canEditInReadonly(t)){this.parent.transition("pointing_shape",e);return}this.editor.select(t.id);const i=this.editor.getEditingShape(),s=i&&i.id!==t.id;this.editor.setEditingShape(t.id);const o=ht.isIos||ht.isAndroid;!o||!s?this.editor.emit("place-caret",{shapeId:t.id,point:e.point}):o&&s&&this.editor.emit("select-all-text",{shapeId:t.id}),za(this.editor)}onComplete(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}onCancel(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}}function CU(r){const e=r.getOnlySelectedShape();return!!(e&&!r.isShapeOrAncestorLocked(e)&&r.getShapeUtil(e).canCrop(e))}function Hk(r,e){const t=r.getSelectedShapeIds(),{currentPagePoint:n}=r.inputs,{shiftKey:i,altKey:s,accelKey:o}=e,a=i||o,l=r.getShapeAtPoint(n,{hitInside:!1,margin:r.options.hitTestMargin/r.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:c=>!c.isLocked});if(l){const c=r.getOutermostSelectableShape(l);if(a&&!s)r.cancelDoubleClick(),t.includes(c.id)?(r.markHistoryStoppingPoint("deselecting shape"),r.deselect(c)):(r.markHistoryStoppingPoint("shift selecting shape"),r.setSelectedShapes([...t,c.id]));else{let u;c===l||c.id===r.getFocusedGroupId()||t.includes(c.id)?u=l:u=c,u&&!t.includes(u.id)&&(r.markHistoryStoppingPoint("selecting shape"),r.select(u.id))}}else{if(a)return;{t.length>0&&(r.markHistoryStoppingPoint("selecting none"),r.selectNone());const c=r.getFocusedGroupId();if(li(c)){const u=r.getShape(c);r.isPointInShape(u,n,{margin:0,hitInside:!0})||r.setFocusedGroup(null)}}}}const Xot=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let Zot=class extends he{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),za(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){za.cancel()}onPointerMove(){za(this.editor)}onPointerDown(e){const t=e.ctrlKey&&CU(this.editor);switch(e.target){case"canvas":{const n=VD(this.editor);if(n&&!n.isLocked){this.onPointerDown({...e,shape:n,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&TU(this.editor,o)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:n}=e;if(this.editor.isShapeOrAncestorLocked(n)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const n=this.editor.getHoveredShape();if(n&&!this.editor.getSelectedShapeIds().includes(n.id)&&!n.isLocked){this.onPointerDown({...e,shape:n,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),i=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){Hk(this.editor,e);return}else{const s=this.editor.getShape(n.parentId);if(s&&this.editor.isShapeOfType(s,"group")&&!(i&&s.id===i)){Hk(this.editor,e);return}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const t=this.editor.getOnlySelectedShape();if(t){const n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const i=n.onDoubleClickEdge?.(t,e);if(i){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([i]),wt(this.editor,[t.id]);return}}if(e.handle==="top_left"||e.handle==="top_right"||e.handle==="bottom_right"||e.handle==="bottom_left"){const i=n.onDoubleClickCorner?.(t,e);if(i){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([i]),wt(this.editor,[t.id]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}break}case"shape":{const{shape:t}=e,n=this.editor.getShapeUtil(t);if(t.type!=="video"&&t.type!=="embed"&&this.editor.getIsReadonly())break;if(n.onDoubleClick){const i=n.onDoubleClick?.(t);if(i){this.editor.updateShapes([i]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)?this.startEditingShape(t,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:t,handle:n}=e,s=this.editor.getShapeUtil(t).onDoubleClickHandle?.(t,n);s?this.editor.updateShapes([s]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&TU(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,i=this.editor.getOutermostSelectableShape(n,s=>!t.includes(s.id));!t.includes(i.id)&&!this.editor.findShapeAncestor(i,s=>t.includes(s.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(e.accelKey){e.shiftKey?e.code==="ArrowDown"?this.editor.selectFirstChildShape():e.code==="ArrowUp"&&this.editor.selectParentShape():this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!1);return}}if(Yt.editOnType.get()&&!Xot.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(e.accelKey){this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!0);break}case"Tab":{this.editor.getSelectedShapes().length&&!e.altKey&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next");break}}}onKeyUp(e){switch(e.key){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}CU(this.editor)&&this.parent.transition("crop",e);break}case"Tab":{this.editor.getSelectedShapes().length&&!e.altKey&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next");break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),Wk(this.editor,e,n),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){return e?hue(this.editor,e):!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=Ct(),{x:n,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:i,props:{richText:ir(""),autoSize:!0}}]);const s=this.editor.getShape(t);if(!s)return;const o=this.editor.getShapeUtil(s);this.editor.getIsReadonly()&&!o.canEditInReadonly(s)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),i=new T(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new T(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:s}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?s*tat:s:n?Qot:eat,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,i.mul(o)),wt(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadonly(e))}};const Qot=10,eat=1,tat=5;function TU(r,e){const t=r.getSelectionRotatedPageBounds();if(!t)return!1;const n=r.getSelectionRotation();return n?hi(e,t.corners.map(i=>T.RotWith(i,t.point,n))):t.containsPoint(e)}class nat extends he{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(e){const{shape:t}=e;typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.didDrag=!1,this.didCtrlOnEnter=e.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===t.id,this.updateCursor();const i=this.editor.getShapeGeometry(t).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);const{currentPagePoint:s}=this.editor.inputs,o=this.editor.getPointInShapeSpace(t,s);if(this._labelDragOffset=T.Sub(i.center,o),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),e.shiftKey||e.accelKey){const l=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...l,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new T(0,0);onPointerMove(){const{isDragging:e}=this.editor.inputs;if(!e)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const t=this.editor.getShape(this.shapeId);if(!t)return;const n=this.editor.getShapeUtil("arrow").options,i=ep(this.editor,t),s=this.editor.getShapePageTransform(t.id),o=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),a=due(this.editor,t);let l=i.uninterpolateAlongEdge(o);isNaN(l)&&(l=a);const c=s.applyToPoint(i.interpolateAlongEdge(l)),u=s.applyToPoint(i.interpolateAlongEdge(a));T.DistMin(c,u,n.labelCenterSnapDistance/this.editor.getZoomLevel())&&(l=a),this.didDrag=!0,this.editor.updateShape({id:t.id,type:t.type,props:{labelPosition:l}})}onPointerUp(){const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e();return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId);const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e();return}this.parent.transition("idle")}}class rat extends he{static id="pointing_canvas";onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){Hk(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}class iat extends he{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(e){this.info=e,this.didCtrlOnEnter=e.accelKey;const{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){const n=zn(this.editor,t),i=n[e.handle.id],s=n[e.handle.id==="start"?"end":"start"],o=this.editor.getShapePageTransform(t.id);i&&iC({editor:this.editor,pointInPageSpace:o.applyToPoint(e.handle),arrow:t,isPrecise:i.props.isPrecise,currentBinding:i,oppositeBinding:s})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:e,handle:t}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:n}=this,i=EU(n,e,t,!1);if(i){Wk(n,i,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(e){const{editor:t}=this;t.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:e}=this;if(e.getIsReadonly())return;const{shape:t,handle:n}=this.info;if(e.isShapeOfType(t,"note")){const i=EU(e,t,n,!0);if(i){const s=e.getPointInParentSpace(i,e.inputs.originPagePoint).sub(T.Rot(dC.clone().mul(t.props.scale),i.rotation));e.updateShape({...i,x:s.x,y:s.y}),e.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{Wk(e,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function EU(r,e,t,n){const i=r.getShapePageTransform(e.id),s=i.point(),o=i.rotation(),l=eue(r,s,o,e.props.growY*e.props.scale,0,e.props.scale)[t.index];if(l)return nue(r,e,l,o,n)}class sat extends he{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:rp[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(e){this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e?.();return}this.parent.transition("idle")}cancel(){const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,{}):e();return}this.parent.transition("idle")}}class oat extends he{static id="pointing_selection";info={};onEnter(e){this.info=e}onPointerUp(e){Hk(this.editor,e),this.parent.transition("idle",e)}onPointerMove(e){this.editor.inputs.isDragging&&this.startTranslating(e)}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||this.parent.transition("translating",e)}onDoubleClick(e){const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(n){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(n)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class aat extends he{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(e){const t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s}}=this.editor,{shiftKey:o,altKey:a,accelKey:l}=e;this.hitShape=e.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=l;const c=this.editor.getOutermostSelectableShape(e.shape),u=this.editor.findShapeAncestor(c,d=>t.includes(d.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(e.shape).onClick||c.id===i||t.includes(c.id)||u||t.length>1&&n?.containsPoint(s)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,o&&!a?(this.editor.cancelDoubleClick(),t.includes(c.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...t,c.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([c.id]))}onPointerUp(e){const t=this.editor.getSelectedShapeIds(),n=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s}}=this.editor,o=e.shiftKey||e.accelKey,a=this.editor.getShapeAtPoint(s,{margin:this.editor.options.hitTestMargin/i,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){const c=this.editor.getShapeUtil(l);if(c.onClick){const u=c.onClick?.(l);if(u){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([u]),this.parent.transition("idle",e);return}}if(l.id===n){t.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const c=this.editor.getOutermostSelectableShape(a,u=>!t.includes(u.id));if(t.includes(c.id))if(o)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(t.includes(l.id)){if(t.length===1){const u=this.editor.getShapeUtil(l).getGeometry(l),d=$ue(u),h=d.length===1?d[0]:void 0;if(h){const f=this.editor.getPointInShapeSpace(l,s);if(h.bounds.containsPoint(f,0)&&h.hitTestPoint(f)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);const p=this.editor.getShapeUtil(l);this.editor.getIsReadonly()&&!p.canEditInReadonly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:l.id}):this.editor.emit("place-caret",{shapeId:l.id,point:e.point}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l);else if(o){const u=this.editor.getShapeAncestors(c);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(d=>!u.find(h=>h.id===d)),c.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([c.id])}this.parent.transition("idle",e)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(e){if(this.editor.inputs.isDragging){if(hue(this.editor,this.hitShape)){this.parent.transition("pointing_arrow_label",{...e,shape:this.hitShape});return}this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startTranslating(e)}}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",e))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class lat extends he{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(e){const{isCreating:t=!1,creatingMarkId:n,creationCursorOffset:i={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=i;try{this.snapshot=this._createSnapshot()}catch(s){console.error(s),this.cancel();return}if(this.markId="",t)if(n)this.markId=n;else{const s=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);s&&(this.markId=s)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");t&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:e}){const{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){const{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:n})=>{const i=this.editor.getShape(n.id);i&&this.editor.getShapeUtil(n).onResizeCancel?.(n,i)}),this.editor.bailToMark(this.markId);const{onInteractionEnd:t}=this.info;if(t){typeof t=="string"?this.editor.setCurrentTool(t,{}):t();return}this.parent.transition("idle")}complete(){if(wt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}const{onInteractionEnd:e}=this.info;if(e)if(typeof e=="string"){if(this.editor.getInstanceState().isToolLocked){this.editor.setCurrentTool(e,{});return}}else{e();return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:n})=>{const s=this.editor.getShapeUtil(n).onResizeStart?.(n);s&&t.push(s)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:n})=>{const i=this.editor.getShape(n.id),o=this.editor.getShapeUtil(n).onResizeEnd?.(n,i);o&&t.push(o)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:i,selectionBounds:s,cursorHandleOffset:o,selectedShapeIds:a,selectionRotation:l,canShapesDeform:c}=this.snapshot;let u=t||!c;if(i.size===1){const E=[...i.values()][0];this.editor.isShapeOfType(E.shape,"text")&&(u=!(this.info.handle==="left"||this.info.handle==="right"))}const d=zt(this.editor.inputs),h=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),f=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!d){const{gridSize:E}=this.editor.getDocumentSettings();h.snapToGrid(E)}const p=this.info.handle,m=MU(p,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!d:d)&&l%kn===0){const{nudge:E}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:T.Sub(h,f),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:MU(p,l),isAspectRatioLocked:u,isResizingFromCenter:e});h.add(E)}const y=T.RotWith(e?s.center:s.getHandlePoint(m),s.point,l),S=T.Sub(h,y).rot(-l),w=T.Sub(f,y).rot(-l),b=T.DivV(S,w);Number.isFinite(b.x)||(b.x=1),Number.isFinite(b.y)||(b.y=1);const v=p==="top"||p==="bottom",C=p==="left"||p==="right";u?C?b.y=Math.abs(b.x):v?b.x=Math.abs(b.y):Math.abs(b.x)>Math.abs(b.y)?b.y=Math.abs(b.x)*(b.y<0?-1:1):b.x=Math.abs(b.y)*(b.x<0?-1:1):(v&&(b.x=1),C&&(b.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:b.x<0,isFlippedY:b.y<0,rotation:l});for(const E of i.keys()){const M=i.get(E);this.editor.resizeShape(E,b,{initialShape:M.shape,initialBounds:M.bounds,initialPageTransform:M.pageTransform,dragHandle:p,mode:a.length===1&&E===a[0]?"resize_bounds":"scale_shape",scaleOrigin:y,isAspectRatioLocked:u,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(d){this.didHoldCommand=!0;for(const{id:E,children:M}of n){if(!M.length)continue;const P=i.get(E).shape,$=this.editor.getShape(E);if(!(P&&$))continue;const A=$.x-P.x,O=$.y-P.y,_=new T(A,O).rot(-P.rotation);if(_.x!==0||_.y!==0)for(const I of M)this.editor.updateShape({id:I.id,type:I.type,x:I.x-_.x,y:I.y-_.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:E}of n)if(E.length)for(const M of E)this.editor.updateShape({id:M.id,type:M.type,x:M.x,y:M.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:i}){const s={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{s.type="nwse-resize",t!==n&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",t!==n&&(s.type="nwse-resize");break}}s.rotation=i,this.editor.setCursor(s)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const{editor:e}=this,t=e.getSelectedShapeIds(),n=e.getSelectionRotation(),{inputs:{originPagePoint:i}}=e,s=e.getSelectionRotatedPageBounds();if(!s)throw Error("Resizing but nothing is selected");const o=T.RotWith(s.getHandlePoint(this.info.handle),s.point,n),a=T.Sub(i,o),l=new Map,c=[],u=h=>{const f=e.getShape(h);if(!f)return!1;const p=e.getShapeUtil(f);if(p.canResize(f)){const m=e.getShapePageTransform(f);l.set(f.id,{shape:f,bounds:e.getShapeGeometry(f).bounds,pageTransform:m,pageRotation:J.Decompose(m).rotation,isAspectRatioLocked:p.isAspectRatioLocked(f)})}if(e.isShapeOfType(f,"frame")&&c.push({id:f.id,children:Re(e.getSortedChildIdsForParent(f).map(m=>e.getShape(m)))}),!p.canResizeChildren(f))return!1};t.forEach(h=>{u(h)!==!1&&e.visitDescendants(h,u)});const d=![...l.values()].some(h=>!lq(h.pageRotation,n)||h.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:s,cursorHandleOffset:a,selectionRotation:n,selectedShapeIds:t,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}}}const pP=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function MU(r,e){e=e%At;const t=Math.round(e/(pt/4)),n=pP.indexOf(r);return pP[(n+t)%pP.length]}const IU=Math.PI/180;class cat extends he{static id="rotating";snapshot={};info={};markId="";onEnter(e){this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const t=cK({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t;const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Ib({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:rp[this.info.handle],rotation:n+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Ib({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:rp[this.info.handle],rotation:e+this.snapshot.initialShapesRotation})}cancel(){const{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:n})=>{const i=this.editor.getShape(n.id);i&&this.editor.getShapeUtil(n).onRotateCancel?.(n,i)}),this.editor.bailToMark(this.markId);const{onInteractionEnd:t}=this.info;if(t){typeof t=="string"?this.editor.setCurrentTool(t,this.info):t();return}this.parent.transition("idle",this.info)}complete(){Ib({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),wt(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id));const{onInteractionEnd:e}=this.info;if(e){typeof e=="string"?this.editor.setCurrentTool(e,this.info):e();return}this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:e}){const{inputs:{shiftKey:t,currentPagePoint:n}}=this.editor,{initialCursorAngle:i,initialShapesRotation:s,initialPageCenter:o}=this.snapshot,a=o.angle(n)-i;let l=s+a;if(t)l=uv(l,24);else if(e&&(l=Math.round(l/IU)*IU,this.editor.getInstanceState().isCoarsePointer)){const c=uv(l,4),u=Eb(l,c);Math.abs(u)<ISe(5)&&(l=c)}return l-s}}class uat extends he{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}updateScribbleSelection(e){const{editor:t}=this,n=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:i,originPagePoint:s,previousPagePoint:o,currentPagePoint:a}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:c}=this;e&&this.pushPointToScribble();const u=n;let d,h,f,p;const m=0;for(let S=0,w=u.length;S<w;S++){if(d=u[S],t.isShapeOfType(d,"group")||l.has(d.id)||t.isShapeOrAncestorLocked(d)||(h=t.getShapeGeometry(d),t.isShapeOfType(d,"frame")&&h.bounds.containsPoint(t.getPointInShapeSpace(d,s))))continue;const b=t.getShapePageTransform(d);if(!h||!b)continue;const v=b.clone().invert();f=v.applyToPoint(o),p=v.applyToPoint(a);const{bounds:C}=h;if(!(C.minX-m>Math.max(f.x,p.x)||C.minY-m>Math.max(f.y,p.y)||C.maxX+m<Math.min(f.x,p.x)||C.maxY+m<Math.min(f.y,p.y))&&h.hitTestLineSegment(f,p,m)){const E=this.editor.getOutermostSelectableShape(d),M=this.editor.getShapeMask(E.id);if(M&&Oq(o,a,M)!==null&&!hi(a,M))continue;l.add(E.id)}}const g=t.getSelectedShapeIds(),y=new Set(i?[...l,...c]:[...l]);(g.length!==y.size||g.some(S=>!y.has(S)))&&this.editor.setSelectedShapes(Array.from(y))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}var dat=Object.create,Rue=Object.defineProperty,hat=Object.getOwnPropertyDescriptor,fat=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Oue=r=>{throw TypeError(r)},Nue=(r,e,t)=>e in r?Rue(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pat=r=>[,,,dat(null)],_ue=["class","method","getter","setter","accessor","field","value","get","set"],Due=r=>r!==void 0&&typeof r!="function"?Oue("Function expected"):r,mat=(r,e,t,n,i)=>({kind:_ue[r],name:e,metadata:n,addInitializer:s=>t._?Oue("Already initialized"):i.push(Due(s||null))}),gat=(r,e)=>Nue(e,fat("metadata"),r[3]),yat=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},xat=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=_ue[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,hat(i,t)),y=n.length-1;y>=0;y--)l=mat(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,Due(o)&&(g[p]=o);return g&&Rue(i,t,g),i},Oa=(r,e,t)=>Nue(r,typeof e!="symbol"?e+"":e,t),Fue,pC;const Sat=320,wat=60;Fue=[Yi];class GD{constructor(e){this.editor=e,yat(pC,5,this),Oa(this,"shapesToActuallyMove",[]),Oa(this,"draggedOverShapeIds",new Set),Oa(this,"initialGroupIds",new Map),Oa(this,"initialParentIds",new Map),Oa(this,"initialIndices",new Map),Oa(this,"initialDraggingOverShape"),Oa(this,"prevDraggingOverShape"),Oa(this,"prevPagePoint",new T),Oa(this,"intervalTimerId",-1),e.disposables.add(this.dispose)}startDraggingShapes(e,t,n){const{editor:i}=this;if(this.intervalTimerId!==-1)return;const s=new Set(e),o=new Set;for(const c of s){const u=i.getShapeParent(c);u&&i.isShapeOfType(u,"group")&&(o.has(u)||o.add(u))}for(const c of o){const u=Re(i.getSortedChildIdsForParent(c).map(d=>i.getShape(d)));s.add(c);for(const d of u)s.delete(d)}this.initialParentIds.clear();for(const c of s){const u=i.getShapeParent(c);u&&this.initialParentIds.set(c.id,u.id),this.initialIndices.set(c.id,c.index);const d=i.findShapeAncestor(c,h=>i.isShapeOfType(h,"group"));d&&this.initialGroupIds.set(c.id,d.id)}const a=i.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(s).filter(c=>!c.isLocked).sort((c,u)=>a.indexOf(c)-a.indexOf(u)),this.initialDraggingOverShape=i.getDraggingOverShape(t,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(t,n);let l=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{l++,!(l%3&&this.editor.inputs.pointerVelocity.len()>.5)&&this.updateDraggingShapes(i.inputs.currentPagePoint,n)},e.length>10?Sat:wat)}dropShapes(e){const{editor:t}=this;this.updateDraggingShapes(t.inputs.currentPagePoint);const n=t.getDraggingOverShape(t.inputs.currentPagePoint,e);n&&t.getShapeUtil(n).onDropShapesOver?.(n,e,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(e,t){const{editor:n}=this,i=Re(this.shapesToActuallyMove.map(a=>n.getShape(a)));if(!i.length)return;const s=n.getDraggingOverShape(e,this.shapesToActuallyMove),o=!this.prevPagePoint.equals(n.inputs.currentPagePoint);this.prevPagePoint.setTo(n.inputs.currentPagePoint),n.run(()=>{if(this.prevDraggingOverShape?.id===s?.id){o&&s&&li(s.id)&&!n.inputs.previousPagePoint.equals(n.inputs.currentPagePoint)&&n.getShapeUtil(s).onDragShapesOver?.(s,i,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices});return}this.prevDraggingOverShape&&n.getShapeUtil(this.prevDraggingOverShape).onDragShapesOut?.(this.editor.getShape(this.prevDraggingOverShape),i,{nextDraggingOverShapeId:s?.id??null,initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),s?(n.getShapeUtil(s).onDragShapesIn?.(s,i,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,prevDraggingOverShapeId:this.prevDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),n.setHintingShapes([s.id])):this.prevDraggingOverShape&&n.setHintingShapes([]),t?.()}),this.prevDraggingOverShape=s}}pC=pat();xat(pC,1,"dispose",Fue,GD);gat(pC,GD);var bat=Object.create,zue=Object.defineProperty,vat=Object.getOwnPropertyDescriptor,Bue=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),jue=r=>{throw TypeError(r)},Lue=(r,e,t)=>e in r?zue(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kat=r=>[,,,bat(r?.[Bue("metadata")]??null)],Uue=["class","method","getter","setter","accessor","field","value","get","set"],Wue=r=>r!==void 0&&typeof r!="function"?jue("Function expected"):r,Cat=(r,e,t,n,i)=>({kind:Uue[r],name:e,metadata:n,addInitializer:s=>t._?jue("Already initialized"):i.push(Wue(s||null))}),Tat=(r,e)=>Lue(e,Bue("metadata"),r[3]),Eat=(r,e,t,n)=>{for(var i=0,s=r[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return n},Mat=(r,e,t,n,i,s)=>{for(var o,a,l,c,u=e&7,d=!1,h=!1,f=2,p=Uue[u+5],m=r[f]||(r[f]=[]),g=(i=i.prototype,vat(i,t)),y=n.length-1;y>=0;y--)l=Cat(u,t,a={},r[3],m),l.static=d,l.private=h,c=l.access={has:S=>t in S},c.get=S=>S[t],o=(0,n[y])(g[p],l),a._=1,Wue(o)&&(g[p]=o);return g&&zue(i,t,g),i},yl=(r,e,t)=>Lue(r,typeof e!="symbol"?e+"":e,t),Hue,tO,mC;class gC extends(tO=he,Hue=[Yi],tO){constructor(){super(...arguments),Eat(mC,5,this),yl(this,"info",{}),yl(this,"selectionSnapshot",{}),yl(this,"snapshot",{}),yl(this,"markId",""),yl(this,"isCloning",!1),yl(this,"isCreating",!1),yl(this,"dragAndDropManager",new GD(this.editor))}onCreate(e){}onEnter(e){const{isCreating:t=!1,creatingMarkId:n,onCreate:i=()=>{}}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,typeof e.onInteractionEnd=="string"&&this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(n)this.markId=n;else{const s=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);s&&(this.markId=s)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=i,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=PU(this.editor),!(!this.isCreating&&this.editor.inputs.altKey&&(this.startCloning(),this.isCloning))&&(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.altKey&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;const e=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(e)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=PU(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),wt(this.editor,this.snapshot.movingShapes.map(t=>t.id));const{onInteractionEnd:e}=this.info;if(e)if(typeof e=="string"){if(this.editor.getInstanceState().isToolLocked){this.editor.setCurrentTool(e);return}}else{e();return}this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){const{movingShapes:e}=this.snapshot;e.forEach(n=>{const i=this.editor.getShape(n.id);i&&this.editor.getShapeUtil(n).onTranslateCancel?.(n,i)}),this.reset();const{onInteractionEnd:t}=this.info;if(t){typeof t=="string"?this.editor.setCurrentTool(t):t();return}this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(n=>{const s=this.editor.getShapeUtil(n).onTranslateStart?.(n);s&&t.push(s)}),t.length>0&&this.editor.updateShapes(t),this.dragAndDropManager.startDraggingShapes(Re(this.snapshot.movingShapes.map(n=>this.editor.getShape(n.id))),this.editor.inputs.originPagePoint,this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const n=T.Average(e.map(s=>this.editor.getShapePageTransform(s.id).point())),i=T.Sub(n,this.selectionSnapshot.averagePagePoint);T.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(s=>s.id),offset:{x:i.x,y:i.y}}})}const t=[];e.forEach(n=>{const i=this.editor.getShape(n.id),o=this.editor.getShapeUtil(n).onTranslateEnd?.(n,i);o&&t.push(o)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.startDraggingShapes(e.movingShapes,this.editor.inputs.originPagePoint,this.updateParentTransforms),Iat({editor:this.editor,snapshot:e});const{movingShapes:t}=e,n=[];t.forEach(i=>{const s=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i).onTranslate?.(i,s);a&&n.push(a)}),n.length>0&&this.editor.updateShapes(n)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(n=>{const i=e.getShape(n.shape.id);if(!i)return null;const s=Gn(i.parentId)?null:J.Inverse(e.getShapePageTransform(i.parentId));n.parentTransform=s})}}mC=kat(tO);Mat(mC,1,"updateParentTransforms",Hue,gC);Tat(mC,gC);yl(gC,"id","translating");function PU(r){const e=[],t=[],n=r.getSelectedShapeIds(),i=Re(n.map(d=>{const h=r.getShape(d);if(!h)return null;e.push(h);const f=r.getShapePageTransform(d),p=f.point(),m=f.rotation();t.push(p);const g=Ci.isId(h.parentId)?null:J.Inverse(r.getShapePageTransform(h.parentId));return{shape:h,pagePoint:p,pageRotation:m,parentTransform:g}})),s=r.getOnlySelectedShape();let o=[];if(s)o=r.snaps.shapeBounds.getSnapPoints(s.id);else{const d=r.getSelectionPageBounds();d&&(o=d.cornersAndCenter.map((h,f)=>({id:"selection:"+f,x:h.x,y:h.y})))}let a,l;const{originPagePoint:c}=r.inputs,u=i.filter(d=>r.isShapeOfType(d.shape,"note")&&r.isPointInShape(d.shape,c));if(u.length!==0)if(u.length===1)l=u[0];else{const d=r.getCurrentPageShapesSorted();l=u.map(h=>({snapshot:h,index:d.findIndex(f=>f.id===h.shape.id)})).sort((h,f)=>f.index-h.index)[0]?.snapshot}return l&&(a=tue(r,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:T.Average(t),movingShapes:e,shapeSnapshots:i,initialPageBounds:r.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:l}}function Iat({editor:r,snapshot:e}){const{inputs:t}=r,{noteSnapshot:n,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:l}=e,c=r.getInstanceState().isGridMode,u=r.getDocumentSettings().gridSize,d=T.Sub(t.currentPagePoint,t.originPagePoint),h=r.inputs.shiftKey?Math.abs(d.x)<Math.abs(d.y)?"x":"y":null;h==="x"?d.x=0:h==="y"&&(d.y=0),r.snaps.clearIndicators();const f=r.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let p=!1;if(f&&r.inputs.pointerVelocity.len()<.5){const{nudge:S}=r.snaps.shapeBounds.snapTranslateShapes({dragDelta:d,initialSelectionPageBounds:s,lockedAxis:h,initialSelectionSnapPoints:o});d.add(S)}else if(n&&i){const{scale:S}=n.shape.props,w=n.pagePoint.clone().add(d).add(dC.clone().mul(S).rot(n.pageRotation));let b=Qce/r.getZoomLevel(),v=new T(0,0);for(const C of i){const E=T.Sub(w,C),M=E.len();M<b&&(p=!0,b=M,v=E)}d.sub(v)}const m=T.Add(l,d),g=r.snaps.getIndicators();c&&!t.ctrlKey&&!p&&g.length===0&&m.snapToGrid(u);const y=T.Sub(m,l);r.updateShapes(Re(a.map(({shape:S,pagePoint:w,parentTransform:b})=>{const v=T.Add(w,y),C=b?J.applyToPoint(b,v):v;return{id:S.id,type:S.type,x:C.x,y:C.y}})))}class Pat extends he{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[Vot,Iue,Zot,rat,aat,gC,Wot,uat,Aue,oat,Hot,Yot,lat,cat,sat,nat,iat,Got]}cleanUpDuplicateProps(){const e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;const n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every(i=>n.has(i))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=Zi("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class Aat extends he{static id="idle";info={};onEnter(e){this.info=e}onPointerDown(){this.parent.transition("pointing",this.info)}}class $at extends he{static id="pointing";info={};onEnter(e){this.info=e}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class Rat extends he{static id="zoom_brushing";info={};zoomBrush=new V;onEnter(e){this.info=e,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(V.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){const n=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(n,{animation:{duration:220}}):this.editor.zoomIn(n,{animation:{duration:220}})}else{const n=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:n,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class Oat extends he{static id="zoom";static initial="idle";static children(){return[Aat,Rat,$at]}static isLockable=!1;info={};onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(e){this.updateCursor(),e.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}const Nat=[_ot,Bot,Uot,Oat,Pat],_at=Be.forwardRef(function({isEditing:e,text:t,handleFocus:n,handleChange:i,handleKeyDown:s,handlePaste:o,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:c},u){const d=z(),h=f=>{i({plaintext:f.target.value})};return x.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!e,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:n,onChange:h,onKeyDown:f=>s(f.nativeEvent),onBlur:a,onTouchEnd:d.markEventAsHandled,onContextMenu:e?f=>f.stopPropagation():void 0,onPointerDown:l,onPaste:o,onDoubleClick:c,onDragStart:Oe})});Be.memo(function({shapeId:e,type:t,text:n,labelColor:i,font:s,fontSize:o,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:d,padding:h=0,onKeyDown:f,classNamePrefix:p,style:m,textWidth:g,textHeight:y}){const{rInput:S,isEmpty:w,isEditing:b,isReadyForEditing:v,...C}=Jit(e,t,n),E=jx.normalizeTextForDom(n||""),M=E.length>0,P=rue(l);if(!b&&!M)return null;const $=p||"tl-text";return x.jsx("div",{className:`${$}-label tl-text-wrapper tl-plain-text-wrapper`,"aria-hidden":!b,"data-font":s,"data-align":l,"data-hastext":!w,"data-isediting":b,"data-is-ready-for-editing":v,"data-textwrap":!!u,"data-isselected":d,style:{justifyContent:l==="middle"||P?"center":l,alignItems:c==="middle"?"center":c,padding:h,...m},children:x.jsxs("div",{className:`${$}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(g||0),color:i,width:g?Math.ceil(g):void 0,height:y?Math.ceil(y):void 0},children:[x.jsx("div",{className:`${$} tl-text tl-text-content`,dir:"auto",children:E.split(`
`).map((A,O)=>x.jsx("div",{dir:"auto",children:A},O))}),(v||d)&&x.jsx(_at,{ref:S,text:n,isEditing:b,shapeId:e,...C,handleKeyDown:f??C.handleKeyDown})]})})});let nO={fonts:{tldraw_mono:`${$n()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${$n()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${$n()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${$n()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${$n()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${$n()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${$n()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${$n()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${$n()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${$n()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${$n()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${$n()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${$n()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${$n()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${$n()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${$n()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};function que(r){return k.useMemo(()=>r?{fonts:{...nO.fonts,...r?.fonts}}:nO,[r])}const Dat=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Vp={...nO,icons:Object.fromEntries(Dat.map(r=>[r,`${$n()}/icons/icon/0_merged.svg#${r}`])),translations:Object.fromEntries($y.map(r=>[r.locale,`${$n()}/translations/${r.locale}.json`])),embedIcons:Object.fromEntries(s_.map(r=>[r.type,`${$n()}/embed-icons/${r.type}.png`]))};function Kue(r){return k.useMemo(()=>r?{fonts:Object.assign({...Vp.fonts},{...r?.fonts}),icons:Object.assign({...Vp.icons},{...r?.icons}),embedIcons:Object.assign({...Vp.embedIcons},{...r?.embedIcons}),translations:Object.assign({...Vp.translations},{...r?.translations})}:Vp,[r])}const Fat=In(function({overrides:e,components:t,assetUrls:n,onUiEvent:i,forceMobile:s,mediaMimeTypes:o,children:a}){const l=Sn();return x.jsx(zY.Provider,{value:o,children:x.jsx(DMe,{children:x.jsx(SY,{assetUrls:Kue(n),children:x.jsx(wY,{overrides:jY(e),locale:l?.user.getLocale()??Wi.locale,children:x.jsx(IMe,{onEvent:i,children:x.jsx(WMe,{children:x.jsx(UMe,{context:"tla",children:x.jsx(nMe,{children:x.jsx(TMe,{forceMobile:s,children:x.jsx(V2e,{overrides:t,children:x.jsx(zat,{overrides:e,children:a})})})})})})})})})})})});function zat({overrides:r,children:e}){const t=gIe(r);return x.jsx(Y2e,{overrides:t.actions,children:x.jsx(yIe,{overrides:t.tools,children:e})})}function Bat(){const r=z(),{addToast:e}=Xa();k.useEffect(()=>{function t({name:n,count:i}){e({title:"Maximum shapes reached",description:`You've reached the maximum number of shapes allowed on ${n} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return r.addListener("max-shapes",t),()=>{r.removeListener("max-shapes",t)}},[r,e])}const jat=Be.memo(function({renderDebugMenuItems:e,children:t,hideUi:n,components:i,...s}){return x.jsx(Fat,{...s,components:i,children:x.jsx(Lat,{hideUi:n,renderDebugMenuItems:e,children:t})})}),Lat=Be.memo(function({children:e,hideUi:t,...n}){return x.jsxs(x.Fragment,{children:[e,t?null:x.jsx(Uat,{...n})]})}),Uat=Be.memo(function(){const e=z(),t=ie(),n=Jn(),i=Ss(),s=F("focus",()=>e.getInstanceState().isFocusMode,[e]),o=F("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:u,Toolbar:d,HelpMenu:h,NavigationPanel:f,HelperButtons:p,DebugPanel:m,Toasts:g,Dialogs:y,A11y:S}=Sa();R2e(),oIe(),Bat();const w=k.useRef(!1),b=k.useRef(-1),[v,C]=k.useState(!1);tN("update hide toolbar while delayed",()=>{if(!(ht.isIos||ht.isAndroid))return;if(e.getEditingShapeId()===null){w.current&&(w.current=!1,clearTimeout(b.current),ht.isAndroid?b.current=e.timers.setTimeout(()=>{C(!1)},150):C(!1));return}w.current||(w.current=!0,clearTimeout(b.current),C(!0))},[]);const{"toggle-focus-mode":E}=wa(),{breakpointsAbove:M,breakpointsBelow:P}=k.useMemo(()=>{const $=[],A=[];for(let O=0;O<Db.length;O++)O<=n?$.push(O):A.push(O);return{breakpointsAbove:$,breakpointsBelow:A}},[n]);return x.jsxs("div",{className:oe("tlui-layout",{"tlui-layout__mobile":n<an.TABLET_SM}),"data-iseditinganything":v,"data-breakpoint":n,"data-breakpoints-above":M.join(" "),"data-breakpoints-below":P.join(" "),children:[x.jsx(aMe,{}),s?x.jsx("div",{className:"tlui-layout__top",children:x.jsx(et,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>E.onSelect("menu"),children:x.jsx(be,{icon:"dot"})})}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"tlui-layout__top",children:[x.jsxs("div",{className:"tlui-layout__top__left",children:[c&&x.jsx(c,{}),p&&x.jsx(p,{})]}),x.jsx("div",{className:"tlui-layout__top__center",children:l&&x.jsx(l,{})}),x.jsxs("div",{className:"tlui-layout__top__right",children:[a&&x.jsx(a,{}),u&&n>=an.TABLET_SM&&!i&&x.jsx(u,{})]})]}),x.jsxs("div",{className:"tlui-layout__bottom",children:[x.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&x.jsx(f,{}),d&&x.jsx(d,{}),h&&x.jsx(h,{})]}),o&&m&&x.jsx(m,{}),S&&x.jsx(S,{})]})]}),g&&x.jsx(g,{}),y&&x.jsx(y,{})]})});function AU(){const{RichTextToolbar:r,ImageToolbar:e,VideoToolbar:t,CursorChatBubble:n,FollowingIndicator:i}=Sa();return x.jsxs(x.Fragment,{children:[r&&x.jsx(r,{}),e&&x.jsx(e,{}),t&&x.jsx(t,{}),i&&x.jsx(i,{}),n&&x.jsx(n,{})]})}const Wat=()=>{const{Spinner:r}=Tt();return x.jsx(GV,{children:r?x.jsx(r,{}):null})},Hat=[...Nat,...Hit];function qat(r){const{children:e,maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:o,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:u=[],embeds:d,textOptions:h,...f}=r,p=hp(a),m=a?.InFrontOfTheCanvas,g=k.useMemo(()=>f.hideUi?m??null:m?()=>x.jsxs(x.Fragment,{children:[x.jsx(AU,{}),x.jsx(m,{})]}):AU,[f.hideUi,m]),y=k.useMemo(()=>({Scribble:v5,ShapeIndicators:jDe,CollaboratorScribble:v5,SelectionForeground:FDe,Handles:MDe,Overlays:$De,Spinner:$Y,LoadingScreen:Wat,...p,InFrontOfTheCanvas:g}),[p,g]),S=bl(l),w=k.useMemo(()=>Ug("type",S,Mue),[S]),b=bl(c),v=k.useMemo(()=>Ug("type",b,eee),[b]),C=bl(u),E=k.useMemo(()=>Ug("id",C,Hat),[C]),M=bl(i??ap),P=bl(s??r1),$=k.useMemo(()=>({addFontsFromNode:Hce,...h,tipTapConfig:{extensions:AS,...h?.tipTapConfig}}),[h]),A=k.useMemo(()=>[...M,...P],[M,P]),O=que(f.assetUrls);return w.find(I=>I.type==="embed")&&d&&Ef.setEmbedDefinitions(d),x.jsx(SY,{assetUrls:Kue(f.assetUrls),children:x.jsx(wY,{overrides:jY(f.overrides),locale:f.user?.userPreferences.get().locale??Wi.locale,children:x.jsx(eke,{initialState:"select",...f,components:y,shapeUtils:w,bindingUtils:v,tools:E,textOptions:$,assetUrls:O,children:x.jsxs(jat,{...f,components:y,mediaMimeTypes:A,children:[x.jsx(Kat,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:M,acceptedVideoMimeTypes:P,onMount:o}),e]})})})})}function Kat({maxImageDimension:r,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:n,onMount:i}){const s=z(),o=Xa(),a=ie(),l=ln();YV(()=>{const d=[];return d.push($ot(s)),s.fonts.requestFonts(Krt),s.once("edit",()=>l("edit",{source:"unknown"})),ait(s,{maxImageDimension:r,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:n,toasts:o,msg:a}),d.push(s.store.props.onMount(s)),d.push(i?.(s)),()=>{d.forEach(h=>h?.())}});const{Canvas:c}=Tt(),{ContextMenu:u}=Sa();return u?x.jsx(u,{}):c?x.jsx(c,{}):null}const Jat={tipTapConfig:{extensions:AS},addFontsFromNode:Hce};k.memo(function(e){const[t,n]=k.useState(null),[i,s]=k.useState(null),o=bl(e.shapeUtils??[]),a=k.useMemo(()=>Ug("type",o,Mue),[o]),l=bl(e.bindingUtils??[]),c=k.useMemo(()=>Ug("type",l,eee),[l]),u=sCe({snapshot:e.snapshot,shapeUtils:a}),{pageId:d,bounds:h,scale:f,pixelRatio:p,background:m,padding:g,darkMode:y,preserveAspectRatio:S,format:w="svg",licenseKey:b,assetUrls:v,textOptions:C=Jat}=e,E=que(v);return k.useLayoutEffect(()=>{if(!i||!u)return;let M=!1;const P=document.createElement("div");i.appendChild(P),i.classList.add("tl-container","tl-theme__light");const $=new ee({store:u,shapeUtils:a,bindingUtils:c,tools:[],getContainer:()=>P,licenseKey:b,fontAssetUrls:E.fonts,textOptions:C});d&&$.setCurrentPage(d);const A=$.getCurrentPageShapeIds();async function O(){await $.fonts.loadRequiredFontsForCurrentPage($.options.maxFontsToLoadBeforeRender);const _=await $.toImage([...A],{bounds:h,scale:f,background:m,padding:g,darkMode:y,preserveAspectRatio:S,format:w});if(!_||M)return;const I=URL.createObjectURL(_.blob);n(I),$.dispose()}return O(),()=>{M=!0}},[w,i,u,a,c,d,h,f,m,g,y,S,b,p,E,C]),k.useEffect(()=>()=>{t&&URL.revokeObjectURL(t)},[t]),x.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&x.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})});k.memo(function({children:e}){const t=ie(),n=Jn(),i=k.useRef(null);ya(i);const s=e??x.jsx(FPe,{});return n<an.MOBILE?null:x.jsx("div",{ref:i,className:"tlui-help-menu",children:x.jsxs(L1,{id:"help menu",children:[x.jsx(U1,{children:x.jsx(et,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:x.jsx(be,{icon:"question-mark",small:!0})})}),x.jsx(W1,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:x.jsx(Ni,{type:"menu",sourceId:"help-menu",children:s})})]})})});const Vat=st({schemaVersion:yr(1),storeVersion:Tb,recordVersions:rv(Ze,st({version:Tb,subTypeVersions:rv(Ze,Tb).optional(),subTypeKey:Ze.optional()}))}),Gat=st({schemaVersion:yr(2),sequences:rv(Ze,Tb)});st({tldrawFileFormatVersion:axe,schema:lxe("schemaVersion",{1:Vat,2:Gat}),records:Bn(st({id:Ze,typeName:Ze}).allowUnknownProperties())});ec("tldraw","4.2.1","esm");function bht(){const{currentNote:r,updateCurrentNoteContent:e}=Zde(),t=k.useRef(null),n=k.useCallback(i=>{if(console.log("Tldraw editor mounted"),r?.content)try{const o=JSON.parse(r.content);i.loadSnapshot(o),console.log("Loaded snapshot from backend")}catch(o){console.error("Failed to parse backend content",o)}return i.store.listen(()=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{const o=i.store.getSnapshot(),a=JSON.stringify(o);e(a)},500)},{source:"user"})},[r?.id]);return r?x.jsx("div",{style:{height:"100%"},children:x.jsx(qat,{persistenceKey:`note-${r.id}`,onMount:n})}):null}export{bht as default};
